{"version":3,"file":"verbum.cjs.production.min.js","sources":["../src/nodes/EmojiNode.tsx","../src/nodes/ImageNode.tsx","../src/nodes/KeywordNode.ts","../src/nodes/MentionNode.ts","../node_modules/style-inject/dist/style-inject.es.js","../src/utils/join-classes.ts","../src/ui/Button.tsx","../src/nodes/PollNode.tsx","../src/shared/src/canUseDOM.ts","../src/shared/src/useLayoutEffect.ts","../src/collaboration.ts","../src/context/SharedHistoryContext.tsx","../src/themes/PlaygroundEditorTheme.ts","../src/themes/StickyEditorTheme.ts","../src/ui/ContentEditable.tsx","../src/ui/Placeholder.tsx","../src/nodes/StickyNode.tsx","../src/nodes/TypeaheadNode.ts","../src/nodes/YouTubeNode.tsx","../src/nodes/PlaygroundNodes.ts","../src/locale/index.tsx","../src/appSettings.ts","../src/context/SettingsContext.tsx","../src/ui/Modal.tsx","../src/hooks/useModal.tsx","../src/plugins/MarkdownTransformers.ts","../src/hooks/useReport.ts","../src/plugins/SpeechToTextPlugin.ts","../src/plugins/ActionsPlugin.tsx","../src/plugins/AutoLinkPlugin.tsx","../src/plugins/CommentPlugin.tsx","../src/plugins/CharacterStylesPopupPlugin.tsx","../src/plugins/ClickableLinkPlugin.ts","../src/plugins/CodeHighlightPlugin.ts","../src/plugins/KeywordsPlugin.ts","../src/plugins/ListMaxIndentLevelPlugin.ts","../src/plugins/MarkdownShortcutPlugin.tsx","../src/plugins/TabFocusPlugin.tsx","../src/context/EditorContext.tsx","../src/ui/Dialog.tsx","../src/ui/FileInput.tsx","../src/ui/TextInput.tsx","../src/plugins/ImagesPlugin.tsx","../src/plugins/DragDropPastePlugin.tsx","../src/utils/node.util.ts","../src/context/ToolbarContext.tsx","../src/ui/DropDown.tsx","../src/plugins/ToolbarPlugin/components/AlignDropdown.tsx","../src/plugins/PollPlugin.ts","../src/plugins/YouTubePlugin.ts","../src/plugins/TableCellResizer.tsx","../src/plugins/TableActionMenuPlugin.tsx","../src/plugins/HorizontalRulePlugin.ts","../src/plugins/ToolbarPlugin/components/InsertDropdown.tsx","../src/shared/src/environment.ts","../src/plugins/ToolbarPlugin/components/UndoButton.tsx","../src/plugins/ToolbarPlugin/components/RedoButton.tsx","../src/ui/Select.tsx","../src/plugins/ToolbarPlugin/components/CodeLanguageDropdown.tsx","../src/plugins/ToolbarPlugin/components/BlockFormatDropdown.tsx","../src/ui/Divider.tsx","../src/plugins/ToolbarPlugin/ToolbarPlugin.tsx","../src/plugins/MentionsPlugin.tsx","../src/ui/ColorPicker.tsx","../src/ui/LinkPreview.tsx","../src/plugins/ToolbarPlugin/components/FloatingLinkEditor.tsx","../src/plugins/ToolbarPlugin/components/FontFamilyDropdown.tsx","../src/plugins/ToolbarPlugin/components/FontSizeDropdown.tsx","../src/nodes/ImageComponent.tsx","../src/plugins/ToolbarPlugin/components/BackgroundColorPicker.tsx","../src/plugins/ToolbarPlugin/components/BoldButton.tsx","../src/plugins/ToolbarPlugin/components/CodeFormatButton.tsx","../src/Editor.tsx","../src/EditorComposer.tsx","../src/plugins/ToolbarPlugin/components/InsertLinkButton.tsx","../src/plugins/ToolbarPlugin/components/ItalicButton.tsx","../src/plugins/ToolbarPlugin/components/TextColorPicker.tsx","../src/plugins/ToolbarPlugin/components/TextFormatDropdown.tsx","../src/plugins/ToolbarPlugin/components/UnderlineButton.tsx"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport React from 'react';\n\nimport type { EditorConfig, LexicalNode, NodeKey } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedEmojiNode = Spread<\n  {\n    className: string;\n    type: 'emoji';\n  },\n  typeof SerializedTextNode\n>;\n\nlet __className: string = 'EmojiNode';\nexport class EmojiNode extends TextNode {\n  static getType(): string {\n    return 'emoji';\n  }\n\n  static clone(node: EmojiNode): EmojiNode {\n    return new EmojiNode(__className, node.__text, node.__key);\n  }\n\n  constructor(className: string, text: string, key?: NodeKey) {\n    super(text, key);\n    __className = className;\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = document.createElement('span');\n    const inner = super.createDOM(config);\n    dom.className = __className;\n    inner.className = 'emoji-inner';\n    dom.appendChild(inner);\n    return dom;\n  }\n\n  updateDOM(\n    prevNode: TextNode,\n    dom: HTMLElement,\n    config: EditorConfig\n  ): boolean {\n    const inner = dom.firstChild;\n    if (inner === null) {\n      return true;\n    }\n    super.updateDOM(prevNode, inner as HTMLElement, config);\n    return false;\n  }\n\n  static importJSON(serializedNode: SerializedEmojiNode): EmojiNode {\n    const node = $createEmojiNode(\n      serializedNode.className,\n      serializedNode.text\n    );\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedEmojiNode {\n    return {\n      ...super.exportJSON(),\n      className: this.getClassName(),\n      type: 'emoji',\n    };\n  }\n\n  getClassName(): string {\n    const self = this.getLatest();\n    return self.__className;\n  }\n}\n\nexport function $isEmojiNode(\n  node: LexicalNode | null | undefined\n): node is EmojiNode {\n  return node instanceof EmojiNode;\n}\n\nexport function $createEmojiNode(\n  className: string,\n  emojiText: string\n): EmojiNode {\n  return new EmojiNode(className, emojiText).setMode('token');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedEditor,\n  SerializedLexicalNode,\n  Spread,\n} from 'lexical';\n\nimport { $applyNodeReplacement, createEditor, DecoratorNode } from 'lexical';\nimport * as React from 'react';\nimport { Suspense } from 'react';\n\nconst ImageComponent = React.lazy(\n  // @ts-ignore\n  () => import('./ImageComponent')\n);\n\nexport interface ImagePayload {\n  altText: string;\n  caption?: LexicalEditor;\n  height?: number;\n  key?: NodeKey;\n  maxWidth?: number;\n  showCaption?: boolean;\n  src: string;\n  width?: number;\n  captionsEnabled?: boolean;\n}\n\nfunction convertImageElement(domNode: Node): null | DOMConversionOutput {\n  if (domNode instanceof HTMLImageElement) {\n    const { alt: altText, src, width, height } = domNode;\n    const node = $createImageNode({ altText, height, src, width });\n    return { node };\n  }\n  return null;\n}\n\nexport type SerializedImageNode = Spread<\n  {\n    altText: string;\n    caption: SerializedEditor;\n    height?: number;\n    maxWidth: number;\n    showCaption: boolean;\n    src: string;\n    width?: number;\n  },\n  SerializedLexicalNode\n>;\n\nexport class ImageNode extends DecoratorNode<JSX.Element> {\n  __src: string;\n  __altText: string;\n  __width: 'inherit' | number;\n  __height: 'inherit' | number;\n  __maxWidth: number;\n  __showCaption: boolean;\n  __caption: LexicalEditor;\n  // Captions cannot yet be used within editor cells\n  __captionsEnabled: boolean;\n\n  static getType(): string {\n    return 'image';\n  }\n\n  static clone(node: ImageNode): ImageNode {\n    return new ImageNode(\n      node.__src,\n      node.__altText,\n      node.__maxWidth,\n      node.__width,\n      node.__height,\n      node.__showCaption,\n      node.__caption,\n      node.__captionsEnabled,\n      node.__key\n    );\n  }\n\n  static importJSON(serializedNode: SerializedImageNode): ImageNode {\n    const { altText, height, width, maxWidth, caption, src, showCaption } =\n      serializedNode;\n    const node = $createImageNode({\n      altText,\n      height,\n      maxWidth,\n      showCaption,\n      src,\n      width,\n    });\n    const nestedEditor = node.__caption;\n    const editorState = nestedEditor.parseEditorState(caption.editorState);\n    if (!editorState.isEmpty()) {\n      nestedEditor.setEditorState(editorState);\n    }\n    return node;\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('img');\n    element.setAttribute('src', this.__src);\n    element.setAttribute('alt', this.__altText);\n    element.setAttribute('width', this.__width.toString());\n    element.setAttribute('height', this.__height.toString());\n    return { element };\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      img: (node: Node) => ({\n        conversion: convertImageElement,\n        priority: 0,\n      }),\n    };\n  }\n\n  constructor(\n    src: string,\n    altText: string,\n    maxWidth: number,\n    width?: 'inherit' | number,\n    height?: 'inherit' | number,\n    showCaption?: boolean,\n    caption?: LexicalEditor,\n    captionsEnabled?: boolean,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__src = src;\n    this.__altText = altText;\n    this.__maxWidth = maxWidth;\n    this.__width = width || 'inherit';\n    this.__height = height || 'inherit';\n    this.__showCaption = showCaption || false;\n    this.__caption = caption || createEditor();\n    this.__captionsEnabled = captionsEnabled || captionsEnabled === undefined;\n  }\n\n  exportJSON(): SerializedImageNode {\n    return {\n      altText: this.getAltText(),\n      caption: this.__caption.toJSON(),\n      height: this.__height === 'inherit' ? 0 : this.__height,\n      maxWidth: this.__maxWidth,\n      showCaption: this.__showCaption,\n      src: this.getSrc(),\n      type: 'image',\n      version: 1,\n      width: this.__width === 'inherit' ? 0 : this.__width,\n    };\n  }\n\n  setWidthAndHeight(\n    width: 'inherit' | number,\n    height: 'inherit' | number\n  ): void {\n    const writable = this.getWritable();\n    writable.__width = width;\n    writable.__height = height;\n  }\n\n  setShowCaption(showCaption: boolean): void {\n    const writable = this.getWritable();\n    writable.__showCaption = showCaption;\n  }\n\n  // View\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const span = document.createElement('span');\n    const theme = config.theme;\n    const className = theme.image;\n    if (className !== undefined) {\n      span.className = className;\n    }\n    return span;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getSrc(): string {\n    return this.__src;\n  }\n\n  getAltText(): string {\n    return this.__altText;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <Suspense fallback={null}>\n        <ImageComponent\n          src={this.__src}\n          altText={this.__altText}\n          width={this.__width}\n          height={this.__height}\n          maxWidth={this.__maxWidth}\n          nodeKey={this.getKey()}\n          showCaption={this.__showCaption}\n          caption={this.__caption}\n          captionsEnabled={this.__captionsEnabled}\n          resizable={true}\n        />\n      </Suspense>\n    );\n  }\n}\n\nexport function $createImageNode({\n  altText,\n  height,\n  maxWidth = 500,\n  captionsEnabled,\n  src,\n  width,\n  showCaption,\n  caption,\n  key,\n}: ImagePayload): ImageNode {\n  return $applyNodeReplacement(\n    new ImageNode(\n      src,\n      altText,\n      maxWidth,\n      width,\n      height,\n      showCaption,\n      caption,\n      captionsEnabled,\n      key\n    )\n  );\n}\n\nexport function $isImageNode(\n  node: LexicalNode | null | undefined\n): node is ImageNode {\n  return node instanceof ImageNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig, LexicalNode } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedKeywordNode = Spread<\n  {\n    type: 'keyword';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nexport class KeywordNode extends TextNode {\n  static getType(): string {\n    return 'keyword';\n  }\n\n  static clone(node: KeywordNode): KeywordNode {\n    return new KeywordNode(node.__text, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedKeywordNode): KeywordNode {\n    const node = $createKeywordNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedKeywordNode {\n    return {\n      ...super.exportJSON(),\n      type: 'keyword',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cursor = 'default';\n    dom.className = 'keyword';\n    return dom;\n  }\n\n  canInsertTextBefore(): boolean {\n    return false;\n  }\n\n  canInsertTextAfter(): boolean {\n    return false;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createKeywordNode(keyword: string): KeywordNode {\n  return new KeywordNode(keyword);\n}\n\nexport function $isKeywordNode(\n  node: LexicalNode | null | undefined | undefined\n): boolean {\n  return node instanceof KeywordNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig, LexicalNode, NodeKey } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedMentionNode = Spread<\n  {\n    mentionName: string;\n    type: 'mention';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nconst mentionStyle = 'background-color: rgba(24, 119, 232, 0.2)';\nexport class MentionNode extends TextNode {\n  __mention: string;\n\n  static getType(): string {\n    return 'mention';\n  }\n\n  static clone(node: MentionNode): MentionNode {\n    return new MentionNode(node.__mention, node.__text, node.__key);\n  }\n  static importJSON(serializedNode: SerializedMentionNode): MentionNode {\n    const node = $createMentionNode(serializedNode.mentionName);\n    node.setTextContent(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  constructor(mentionName: string, text?: string, key?: NodeKey) {\n    super(text ?? mentionName, key);\n    this.__mention = mentionName;\n  }\n\n  exportJSON(): SerializedMentionNode {\n    return {\n      ...super.exportJSON(),\n      mentionName: this.__mention,\n      type: 'mention',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = mentionStyle;\n    dom.className = 'mention';\n    return dom;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createMentionNode(mentionName: string): MentionNode {\n  const mentionNode = new MentionNode(mentionName);\n  mentionNode.setMode('segmented').toggleDirectionless();\n  return mentionNode;\n}\n\nexport function $isMentionNode(\n  node: LexicalNode | null | undefined\n): node is MentionNode {\n  return node instanceof MentionNode;\n}\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport default function joinClasses(...args) {\n  return args.filter(Boolean).join(' ');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Button.css';\n\nimport * as React from 'react';\n\nimport joinClasses from '../utils/join-classes';\n\nexport default function Button({\n  'data-test-id': dataTestId,\n  children,\n  className,\n  onClick,\n  disabled,\n  small,\n  title,\n}: {\n  'data-test-id'?: string;\n  children: JSX.Element | string | (JSX.Element | string)[];\n  className?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  small?: boolean;\n  title?: string;\n}): JSX.Element {\n  return (\n    <button\n      disabled={disabled}\n      className={joinClasses(\n        'Button__root',\n        disabled && 'Button__disabled',\n        small && 'Button__small',\n        className\n      )}\n      onClick={onClick}\n      title={title}\n      aria-label={title}\n      {...(dataTestId && { 'data-test-id': dataTestId })}\n    >\n      {children}\n    </button>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './PollNode.css';\n\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getNodeByKey, DecoratorNode } from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useMemo, useRef } from 'react';\n\nimport Button from '../ui/Button';\nimport joinClasses from '../utils/join-classes';\n\ntype Options = ReadonlyArray<Option>;\n\ntype Option = Readonly<{\n  text: string;\n  uid: string;\n  votes: Array<number>;\n}>;\n\nfunction createUID(): string {\n  return Math.random()\n    .toString(36)\n    .replace(/[^a-z]+/g, '')\n    .substr(0, 5);\n}\n\nfunction createPollOption(text = ''): Option {\n  return {\n    text,\n    uid: createUID(),\n    votes: [],\n  };\n}\n\nfunction cloneOption(\n  option: Option,\n  text: string,\n  votes?: Array<number>\n): Option {\n  return {\n    text,\n    uid: option.uid,\n    votes: votes || Array.from(option.votes),\n  };\n}\n\nfunction getTotalVotes(options: Options): number {\n  return options.reduce((totalVotes, next) => {\n    return totalVotes + next.votes.length;\n  }, 0);\n}\n\nfunction PollOptionComponent({\n  option,\n  index,\n  options,\n  totalVotes,\n  withPollNode,\n}: {\n  index: number;\n  option: Option;\n  options: Options;\n  totalVotes: number;\n  withPollNode: (cb: (PollNode) => void) => void;\n}): JSX.Element {\n  const { clientID } = useCollaborationContext();\n  const checkboxRef = useRef(null);\n  const votesArray = option.votes;\n  const checkedIndex = votesArray.indexOf(clientID);\n  const checked = checkedIndex !== -1;\n  const votes = votesArray.length;\n  const text = option.text;\n\n  return (\n    <div className=\"PollNode__optionContainer\">\n      <div\n        className={joinClasses(\n          'PollNode__optionCheckboxWrapper',\n          checked && 'PollNode__optionCheckboxChecked'\n        )}\n      >\n        <input\n          ref={checkboxRef}\n          className=\"PollNode__optionCheckbox\"\n          type=\"checkbox\"\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.toggleVote(option, clientID);\n            });\n          }}\n          checked={checked}\n        />\n      </div>\n      <div className=\"PollNode__optionInputWrapper\">\n        <div\n          className=\"PollNode__optionInputVotes\"\n          style={{ width: `${votes === 0 ? 0 : (votes / totalVotes) * 100}%` }}\n        />\n        <span className=\"PollNode__optionInputVotesCount\">\n          {votes > 0 && (votes === 1 ? '1 vote' : `${votes} votes`)}\n        </span>\n        <input\n          className=\"PollNode__optionInput\"\n          type=\"text\"\n          value={text}\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.setOptionText(option, e.target.value);\n            });\n          }}\n          placeholder={`Option ${index + 1}`}\n        />\n      </div>\n      <button\n        disabled={options.length < 3}\n        className={joinClasses(\n          'PollNode__optionDelete',\n          options.length < 3 && 'PollNode__optionDeleteDisabled'\n        )}\n        arial-label=\"Remove\"\n        onClick={() => {\n          withPollNode((node) => {\n            node.deleteOption(option);\n          });\n        }}\n      />\n    </div>\n  );\n}\n\nfunction PollComponent({\n  question,\n  options,\n  nodeKey,\n}: {\n  nodeKey: NodeKey;\n  options: Options;\n  question: string;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const totalVotes = useMemo(() => getTotalVotes(options), [options]);\n\n  const withPollNode = (cb: (node: PollNode) => void): void => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isPollNode(node)) {\n        cb(node);\n      }\n    });\n  };\n\n  const addOption = () => {\n    withPollNode((node) => {\n      node.addOption(createPollOption());\n    });\n  };\n\n  return (\n    <div className=\"PollNode__container\">\n      <h2 className=\"PollNode__heading\">{question}</h2>\n      {options.map((option, index) => {\n        const key = option.uid;\n        return (\n          <PollOptionComponent\n            key={key}\n            withPollNode={withPollNode}\n            option={option}\n            index={index}\n            options={options}\n            totalVotes={totalVotes}\n          />\n        );\n      })}\n      <div className=\"PollNode__footer\">\n        <Button onClick={addOption} small={true}>\n          Add Option\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport type SerializedPollNode = Spread<\n  {\n    question: string;\n    options: Options;\n    type: 'poll';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nfunction convertPollElement(domNode: HTMLElement): DOMConversionOutput {\n  const question = domNode.getAttribute('data-lexical-poll-question');\n  const node = $createPollNode(question);\n  return { node };\n}\n\nexport class PollNode extends DecoratorNode<JSX.Element> {\n  __question: string;\n  __options: Options;\n\n  static getType(): string {\n    return 'poll';\n  }\n\n  static clone(node: PollNode): PollNode {\n    return new PollNode(node.__question, node.__options, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedPollNode): PollNode {\n    const node = $createPollNode(serializedNode.question);\n    serializedNode.options.forEach(node.addOption);\n    return node;\n  }\n\n  constructor(question: string, options?: Options, key?: NodeKey) {\n    super(key);\n    this.__question = question;\n    this.__options = options || [createPollOption(), createPollOption()];\n  }\n\n  exportJSON(): SerializedPollNode {\n    return {\n      options: this.__options,\n      question: this.__question,\n      type: 'poll',\n      version: 1,\n    };\n  }\n\n  addOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    options.push(option);\n    self.__options = options;\n  }\n\n  deleteOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options.splice(index, 1);\n    self.__options = options;\n  }\n\n  setOptionText(option: Option, text: string): void {\n    const self = this.getWritable();\n    const clonedOption = cloneOption(option, text);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  toggleVote(option: Option, clientID: number): void {\n    const self = this.getWritable();\n    const votes = option.votes;\n    const votesClone = Array.from(votes);\n    const voteIndex = votes.indexOf(clientID);\n    if (voteIndex === -1) {\n      votesClone.push(clientID);\n    } else {\n      votesClone.splice(voteIndex, 1);\n    }\n    const clonedOption = cloneOption(option, option.text, votesClone);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      span: (domNode: HTMLElement) => {\n        if (!domNode.hasAttribute('data-lexical-poll-question')) {\n          return null;\n        }\n        return {\n          conversion: convertPollElement,\n          priority: 2,\n        };\n      },\n    };\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('span');\n    element.setAttribute('data-lexical-poll-question', this.__question);\n    return { element };\n  }\n\n  createDOM(): HTMLElement {\n    const elem = document.createElement('span');\n    elem.style.display = 'inline-block';\n    return elem;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <PollComponent\n        question={this.__question}\n        options={this.__options}\n        nodeKey={this.__key}\n      />\n    );\n  }\n}\n\nexport function $createPollNode(question: string): PollNode {\n  return new PollNode(question);\n}\n\nexport function $isPollNode(\n  node: LexicalNode | null | undefined\n): node is PollNode {\n  return node instanceof PollNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nimport { useEffect, useLayoutEffect } from 'react';\nimport { CAN_USE_DOM } from './canUseDOM';\n\nconst useLayoutEffectImpl: typeof useLayoutEffect = CAN_USE_DOM\n  ? useLayoutEffect\n  : useEffect;\n\nexport default useLayoutEffectImpl;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {Provider} from '@lexical/yjs';\nimport { WebsocketProvider } from 'y-websocket';\nimport { Doc } from 'yjs';\n\nconst url = new URL(window.location.href);\nconst params = new URLSearchParams(url.search);\nconst WEBSOCKET_ENDPOINT = 'ws://localhost:1234';\nconst WEBSOCKET_SLUG = 'playground';\nconst WEBSOCKET_ID = params.get('collabId') || '0';\n\n// parent dom -> child doc\nexport function createWebsocketProvider(\n  id: string,\n  yjsDocMap: Map<string, Doc>\n): Provider {\n  let doc = yjsDocMap.get(id);\n\n  if (doc === undefined) {\n    doc = new Doc();\n    yjsDocMap.set(id, doc);\n  } else {\n    doc.load();\n  }\n\n  \n  // @ts-ignore\n  return new WebsocketProvider(\n    WEBSOCKET_ENDPOINT,\n    WEBSOCKET_SLUG + '/' + WEBSOCKET_ID + '/' + id,\n    doc,\n    {\n      connect: false,\n    }\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { HistoryState } from '@lexical/react/LexicalHistoryPlugin';\n\nimport { createEmptyHistoryState } from '@lexical/react/LexicalHistoryPlugin';\nimport * as React from 'react';\nimport { createContext, useContext, useMemo } from 'react';\n\ntype ContextShape = {\n  historyState: HistoryState;\n};\n\nconst Context: React.Context<ContextShape> = createContext({\n  historyState: { current: null, redoStack: [], undoStack: [] },\n});\n\nexport const SharedHistoryContext = ({\n  children,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n}): JSX.Element => {\n  const historyContext = useMemo(\n    () => ({ historyState: createEmptyHistoryState() }),\n    []\n  );\n  return <Context.Provider value={historyContext}>{children}</Context.Provider>;\n};\n\nexport const useSharedHistoryContext = (): ContextShape => {\n  return useContext(Context);\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorThemeClasses } from 'lexical';\n\nimport './PlaygroundEditorTheme.css';\n\nconst theme: EditorThemeClasses = {\n  characterLimit: 'PlaygroundEditorTheme__characterLimit',\n  code: 'PlaygroundEditorTheme__code',\n  codeHighlight: {\n    atrule: 'PlaygroundEditorTheme__tokenAttr',\n    attr: 'PlaygroundEditorTheme__tokenAttr',\n    boolean: 'PlaygroundEditorTheme__tokenProperty',\n    builtin: 'PlaygroundEditorTheme__tokenSelector',\n    cdata: 'PlaygroundEditorTheme__tokenComment',\n    char: 'PlaygroundEditorTheme__tokenSelector',\n    class: 'PlaygroundEditorTheme__tokenFunction',\n    'class-name': 'PlaygroundEditorTheme__tokenFunction',\n    comment: 'PlaygroundEditorTheme__tokenComment',\n    constant: 'PlaygroundEditorTheme__tokenProperty',\n    deleted: 'PlaygroundEditorTheme__tokenProperty',\n    doctype: 'PlaygroundEditorTheme__tokenComment',\n    entity: 'PlaygroundEditorTheme__tokenOperator',\n    function: 'PlaygroundEditorTheme__tokenFunction',\n    important: 'PlaygroundEditorTheme__tokenVariable',\n    inserted: 'PlaygroundEditorTheme__tokenSelector',\n    keyword: 'PlaygroundEditorTheme__tokenAttr',\n    namespace: 'PlaygroundEditorTheme__tokenVariable',\n    number: 'PlaygroundEditorTheme__tokenProperty',\n    operator: 'PlaygroundEditorTheme__tokenOperator',\n    prolog: 'PlaygroundEditorTheme__tokenComment',\n    property: 'PlaygroundEditorTheme__tokenProperty',\n    punctuation: 'PlaygroundEditorTheme__tokenPunctuation',\n    regex: 'PlaygroundEditorTheme__tokenVariable',\n    selector: 'PlaygroundEditorTheme__tokenSelector',\n    string: 'PlaygroundEditorTheme__tokenSelector',\n    symbol: 'PlaygroundEditorTheme__tokenProperty',\n    tag: 'PlaygroundEditorTheme__tokenProperty',\n    url: 'PlaygroundEditorTheme__tokenOperator',\n    variable: 'PlaygroundEditorTheme__tokenVariable',\n  },\n  hashtag: 'PlaygroundEditorTheme__hashtag',\n  heading: {\n    h1: 'PlaygroundEditorTheme__h1',\n    h2: 'PlaygroundEditorTheme__h2',\n    h3: 'PlaygroundEditorTheme__h3',\n    h4: 'PlaygroundEditorTheme__h4',\n    h5: 'PlaygroundEditorTheme__h5',\n  },\n  image: 'editor-image',\n  link: 'PlaygroundEditorTheme__link',\n  list: {\n    listitem: 'PlaygroundEditorTheme__listItem',\n    listitemChecked: 'PlaygroundEditorTheme__listItemChecked',\n    listitemUnchecked: 'PlaygroundEditorTheme__listItemUnchecked',\n    nested: {\n      listitem: 'PlaygroundEditorTheme__nestedListItem',\n    },\n    olDepth: [\n      'PlaygroundEditorTheme__ol1',\n      'PlaygroundEditorTheme__ol2',\n      'PlaygroundEditorTheme__ol3',\n      'PlaygroundEditorTheme__ol4',\n      'PlaygroundEditorTheme__ol5',\n    ],\n    ul: 'PlaygroundEditorTheme__ul',\n  },\n  ltr: 'PlaygroundEditorTheme__ltr',\n  mark: 'PlaygroundEditorTheme__mark',\n  markOverlap: 'PlaygroundEditorTheme__markOverlap',\n  paragraph: 'PlaygroundEditorTheme__paragraph',\n  quote: 'PlaygroundEditorTheme__quote',\n  rtl: 'PlaygroundEditorTheme__rtl',\n  table: 'PlaygroundEditorTheme__table',\n  tableCell: 'PlaygroundEditorTheme__tableCell',\n  tableCellHeader: 'PlaygroundEditorTheme__tableCellHeader',\n  text: {\n    bold: 'PlaygroundEditorTheme__textBold',\n    code: 'PlaygroundEditorTheme__textCode',\n    italic: 'PlaygroundEditorTheme__textItalic',\n    strikethrough: 'PlaygroundEditorTheme__textStrikethrough',\n    subscript: 'PlaygroundEditorTheme__textSubscript',\n    superscript: 'PlaygroundEditorTheme__textSuperscript',\n    underline: 'PlaygroundEditorTheme__textUnderline',\n    underlineStrikethrough: 'PlaygroundEditorTheme__textUnderlineStrikethrough',\n  },\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorThemeClasses } from 'lexical';\n\nimport './StickyEditorTheme.css';\n\nimport baseTheme from './PlaygroundEditorTheme';\n\nconst theme: EditorThemeClasses = {\n  ...baseTheme,\n  paragraph: 'StickyEditorTheme__paragraph',\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './ContentEditable.css';\n\nimport { ContentEditable } from '@lexical/react/LexicalContentEditable';\nimport * as React from 'react';\n\nexport default function LexicalContentEditable({\n  className,\n}: {\n  className?: string;\n}): JSX.Element {\n  return <ContentEditable className={className || 'ContentEditable__root'} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Placeholder.css';\n\nimport * as React from 'react';\n\nexport default function Placeholder({\n  children,\n  className,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  className?: string;\n}): JSX.Element {\n  return <div className={className || 'Placeholder__root'}>{children}</div>;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './StickyNode.css';\n\nimport { CollaborationPlugin } from '@lexical/react/LexicalCollaborationPlugin';\n\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { LexicalNestedComposer } from '@lexical/react/LexicalNestedComposer';\nimport { PlainTextPlugin } from '@lexical/react/LexicalPlainTextPlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport {\n  $getNodeByKey,\n  $setSelection,\n  createEditor,\n  DecoratorNode,\n} from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport { createWebsocketProvider } from '../collaboration';\nimport { useSharedHistoryContext } from '../context/SharedHistoryContext';\nimport StickyEditorTheme from '../themes/StickyEditorTheme';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\n\nfunction positionSticky(stickyElem: HTMLElement, positioning): void {\n  const style = stickyElem.style;\n  const rootElementRect = positioning.rootElementRect;\n  const rectLeft = rootElementRect !== null ? rootElementRect.left : 0;\n  const rectTop = rootElementRect !== null ? rootElementRect.top : 0;\n  style.top = rectTop + positioning.y + 'px';\n  style.left = rectLeft + positioning.x + 'px';\n}\n\nfunction StickyComponent({\n  x,\n  y,\n  nodeKey,\n  color,\n  caption,\n}: {\n  caption: LexicalEditor;\n  color: 'pink' | 'yellow';\n  nodeKey: NodeKey;\n  x: number;\n  y: number;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const stickyContainerRef = useRef<null | HTMLDivElement>(null);\n  const positioningRef = useRef<{\n    isDragging: boolean;\n    offsetX: number;\n    offsetY: number;\n    rootElementRect: null | ClientRect;\n    x: number;\n    y: number;\n  }>({\n    isDragging: false,\n    offsetX: 0,\n    offsetY: 0,\n    rootElementRect: null,\n    x: 0,\n    y: 0,\n  });\n  const { yjsDocMap } = useCollaborationContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n\n  useEffect(() => {\n    const position = positioningRef.current;\n    position.x = x;\n    position.y = y;\n\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      positionSticky(stickyContainer, position);\n    }\n  }, [x, y]);\n\n  useLayoutEffect(() => {\n    const position = positioningRef.current;\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (let i = 0; i < entries.length; i++) {\n        const entry = entries[i];\n        const { target } = entry;\n        position.rootElementRect = target.getBoundingClientRect();\n        const stickyContainer = stickyContainerRef.current;\n        if (stickyContainer !== null) {\n          positionSticky(stickyContainer, position);\n        }\n      }\n    });\n\n    const removeRootListener = editor.registerRootListener(\n      (nextRootElem, prevRootElem) => {\n        if (prevRootElem !== null) {\n          resizeObserver.unobserve(prevRootElem);\n        }\n        if (nextRootElem !== null) {\n          resizeObserver.observe(nextRootElem);\n        }\n      }\n    );\n\n    const handleWindowResize = () => {\n      const rootElement = editor.getRootElement();\n      const stickyContainer = stickyContainerRef.current;\n      if (rootElement !== null && stickyContainer !== null) {\n        position.rootElementRect = rootElement.getBoundingClientRect();\n        positionSticky(stickyContainer, position);\n      }\n    };\n\n    window.addEventListener('resize', handleWindowResize);\n\n    return () => {\n      window.removeEventListener('resize', handleWindowResize);\n      removeRootListener();\n    };\n  }, [editor]);\n\n  useEffect(() => {\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      // Delay adding transition so we don't trigger the\n      // transition on load of the sticky.\n      setTimeout(() => {\n        stickyContainer.style.setProperty(\n          'transition',\n          'top 0.3s ease 0s, left 0.3s ease 0s'\n        );\n      }, 500);\n    }\n  }, []);\n\n  const handlePointerMove = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    const rootElementRect = positioning.rootElementRect;\n    if (\n      stickyContainer !== null &&\n      positioning.isDragging &&\n      rootElementRect !== null\n    ) {\n      positioning.x = event.pageX - positioning.offsetX - rootElementRect.left;\n      positioning.y = event.pageY - positioning.offsetY - rootElementRect.top;\n      positionSticky(stickyContainer, positioning);\n    }\n  };\n\n  const handlePointerUp = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    if (stickyContainer !== null) {\n      positioning.isDragging = false;\n      stickyContainer.classList.remove('dragging');\n      editor.update(() => {\n        const node = $getNodeByKey(nodeKey);\n        if ($isStickyNode(node)) {\n          node.setPosition(positioning.x, positioning.y);\n        }\n      });\n    }\n    document.removeEventListener('pointermove', handlePointerMove);\n    document.removeEventListener('pointerup', handlePointerUp);\n  };\n\n  const handleDelete = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.remove();\n      }\n    });\n  };\n\n  const handleColorChange = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.toggleColor();\n      }\n    });\n  };\n\n  const { historyState } = useSharedHistoryContext();\n\n  return (\n    <div ref={stickyContainerRef} className=\"sticky-note-container\">\n      <div\n        className={`sticky-note ${color}`}\n        onPointerDown={(event) => {\n          const stickyContainer = stickyContainerRef.current;\n          if (\n            stickyContainer == null ||\n            event.button === 2 ||\n            event.target !== stickyContainer.firstChild\n          ) {\n            // Right click or click on editor should not work\n            return;\n          }\n          const stickContainer = stickyContainer;\n          const positioning = positioningRef.current;\n          if (stickContainer !== null) {\n            const { top, left } = stickContainer.getBoundingClientRect();\n            positioning.offsetX = event.clientX - left;\n            positioning.offsetY = event.clientY - top;\n            positioning.isDragging = true;\n            stickContainer.classList.add('dragging');\n            document.addEventListener('pointermove', handlePointerMove);\n            document.addEventListener('pointerup', handlePointerUp);\n            event.preventDefault();\n          }\n        }}\n      >\n        <button\n          onClick={handleDelete}\n          className=\"delete\"\n          aria-label=\"Delete sticky note\"\n          title=\"Delete\"\n        >\n          X\n        </button>\n        <button\n          onClick={handleColorChange}\n          className=\"color\"\n          aria-label=\"Change sticky note color\"\n          title=\"Color\"\n        >\n          <i className=\"bucket\" />\n        </button>\n        <LexicalNestedComposer\n          initialEditor={caption}\n          initialTheme={StickyEditorTheme}\n        >\n          {isCollab ? (\n            <CollaborationPlugin\n              id={caption.getKey()}\n              providerFactory={createWebsocketProvider}\n              shouldBootstrap={true}\n            />\n          ) : (\n            <HistoryPlugin externalHistoryState={historyState} />\n          )}\n          <PlainTextPlugin\n            contentEditable={\n              <ContentEditable className=\"StickyNode__contentEditable\" />\n            }\n            placeholder={\n              <Placeholder className=\"StickyNode__placeholder\">\n                What's up?\n              </Placeholder>\n            }\n            ErrorBoundary={LexicalErrorBoundary}\n          />\n        </LexicalNestedComposer>\n      </div>\n    </div>\n  );\n}\n\ntype StickyNoteColor = 'pink' | 'yellow';\n\nexport type SerializedStickyNode = Spread<\n  {\n    xOffset: number;\n    yOffset: number;\n    color: StickyNoteColor;\n    caption: LexicalEditor;\n    type: 'sticky';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nexport class StickyNode extends DecoratorNode<JSX.Element> {\n  __x: number;\n  __y: number;\n  __color: StickyNoteColor;\n  __caption: LexicalEditor;\n\n  static getType(): string {\n    return 'sticky';\n  }\n\n  static clone(node: StickyNode): StickyNode {\n    return new StickyNode(\n      node.__x,\n      node.__y,\n      node.__color,\n      node.__caption,\n      node.__key\n    );\n  }\n  static importJSON(serializedNode: SerializedStickyNode): StickyNode {\n    return new StickyNode(\n      serializedNode.xOffset,\n      serializedNode.yOffset,\n      serializedNode.color,\n      serializedNode.caption\n    );\n  }\n\n  constructor(\n    x: number,\n    y: number,\n    color: 'pink' | 'yellow',\n    caption?: LexicalEditor,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__x = x;\n    this.__y = y;\n    this.__caption = caption || createEditor();\n    this.__color = color;\n  }\n\n  exportJSON(): SerializedStickyNode {\n    return {\n      caption: this.__caption,\n      color: this.__color,\n      type: 'sticky',\n      version: 1,\n      xOffset: this.__x,\n      yOffset: this.__y,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const div = document.createElement('div');\n    div.style.display = 'contents';\n    return div;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  setPosition(x: number, y: number): void {\n    const writable = this.getWritable();\n    writable.__x = x;\n    writable.__y = y;\n    $setSelection(null);\n  }\n\n  toggleColor(): void {\n    const writable = this.getWritable();\n    writable.__color = writable.__color === 'pink' ? 'yellow' : 'pink';\n  }\n\n  decorate(editor: LexicalEditor): JSX.Element {\n    return createPortal(\n      <StickyComponent\n        color={this.__color}\n        x={this.__x}\n        y={this.__y}\n        nodeKey={this.getKey()}\n        caption={this.__caption}\n      />,\n      document.body\n    );\n  }\n\n  isIsolated(): true {\n    return true;\n  }\n}\n\nexport function $isStickyNode(\n  node: LexicalNode | null | undefined\n): node is StickyNode {\n  return node instanceof StickyNode;\n}\n\nexport function $createStickyNode(\n  xOffset: number,\n  yOffset: number\n): StickyNode {\n  return new StickyNode(xOffset, yOffset, 'yellow');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig } from 'lexical';\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedTypeaheadNode = Spread<\n  {\n    type: 'typeahead';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nexport class TypeaheadNode extends TextNode {\n  static clone(node: TypeaheadNode): TypeaheadNode {\n    return new TypeaheadNode(node.__text, node.__key);\n  }\n\n  static getType(): 'typeahead' {\n    return 'typeahead';\n  }\n\n  static importJSON(serializedNode: SerializedTypeaheadNode): TypeaheadNode {\n    const node = $createTypeaheadNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedTypeaheadNode {\n    return {\n      ...super.exportJSON(),\n      type: 'typeahead',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = 'color: #ccc;';\n    return dom;\n  }\n}\n\nexport function $createTypeaheadNode(text: string): TypeaheadNode {\n  return new TypeaheadNode(text).setMode('token');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  ElementFormatType,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  Spread,\n} from 'lexical';\n\nimport { BlockWithAlignableContents } from '@lexical/react/LexicalBlockWithAlignableContents';\nimport {\n  DecoratorBlockNode,\n  SerializedDecoratorBlockNode,\n} from '@lexical/react/LexicalDecoratorBlockNode';\nimport * as React from 'react';\n\ntype YouTubeComponentProps = Readonly<{\n  className: Readonly<{\n    base: string;\n    focus: string;\n  }>;\n  format: ElementFormatType | null;\n  nodeKey: NodeKey;\n  videoID: string;\n}>;\n\nfunction YouTubeComponent({\n  className,\n  format,\n  nodeKey,\n  videoID,\n}: YouTubeComponentProps) {\n  return (\n    <BlockWithAlignableContents\n      className={className}\n      format={format}\n      nodeKey={nodeKey}\n    >\n      <iframe\n        width=\"560\"\n        height=\"315\"\n        src={`https://www.youtube.com/embed/${videoID}`}\n        frameBorder=\"0\"\n        allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n        allowFullScreen={true}\n        title=\"YouTube video\"\n      />\n    </BlockWithAlignableContents>\n  );\n}\n\nexport type SerializedYouTubeNode = Spread<\n  {\n    videoID: string;\n    type: 'youtube';\n    version: 1;\n  },\n  SerializedDecoratorBlockNode\n>;\n\nexport class YouTubeNode extends DecoratorBlockNode {\n  __id: string;\n\n  static getType(): string {\n    return 'youtube';\n  }\n\n  static clone(node: YouTubeNode): YouTubeNode {\n    return new YouTubeNode(node.__id, node.__format, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedYouTubeNode): YouTubeNode {\n    const node = $createYouTubeNode(serializedNode.videoID);\n    node.setFormat(serializedNode.format);\n    return node;\n  }\n\n  exportJSON(): SerializedYouTubeNode {\n    return {\n      ...super.exportJSON(),\n      type: 'youtube',\n      version: 1,\n      videoID: this.__id,\n    };\n  }\n\n  constructor(id: string, format?: ElementFormatType, key?: NodeKey) {\n    super(format, key);\n    this.__id = id;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getId(): string {\n    return this.__id;\n  }\n\n  decorate(_editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    const embedBlockTheme = config.theme.embedBlock || {};\n    const className = {\n      base: embedBlockTheme.base || '',\n      focus: embedBlockTheme.focus || '',\n    };\n    return (\n      <YouTubeComponent\n        className={className}\n        format={this.__format}\n        nodeKey={this.getKey()}\n        videoID={this.__id}\n      />\n    );\n  }\n\n  isTopLevel(): true {\n    return true;\n  }\n}\n\nexport function $createYouTubeNode(videoID: string): YouTubeNode {\n  return new YouTubeNode(videoID);\n}\n\nexport function $isYouTubeNode(\n  node: YouTubeNode | LexicalNode | null | undefined\n): node is YouTubeNode {\n  return node instanceof YouTubeNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalNode } from 'lexical';\n\nimport { CodeHighlightNode, CodeNode } from '@lexical/code';\nimport { HashtagNode } from '@lexical/hashtag';\nimport { AutoLinkNode, LinkNode } from '@lexical/link';\nimport { ListItemNode, ListNode } from '@lexical/list';\nimport { MarkNode } from '@lexical/mark';\nimport { OverflowNode } from '@lexical/overflow';\nimport { HorizontalRuleNode } from '@lexical/react/LexicalHorizontalRuleNode';\nimport { HeadingNode, QuoteNode } from '@lexical/rich-text';\nimport { TableCellNode, TableNode, TableRowNode } from '@lexical/table';\nimport { Class } from 'utility-types';\n\nimport { EmojiNode } from './EmojiNode';\nimport { ImageNode } from './ImageNode';\nimport { KeywordNode } from './KeywordNode';\nimport { MentionNode } from './MentionNode';\nimport { PollNode } from './PollNode';\nimport { StickyNode } from './StickyNode';\nimport { TypeaheadNode } from './TypeaheadNode';\nimport { YouTubeNode } from './YouTubeNode';\n\nconst PlaygroundNodes: Array<Class<LexicalNode>> = [\n  HeadingNode,\n  ListNode,\n  ListItemNode,\n  QuoteNode,\n  CodeNode,\n  TableNode,\n  TableCellNode,\n  TableRowNode,\n  HashtagNode,\n  CodeHighlightNode,\n  AutoLinkNode,\n  LinkNode,\n  OverflowNode,\n  PollNode,\n  StickyNode,\n  ImageNode,\n  MentionNode,\n  EmojiNode,\n  TypeaheadNode,\n  KeywordNode,\n  HorizontalRuleNode,\n  YouTubeNode,\n  MarkNode,\n];\n\nexport default PlaygroundNodes;\n","import * as i18next from 'i18next';\nimport EN from './languages/en.json';\nimport FR from './languages/fr.json';\nimport PTBR from './languages/ptBr.json';\nimport RU from './languages/ru.json';\n\nexport const resources = {\n  ar: {},\n  de: {},\n  en: EN,\n  es: {},\n  fr: FR,\n  it: {},\n  ja: {},\n  nl: {},\n  pl: {},\n  pt: {},\n  ptBr: PTBR,\n  ru: RU,\n  ukr: {},\n  zh: {},\n} as const;\n\nexport const languageDetector = {\n  type: 'languageDetector',\n  async: true,\n  detect: (callback) => {\n    const language = navigator.language;\n    callback(language.substring(0, 2));\n  },\n  init: () => {},\n  cacheUserLanguage: () => {},\n};\n\nconst i18n = i18next\n  .createInstance(\n    {\n      ns: ['toolbar', 'action'],\n      resources,\n      fallbackLng: 'en',\n      debug: true,\n      interpolation: {\n        escapeValue: false,\n      },\n    },\n    // We must provide a function as second parameter, otherwise i18next errors\n    (err, t) => {}\n  )\n  .use(languageDetector as i18next.Module);\n\nexport default i18n;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport type SettingName =\n  | 'disableBeforeInput'\n  | 'measureTypingPerf'\n  | 'isRichText'\n  | 'isCollab'\n  | 'isCharLimit'\n  | 'isCharLimitUtf8'\n  | 'isAutocomplete'\n  | 'showTreeView'\n  | 'showNestedEditorTreeView'\n  | 'emptyEditor';\n\nexport type Settings = Record<SettingName, boolean>;\n\nconst hostName = window.location.hostname;\nexport const isDevPlayground: boolean =\n  hostName !== 'playground.lexical.dev' &&\n  hostName !== 'lexical-playground.vercel.app';\n\nexport const DEFAULT_SETTINGS: Settings = {\n  disableBeforeInput: false,\n  emptyEditor: isDevPlayground,\n  isAutocomplete: false,\n  isCharLimit: false,\n  isCharLimitUtf8: false,\n  isCollab: false,\n  isRichText: true,\n  measureTypingPerf: false,\n  showNestedEditorTreeView: false,\n  showTreeView: true,\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { SettingName } from '../appSettings';\n\nimport * as React from 'react';\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n} from 'react';\n\nimport { DEFAULT_SETTINGS } from '../appSettings';\n\ntype SettingsContextShape = {\n  setOption: (name: SettingName, value: boolean) => void;\n  settings: Record<SettingName, boolean>;\n};\n\nconst Context: React.Context<SettingsContextShape> = createContext({\n  setOption: (name: SettingName, value: boolean) => {\n    return;\n  },\n  settings: DEFAULT_SETTINGS,\n});\n\nexport const SettingsContext = ({\n  children,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n}): JSX.Element => {\n  const [settings, setSettings] = useState(DEFAULT_SETTINGS);\n  const setOption = useCallback((setting: SettingName, value: boolean) => {\n    setSettings((options) => ({\n      ...options,\n      [setting as string]: value,\n    }));\n    if (DEFAULT_SETTINGS[setting] === value) {\n      setURLParam(setting, null);\n    } else {\n      setURLParam(setting, value);\n    }\n  }, []);\n  const contextValue = useMemo(() => {\n    return { setOption, settings };\n  }, [setOption, settings]);\n  return <Context.Provider value={contextValue}>{children}</Context.Provider>;\n};\n\nexport const useSettings = (): SettingsContextShape => {\n  return useContext(Context);\n};\n\nfunction setURLParam(param: SettingName, value: null | boolean) {\n  const url = new URL(window.location.href);\n  const params = new URLSearchParams(url.search);\n  if (value !== null) {\n    if (params.has(param)) {\n      params.set(param, String(value));\n    } else {\n      params.append(param, String(value));\n    }\n  } else {\n    if (params.has(param)) {\n      params.delete(param);\n    }\n  }\n  url.search = params.toString();\n  window.history.pushState(null, '', url.toString());\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Modal.css';\n\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\n\nfunction PortalImpl({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  closeOnClickOutside: boolean;\n  onClose: () => void;\n  title: string;\n}) {\n  const modalRef = useRef<HTMLDivElement>();\n\n  useEffect(() => {\n    if (modalRef.current !== null) {\n      modalRef.current.focus();\n    }\n  }, []);\n\n  useEffect(() => {\n    let modalOverlayElement = null;\n    const handler = (event) => {\n      if (event.keyCode === 27) {\n        onClose();\n      }\n    };\n    const clickOutsideHandler = (event: MouseEvent) => {\n      const target = event.target;\n      if (\n        modalRef.current !== null &&\n        !modalRef.current.contains(target as Node) &&\n        closeOnClickOutside\n      ) {\n        onClose();\n      }\n    };\n    if (modalRef.current !== null) {\n      modalOverlayElement = modalRef.current?.parentElement;\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.addEventListener('click', clickOutsideHandler);\n      }\n    }\n\n    window.addEventListener('keydown', handler);\n\n    return () => {\n      window.removeEventListener('keydown', handler);\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.removeEventListener('click', clickOutsideHandler);\n      }\n    };\n  }, [closeOnClickOutside, onClose]);\n\n  return (\n    <div className=\"Modal__overlay\" role=\"dialog\">\n      <div className=\"Modal__modal\" tabIndex={-1} ref={modalRef}>\n        <h2 className=\"Modal__title\">{title}</h2>\n        <button\n          className=\"Modal__closeButton\"\n          aria-label=\"Close modal\"\n          type=\"button\"\n          onClick={onClose}\n        >\n          X\n        </button>\n        <div className=\"Modal__content\">{children}</div>\n      </div>\n    </div>\n  );\n}\n\nexport default function Modal({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside = false,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  closeOnClickOutside?: boolean;\n  onClose: () => void;\n  title: string;\n}): JSX.Element {\n  return createPortal(\n    <PortalImpl\n      onClose={onClose}\n      title={title}\n      closeOnClickOutside={closeOnClickOutside}\n    >\n      {children}\n    </PortalImpl>,\n    document.body\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCallback, useMemo, useState } from 'react';\nimport * as React from 'react';\n\nimport Modal from '../ui/Modal';\n\nexport default function useModal(): [\n  JSX.Element,\n  (title: string, showModal: (onClose: () => void) => JSX.Element) => void\n] {\n  const [modalContent, setModalContent] = useState<null | {\n    closeOnClickOutside: boolean;\n    content: JSX.Element;\n    title: string;\n  }>(null);\n\n  const onClose = useCallback(() => {\n    setModalContent(null);\n  }, []);\n\n  const modal = useMemo(() => {\n    if (modalContent === null) {\n      return null;\n    }\n    const { title, content, closeOnClickOutside } = modalContent;\n    return (\n      <Modal\n        onClose={onClose}\n        title={title}\n        closeOnClickOutside={closeOnClickOutside}\n      >\n        {content}\n      </Modal>\n    );\n  }, [modalContent, onClose]);\n\n  const showModal = useCallback(\n    (\n      title,\n      // eslint-disable-next-line no-shadow\n      getContent: (onClose: () => void) => JSX.Element,\n      closeOnClickOutside = false\n    ) => {\n      setModalContent({\n        closeOnClickOutside,\n        content: getContent(onClose),\n        title,\n      });\n    },\n    [onClose]\n  );\n\n  return [modal, showModal];\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  ElementTransformer,\n  TextMatchTransformer,\n  Transformer,\n} from '@lexical/markdown';\nimport type { ElementNode, LexicalNode } from 'lexical';\n\nimport {\n  CHECK_LIST,\n  ELEMENT_TRANSFORMERS,\n  TEXT_FORMAT_TRANSFORMERS,\n  TEXT_MATCH_TRANSFORMERS,\n} from '@lexical/markdown';\nimport {\n  $createHorizontalRuleNode,\n  $isHorizontalRuleNode,\n  HorizontalRuleNode,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $createTableCellNode,\n  $createTableNode,\n  $createTableRowNode,\n  $isTableNode,\n  $isTableRowNode,\n  TableCellHeaderStates,\n  TableCellNode,\n  TableNode,\n  TableRowNode,\n} from '@lexical/table';\nimport {\n  $createParagraphNode,\n  $createTextNode,\n  $isElementNode,\n  $isParagraphNode,\n  $isTextNode,\n} from 'lexical';\n\nimport { $createImageNode, $isImageNode, ImageNode } from '../nodes/ImageNode';\n\nexport const HR: ElementTransformer = {\n  dependencies: [HorizontalRuleNode],\n  export: (node: LexicalNode) => {\n    return $isHorizontalRuleNode(node) ? '***' : null;\n  },\n  regExp: /^(---|\\*\\*\\*|___)\\s?$/,\n  replace: (parentNode, _1, _2, isImport) => {\n    const line = $createHorizontalRuleNode();\n\n    // TODO: Get rid of isImport flag\n    if (isImport || parentNode.getNextSibling() != null) {\n      parentNode.replace(line);\n    } else {\n      parentNode.insertBefore(line);\n    }\n\n    line.selectNext();\n  },\n  type: 'element',\n};\n\nexport const IMAGE: TextMatchTransformer = {\n  dependencies: [ImageNode],\n  export: (node, exportChildren, exportFormat) => {\n    if (!$isImageNode(node)) {\n      return null;\n    }\n\n    return `![${node.getAltText()}](${node.getSrc()})`;\n  },\n  importRegExp: /!(?:\\[([^[]*)\\])(?:\\(([^(]+)\\))/,\n  regExp: /!(?:\\[([^[]*)\\])(?:\\(([^(]+)\\))$/,\n  replace: (textNode, match) => {\n    const [, altText, src] = match;\n    const imageNode = $createImageNode({\n      altText,\n      maxWidth: 800,\n      src,\n    });\n    textNode.replace(imageNode);\n  },\n  trigger: ')',\n  type: 'text-match',\n};\n\n// Very primitive table setup\nconst TABLE_ROW_REG_EXP = /^(?:\\|)(.+)(?:\\|)\\s?$/;\n\nexport const TABLE: ElementTransformer = {\n  dependencies: [TableNode, TableRowNode, TableCellNode],\n  export: (\n    node: LexicalNode,\n    exportChildren: (elementNode: ElementNode) => string\n  ) => {\n    if (!$isTableNode(node)) {\n      return null;\n    }\n\n    const output = [];\n\n    for (const row of node.getChildren()) {\n      const rowOutput = [];\n\n      if ($isTableRowNode(row)) {\n        for (const cell of row.getChildren()) {\n          // It's TableCellNode (hence ElementNode) so it's just to make flow happy\n          if ($isElementNode(cell)) {\n            rowOutput.push(exportChildren(cell));\n          }\n        }\n      }\n\n      output.push(`| ${rowOutput.join(' | ')} |`);\n    }\n\n    return output.join('\\n');\n  },\n  regExp: TABLE_ROW_REG_EXP,\n  replace: (parentNode, _1, match) => {\n    const matchCells = mapToTableCells(match[0]);\n\n    if (matchCells == null) {\n      return;\n    }\n\n    const rows = [matchCells];\n    let sibling = parentNode.getPreviousSibling();\n    let maxCells = matchCells.length;\n\n    while (sibling) {\n      if (!$isParagraphNode(sibling)) {\n        break;\n      }\n\n      if (sibling.getChildrenSize() !== 1) {\n        break;\n      }\n\n      const firstChild = sibling.getFirstChild();\n\n      if (!$isTextNode(firstChild)) {\n        break;\n      }\n\n      const cells = mapToTableCells(firstChild.getTextContent());\n\n      if (cells == null) {\n        break;\n      }\n\n      maxCells = Math.max(maxCells, cells.length);\n      rows.unshift(cells);\n      const previousSibling = sibling.getPreviousSibling();\n      sibling.remove();\n      sibling = previousSibling;\n    }\n\n    const table = $createTableNode();\n\n    for (const cells of rows) {\n      const tableRow = $createTableRowNode();\n      table.append(tableRow);\n\n      for (let i = 0; i < maxCells; i++) {\n        tableRow.append(i < cells.length ? cells[i] : createTableCell(null));\n      }\n    }\n\n    const previousSibling = parentNode.getPreviousSibling();\n    if (\n      $isTableNode(previousSibling) &&\n      getTableColumnsSize(previousSibling) === maxCells\n    ) {\n      previousSibling.append(...table.getChildren());\n      parentNode.remove();\n    } else {\n      parentNode.replace(table);\n    }\n\n    table.selectEnd();\n  },\n  type: 'element',\n};\n\nfunction getTableColumnsSize(table: TableNode) {\n  const row = table.getFirstChild();\n  return $isTableRowNode(row) ? row.getChildrenSize() : 0;\n}\n\nconst createTableCell = (\n  textContent: string | null | undefined\n): TableCellNode => {\n  const cell = $createTableCellNode(TableCellHeaderStates.NO_STATUS);\n  const paragraph = $createParagraphNode();\n\n  if (textContent != null) {\n    paragraph.append($createTextNode(textContent.trim()));\n  }\n\n  cell.append(paragraph);\n  return cell;\n};\n\nconst mapToTableCells = (textContent: string): Array<TableCellNode> | null => {\n  // TODO:\n  // For now plain text, single node. Can be expanded to more complex content\n  // including formatted text\n  const match = textContent.match(TABLE_ROW_REG_EXP);\n\n  if (!match || !match[1]) {\n    return null;\n  }\n\n  return match[1].split('|').map((text) => createTableCell(text));\n};\n\nexport const PLAYGROUND_TRANSFORMERS: Array<Transformer> = [\n  TABLE,\n  HR,\n  IMAGE,\n  CHECK_LIST,\n  ...ELEMENT_TRANSFORMERS,\n  ...TEXT_FORMAT_TRANSFORMERS,\n  ...TEXT_MATCH_TRANSFORMERS,\n];\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCallback, useEffect, useRef } from 'react';\n\nconst getElement = (): HTMLElement => {\n  let element = document.getElementById('report-container');\n\n  if (element === null) {\n    element = document.createElement('div');\n    element.id = 'report-container';\n    element.style.position = 'fixed';\n    element.style.top = '50%';\n    element.style.left = '50%';\n    element.style.fontSize = '32px';\n    element.style.transform = 'translate(-50%, -50px)';\n    element.style.padding = '20px';\n    element.style.background = 'rgba(240, 240, 240, 0.4)';\n    element.style.borderRadius = '20px';\n\n    if (document.body) {\n      document.body.appendChild(element);\n    }\n  }\n\n  return element;\n};\n\nexport default function useReport(): (arg0: string) => NodeJS.Timeout {\n  const timer = useRef<NodeJS.Timeout | null>(null);\n  const cleanup = useCallback(() => {\n    clearTimeout(timer.current);\n\n    if (document.body) {\n      document.body.removeChild(getElement());\n    }\n  }, []);\n\n  useEffect(() => {\n    return cleanup;\n  }, [cleanup]);\n\n  return useCallback(\n    (content) => {\n      // eslint-disable-next-line no-console\n      console.log(content);\n      const element = getElement();\n      clearTimeout(timer.current);\n      element.innerHTML = content;\n      timer.current = setTimeout(cleanup, 1000);\n      return timer.current;\n    },\n    [cleanup]\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand, LexicalEditor, RangeSelection } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  REDO_COMMAND,\n  UNDO_COMMAND,\n} from 'lexical';\nimport { useEffect, useRef, useState } from 'react';\n\nimport useReport from '../hooks/useReport';\n\nexport const SPEECH_TO_TEXT_COMMAND: LexicalCommand<boolean> = createCommand();\n\nconst VOICE_COMMANDS: Readonly<\n  Record<\n    string,\n    (arg0: { editor: LexicalEditor; selection: RangeSelection }) => void\n  >\n> = {\n  '\\n': ({ selection }) => {\n    selection.insertParagraph();\n  },\n  redo: ({ editor }) => {\n    editor.dispatchCommand(REDO_COMMAND, undefined);\n  },\n  undo: ({ editor }) => {\n    editor.dispatchCommand(UNDO_COMMAND, undefined);\n  },\n};\n\nexport const SUPPORT_SPEECH_RECOGNITION: boolean =\n  'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;\n\nfunction SpeechToTextPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n  const [isEnabled, setIsEnabled] = useState<boolean>(false);\n  const SpeechRecognition =\n    // @ts-ignore\n    window.SpeechRecognition || window.webkitSpeechRecognition;\n  const recognition = useRef<typeof SpeechRecognition | null>(null);\n  const report = useReport();\n\n  useEffect(() => {\n    if (isEnabled && recognition.current === null) {\n      recognition.current = new SpeechRecognition();\n      recognition.current.continuous = true;\n      recognition.current.interimResults = true;\n      recognition.current.addEventListener(\n        'result',\n        (event: typeof SpeechRecognition) => {\n          const resultItem = event.results.item(event.resultIndex);\n          const { transcript } = resultItem.item(0);\n          report(transcript);\n\n          if (!resultItem.isFinal) {\n            return;\n          }\n\n          editor.update(() => {\n            const selection = $getSelection();\n\n            if ($isRangeSelection(selection)) {\n              const command = VOICE_COMMANDS[transcript.toLowerCase().trim()];\n\n              if (command) {\n                command({\n                  editor,\n                  selection,\n                });\n              } else if (transcript.match(/\\s*\\n\\s*/)) {\n                selection.insertParagraph();\n              } else {\n                selection.insertText(transcript);\n              }\n            }\n          });\n        }\n      );\n    }\n\n    if (recognition.current) {\n      if (isEnabled) {\n        recognition.current.start();\n      } else {\n        recognition.current.stop();\n      }\n    }\n\n    return () => {\n      if (recognition.current !== null) {\n        recognition.current.stop();\n      }\n    };\n  }, [SpeechRecognition, editor, isEnabled, report]);\n  useEffect(() => {\n    return editor.registerCommand(\n      SPEECH_TO_TEXT_COMMAND,\n      (_isEnabled: boolean) => {\n        setIsEnabled(_isEnabled);\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n\nexport default (SUPPORT_SPEECH_RECOGNITION\n  ? SpeechToTextPlugin\n  : () => null) as () => null;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalEditor } from 'lexical';\n\nimport { $createCodeNode, $isCodeNode } from '@lexical/code';\nimport { exportFile, importFile } from '@lexical/file';\nimport {\n  $convertFromMarkdownString,\n  $convertToMarkdownString,\n} from '@lexical/markdown';\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { mergeRegister } from '@lexical/utils';\nimport { CONNECTED_COMMAND, TOGGLE_CONNECT_COMMAND } from '@lexical/yjs';\nimport {\n  $createTextNode,\n  $getRoot,\n  $isParagraphNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport * as React from 'react';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport useModal from '../hooks/useModal';\nimport Button from '../ui/Button';\nimport { PLAYGROUND_TRANSFORMERS } from './MarkdownTransformers';\nimport {\n  SPEECH_TO_TEXT_COMMAND,\n  SUPPORT_SPEECH_RECOGNITION,\n} from './SpeechToTextPlugin';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nexport default function ActionsPlugin({\n  isRichText,\n}: {\n  isRichText: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [isEditable, setIsEditable] = useState(() => editor.isEditable());\n  const [isSpeechToText, setIsSpeechToText] = useState(false);\n  const [connected, setConnected] = useState(false);\n  const [isEditorEmpty, setIsEditorEmpty] = useState(true);\n  const [modal, showModal] = useModal();\n  const { yjsDocMap } = useCollaborationContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n  const { t } = useTranslation(['action']);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerEditableListener((editable) => {\n        setIsEditable(editable);\n      }),\n      editor.registerCommand<boolean>(\n        CONNECTED_COMMAND,\n        (payload) => {\n          const isConnected = payload;\n          setConnected(isConnected);\n          return false;\n        },\n        COMMAND_PRIORITY_EDITOR\n      )\n    );\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        const root = $getRoot();\n        const children = root.getChildren();\n\n        if (children.length > 1) {\n          setIsEditorEmpty(false);\n        } else {\n          if ($isParagraphNode(children[0])) {\n            const paragraphChildren = children[0].getChildren();\n            setIsEditorEmpty(paragraphChildren.length === 0);\n          } else {\n            setIsEditorEmpty(false);\n          }\n        }\n      });\n    });\n  }, [editor]);\n\n  const handleMarkdownToggle = useCallback(() => {\n    editor.update(() => {\n      const root = $getRoot();\n      const firstChild = root.getFirstChild();\n      if ($isCodeNode(firstChild) && firstChild.getLanguage() === 'markdown') {\n        $convertFromMarkdownString(\n          firstChild.getTextContent(),\n          PLAYGROUND_TRANSFORMERS\n        );\n      } else {\n        const markdown = $convertToMarkdownString(PLAYGROUND_TRANSFORMERS);\n        root\n          .clear()\n          .append(\n            $createCodeNode('markdown').append($createTextNode(markdown))\n          );\n      }\n      root.selectEnd();\n    });\n  }, [editor]);\n\n  return (\n    <div className=\"verbum-actions\">\n      {SUPPORT_SPEECH_RECOGNITION && (\n        <button\n          onClick={() => {\n            editor.dispatchCommand(SPEECH_TO_TEXT_COMMAND, !isSpeechToText);\n            setIsSpeechToText(!isSpeechToText);\n          }}\n          className={\n            'action-button action-button-mic ' +\n            (isSpeechToText ? 'active' : '')\n          }\n          title={t('action:Speech_To_Text')}\n          aria-label={`${\n            isSpeechToText ? t('action:Enable') : t('action:Disable')\n          } ${t('action:speech_To_Text')}`}\n          type=\"button\"\n        >\n          <i className=\"verbum-mic\" />\n        </button>\n      )}\n      <button\n        className=\"verbum-action-button import\"\n        onClick={() => importFile(editor)}\n        title={t('action:Import')}\n        aria-label={t('action:Import_Description')}\n        type=\"button\"\n      >\n        <i className=\"verbum-import\" />\n      </button>\n      <button\n        className=\"verbum-action-button export\"\n        onClick={() =>\n          exportFile(editor, {\n            fileName: `Playground ${new Date().toISOString()}`,\n            source: 'Playground',\n          })\n        }\n        title={t('action:Export')}\n        aria-label={t('action:Export_Description')}\n        type=\"button\"\n      >\n        <i className=\"verbum-export\" />\n      </button>\n      <button\n        className=\"verbum-action-button clear\"\n        disabled={isEditorEmpty}\n        onClick={() => {\n          showModal(t('action:Clear_Editor'), (onClose) => (\n            <ShowClearDialog editor={editor} onClose={onClose} t={t} />\n          ));\n        }}\n        title={t('action:Clear')}\n        aria-label={t('action:Clear_Description')}\n        type=\"button\"\n      >\n        <i className=\"clear\" />\n      </button>\n      <button\n        className={`verbum-action-button ${isEditable ? 'unlock' : 'lock'}`}\n        onClick={() => {\n          editor.setEditable(!editor.isEditable());\n        }}\n        title={t('action:Read-Only_Mode')}\n        aria-label={`${isEditable ? t('action:Unlock') : t('action:Lock')} ${t(\n          'action:Read-Only_Mode'\n        )}`}\n        type=\"button\"\n      >\n        <i className={isEditable ? 'unlock' : 'lock'} />\n      </button>\n      <button\n        className=\"verbum-action-button\"\n        onClick={handleMarkdownToggle}\n        title={t('action:Convert_From_Markdown')}\n        aria-label={t('action:Convert_From_Markdown_Description')}\n        type=\"button\"\n      >\n        <i className=\"verbum-markdown\" />\n      </button>\n      {isCollab && (\n        <button\n          className=\"verbum-action-button connect\"\n          onClick={() => {\n            editor.dispatchCommand(TOGGLE_CONNECT_COMMAND, !connected);\n          }}\n          title={`${\n            connected ? t('action:Disconnect') : t('action:Connect')\n          } ${t('action:Collaborative')}`}\n          aria-label={`${\n            connected ? t('action:Disconnect_From') : t('action:Connect_To')\n          } ${t('action:Server')}`}\n          type=\"button\"\n        >\n          <i\n            className={connected ? t('action:disconnect') : t('action:connect')}\n          />\n        </button>\n      )}\n      {modal}\n    </div>\n  );\n}\n\nfunction ShowClearDialog({\n  editor,\n  onClose,\n  t,\n}: {\n  editor: LexicalEditor;\n  onClose: () => void;\n  t: TFunction;\n}): JSX.Element {\n  return (\n    <>\n      {t('action:Confirm_Clear')}\n      <div className=\"Modal__content\">\n        <Button\n          onClick={() => {\n            editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n            editor.focus();\n            onClose();\n          }}\n        >\n          {t('action:Clear')}\n        </Button>{' '}\n        <Button\n          onClick={() => {\n            editor.focus();\n            onClose();\n          }}\n        >\n          {t('action:Cancel')}\n        </Button>\n      </div>\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { AutoLinkPlugin } from '@lexical/react/LexicalAutoLinkPlugin';\nimport * as React from 'react';\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nconst EMAIL_MATCHER =\n  /(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))/;\n\nconst MATCHERS = [\n  (text) => {\n    const match = URL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: match[0],\n      }\n    );\n  },\n  (text) => {\n    const match = EMAIL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: `mailto:${match[0]}`,\n      }\n    );\n  },\n];\n\nexport default function LexicalAutoLinkPlugin(): JSX.Element {\n  return <AutoLinkPlugin matchers={MATCHERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {\n  Comment,\n  Comments,\n  CommentStore,\n  createComment,\n  createThread,\n  Thread,\n  useCommentStore,\n} from '../commenting';\nimport type {\n  EditorState,\n  LexicalCommand,\n  LexicalEditor,\n  NodeKey,\n} from 'lexical';\n\nimport './CommentPlugin.css';\n\nimport {\n  $createMarkNode,\n  $getMarkIDs,\n  $isMarkNode,\n  $unwrapMarkNode,\n  $wrapSelectionInMarkNode,\n  MarkNode,\n} from '@lexical/mark';\nimport { AutoFocusPlugin } from '@lexical/react/LexicalAutoFocusPlugin';\nimport { ClearEditorPlugin } from '@lexical/react/LexicalClearEditorPlugin';\nimport { LexicalComposer } from '@lexical/react/LexicalComposer';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { OnChangePlugin } from '@lexical/react/LexicalOnChangePlugin';\nimport { PlainTextPlugin } from '@lexical/react/LexicalPlainTextPlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport { createDOMRange, createRectsFromDOMRange } from '@lexical/selection';\nimport { $isRootTextContentEmpty, $rootTextContent } from '@lexical/text';\nimport { mergeRegister, registerNestedElementResolver } from '@lexical/utils';\nimport {\n  $getNodeByKey,\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  KEY_ESCAPE_COMMAND,\n} from 'lexical';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport useModal from '../hooks/useModal';\nimport CommentEditorTheme from '../themes/CommentEditorTheme';\nimport Button from '../ui/Button';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\nimport type { Doc } from 'yjs';\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { WebsocketProvider } from 'y-websocket';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nexport const INSERT_INLINE_COMMAND: LexicalCommand<void> = createCommand();\n\nfunction AddCommentBox({\n  anchorKey,\n  editor,\n  onAddComment,\n}: {\n  anchorKey: NodeKey;\n  editor: LexicalEditor;\n  onAddComment: () => void;\n}): JSX.Element {\n  const boxRef = useRef<HTMLDivElement>(null);\n\n  const updatePosition = useCallback(() => {\n    const boxElem = boxRef.current;\n    const rootElement = editor.getRootElement();\n    const anchorElement = editor.getElementByKey(anchorKey);\n\n    if (boxElem !== null && rootElement !== null && anchorElement !== null) {\n      const { right } = rootElement.getBoundingClientRect();\n      const { top } = anchorElement.getBoundingClientRect();\n      boxElem.style.left = `${right - 20}px`;\n      boxElem.style.top = `${top - 30}px`;\n    }\n  }, [anchorKey, editor]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updatePosition);\n\n    return () => {\n      window.removeEventListener('resize', updatePosition);\n    };\n  }, [editor, updatePosition]);\n\n  useLayoutEffect(() => {\n    updatePosition();\n  }, [anchorKey, editor, updatePosition]);\n\n  return (\n    <div className=\"CommentPlugin_AddCommentBox\" ref={boxRef}>\n      <button\n        className=\"CommentPlugin_AddCommentBox_button\"\n        onClick={onAddComment}\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-add-comment\" />\n      </button>\n    </div>\n  );\n}\n\nfunction EditorRefPlugin({\n  editorRef,\n}: {\n  editorRef: { current: null | LexicalEditor };\n}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useLayoutEffect(() => {\n    editorRef.current = editor;\n    return () => {\n      editorRef.current = null;\n    };\n  }, [editor, editorRef]);\n\n  return null;\n}\n\nfunction EscapeHandlerPlugin({\n  onEscape,\n}: {\n  onEscape: (e: KeyboardEvent) => boolean;\n}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      KEY_ESCAPE_COMMAND,\n      (event: KeyboardEvent) => {\n        return onEscape(event);\n      },\n      2\n    );\n  }, [editor, onEscape]);\n\n  return null;\n}\n\nfunction PlainTextEditor({\n  className,\n  autoFocus,\n  onEscape,\n  onChange,\n  editorRef,\n  placeholder = 'Type a comment...',\n}: {\n  autoFocus?: boolean;\n  className?: string;\n  editorRef?: { current: null | LexicalEditor };\n  onChange: (editorState: EditorState, editor: LexicalEditor) => void;\n  onEscape: (e: KeyboardEvent) => boolean;\n  placeholder?: string;\n}) {\n  const initialConfig = {\n    namespace: 'Commenting',\n    nodes: [],\n    onError: (error: Error) => {\n      throw error;\n    },\n    theme: CommentEditorTheme,\n  };\n\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <div className=\"CommentPlugin_CommentInputBox_EditorContainer\">\n        <PlainTextPlugin\n          contentEditable={<ContentEditable className={className} />}\n          placeholder={<Placeholder>{placeholder}</Placeholder>}\n          ErrorBoundary={LexicalErrorBoundary}\n        />\n        <OnChangePlugin onChange={onChange} />\n        <HistoryPlugin />\n        {autoFocus !== false && <AutoFocusPlugin />}\n        <EscapeHandlerPlugin onEscape={onEscape} />\n        <ClearEditorPlugin />\n        {editorRef !== undefined && <EditorRefPlugin editorRef={editorRef} />}\n      </div>\n    </LexicalComposer>\n  );\n}\n\nfunction useOnChange(\n  setContent: (text: string) => void,\n  setCanSubmit: (canSubmit: boolean) => void\n) {\n  return useCallback(\n    (editorState: EditorState, _editor: LexicalEditor) => {\n      editorState.read(() => {\n        setContent($rootTextContent());\n        setCanSubmit(!$isRootTextContentEmpty(_editor.isComposing(), true));\n      });\n    },\n    [setCanSubmit, setContent]\n  );\n}\n\nfunction CommentInputBox({\n  editor,\n  cancelAddComment,\n  submitAddComment,\n  t,\n}: {\n  cancelAddComment: () => void;\n  editor: LexicalEditor;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean\n  ) => void;\n  t: TFunction;\n}) {\n  const [content, setContent] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n  const boxRef = useRef<HTMLDivElement>(null);\n  const selectionState = useMemo(\n    () => ({\n      container: document.createElement('div'),\n      elements: [],\n    }),\n    []\n  );\n  const author = useCollabAuthorName();\n\n  const updateLocation = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n      if ($isRangeSelection(selection)) {\n        const anchor = selection.anchor;\n        const focus = selection.focus;\n        const range = createDOMRange(\n          editor,\n          anchor.getNode(),\n          anchor.offset,\n          focus.getNode(),\n          focus.offset\n        );\n        const boxElem = boxRef.current;\n        if (range !== null && boxElem !== null) {\n          const { left, bottom, width } = range.getBoundingClientRect();\n          const selectionRects = createRectsFromDOMRange(editor, range);\n          let correctedLeft =\n            selectionRects.length === 1 ? left + width / 2 - 125 : left - 125;\n          if (correctedLeft < 10) {\n            correctedLeft = 10;\n          }\n          boxElem.style.left = `${correctedLeft}px`;\n          boxElem.style.top = `${bottom + 20}px`;\n          const selectionRectsLength = selectionRects.length;\n          const { container } = selectionState;\n          const elements: Array<HTMLSpanElement> = selectionState.elements;\n          const elementsLength = elements.length;\n\n          for (let i = 0; i < selectionRectsLength; i++) {\n            const selectionRect = selectionRects[i];\n            let elem: HTMLSpanElement = elements[i];\n            if (elem === undefined) {\n              elem = document.createElement('span');\n              elements[i] = elem;\n              container.appendChild(elem);\n            }\n            const color = '255, 212, 0';\n            const style = `position:absolute;top:${selectionRect.top}px;left:${selectionRect.left}px;height:${selectionRect.height}px;width:${selectionRect.width}px;background-color:rgba(${color}, 0.3);pointer-events:none;z-index:5;`;\n            elem.style.cssText = style;\n          }\n          for (let i = elementsLength - 1; i >= selectionRectsLength; i--) {\n            const elem = elements[i];\n            container.removeChild(elem);\n            elements.pop();\n          }\n        }\n      }\n    });\n  }, [editor, selectionState]);\n\n  useLayoutEffect(() => {\n    updateLocation();\n    const container = selectionState.container;\n    const body = document.body;\n    if (body !== null) {\n      body.appendChild(container);\n      return () => {\n        body.removeChild(container);\n      };\n    }\n  }, [selectionState.container, updateLocation]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updateLocation);\n\n    return () => {\n      window.removeEventListener('resize', updateLocation);\n    };\n  }, [updateLocation]);\n\n  const onEscape = (event: KeyboardEvent): boolean => {\n    event.preventDefault();\n    cancelAddComment();\n    return true;\n  };\n\n  const submitComment = () => {\n    if (canSubmit) {\n      let quote = editor.getEditorState().read(() => {\n        const selection = $getSelection();\n        return selection !== null ? selection.getTextContent() : '';\n      });\n      if (quote.length > 100) {\n        quote = quote.slice(0, 99) + '';\n      }\n      submitAddComment(\n        createThread(quote, [createComment(content, author)]),\n        true\n      );\n    }\n  };\n\n  const onChange = useOnChange(setContent, setCanSubmit);\n\n  return (\n    <div className=\"CommentPlugin_CommentInputBox\" ref={boxRef}>\n      <PlainTextEditor\n        className=\"CommentPlugin_CommentInputBox_Editor\"\n        onEscape={onEscape}\n        onChange={onChange}\n      />\n      <div className=\"CommentPlugin_CommentInputBox_Buttons\">\n        <Button\n          onClick={cancelAddComment}\n          className=\"CommentPlugin_CommentInputBox_Button\"\n        >\n          {t('action:Cancel')}\n        </Button>\n        <Button\n          onClick={submitComment}\n          disabled={!canSubmit}\n          className=\"CommentPlugin_CommentInputBox_Button primary\"\n        >\n          {t('action:Comment')}\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nfunction CommentsComposer({\n  submitAddComment,\n  thread,\n  placeholder,\n}: {\n  placeholder?: string;\n  submitAddComment: (\n    commentOrThread: Comment,\n    isInlineComment: boolean,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  thread?: Thread;\n}) {\n  const [content, setContent] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n  const editorRef = useRef<LexicalEditor>(null);\n  const author = useCollabAuthorName();\n\n  const onChange = useOnChange(setContent, setCanSubmit);\n\n  const submitComment = () => {\n    if (canSubmit) {\n      submitAddComment(createComment(content, author), false, thread);\n      const editor = editorRef.current;\n      if (editor !== null) {\n        editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n      }\n    }\n  };\n\n  return (\n    <>\n      <PlainTextEditor\n        className=\"CommentPlugin_CommentsPanel_Editor\"\n        autoFocus={false}\n        onEscape={() => {\n          return true;\n        }}\n        onChange={onChange}\n        editorRef={editorRef}\n        placeholder={placeholder}\n      />\n      <Button\n        className=\"CommentPlugin_CommentsPanel_SendButton\"\n        onClick={submitComment}\n        disabled={!canSubmit}\n      >\n        <i className=\"send\" />\n      </Button>\n    </>\n  );\n}\n\nfunction ShowDeleteCommentOrThreadDialog({\n  commentOrThread,\n  deleteCommentOrThread,\n  onClose,\n  thread = undefined,\n  t,\n}: {\n  commentOrThread: Comment | Thread;\n\n  deleteCommentOrThread: (\n    comment: Comment | Thread,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  onClose: () => void;\n  thread?: Thread;\n  t: TFunction;\n}): JSX.Element {\n  return (\n    <>\n      {`${t('toolbar:commentPlugin.Delete_Comment_Description')} ${\n        commentOrThread.type\n      }?`}\n      <div className=\"Modal__content\">\n        <Button\n          onClick={() => {\n            deleteCommentOrThread(commentOrThread, thread);\n            onClose();\n          }}\n        >\n          {t('action:Delete')}\n        </Button>{' '}\n        <Button\n          onClick={() => {\n            onClose();\n          }}\n        >\n          {t('action:Cancel')}\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction CommentsPanelListComment({\n  comment,\n  deleteComment,\n  thread,\n  rtf,\n  t,\n}: {\n  comment: Comment;\n  deleteComment: (\n    commentOrThread: Comment | Thread,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  thread?: Thread;\n  rtf: null; //FIXME: Intl.RelativeTimeFormat gives build error;\n  t: TFunction;\n}): JSX.Element {\n  const seconds = Math.round((comment.timeStamp - performance.now()) / 1000);\n  const minutes = Math.round(seconds / 60);\n  const [modal, showModal] = useModal();\n\n  return (\n    <li className=\"CommentPlugin_CommentsPanel_List_Comment\">\n      <div className=\"CommentPlugin_CommentsPanel_List_Details\">\n        <span className=\"CommentPlugin_CommentsPanel_List_Comment_Author\">\n          {comment.author}\n        </span>\n        <span className=\"CommentPlugin_CommentsPanel_List_Comment_Time\">\n          {/*  {seconds > -10 ? 'Just now' : rtf.format(minutes, 'minute')} */}\n        </span>\n      </div>\n      <p\n        className={\n          comment.deleted ? 'CommentPlugin_CommentsPanel_DeletedComment' : ''\n        }\n      >\n        {comment.content}\n      </p>\n      {!comment.deleted && (\n        <>\n          <Button\n            onClick={() => {\n              showModal(\n                t('toolbar:commentPlugin.Delete_Comment'),\n                (onClose) => (\n                  <ShowDeleteCommentOrThreadDialog\n                    commentOrThread={comment}\n                    deleteCommentOrThread={deleteComment}\n                    thread={thread}\n                    onClose={onClose}\n                    t={t}\n                  />\n                )\n              );\n            }}\n            className=\"CommentPlugin_CommentsPanel_List_DeleteButton\"\n          >\n            <i className=\"delete\" />\n          </Button>\n          {modal}\n        </>\n      )}\n    </li>\n  );\n}\n\nfunction CommentsPanelList({\n  activeIDs,\n  comments,\n  deleteCommentOrThread,\n  listRef,\n  markNodeMap,\n  submitAddComment,\n  t,\n}: {\n  activeIDs: Array<string>;\n  comments: Comments;\n  deleteCommentOrThread: (\n    commentOrThread: Comment | Thread,\n    thread?: Thread\n  ) => void;\n  listRef: { current: null | HTMLUListElement };\n  markNodeMap: Map<string, Set<NodeKey>>;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean,\n    thread?: Thread\n  ) => void;\n  t: TFunction;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [counter, setCounter] = useState(0);\n  const [modal, showModal] = useModal();\n  // const rtf = useMemo(\n  //   () =>\n  //     new Intl.RelativeTimeFormat('en', {\n  //       localeMatcher: 'best fit',\n  //       numeric: 'auto',\n  //       style: 'short',\n  //     }),\n  //   []\n  // ); //FIXME: it is closed to fix a build error\n  const rtf = null;\n\n  useEffect(() => {\n    // Used to keep the time stamp up to date\n    const id = setTimeout(() => {\n      setCounter(counter + 1);\n    }, 10000);\n\n    return () => {\n      clearTimeout(id);\n    };\n  }, [counter]);\n\n  return (\n    <ul className=\"CommentPlugin_CommentsPanel_List\" ref={listRef}>\n      {comments.map((commentOrThread) => {\n        const id = commentOrThread.id;\n        if (commentOrThread.type === 'thread') {\n          const handleClickThread = () => {\n            const markNodeKeys = markNodeMap.get(id);\n            if (\n              markNodeKeys !== undefined &&\n              (activeIDs === null || activeIDs.indexOf(id) === -1)\n            ) {\n              const activeElement = document.activeElement;\n              // Move selection to the start of the mark, so that we\n              // update the UI with the selected thread.\n              editor.update(\n                () => {\n                  const markNodeKey = Array.from(markNodeKeys)[0];\n                  const markNode = $getNodeByKey<MarkNode>(markNodeKey);\n                  if ($isMarkNode(markNode)) {\n                    markNode.selectStart();\n                  }\n                },\n                {\n                  onUpdate() {\n                    // Restore selection to the previous element\n                    if (activeElement !== null) {\n                      (activeElement as HTMLElement).focus();\n                    }\n                  },\n                }\n              );\n            }\n          };\n\n          return (\n            // eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions\n            <li\n              key={id}\n              onClick={handleClickThread}\n              className={`CommentPlugin_CommentsPanel_List_Thread ${\n                markNodeMap.has(id) ? 'interactive' : ''\n              } ${activeIDs.indexOf(id) === -1 ? '' : 'active'}`}\n            >\n              <div className=\"CommentPlugin_CommentsPanel_List_Thread_QuoteBox\">\n                <blockquote className=\"CommentPlugin_CommentsPanel_List_Thread_Quote\">\n                  {'> '}\n                  <span>{commentOrThread.quote}</span>\n                </blockquote>\n                {/* INTRODUCE DELETE THREAD HERE*/}\n                <Button\n                  onClick={() => {\n                    showModal(\n                      t('toolbar:commentPlugin.Delete_Thread'),\n                      (onClose) => (\n                        <ShowDeleteCommentOrThreadDialog\n                          commentOrThread={commentOrThread}\n                          deleteCommentOrThread={deleteCommentOrThread}\n                          onClose={onClose}\n                          t={t}\n                        />\n                      )\n                    );\n                  }}\n                  className=\"CommentPlugin_CommentsPanel_List_DeleteButton\"\n                >\n                  <i className=\"delete\" />\n                </Button>\n                {modal}\n              </div>\n              <ul className=\"CommentPlugin_CommentsPanel_List_Thread_Comments\">\n                {commentOrThread.comments.map((comment) => (\n                  <CommentsPanelListComment\n                    key={comment.id}\n                    comment={comment}\n                    deleteComment={deleteCommentOrThread}\n                    thread={commentOrThread}\n                    rtf={rtf}\n                    t={t}\n                  />\n                ))}\n              </ul>\n              <div className=\"CommentPlugin_CommentsPanel_List_Thread_Editor\">\n                <CommentsComposer\n                  submitAddComment={submitAddComment}\n                  thread={commentOrThread}\n                  placeholder={t('toolbar:commentPlugin.Reply_to_comment')}\n                />\n              </div>\n            </li>\n          );\n        }\n        return (\n          <CommentsPanelListComment\n            key={id}\n            comment={commentOrThread}\n            deleteComment={deleteCommentOrThread}\n            rtf={rtf}\n            t={t}\n          />\n        );\n      })}\n    </ul>\n  );\n}\n\nfunction CommentsPanel({\n  activeIDs,\n  deleteCommentOrThread,\n  comments,\n  markNodeMap,\n  submitAddComment,\n  t,\n}: {\n  activeIDs: Array<string>;\n  comments: Comments;\n  deleteCommentOrThread: (\n    commentOrThread: Comment | Thread,\n    thread?: Thread\n  ) => void;\n  markNodeMap: Map<string, Set<NodeKey>>;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean,\n    thread?: Thread\n  ) => void;\n  t: TFunction;\n}): JSX.Element {\n  const listRef = useRef<HTMLUListElement>(null);\n  const isEmpty = comments.length === 0;\n\n  return (\n    <div className=\"CommentPlugin_CommentsPanel\">\n      <h2 className=\"CommentPlugin_CommentsPanel_Heading\">\n        {t('toolbar:commentPlugin.Comments')}\n      </h2>\n      {isEmpty ? (\n        <div className=\"CommentPlugin_CommentsPanel_Empty\">\n          {t('toolbar:commentPlugin.No_Comments')}\n        </div>\n      ) : (\n        <CommentsPanelList\n          activeIDs={activeIDs}\n          comments={comments}\n          deleteCommentOrThread={deleteCommentOrThread}\n          listRef={listRef}\n          submitAddComment={submitAddComment}\n          markNodeMap={markNodeMap}\n          t={t}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction useCollabAuthorName(): string {\n  const collabContext = useCollaborationContext();\n  const { yjsDocMap, name } = collabContext;\n  return yjsDocMap.has('comments') ? name : 'Playground User';\n}\n\nexport default function CommentPlugin({\n  providerFactory,\n}: {\n  providerFactory?: (\n    id: string,\n    yjsDocMap: Map<string, Doc>\n  ) => WebsocketProvider;\n}): JSX.Element {\n  const collabContext = useCollaborationContext();\n  const [editor] = useLexicalComposerContext();\n  const commentStore = useMemo(() => new CommentStore(editor), [editor]);\n  const comments = useCommentStore(commentStore);\n  const markNodeMap = useMemo<Map<string, Set<NodeKey>>>(() => {\n    return new Map();\n  }, []);\n  const [activeAnchorKey, setActiveAnchorKey] = useState<NodeKey | null>();\n  const [activeIDs, setActiveIDs] = useState<Array<string>>([]);\n  const [showCommentInput, setShowCommentInput] = useState(false);\n  const [showComments, setShowComments] = useState(false);\n  const { yjsDocMap } = collabContext;\n  const { t } = useTranslation(['toolbar']);\n\n  useEffect(() => {\n    if (providerFactory) {\n      const provider = providerFactory('comments', yjsDocMap);\n      return commentStore.registerCollaboration(provider);\n    }\n  }, [commentStore, providerFactory, yjsDocMap]);\n\n  const cancelAddComment = useCallback(() => {\n    editor.update(() => {\n      const selection = $getSelection();\n      // Restore selection\n      if (selection !== null) {\n        selection.dirty = true;\n      }\n    });\n    setShowCommentInput(false);\n  }, [editor]);\n\n  const deleteCommentOrThread = useCallback(\n    (comment: Comment | Thread, thread?: Thread) => {\n      if (comment.type === 'comment') {\n        const deletionInfo = commentStore.deleteCommentOrThread(\n          comment,\n          thread\n        );\n        if (!deletionInfo) return;\n        const { markedComment, index } = deletionInfo;\n        commentStore.addComment(markedComment, thread, index);\n      } else {\n        commentStore.deleteCommentOrThread(comment);\n        // Remove ids from associated marks\n        const id = thread !== undefined ? thread.id : comment.id;\n        const markNodeKeys = markNodeMap.get(id);\n        if (markNodeKeys !== undefined) {\n          // Do async to avoid causing a React infinite loop\n          setTimeout(() => {\n            editor.update(() => {\n              for (const key of markNodeKeys) {\n                const node: null | MarkNode = $getNodeByKey(key);\n                if ($isMarkNode(node)) {\n                  node.deleteID(id);\n                  if (node.getIDs().length === 0) {\n                    $unwrapMarkNode(node);\n                  }\n                }\n              }\n            });\n          });\n        }\n      }\n    },\n    [commentStore, editor, markNodeMap]\n  );\n\n  const submitAddComment = useCallback(\n    (\n      commentOrThread: Comment | Thread,\n      isInlineComment: boolean,\n      thread?: Thread\n    ) => {\n      commentStore.addComment(commentOrThread, thread);\n      if (isInlineComment) {\n        editor.update(() => {\n          const selection = $getSelection();\n          if ($isRangeSelection(selection)) {\n            const focus = selection.focus;\n            const anchor = selection.anchor;\n            const isBackward = selection.isBackward();\n            const id = commentOrThread.id;\n\n            // Wrap content in a MarkNode\n            $wrapSelectionInMarkNode(selection, isBackward, id);\n\n            // Make selection collapsed at the end\n            if (isBackward) {\n              focus.set(anchor.key, anchor.offset, anchor.type);\n            } else {\n              anchor.set(focus.key, focus.offset, focus.type);\n            }\n          }\n        });\n        setShowCommentInput(false);\n      }\n    },\n    [commentStore, editor]\n  );\n\n  useEffect(() => {\n    const changedElems: Array<HTMLElement> = [];\n    for (let i = 0; i < activeIDs.length; i++) {\n      const id = activeIDs[i];\n      const keys = markNodeMap.get(id);\n      if (keys !== undefined) {\n        for (const key of keys) {\n          const elem = editor.getElementByKey(key);\n          if (elem !== null) {\n            elem.classList.add('selected');\n            changedElems.push(elem);\n            setShowComments(true);\n          }\n        }\n      }\n    }\n    return () => {\n      for (let i = 0; i < changedElems.length; i++) {\n        const changedElem = changedElems[i];\n        changedElem.classList.remove('selected');\n      }\n    };\n  }, [activeIDs, editor, markNodeMap]);\n\n  useEffect(() => {\n    const markNodeKeysToIDs: Map<NodeKey, Array<string>> = new Map();\n\n    return mergeRegister(\n      registerNestedElementResolver<MarkNode>(\n        editor,\n        MarkNode,\n        (from: MarkNode) => {\n          return $createMarkNode(from.getIDs());\n        },\n        (from: MarkNode, to: MarkNode) => {\n          // Merge the IDs\n          const ids = from.getIDs();\n          ids.forEach((id) => {\n            to.addID(id);\n          });\n        }\n      ),\n      editor.registerMutationListener(MarkNode, (mutations) => {\n        editor.getEditorState().read(() => {\n          for (const [key, mutation] of mutations) {\n            const node: null | MarkNode = $getNodeByKey(key);\n            let ids: NodeKey[] = [];\n\n            if (mutation === 'destroyed') {\n              ids = markNodeKeysToIDs.get(key) || [];\n            } else if ($isMarkNode(node)) {\n              ids = node.getIDs();\n            }\n\n            for (let i = 0; i < ids.length; i++) {\n              const id = ids[i];\n              let markNodeKeys = markNodeMap.get(id);\n              markNodeKeysToIDs.set(key, ids);\n\n              if (mutation === 'destroyed') {\n                if (markNodeKeys !== undefined) {\n                  markNodeKeys.delete(key);\n                  if (markNodeKeys.size === 0) {\n                    markNodeMap.delete(id);\n                  }\n                }\n              } else {\n                if (markNodeKeys === undefined) {\n                  markNodeKeys = new Set();\n                  markNodeMap.set(id, markNodeKeys);\n                }\n                if (!markNodeKeys.has(key)) {\n                  markNodeKeys.add(key);\n                }\n              }\n            }\n          }\n        });\n      }),\n      editor.registerUpdateListener(({ editorState, tags }) => {\n        editorState.read(() => {\n          const selection = $getSelection();\n          let hasActiveIds = false;\n          let hasAnchorKey = false;\n\n          if ($isRangeSelection(selection)) {\n            const anchorNode = selection.anchor.getNode();\n\n            if ($isTextNode(anchorNode)) {\n              const commentIDs = $getMarkIDs(\n                anchorNode,\n                selection.anchor.offset\n              );\n              if (commentIDs !== null) {\n                setActiveIDs(commentIDs);\n                hasActiveIds = true;\n              }\n              if (!selection.isCollapsed()) {\n                setActiveAnchorKey(anchorNode.getKey());\n                hasAnchorKey = true;\n              }\n            }\n          }\n          if (!hasActiveIds) {\n            setActiveIDs((_activeIds) =>\n              _activeIds.length === 0 ? _activeIds : []\n            );\n          }\n          if (!hasAnchorKey) {\n            setActiveAnchorKey(null);\n          }\n        });\n        if (!tags.has('collaboration')) {\n          setShowCommentInput(false);\n        }\n      }),\n      editor.registerCommand(\n        INSERT_INLINE_COMMAND,\n        () => {\n          const domSelection = window.getSelection();\n          if (domSelection !== null) {\n            domSelection.removeAllRanges();\n          }\n          setShowCommentInput(true);\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR\n      )\n    );\n  }, [editor, markNodeMap]);\n\n  const onAddComment = () => {\n    editor.dispatchCommand(INSERT_INLINE_COMMAND, undefined);\n  };\n\n  return (\n    <>\n      {showCommentInput &&\n        createPortal(\n          <CommentInputBox\n            editor={editor}\n            cancelAddComment={cancelAddComment}\n            submitAddComment={submitAddComment}\n            t={t}\n          />,\n          document.body\n        )}\n      {activeAnchorKey !== null &&\n        activeAnchorKey !== undefined &&\n        !showCommentInput &&\n        createPortal(\n          <AddCommentBox\n            anchorKey={activeAnchorKey}\n            editor={editor}\n            onAddComment={onAddComment}\n          />,\n          document.body\n        )}\n      {createPortal(\n        <Button\n          className={`CommentPlugin_ShowCommentsButton ${\n            showComments ? 'active' : ''\n          }`}\n          onClick={() => setShowComments(!showComments)}\n          title={\n            showComments\n              ? t('toolbar:commentPlugin.Hide_Comments')\n              : t('toolbar:commentPlugin.Show_Comments')\n          }\n        >\n          <i className=\"comments\" />\n        </Button>,\n        document.body\n      )}\n      {showComments &&\n        createPortal(\n          <CommentsPanel\n            comments={comments}\n            submitAddComment={submitAddComment}\n            deleteCommentOrThread={deleteCommentOrThread}\n            activeIDs={activeIDs}\n            markNodeMap={markNodeMap}\n            t={t}\n          />,\n          document.body\n        )}\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { $isCodeHighlightNode } from '@lexical/code';\nimport { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $isAtNodeEnd } from '@lexical/selection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  FORMAT_TEXT_COMMAND,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\n\nimport { INSERT_INLINE_COMMAND } from './CommentPlugin';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nfunction setPopupPosition(\n  editor: HTMLElement,\n  rect: ClientRect,\n  rootElementRect: ClientRect\n): void {\n  let top = rect.top - 8 + window.pageYOffset;\n  let left =\n    rect.left + 340 + window.pageXOffset - editor.offsetWidth + rect.width;\n  if (\n    rect.width >= rootElementRect.width - 20 ||\n    left > rootElementRect.width - 150\n  ) {\n    left = rect.left;\n    top = rect.top - 50 + window.pageYOffset;\n  }\n  if (top < rootElementRect.top) {\n    top = rect.bottom + 20;\n  }\n  editor.style.opacity = '1';\n  editor.style.top = `${top}px`;\n  editor.style.left = `${left}px`;\n}\n\nfunction FloatingCharacterStylesEditor({\n  editor,\n  isLink,\n  isBold,\n  isItalic,\n  isUnderline,\n  isCode,\n  isStrikethrough,\n  isSubscript,\n  isSuperscript,\n  t,\n}: {\n  editor: LexicalEditor;\n  isBold: boolean;\n  isCode: boolean;\n  isItalic: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  isUnderline: boolean;\n  t: TFunction;\n}): JSX.Element {\n  const popupCharStylesEditorRef = useRef<HTMLDivElement | null>(null);\n  const mouseDownRef = useRef(false);\n\n  const insertLink = useCallback(() => {\n    if (!isLink) {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n    } else {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n    }\n  }, [editor, isLink]);\n\n  const insertComment = () => {\n    editor.dispatchCommand(INSERT_INLINE_COMMAND, null);\n  };\n\n  const updateCharacterStylesEditor = useCallback(() => {\n    const selection = $getSelection();\n\n    const popupCharStylesEditorElem = popupCharStylesEditorRef.current;\n    const nativeSelection = window.getSelection();\n\n    if (popupCharStylesEditorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      nativeSelection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      const rootElementRect = rootElement.getBoundingClientRect();\n      let rect;\n\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      if (!mouseDownRef.current) {\n        setPopupPosition(popupCharStylesEditorElem, rect, rootElementRect);\n      }\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateCharacterStylesEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateCharacterStylesEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateCharacterStylesEditor();\n    });\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateCharacterStylesEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateCharacterStylesEditor();\n          return false;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, updateCharacterStylesEditor]);\n\n  return (\n    <div ref={popupCharStylesEditorRef} className=\"verbum-character-style-popup\">\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n        }}\n        className={'verbum-popup-item spaced ' + (isBold ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_text_as_bold')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-bold\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n        }}\n        className={'verbum-popup-item spaced ' + (isItalic ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_as_italics'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-italic\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n        }}\n        className={'verbum-popup-item spaced ' + (isUnderline ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_to_underlined'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-underline\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={'verbum-popup-item spaced ' + (isStrikethrough ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_with_a_strikethrough'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-strikethrough\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'verbum-popup-item spaced ' + (isSubscript ? 'active' : '')}\n        title=\"Subscript\"\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_Subscript')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-subscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={'verbum-popup-item spaced ' + (isSuperscript ? 'active' : '')}\n        title=\"Superscript\"\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_Superscript')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-superscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n        }}\n        className={'verbum-popup-item spaced ' + (isCode ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Insert_code_block')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-code\" />\n      </button>\n      <button\n        onClick={insertLink}\n        className={'verbum-popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Insert_link')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-link\" />\n      </button>\n      <button\n        onClick={insertComment}\n        className={'verbum-popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Add_comment')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-add-comment\" />\n      </button>\n    </div>\n  );\n}\n\nfunction getSelectedNode(selection: RangeSelection): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n\nfunction useCharacterStylesPopup(editor: LexicalEditor): JSX.Element | null {\n  const [isText, setIsText] = useState(false);\n  const [isLink, setIsLink] = useState(false);\n  const [isBold, setIsBold] = useState(false);\n  const [isItalic, setIsItalic] = useState(false);\n  const [isUnderline, setIsUnderline] = useState(false);\n  const [isStrikethrough, setIsStrikethrough] = useState(false);\n  const [isSubscript, setIsSubscript] = useState(false);\n  const [isSuperscript, setIsSuperscript] = useState(false);\n  const [isCode, setIsCode] = useState(false);\n  const { t } = useTranslation(['toolbar']);\n\n  const updatePopup = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n      const nativeSelection = window.getSelection();\n      const rootElement = editor.getRootElement();\n\n      if (\n        nativeSelection !== null &&\n        (!$isRangeSelection(selection) ||\n          rootElement === null ||\n          !rootElement.contains(nativeSelection.anchorNode))\n      ) {\n        setIsText(false);\n        return;\n      }\n\n      if (!$isRangeSelection(selection)) {\n        return;\n      }\n\n      const node = getSelectedNode(selection);\n\n      // Update text format\n      setIsBold(selection.hasFormat('bold'));\n      setIsItalic(selection.hasFormat('italic'));\n      setIsUnderline(selection.hasFormat('underline'));\n      setIsStrikethrough(selection.hasFormat('strikethrough'));\n      setIsSubscript(selection.hasFormat('subscript'));\n      setIsSuperscript(selection.hasFormat('superscript'));\n      setIsCode(selection.hasFormat('code'));\n\n      // Update links\n      const parent = node.getParent();\n      if ($isLinkNode(parent) || $isLinkNode(node)) {\n        setIsLink(true);\n      } else {\n        setIsLink(false);\n      }\n\n      if (\n        !$isCodeHighlightNode(selection.anchor.getNode()) &&\n        selection.getTextContent() !== ''\n      ) {\n        setIsText($isTextNode(node));\n      } else {\n        setIsText(false);\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    document.addEventListener('selectionchange', updatePopup);\n    return () => {\n      document.removeEventListener('selectionchange', updatePopup);\n    };\n  }, [updatePopup]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      updatePopup();\n    });\n  }, [editor, updatePopup]);\n\n  if (!isText || isLink) {\n    return null;\n  }\n\n  return createPortal(\n    <FloatingCharacterStylesEditor\n      editor={editor}\n      isLink={isLink}\n      isBold={isBold}\n      isItalic={isItalic}\n      isStrikethrough={isStrikethrough}\n      isSubscript={isSubscript}\n      isSuperscript={isSuperscript}\n      isUnderline={isUnderline}\n      isCode={isCode}\n      t={t}\n    />,\n    document.body\n  );\n}\n\nexport default function CharacterStylesPopupPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n  return useCharacterStylesPopup(editor);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LinkNode } from '@lexical/link';\nimport type { LexicalEditor } from 'lexical';\n\nimport { $isLinkNode } from '@lexical/link';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getNearestNodeFromDOMNode } from 'lexical';\nimport { useEffect, useRef } from 'react';\n\ntype LinkFilter = (event: MouseEvent, linkNode: LinkNode) => boolean;\nexport default function ClickableLinkPlugin({\n  filter,\n  newTab = true,\n}: {\n  filter?: LinkFilter;\n  newTab?: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const hasMoved = useRef(false);\n  useEffect(() => {\n    let prevOffsetX;\n    let prevOffsetY;\n\n    function onPointerDown(event: PointerEvent) {\n      prevOffsetX = event.offsetX;\n      prevOffsetY = event.offsetY;\n    }\n\n    function onPointerUp(event: PointerEvent) {\n      hasMoved.current =\n        event.offsetX !== prevOffsetX || event.offsetY !== prevOffsetY;\n    }\n\n    function onClick(e: Event) {\n      // Based on pointerdown/up we can check if cursor moved during click event,\n      // and ignore clicks with moves (to allow link text selection)\n      const hasMovedDuringClick = hasMoved.current;\n      hasMoved.current = false;\n      // $FlowExpectedError[incompatible-cast] onClick handler will get MouseEvent, safe to cast\n      const event = e as MouseEvent;\n      const linkDomNode = getLinkDomNode(event, editor);\n\n      if (linkDomNode === null) {\n        return;\n      }\n\n      const href = linkDomNode.getAttribute('href');\n\n      if (\n        linkDomNode.getAttribute('contenteditable') === 'false' ||\n        href === undefined\n      ) {\n        return;\n      }\n\n      let linkNode = null;\n      editor.update(() => {\n        const maybeLinkNode = $getNearestNodeFromDOMNode(linkDomNode);\n\n        if ($isLinkNode(maybeLinkNode)) {\n          linkNode = maybeLinkNode;\n        }\n      });\n\n      if (\n        linkNode === null ||\n        (filter !== undefined && !filter(event, linkNode))\n      ) {\n        return;\n      }\n\n      if (hasMovedDuringClick) {\n        return;\n      }\n\n      try {\n        window.open(\n          href,\n          newTab || event.metaKey || event.ctrlKey ? '_blank' : '_self'\n        );\n      } catch {\n        // It didn't work, which is better than throwing an exception!\n      }\n    }\n\n    return editor.registerRootListener(\n      (\n        rootElement: null | HTMLElement,\n        prevRootElement: null | HTMLElement\n      ) => {\n        if (prevRootElement !== null) {\n          prevRootElement.removeEventListener('pointerdown', onPointerDown);\n          prevRootElement.removeEventListener('pointerup', onPointerUp);\n          prevRootElement.removeEventListener('click', onClick);\n        }\n\n        if (rootElement !== null) {\n          rootElement.addEventListener('click', onClick);\n          rootElement.addEventListener('pointerdown', onPointerDown);\n          rootElement.addEventListener('pointerup', onPointerUp);\n        }\n      }\n    );\n  }, [editor, filter, newTab]);\n  return null;\n}\n\nfunction isLinkDomNode(domNode: Node): boolean {\n  return domNode.nodeName.toLowerCase() === 'a';\n}\n\nfunction getLinkDomNode(\n  event: MouseEvent,\n  editor: LexicalEditor\n): HTMLAnchorElement | null {\n  return editor.getEditorState().read(() => {\n    // $FlowExpectedError[incompatible-cast]\n    const domNode = event.target as Node;\n\n    if (isLinkDomNode(domNode)) {\n      // $FlowExpectedError[incompatible-cast]\n      return domNode as HTMLAnchorElement;\n    }\n\n    if (domNode.parentNode && isLinkDomNode(domNode.parentNode)) {\n      // $FlowExpectedError[incompatible-cast]\n      return domNode.parentNode as HTMLAnchorElement;\n    }\n\n    return null;\n  });\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { registerCodeHighlighting } from '@lexical/code';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useEffect } from 'react';\n\nexport default function CodeHighlightPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return registerCodeHighlighting(editor);\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { TextNode } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useLexicalTextEntity } from '@lexical/react/useLexicalTextEntity';\nimport { useCallback, useEffect } from 'react';\n\nimport { $createKeywordNode, KeywordNode } from '../nodes/KeywordNode';\n\nconst KEYWORDS_REGEX =\n  /(^|$|[^A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------])(congrats|congratulations|gratuluju|gratuluji|gratulujeme|blahopeju|blahopeji|blahopejeme|Til lykke|Tillykke|Glckwunsch|Gratuliere|felicitaciones|enhorabuena|paljon onnea|onnittelut|Flicitations|gratula|gratullok|gratullunk|congratulazioni|complimenti|||||gratulerer|Gefeliciteerd|gratulacje|Parabns|parabns|felicitaes|felicitri| |||gratulujem|blahoelm|||tebrikler|tebrik ederim||||||baie geluk|veels geluk||estitam|estitke|estitamo||||badhai|||| |hongera|||||Chc mng| |mazel tov|mazal tov)(^|$|[^A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------])/i;\n\nexport default function KeywordsPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([KeywordNode])) {\n      throw new Error('KeywordsPlugin: KeywordNode not registered on editor');\n    }\n  }, [editor]);\n\n  const createKeywordNode = useCallback((textNode: TextNode): KeywordNode => {\n    return $createKeywordNode(textNode.getTextContent());\n  }, []);\n\n  const getKeywordMatch = useCallback((text: string) => {\n    const matchArr = KEYWORDS_REGEX.exec(text);\n\n    if (matchArr === null) {\n      return null;\n    }\n\n    const hashtagLength = matchArr[2].length;\n    const startOffset = matchArr.index + matchArr[1].length;\n    const endOffset = startOffset + hashtagLength;\n    return {\n      end: endOffset,\n      start: startOffset,\n    };\n  }, []);\n\n  useLexicalTextEntity<KeywordNode>(\n    getKeywordMatch,\n    KeywordNode,\n    createKeywordNode\n  );\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { RangeSelection } from 'lexical';\n\nimport { $getListDepth, $isListItemNode, $isListNode } from '@lexical/list';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isElementNode,\n  $isRangeSelection,\n  COMMAND_PRIORITY_CRITICAL,\n  ElementNode,\n  INDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport { useEffect } from 'react';\n\ntype Props = Readonly<{\n  maxDepth: number | null | undefined;\n}>;\n\nfunction getElementNodesInSelection(\n  selection: RangeSelection\n): Set<ElementNode> {\n  const nodesInSelection = selection.getNodes();\n\n  if (nodesInSelection.length === 0) {\n    return new Set([\n      selection.anchor.getNode().getParentOrThrow(),\n      selection.focus.getNode().getParentOrThrow(),\n    ]);\n  }\n\n  return new Set(\n    nodesInSelection.map((n) => ($isElementNode(n) ? n : n.getParentOrThrow()))\n  );\n}\n\nfunction isIndentPermitted(maxDepth: number): boolean {\n  const selection = $getSelection();\n\n  if (!$isRangeSelection(selection)) {\n    return false;\n  }\n\n  const elementNodesInSelection: Set<ElementNode> =\n    getElementNodesInSelection(selection);\n\n  let totalDepth = 0;\n\n  for (const elementNode of elementNodesInSelection) {\n    if ($isListNode(elementNode)) {\n      totalDepth = Math.max($getListDepth(elementNode) + 1, totalDepth);\n    } else if ($isListItemNode(elementNode)) {\n      const parent = elementNode.getParent();\n\n      if (!$isListNode(parent)) {\n        throw new Error(\n          'ListMaxIndentLevelPlugin: A ListItemNode must have a ListNode for a parent.'\n        );\n      }\n\n      totalDepth = Math.max($getListDepth(parent) + 1, totalDepth);\n    }\n  }\n\n  return totalDepth <= maxDepth;\n}\n\nexport default function ListMaxIndentLevelPlugin({ maxDepth }: Props): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INDENT_CONTENT_COMMAND,\n      () => !isIndentPermitted(maxDepth ?? 7),\n      COMMAND_PRIORITY_CRITICAL\n    );\n  }, [editor, maxDepth]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n *\n */\n\nimport { MarkdownShortcutPlugin } from '@lexical/react/LexicalMarkdownShortcutPlugin';\nimport * as React from 'react';\n\nimport { PLAYGROUND_TRANSFORMERS } from './MarkdownTransformers';\n\nexport default function MarkdownPlugin(): JSX.Element {\n  return <MarkdownShortcutPlugin transformers={PLAYGROUND_TRANSFORMERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $setSelection,\n  FOCUS_COMMAND,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nconst COMMAND_PRIORITY_LOW = 1;\nconst TAB_TO_FOCUS_INTERVAL = 100;\n\nlet lastTabKeyDownTimestamp = 0;\nlet hasRegisteredKeyDownListener = false;\n\nfunction registerKeyTimeStampTracker() {\n  window.addEventListener(\n    'keydown',\n    (event: KeyboardEvent) => {\n      // Tab\n      if (event.keyCode === 9) {\n        lastTabKeyDownTimestamp = event.timeStamp;\n      }\n    },\n    true\n  );\n}\n\nexport default function TabFocusPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!hasRegisteredKeyDownListener) {\n      registerKeyTimeStampTracker();\n      hasRegisteredKeyDownListener = true;\n    }\n\n    return editor.registerCommand(\n      FOCUS_COMMAND,\n      (event: FocusEvent) => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n          if (\n            lastTabKeyDownTimestamp + TAB_TO_FOCUS_INTERVAL >\n            event.timeStamp\n          ) {\n            $setSelection(selection.clone());\n          }\n        }\n        return false;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n  }, [editor]);\n\n  return null;\n}\n","import { LexicalEditor } from 'lexical';\nimport React, { createContext } from 'react';\n\ninterface IEditorContext {\n  initialEditor: LexicalEditor;\n  activeEditor: LexicalEditor;\n  setActiveEditor: React.Dispatch<React.SetStateAction<LexicalEditor>>;\n}\n\nconst EditorContext = createContext<IEditorContext | null>(null);\n\nexport default EditorContext;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Dialog.css';\n\nimport * as React from 'react';\nimport { ReactNode } from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  children: ReactNode;\n}>;\n\nexport function DialogButtonsList({ children }: Props): JSX.Element {\n  return <div className=\"DialogButtonsList\">{children}</div>;\n}\n\nexport function DialogActions({\n  'data-test-id': dataTestId,\n  children,\n}: Props): JSX.Element {\n  return (\n    <div className=\"DialogActions\" data-test-id={dataTestId}>\n      {children}\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  accept?: string;\n  label: string;\n  onChange: (files: FileList) => void;\n}>;\n\nexport default function FileInput({\n  accept,\n  label,\n  onChange,\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"file\"\n        accept={accept}\n        className=\"Input__input\"\n        onChange={(e) => onChange(e.target.files)}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  label: string;\n  onChange: (string) => void;\n  placeholder?: string;\n  value: string;\n}>;\n\nexport default function TextInput({\n  label,\n  value,\n  onChange,\n  placeholder = '',\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"text\"\n        className=\"Input__input\"\n        placeholder={placeholder}\n        value={value}\n        onChange={(e) => {\n          onChange(e.target.value);\n        }}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $wrapNodeInElement, mergeRegister } from '@lexical/utils';\nimport {\n  $createParagraphNode,\n  $createRangeSelection,\n  $getSelection,\n  $insertNodes,\n  $isNodeSelection,\n  $isRootOrShadowRoot,\n  $setSelection,\n  COMMAND_PRIORITY_EDITOR,\n  COMMAND_PRIORITY_HIGH,\n  COMMAND_PRIORITY_LOW,\n  createCommand,\n  DRAGOVER_COMMAND,\n  DRAGSTART_COMMAND,\n  DROP_COMMAND,\n  LexicalCommand,\n  LexicalEditor,\n} from 'lexical';\nimport { useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\n\nimport {\n  $createImageNode,\n  $isImageNode,\n  ImageNode,\n  ImagePayload,\n} from '../nodes/ImageNode';\nimport Button from '../ui/Button';\nimport { DialogActions, DialogButtonsList } from '../ui/Dialog';\nimport FileInput from '../ui/FileInput';\nimport TextInput from '../ui/TextInput';\n\nexport type InsertImagePayload = Readonly<ImagePayload>;\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n\nconst getDOMSelection = (targetWindow: Window | null): Selection | null =>\n  CAN_USE_DOM ? (targetWindow || window).getSelection() : null;\n\nexport const INSERT_IMAGE_COMMAND: LexicalCommand<InsertImagePayload> =\n  createCommand('INSERT_IMAGE_COMMAND');\n\nexport function InsertImageUriDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  return (\n    <>\n      <TextInput\n        label=\"Image URL\"\n        placeholder=\"i.e. https://source.unsplash.com/random\"\n        onChange={setSrc}\n        value={src}\n        data-test-id=\"image-modal-url-input\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Random unsplash image\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <DialogActions>\n        <Button\n          data-test-id=\"image-modal-confirm-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </DialogActions>\n    </>\n  );\n}\n\nexport function InsertImageUploadedDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  const loadImage = (files: FileList | null) => {\n    const reader = new FileReader();\n    reader.onload = function () {\n      if (typeof reader.result === 'string') {\n        setSrc(reader.result);\n      }\n      return '';\n    };\n    if (files !== null) {\n      reader.readAsDataURL(files[0]);\n    }\n  };\n\n  return (\n    <>\n      <FileInput\n        label=\"Image Upload\"\n        onChange={loadImage}\n        accept=\"image/*\"\n        data-test-id=\"image-modal-file-upload\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Descriptive alternative text\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <DialogActions>\n        <Button\n          data-test-id=\"image-modal-file-upload-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </DialogActions>\n    </>\n  );\n}\n\nexport const InsertImageDialog = ({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element => {\n  const [mode, setMode] = useState<null | 'url' | 'file'>(null);\n  const hasModifier = useRef(false);\n\n  useEffect(() => {\n    hasModifier.current = false;\n    const handler = (e: KeyboardEvent) => {\n      hasModifier.current = e.altKey;\n    };\n    document.addEventListener('keydown', handler);\n    return () => {\n      document.removeEventListener('keydown', handler);\n    };\n  }, [activeEditor]);\n\n  const onClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n    onClose();\n  };\n\n  return (\n    <>\n      {!mode && (\n        <DialogButtonsList>\n          <Button\n            data-test-id=\"image-modal-option-url\"\n            onClick={() => setMode('url')}\n          >\n            URL\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-file\"\n            onClick={() => setMode('file')}\n          >\n            File\n          </Button>\n        </DialogButtonsList>\n      )}\n      {mode === 'url' && <InsertImageUriDialogBody onClick={onClick} />}\n      {mode === 'file' && <InsertImageUploadedDialogBody onClick={onClick} />}\n    </>\n  );\n}\n\nexport default function ImagesPlugin({\n  captionsEnabled,\n  maxWidth,\n}: {\n  captionsEnabled?: boolean;\n  maxWidth?: number;\n}): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([ImageNode])) {\n      throw new Error('ImagesPlugin: ImageNode not registered on editor');\n    }\n\n    return mergeRegister(\n      editor.registerCommand<InsertImagePayload>(\n        INSERT_IMAGE_COMMAND,\n        (payload) => {\n          const imageNode = $createImageNode({\n            ...payload,\n            maxWidth: maxWidth,\n          });\n          $insertNodes([imageNode]);\n          if ($isRootOrShadowRoot(imageNode.getParentOrThrow())) {\n            $wrapNodeInElement(imageNode, $createParagraphNode).selectEnd();\n          }\n\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGSTART_COMMAND,\n        (event) => {\n          return onDragStart(event);\n        },\n        COMMAND_PRIORITY_HIGH\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGOVER_COMMAND,\n        (event) => {\n          return onDragover(event);\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand<DragEvent>(\n        DROP_COMMAND,\n        (event) => {\n          return onDrop(event, editor);\n        },\n        COMMAND_PRIORITY_HIGH\n      )\n    );\n  }, [captionsEnabled, editor]);\n\n  return null;\n}\n\nconst TRANSPARENT_IMAGE =\n  'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\nconst img = document.createElement('img');\nimg.src = TRANSPARENT_IMAGE;\n\nfunction onDragStart(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const dataTransfer = event.dataTransfer;\n  if (!dataTransfer) {\n    return false;\n  }\n  dataTransfer.setData('text/plain', '_');\n  dataTransfer.setDragImage(img, 0, 0);\n  dataTransfer.setData(\n    'application/x-lexical-drag',\n    JSON.stringify({\n      data: {\n        altText: node.__altText,\n        caption: node.__caption,\n        height: node.__height,\n        key: node.getKey(),\n        maxWidth: node.__maxWidth,\n        showCaption: node.__showCaption,\n        src: node.__src,\n        width: node.__width,\n      },\n      type: 'image',\n    })\n  );\n\n  return true;\n}\n\nfunction onDragover(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  if (!canDropImage(event)) {\n    event.preventDefault();\n  }\n  return true;\n}\n\nfunction onDrop(event: DragEvent, editor: LexicalEditor): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const data = getDragImageData(event);\n  if (!data) {\n    return false;\n  }\n  event.preventDefault();\n  if (canDropImage(event)) {\n    const range = getDragSelection(event);\n    node.remove();\n    const rangeSelection = $createRangeSelection();\n    if (range !== null && range !== undefined) {\n      rangeSelection.applyDOMRange(range);\n    }\n    $setSelection(rangeSelection);\n    editor.dispatchCommand(INSERT_IMAGE_COMMAND, data);\n  }\n  return true;\n}\n\nfunction getImageNodeInSelection(): ImageNode | null {\n  const selection = $getSelection();\n  if (!$isNodeSelection(selection)) {\n    return null;\n  }\n  const nodes = selection.getNodes();\n  const node = nodes[0];\n  return $isImageNode(node) ? node : null;\n}\n\nfunction getDragImageData(event: DragEvent): null | InsertImagePayload {\n  const dragData = event.dataTransfer?.getData('application/x-lexical-drag');\n  if (!dragData) {\n    return null;\n  }\n  const { type, data } = JSON.parse(dragData);\n  if (type !== 'image') {\n    return null;\n  }\n\n  return data;\n}\n\ndeclare global {\n  interface DragEvent {\n    rangeOffset?: number;\n    rangeParent?: Node;\n  }\n}\n\nfunction canDropImage(event: DragEvent): boolean {\n  const target = event.target;\n  return !!(\n    target &&\n    target instanceof HTMLElement &&\n    !target.closest('code, span.editor-image') &&\n    target.parentElement &&\n    target.parentElement.closest('div.ContentEditable__root')\n  );\n}\n\nfunction getDragSelection(event: DragEvent): Range | null | undefined {\n  let range;\n  const target = event.target as null | Element | Document;\n  const targetWindow =\n    target == null\n      ? null\n      : target.nodeType === 9\n      ? (target as Document).defaultView\n      : (target as Element).ownerDocument.defaultView;\n  const domSelection = getDOMSelection(targetWindow);\n  if (document.caretRangeFromPoint) {\n    range = document.caretRangeFromPoint(event.clientX, event.clientY);\n  } else if (event.rangeParent && domSelection !== null) {\n    domSelection.collapse(event.rangeParent, event.rangeOffset || 0);\n    range = domSelection.getRangeAt(0);\n  } else {\n    throw Error(`Cannot get the selection when dragging`);\n  }\n\n  return range;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { DRAG_DROP_PASTE } from '@lexical/rich-text';\nimport { isMimeType, mediaFileReader } from '@lexical/utils';\nimport { COMMAND_PRIORITY_LOW } from 'lexical';\nimport { useEffect } from 'react';\n\nimport { INSERT_IMAGE_COMMAND } from './ImagesPlugin';\n\nconst ACCEPTABLE_IMAGE_TYPES = [\n  'image/',\n  'image/heic',\n  'image/heif',\n  'image/gif',\n  'image/webp',\n];\n\nexport default function DragDropPaste(): null {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    return editor.registerCommand(\n      DRAG_DROP_PASTE,\n      (files) => {\n        (async () => {\n          const filesResult = await mediaFileReader(\n            files,\n            [ACCEPTABLE_IMAGE_TYPES].flatMap((x) => x)\n          );\n          for (const { file, result } of filesResult) {\n            if (isMimeType(file, ACCEPTABLE_IMAGE_TYPES)) {\n              editor.dispatchCommand(INSERT_IMAGE_COMMAND, {\n                altText: file.name,\n                src: result,\n              });\n            }\n          }\n        })();\n        return true;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n  }, [editor]);\n  return null;\n}\n","import { $isAtNodeEnd } from '@lexical/selection';\nimport { ElementNode, RangeSelection, TextNode } from 'lexical';\n\nexport function getSelectedNode(\n  selection: RangeSelection\n): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n","import { LexicalEditor } from 'lexical';\nimport React, { createContext } from 'react';\n\ninterface IToolbarContext {\n  isRTL: boolean;\n  isBold: boolean;\n  isItalic: boolean;\n  isUnderline: boolean;\n  isCode: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  canUndo: boolean;\n  canRedo: boolean;\n  fontFamily: string;\n  fontSize: string;\n  fontColor: string;\n  bgColor: string;\n  blockType: string;\n  codeLanguage: string;\n  selectedElementKey: string;\n  applyStyleText: (styles: Record<string, string>) => void;\n  insertLink: () => void;\n}\n\nconst ToolbarContext = createContext<IToolbarContext | null>(null);\n\nexport default ToolbarContext;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\n\nexport default function DropDown({\n  buttonLabel,\n  buttonAriaLabel,\n  buttonClassName,\n  buttonIconClassName,\n  children,\n  stopCloseOnClickSelf,\n}: {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  children: JSX.Element | string | (JSX.Element | string)[];\n  stopCloseOnClickSelf?: boolean;\n}): JSX.Element {\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const buttonRef = useRef<HTMLButtonElement | null>(null);\n  const [showDropDown, setShowDropDown] = useState(false);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n    const dropDown = dropDownRef.current;\n\n    if (showDropDown && button !== null && dropDown !== null) {\n      const { top, left } = button.getBoundingClientRect();\n      dropDown.style.top = `${top + 40}px`;\n      dropDown.style.left = `${Math.min(\n        left,\n        window.innerWidth - dropDown.offsetWidth - 20\n      )}px`;\n    }\n  }, [dropDownRef, buttonRef, showDropDown]);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n\n    if (button !== null && showDropDown) {\n      const handle = (event: MouseEvent) => {\n        const target = event.target;\n        if (stopCloseOnClickSelf) {\n          if (dropDownRef.current.contains(target as Node)) return;\n        }\n        if (!button.contains(target as Node)) {\n          setShowDropDown(false);\n        }\n      };\n      document.addEventListener('click', handle);\n\n      return () => {\n        document.removeEventListener('click', handle);\n      };\n    }\n  }, [dropDownRef, buttonRef, showDropDown, stopCloseOnClickSelf]);\n\n  return (\n    <>\n      <button\n        aria-label={buttonAriaLabel || buttonLabel}\n        className={buttonClassName}\n        onClick={() => setShowDropDown(!showDropDown)}\n        ref={buttonRef}\n        type=\"button\"\n      >\n        {buttonIconClassName && <span className={buttonIconClassName} />}\n        {buttonLabel && (\n          <span className=\"verbum-text verbum-dropdown-button-text\">{buttonLabel}</span>\n        )}\n        <i className=\"verbum-chevron-down\" />\n      </button>\n\n      {showDropDown &&\n        createPortal(\n          <div className=\"verbum-dropdown\" ref={dropDownRef}>\n            {children}\n          </div>,\n          document.body\n        )}\n    </>\n  );\n}\n","import React, { useContext } from 'react';\nimport DropDown from '../../../ui/DropDown';\n\nimport {\n  FORMAT_ELEMENT_COMMAND,\n  INDENT_CONTENT_COMMAND,\n  LexicalEditor,\n  OUTDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nfunction Divider(): JSX.Element {\n  return <div className=\"verbum-divider\" />;\n}\n\nconst AlignDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isRTL } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <DropDown\n      buttonLabel={t('toolbar:alignDropdown.Title')}\n      buttonAriaLabel={t('toolbar:alignDropdown.Description')}\n      buttonClassName=\"verbum-toolbar-item spaced alignment\"\n      buttonIconClassName=\"verbum-icon verbum-left-align\"\n    >\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'left');\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-left-align\" />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.LeftAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'center');\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-center-align\" />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.CenterAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'right');\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-right-align\" />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.RightAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'justify');\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-justify-align\" />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.JustifyAlign')}</span>\n      </button>\n      <Divider />\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(OUTDENT_CONTENT_COMMAND, undefined);\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className={'icon ' + (isRTL ? 'indent' : 'outdent')} />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.Outdent')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(INDENT_CONTENT_COMMAND, undefined);\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className={'icon ' + (isRTL ? 'outdent' : 'indent')} />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.Indent')}</span>\n      </button>\n    </DropDown>\n  );\n};\n\nexport default AlignDropdown;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isRootNode,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createPollNode, PollNode } from '../nodes/PollNode';\n\nexport const INSERT_POLL_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function PollPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    if (!editor.hasNodes([PollNode])) {\n      throw new Error('PollPlugin: PollNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_POLL_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const question = payload;\n          const pollNode = $createPollNode(question);\n\n          if ($isRootNode(selection.anchor.getNode())) {\n            selection.insertParagraph();\n          }\n\n          selection.insertNodes([pollNode]);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createYouTubeNode, YouTubeNode } from '../nodes/YouTubeNode';\n\nexport const INSERT_YOUTUBE_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function YouTubePlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([YouTubeNode])) {\n      throw new Error('YouTubePlugin: YouTubeNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_YOUTUBE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const focusNode = selection.focus.getNode();\n\n          if (focusNode !== null) {\n            const youTubeNode = $createYouTubeNode(payload);\n            selection.focus\n              .getNode()\n              .getTopLevelElementOrThrow()\n              .insertAfter(youTubeNode);\n            const paragraphNode = $createParagraphNode();\n            youTubeNode.insertAfter(paragraphNode);\n            paragraphNode.select();\n          }\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport type { Cell } from '@lexical/table';\nimport type { LexicalEditor } from 'lexical';\n\nimport './TableCellResizer.css';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $isTableCellNode,\n  $isTableRowNode,\n  getCellFromTarget,\n} from '@lexical/table';\nimport {\n  $getNearestNodeFromDOMNode,\n  $getSelection,\n  DEPRECATED_$isGridSelection,\n  COMMAND_PRIORITY_HIGH,\n  SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {\n  ReactPortal,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { createPortal } from 'react-dom';\n\ntype MousePosition = {\n  x: number;\n  y: number;\n};\n\ntype MouseDraggingDirection = 'right' | 'bottom';\n\nconst MIN_ROW_HEIGHT = 33;\nconst MIN_COLUMN_WIDTH = 50;\n\nfunction TableCellResizer({ editor }: { editor: LexicalEditor }): JSX.Element {\n  const targetRef = useRef<HTMLElement | null>(null);\n  const resizerRef = useRef<HTMLDivElement | null>(null);\n  const tableRectRef = useRef<ClientRect | null>(null);\n\n  const mouseStartPosRef = useRef<MousePosition | null>(null);\n  const [mouseCurrentPos, updateMouseCurrentPos] =\n    useState<MousePosition | null>(null);\n\n  const [activeCell, updateActiveCell] = useState<Cell | null>(null);\n  const [isSelectingGrid, updateIsSelectingGrid] = useState<boolean>(false);\n  const [draggingDirection, updateDraggingDirection] =\n    useState<MouseDraggingDirection | null>(null);\n\n  useEffect(() => {\n    return editor.registerCommand(\n      SELECTION_CHANGE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n        const isGridSelection = DEPRECATED_$isGridSelection(selection);\n\n        if (isSelectingGrid !== isGridSelection) {\n          updateIsSelectingGrid(isGridSelection);\n        }\n\n        return false;\n      },\n      COMMAND_PRIORITY_HIGH\n    );\n  });\n\n  const resetState = useCallback(() => {\n    updateActiveCell(null);\n    targetRef.current = null;\n    updateDraggingDirection(null);\n    mouseStartPosRef.current = null;\n    tableRectRef.current = null;\n  }, []);\n\n  useEffect(() => {\n    const onMouseMove = (event: MouseEvent) => {\n      setTimeout(() => {\n        const target = event.target;\n\n        if (draggingDirection) {\n          updateMouseCurrentPos({\n            x: event.clientX,\n            y: event.clientY,\n          });\n          return;\n        }\n\n        if (resizerRef.current && resizerRef.current.contains(target as Node)) {\n          return;\n        }\n\n        if (targetRef.current !== target) {\n          targetRef.current = target as HTMLElement;\n          const cell = getCellFromTarget(target as HTMLElement);\n\n          if (cell && activeCell !== cell) {\n            editor.update(() => {\n              const tableCellNode = $getNearestNodeFromDOMNode(cell.elem);\n              if (!tableCellNode) {\n                throw new Error('TableCellResizer: Table cell node not found.');\n              }\n\n              const tableNode =\n                $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n              const tableElement = editor.getElementByKey(tableNode.getKey());\n\n              if (!tableElement) {\n                throw new Error('TableCellResizer: Table element not found.');\n              }\n\n              targetRef.current = target as HTMLElement;\n              tableRectRef.current = tableElement.getBoundingClientRect();\n              updateActiveCell(cell);\n            });\n          } else if (cell == null) {\n            resetState();\n          }\n        }\n      }, 0);\n    };\n\n    document.addEventListener('mousemove', onMouseMove);\n\n    return () => {\n      document.removeEventListener('mousemove', onMouseMove);\n    };\n  }, [activeCell, draggingDirection, editor, resetState]);\n\n  const isHeightChanging = (direction: MouseDraggingDirection) => {\n    if (direction === 'bottom') return true;\n    return false;\n  };\n\n  const updateRowHeight = useCallback(\n    (newHeight: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableRow = tableRows[tableRowIndex];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        tableRow.setHeight(newHeight);\n      });\n    },\n    [activeCell, editor]\n  );\n\n  const updateColumnWidth = useCallback(\n    (newWidth: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableColumnIndex =\n          $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        for (let r = 0; r < tableRows.length; r++) {\n          const tableRow = tableRows[r];\n\n          if (!$isTableRowNode(tableRow)) {\n            throw new Error('Expected table row');\n          }\n\n          const tableCells = tableRow.getChildren();\n\n          if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n            throw new Error('Expected table cell to be inside of table row.');\n          }\n\n          const tableCell = tableCells[tableColumnIndex];\n\n          if (!$isTableCellNode(tableCell)) {\n            throw new Error('Expected table cell');\n          }\n\n          tableCell.setWidth(newWidth);\n        }\n      });\n    },\n    [activeCell, editor]\n  );\n\n  const toggleResize = useCallback(\n    (direction) => (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      if (draggingDirection === direction && mouseStartPosRef.current) {\n        const { x, y } = mouseStartPosRef.current;\n\n        if (!activeCell) {\n          return;\n        }\n\n        const { height, width } = activeCell.elem.getBoundingClientRect();\n\n        if (isHeightChanging(direction)) {\n          const heightChange = Math.abs(event.clientY - y);\n\n          const isShrinking = direction === 'bottom' && y > event.clientY;\n\n          updateRowHeight(\n            Math.max(\n              isShrinking ? height - heightChange : heightChange + height,\n              MIN_ROW_HEIGHT\n            )\n          );\n        } else {\n          const widthChange = Math.abs(event.clientX - x);\n\n          const isShrinking = direction === 'right' && x > event.clientX;\n\n          updateColumnWidth(\n            Math.max(\n              isShrinking ? width - widthChange : widthChange + width,\n              MIN_COLUMN_WIDTH\n            )\n          );\n        }\n\n        resetState();\n      } else {\n        mouseStartPosRef.current = {\n          x: event.clientX,\n          y: event.clientY,\n        };\n        updateMouseCurrentPos(mouseStartPosRef.current);\n        updateDraggingDirection(direction);\n      }\n    },\n    [\n      activeCell,\n      draggingDirection,\n      resetState,\n      updateColumnWidth,\n      updateRowHeight,\n    ]\n  );\n\n  const getResizers = useCallback(() => {\n    if (activeCell) {\n      const { height, width, top, left } =\n        activeCell.elem.getBoundingClientRect();\n\n      const styles = {\n        bottom: {\n          backgroundColor: 'none',\n          cursor: 'row-resize',\n          height: '10px',\n          left: `${window.pageXOffset + left}px`,\n          top: `${window.pageYOffset + top + height}px`,\n          width: `${width}px`,\n        },\n        right: {\n          backgroundColor: 'none',\n          cursor: 'col-resize',\n          height: `${height}px`,\n          left: `${window.pageXOffset + left + width}px`,\n          top: `${window.pageYOffset + top}px`,\n          width: '10px',\n        },\n      };\n\n      const tableRect = tableRectRef.current;\n\n      if (draggingDirection && mouseCurrentPos && tableRect) {\n        if (isHeightChanging(draggingDirection)) {\n          styles[draggingDirection].left = `${\n            window.pageXOffset + tableRect.left\n          }px`;\n          styles[draggingDirection].top = `${\n            window.pageYOffset + mouseCurrentPos.y\n          }px`;\n          styles[draggingDirection].height = '3px';\n          styles[draggingDirection].width = `${tableRect.width}px`;\n        } else {\n          styles[draggingDirection].top = `${\n            window.pageYOffset + tableRect.top\n          }px`;\n          styles[draggingDirection].left = `${\n            window.pageXOffset + mouseCurrentPos.x\n          }px`;\n          styles[draggingDirection].width = '3px';\n          styles[draggingDirection].height = `${tableRect.height}px`;\n        }\n\n        styles[draggingDirection].backgroundColor = '#adf';\n      }\n\n      return styles;\n    }\n\n    return {\n      bottom: null,\n      left: null,\n      right: null,\n      top: null,\n    };\n  }, [activeCell, draggingDirection, mouseCurrentPos]);\n\n  const resizerStyles = getResizers();\n\n  return (\n    <div ref={resizerRef}>\n      {activeCell != null && !isSelectingGrid && (\n        <>\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.right}\n            onMouseDown={toggleResize('right')}\n            onMouseUp={toggleResize('right')}\n          />\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.bottom}\n            onMouseDown={toggleResize('bottom')}\n            onMouseUp={toggleResize('bottom')}\n          />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableCellResizerPlugin(): ReactPortal {\n  const [editor] = useLexicalComposerContext();\n\n  return useMemo(\n    () => createPortal(<TableCellResizer editor={editor} />, document.body),\n    [editor]\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $deleteTableColumn,\n  $getElementGridForTableNode,\n  $getTableCellNodeFromLexicalNode,\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $insertTableColumn,\n  $insertTableRow,\n  $isTableCellNode,\n  $isTableRowNode,\n  $removeTableRowAtIndex,\n  getTableSelectionFromTableElement,\n  HTMLTableElementWithWithTableSelectionState,\n  TableCellHeaderStates,\n  TableCellNode,\n} from '@lexical/table';\nimport { TFunction } from 'i18next';\nimport {\n  $getSelection,\n  DEPRECATED_$isGridSelection,\n  $isRangeSelection,\n  $setSelection,\n} from 'lexical';\nimport * as React from 'react';\nimport { ReactPortal, useCallback, useEffect, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useTranslation } from 'react-i18next';\n\ntype TableCellActionMenuProps = Readonly<{\n  contextRef: { current: null | HTMLElement };\n  onClose: () => void;\n  setIsMenuOpen: (isOpen: boolean) => void;\n  tableCellNode: TableCellNode;\n  t: TFunction;\n}>;\n\nfunction TableActionMenu({\n  onClose,\n  tableCellNode: _tableCellNode,\n  setIsMenuOpen,\n  contextRef,\n  t,\n}: TableCellActionMenuProps) {\n  const [editor] = useLexicalComposerContext();\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const [tableCellNode, updateTableCellNode] = useState(_tableCellNode);\n  const [selectionCounts, updateSelectionCounts] = useState({\n    columns: 1,\n    rows: 1,\n  });\n\n  useEffect(() => {\n    return editor.registerMutationListener(TableCellNode, (nodeMutations) => {\n      const nodeUpdated =\n        nodeMutations.get(tableCellNode.getKey()) === 'updated';\n\n      if (nodeUpdated) {\n        editor.getEditorState().read(() => {\n          updateTableCellNode(tableCellNode.getLatest());\n        });\n      }\n    });\n  }, [editor, tableCellNode]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n      if (DEPRECATED_$isGridSelection(selection)) {\n        const selectionShape = selection.getShape();\n\n        updateSelectionCounts({\n          columns: selectionShape.toX - selectionShape.fromX + 1,\n          rows: selectionShape.toY - selectionShape.fromY + 1,\n        });\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    const menuButtonElement = contextRef.current;\n    const dropDownElement = dropDownRef.current;\n\n    if (menuButtonElement != null && dropDownElement != null) {\n      const menuButtonRect = menuButtonElement.getBoundingClientRect();\n\n      dropDownElement.style.opacity = '1';\n\n      dropDownElement.style.left = `${\n        menuButtonRect.left + menuButtonRect.width + window.pageXOffset + 5\n      }px`;\n\n      dropDownElement.style.top = `${\n        menuButtonRect.top + window.pageYOffset\n      }px`;\n    }\n  }, [contextRef, dropDownRef]);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (\n        dropDownRef.current != null &&\n        contextRef.current != null &&\n        !dropDownRef.current.contains(event.target as Node) &&\n        !contextRef.current.contains(event.target as Node)\n      ) {\n        setIsMenuOpen(false);\n      }\n    }\n\n    window.addEventListener('click', handleClickOutside);\n\n    return () => window.removeEventListener('click', handleClickOutside);\n  }, [setIsMenuOpen, contextRef]);\n\n  const clearTableSelection = useCallback(() => {\n    editor.update(() => {\n      if (tableCellNode.isAttached()) {\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n        const tableElement = editor.getElementByKey(\n          tableNode.getKey()\n        ) as HTMLTableElementWithWithTableSelectionState;\n\n        if (!tableElement) {\n          throw new Error('Expected to find tableElement in DOM');\n        }\n\n        const tableSelection = getTableSelectionFromTableElement(tableElement);\n        if (tableSelection !== null) {\n          tableSelection.clearHighlight();\n        }\n\n        tableNode.markDirty();\n        updateTableCellNode(tableCellNode.getLatest());\n      }\n\n      $setSelection(null);\n    });\n  }, [editor, tableCellNode]);\n\n  const insertTableRowAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableRowIndex;\n\n        if (DEPRECATED_$isGridSelection(selection)) {\n          const selectionShape = selection.getShape();\n          tableRowIndex = shouldInsertAfter\n            ? selectionShape.toY\n            : selectionShape.fromY;\n        } else {\n          tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n        }\n\n        const grid = $getElementGridForTableNode(editor, tableNode);\n\n        $insertTableRow(\n          tableNode,\n          tableRowIndex,\n          shouldInsertAfter,\n          selectionCounts.rows,\n          grid\n        );\n\n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [editor, tableCellNode, selectionCounts.rows, clearTableSelection, onClose]\n  );\n\n  const insertTableColumnAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableColumnIndex;\n\n        if (DEPRECATED_$isGridSelection(selection)) {\n          const selectionShape = selection.getShape();\n          tableColumnIndex = shouldInsertAfter\n            ? selectionShape.toX\n            : selectionShape.fromX;\n        } else {\n          tableColumnIndex =\n            $getTableColumnIndexFromTableCellNode(tableCellNode);\n        }\n\n        const grid = $getElementGridForTableNode(editor, tableNode);\n\n        $insertTableColumn(\n          tableNode,\n          tableColumnIndex,\n          shouldInsertAfter,\n          selectionCounts.columns,\n          grid\n        );\n\n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [\n      editor,\n      tableCellNode,\n      selectionCounts.columns,\n      clearTableSelection,\n      onClose,\n    ]\n  );\n\n  const deleteTableRowAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      $removeTableRowAtIndex(tableNode, tableRowIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      tableNode.remove();\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableColumnAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      $deleteTableColumn(tableNode, tableColumnIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableRowIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n        throw new Error('Expected table cell to be inside of table row.');\n      }\n\n      const tableRow = tableRows[tableRowIndex];\n\n      if (!$isTableRowNode(tableRow)) {\n        throw new Error('Expected table row');\n      }\n\n      tableRow.getChildren().forEach((tableCell) => {\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.ROW);\n      });\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableColumnIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      for (let r = 0; r < tableRows.length; r++) {\n        const tableRow = tableRows[r];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        const tableCells = tableRow.getChildren();\n\n        if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableCell = tableCells[tableColumnIndex];\n\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.COLUMN);\n      }\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  return createPortal(\n    // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n    <div\n      className=\"verbum-dropdown\"\n      ref={dropDownRef}\n      onClick={(e) => {\n        e.stopPropagation();\n      }}\n    >\n      <button\n        className=\"verbum-item\"\n        onClick={() => insertTableRowAtSelection(false)}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.rows === 1\n            ? t('toolbar:tableActionMenuPlugin.row')\n            : `${selectionCounts.rows} ${t(\n                'toolbar:tableActionMenuPlugin.rows'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.above')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => insertTableRowAtSelection(true)}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.rows === 1\n            ? t('toolbar:tableActionMenuPlugin.row')\n            : `${selectionCounts.rows} ${t(\n                'toolbar:tableActionMenuPlugin.rows'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.below')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"verbum-item\"\n        onClick={() => insertTableColumnAtSelection(false)}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.columns === 1\n            ? t('toolbar:tableActionMenuPlugin.column')\n            : `${selectionCounts.columns} ${t(\n                'toolbar:tableActionMenuPlugin.columns'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.left')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => insertTableColumnAtSelection(true)}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.columns === 1\n            ? t('toolbar:tableActionMenuPlugin.column')\n            : `${selectionCounts.columns} ${t(\n                'toolbar:tableActionMenuPlugin.columns'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.right')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"verbum-item\"\n        onClick={() => deleteTableColumnAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_column')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => deleteTableRowAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_row')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => deleteTableAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_table')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"verbum-item\"\n        onClick={() => toggleTableRowIsHeader()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.ROW) ===\n          TableCellHeaderStates.ROW\n            ? t('action:Remove')\n            : t('action:Add')}{' '}\n          {t('toolbar:tableActionMenuPlugin.row_header')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => toggleTableColumnIsHeader()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.COLUMN) ===\n          TableCellHeaderStates.COLUMN\n            ? t('action:Remove')\n            : t('action:Add ')}{' '}\n          {t('toolbar:tableActionMenuPlugin.column_header')}\n        </span>\n      </button>\n    </div>,\n    document.body\n  );\n}\n\nfunction TableCellActionMenuContainer(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  const menuButtonRef = useRef(null);\n  const menuRootRef = useRef(null);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n\n  const [tableCellNode, setTableMenuCellNode] = useState<TableCellNode | null>(\n    null\n  );\n  const { t } = useTranslation(['toolbar', 'action']);\n\n  const moveMenu = useCallback(() => {\n    const menu = menuButtonRef.current;\n    const selection = $getSelection();\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (selection == null || menu == null) {\n      setTableMenuCellNode(null);\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n\n    if (\n      $isRangeSelection(selection) &&\n      rootElement !== null &&\n      nativeSelection !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const tableCellNodeFromSelection = $getTableCellNodeFromLexicalNode(\n        selection.anchor.getNode()\n      );\n\n      if (tableCellNodeFromSelection == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      const tableCellParentNodeDOM = editor.getElementByKey(\n        tableCellNodeFromSelection.getKey()\n      );\n\n      if (tableCellParentNodeDOM == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      setTableMenuCellNode(tableCellNodeFromSelection);\n    } else if (!activeElement) {\n      setTableMenuCellNode(null);\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        moveMenu();\n      });\n    });\n  });\n\n  useEffect(() => {\n    const menuButtonDOM = menuButtonRef.current as HTMLButtonElement | null;\n\n    if (menuButtonDOM != null && tableCellNode != null) {\n      const tableCellNodeDOM = editor.getElementByKey(tableCellNode.getKey());\n\n      if (tableCellNodeDOM != null) {\n        const tableCellRect = tableCellNodeDOM.getBoundingClientRect();\n        const menuRect = menuButtonDOM.getBoundingClientRect();\n\n        menuButtonDOM.style.opacity = '1';\n\n        menuButtonDOM.style.left = `${\n          tableCellRect.left +\n          window.pageXOffset -\n          menuRect.width +\n          tableCellRect.width -\n          10\n        }px`;\n\n        menuButtonDOM.style.top = `${\n          tableCellRect.top + window.pageYOffset + 5\n        }px`;\n      } else {\n        menuButtonDOM.style.opacity = '0';\n      }\n    }\n  }, [menuButtonRef, tableCellNode, editor]);\n\n  const prevTableCellDOM = useRef(tableCellNode);\n\n  useEffect(() => {\n    if (prevTableCellDOM.current !== tableCellNode) {\n      setIsMenuOpen(false);\n    }\n\n    prevTableCellDOM.current = tableCellNode;\n  }, [prevTableCellDOM, tableCellNode]);\n\n  return (\n    <div className=\"verbum-table-cell-action-button-container\" ref={menuButtonRef}>\n      {tableCellNode != null && (\n        <>\n          <button\n            className=\"verbum-table-cell-action-button chevron-down\"\n            onClick={(e) => {\n              e.stopPropagation();\n              setIsMenuOpen(!isMenuOpen);\n            }}\n            ref={menuRootRef}\n            type=\"button\"\n          >\n            <i className=\"verbum-chevron-down\" />\n          </button>\n          {isMenuOpen && (\n            <TableActionMenu\n              contextRef={menuRootRef}\n              setIsMenuOpen={setIsMenuOpen}\n              onClose={() => setIsMenuOpen(false)}\n              tableCellNode={tableCellNode}\n              t={t}\n            />\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableActionMenuPlugin(): ReactPortal {\n  return createPortal(<TableCellActionMenuContainer />, document.body);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createHorizontalRuleNode,\n  INSERT_HORIZONTAL_RULE_COMMAND,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nexport default function HorizontalRulePlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INSERT_HORIZONTAL_RULE_COMMAND,\n      (type) => {\n        const selection = $getSelection();\n\n        if (!$isRangeSelection(selection)) {\n          return false;\n        }\n\n        const focusNode = selection.focus.getNode();\n\n        if (focusNode !== null) {\n          const horizontalRuleNode = $createHorizontalRuleNode();\n          selection.insertParagraph();\n          selection.focus\n            .getNode()\n            .getTopLevelElementOrThrow()\n            .insertBefore(horizontalRuleNode);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","import React, { useState, useContext } from 'react';\nimport { $getRoot, LexicalEditor } from 'lexical';\nimport DropDown from '../../../ui/DropDown';\nimport Button from '../../../ui/Button';\nimport TextInput from '../../../ui/TextInput';\nimport FileInput from '../../../ui/FileInput';\nimport ImagesPlugin, {\n  INSERT_IMAGE_COMMAND,\n  InsertImagePayload,\n} from '../../ImagesPlugin';\nimport { INSERT_TABLE_COMMAND } from '@lexical/table';\nimport { INSERT_HORIZONTAL_RULE_COMMAND } from '@lexical/react/LexicalHorizontalRuleNode';\nimport PollPlugin, { INSERT_POLL_COMMAND } from '../../PollPlugin';\nimport YouTubePlugin, { INSERT_YOUTUBE_COMMAND } from '../../YouTubePlugin';\nimport { $createStickyNode } from '../../../nodes/StickyNode';\nimport useModal from '../../../hooks/useModal';\nimport TableCellResizer from '../../TableCellResizer';\nimport { TablePlugin } from '@lexical/react/LexicalTablePlugin';\nimport TableCellActionMenuPlugin from '../../TableActionMenuPlugin';\nimport HorizontalRulePlugin from '../../HorizontalRulePlugin';\nimport EditorContext from '../../../context/EditorContext';\n\n// Taken from https://stackoverflow.com/a/9102270\nconst YOUTUBE_ID_PARSER =\n  /^.*(youtu\\.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/;\n\nconst parseYouTubeVideoID = (url: string) => {\n  const urlMatches = url.match(YOUTUBE_ID_PARSER);\n\n  return urlMatches?.[2].length === 11 ? urlMatches[2] : null;\n};\n\n//#region Inserting different modules\nfunction InsertImageDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [mode, setMode] = useState<null | 'url' | 'file'>(null);\n\n  const onClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n    onClose();\n  };\n\n  return (\n    <>\n      {!mode && (\n        <div className=\"ToolbarPlugin__dialogButtonsList\">\n          <Button\n            data-test-id=\"image-modal-option-url\"\n            onClick={() => setMode('url')}\n          >\n            URL\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-file\"\n            onClick={() => setMode('file')}\n          >\n            File\n          </Button>\n        </div>\n      )}\n      {mode === 'url' && <InsertImageUriDialogBody onClick={onClick} />}\n      {mode === 'file' && <InsertImageUploadedDialogBody onClick={onClick} />}\n    </>\n  );\n}\n\nfunction InsertTableDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [rows, setRows] = useState('5');\n  const [columns, setColumns] = useState('5');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_TABLE_COMMAND, { columns, rows });\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"No of rows\" onChange={setRows} value={rows} />\n      <TextInput label=\"No of columns\" onChange={setColumns} value={columns} />\n      <div\n        className=\"ToolbarPlugin__dialogActions\"\n        data-test-id=\"table-model-confirm-insert\"\n      >\n        <Button onClick={onClick}>Confirm</Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertPollDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [question, setQuestion] = useState('');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_POLL_COMMAND, question);\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"Question\" onChange={setQuestion} value={question} />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button disabled={question.trim() === ''} onClick={onClick}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageUriDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  return (\n    <>\n      <TextInput\n        label=\"Image URL\"\n        placeholder=\"i.e. https://source.unsplash.com/random\"\n        onChange={setSrc}\n        value={src}\n        data-test-id=\"image-modal-url-input\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Random unsplash image\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-confirm-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageUploadedDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  const loadImage = (files: FileList) => {\n    const reader = new FileReader();\n    reader.onload = function () {\n      if (typeof reader.result === 'string') {\n        setSrc(reader.result);\n      }\n      return '';\n    };\n    reader.readAsDataURL(files[0]);\n  };\n\n  return (\n    <>\n      <FileInput\n        label=\"Image Upload\"\n        onChange={loadImage}\n        accept=\"image/*\"\n        data-test-id=\"image-modal-file-upload\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Descriptive alternative text\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-file-upload-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertYouTubeDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [text, setText] = useState('');\n\n  const onClick = () => {\n    const videoID = parseYouTubeVideoID(text);\n    if (videoID) {\n      activeEditor.dispatchCommand(INSERT_YOUTUBE_COMMAND, videoID);\n    }\n    onClose();\n  };\n\n  const isDisabled = text === '' || !parseYouTubeVideoID(text);\n\n  return (\n    <>\n      <TextInput\n        data-test-id=\"youtube-embed-modal-url\"\n        label=\"YouTube URL\"\n        placeholder=\"i.e. https://www.youtube.com/watch?v=jNQXAC9IVRw\"\n        onChange={setText}\n        value={text}\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"youtube-embed-modal-submit-btn\"\n          disabled={isDisabled}\n          onClick={onClick}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\n//#endregion Inserting different modules\n\nexport interface IInsertDropdownProps {\n  enableTable?: boolean;\n  enableYoutube?: boolean;\n  enablePoll?: boolean;\n  enableImage?: { enable: boolean; maxWidth: number };\n  enableEquations?: boolean;\n  enableExcalidraw?: boolean;\n  enableHorizontalRule?: boolean;\n  enableStickyNote?: boolean;\n}\n\nconst InsertDropdown: React.FC<IInsertDropdownProps> = ({\n  enableTable = true,\n  enableImage = { enable: true, maxWidth: 1000 },\n  enableYoutube = false,\n  enablePoll = false,\n  enableHorizontalRule = false,\n  enableStickyNote = false,\n}: IInsertDropdownProps) => {\n  const { initialEditor, activeEditor } = useContext(EditorContext);\n  const [modal, showModal] = useModal();\n\n  return (\n    <div>\n      {enableTable && (\n        <>\n          <TablePlugin />\n          <TableCellActionMenuPlugin />\n          <TableCellResizer />\n        </>\n      )}\n      {enableYoutube && <YouTubePlugin />}\n      {enablePoll && <PollPlugin />}\n      {enableImage.enable && <ImagesPlugin maxWidth={enableImage.maxWidth} />}\n      {enableHorizontalRule && <HorizontalRulePlugin />}\n\n      <DropDown\n        buttonClassName=\"verbum-toolbar-item spaced\"\n        buttonLabel=\"Insert\"\n        buttonAriaLabel=\"Insert specialized editor node\"\n        buttonIconClassName=\"verbum-icon verbum-plus\"\n      >\n        {enableHorizontalRule && (\n          <button\n            onClick={() => {\n              activeEditor.dispatchCommand(\n                INSERT_HORIZONTAL_RULE_COMMAND,\n                undefined\n              );\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-horizontal-rule\" />\n            <span className=\"verbum-text\">Horizontal Rule</span>\n          </button>\n        )}\n        {enableImage.enable && (\n          <button\n            onClick={() => {\n              showModal('Insert Image', (onClose) => (\n                <InsertImageDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-image\" />\n            <span className=\"verbum-text\">Image</span>\n          </button>\n        )}\n        {enableTable && (\n          <div>\n            <button\n              onClick={() => {\n                showModal('Insert Table', (onClose) => (\n                  <InsertTableDialog\n                    activeEditor={activeEditor}\n                    onClose={onClose}\n                  />\n                ));\n              }}\n              className=\"verbum-item\"\n              type=\"button\"\n            >\n              <i className=\"verbum-icon verbum-table\" />\n              <span className=\"verbum-text\">Table</span>\n            </button>\n          </div>\n        )}\n        {enablePoll && (\n          <button\n            onClick={() => {\n              showModal('Insert Poll', (onClose) => (\n                <InsertPollDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-poll\" />\n            <span className=\"verbum-text\">Poll</span>\n          </button>\n        )}\n        {enableYoutube && (\n          <button\n            onClick={() => {\n              showModal('Insert YouTube Video', (onClose) => (\n                <InsertYouTubeDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-youtube\" />\n            <span className=\"verbum-text\">YouTube Video</span>\n          </button>\n        )}\n        {enableStickyNote && (\n          <button\n            onClick={() => {\n              initialEditor.update(() => {\n                const root = $getRoot();\n                const stickyNode = $createStickyNode(0, 0);\n                root.append(stickyNode);\n              });\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-sticky\" />\n            <span className=\"verbum-text\">Sticky Note</span>\n          </button>\n        )}\n      </DropDown>\n      {modal}\n    </div>\n  );\n};\n\nexport default InsertDropdown;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nimport { CAN_USE_DOM } from './canUseDOM';\n\nconst documentMode =\n  // @ts-ignore\n  CAN_USE_DOM && 'documentMode' in document ? document.documentMode : null;\n\nexport const IS_APPLE: boolean =\n  CAN_USE_DOM && /Mac|iPod|iPhone|iPad/.test(navigator.platform);\n\nexport const IS_FIREFOX: boolean =\n  CAN_USE_DOM && /^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);\n\nexport const CAN_USE_BEFORE_INPUT: boolean =\n  CAN_USE_DOM && 'InputEvent' in window && !documentMode\n    ? 'getTargetRanges' in new window.InputEvent('input')\n    : false;\n\nexport const IS_SAFARI: boolean =\n  CAN_USE_DOM && /Version\\/[\\d\\.]+.*Safari/.test(navigator.userAgent);\n\nexport const IS_IOS: boolean =\n  CAN_USE_DOM &&\n  /iPad|iPhone|iPod/.test(navigator.userAgent) &&\n  !(window as any).MSStream;\n\n// Keep these in case we need to use them in the future.\n// export const IS_WINDOWS: boolean = CAN_USE_DOM && /Win/.test(navigator.platform);\n// export const IS_CHROME: boolean = CAN_USE_DOM && /^(?=.*Chrome).*/i.test(navigator.userAgent);\n// export const canUseTextInputEvent: boolean = CAN_USE_DOM && 'TextEvent' in window && !documentMode;\n","import * as React from 'react';\nimport { useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { UNDO_COMMAND } from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport { useTranslation } from 'react-i18next';\n\nconst UndoButton = () => {\n  const { canUndo } = useContext(ToolbarContext);\n  const { activeEditor } = useContext(EditorContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <button\n      disabled={!canUndo}\n      onClick={() => {\n        activeEditor.dispatchCommand(UNDO_COMMAND, undefined);\n      }}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:undoButton.Title')} (Z)`\n          : `${t('toolbar:undoButton.Title')} (Ctrl+Z)`\n      }\n      className=\"verbum-toolbar-item spaced\"\n      aria-label={t('toolbar:undoButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-undo\" />\n    </button>\n  );\n};\n\nexport default UndoButton;\n","import * as React from 'react';\nimport { useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { REDO_COMMAND } from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport { useTranslation } from 'react-i18next';\n\nconst RedoButton = () => {\n  const { canRedo } = useContext(ToolbarContext);\n  const { activeEditor } = useContext(EditorContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <button\n      disabled={!canRedo}\n      onClick={() => {\n        activeEditor.dispatchCommand(REDO_COMMAND, undefined);\n      }}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:redoButton.Title')} (Y)`\n          : `${t('toolbar:redoButton.Title')} (Ctrl+Y)`\n      }\n      className=\"verbum-toolbar-item\"\n      aria-label={t('toolbar:redoButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-redo\" />\n    </button>\n  );\n};\n\nexport default RedoButton;\n","import React from 'react';\n\nconst Select = ({\n  onChange,\n  className,\n  options,\n  value,\n}: {\n  className: string;\n  onChange: (event: { target: { value: string } }) => void;\n  options: [string, string][];\n  value: string;\n}): JSX.Element => {\n  return (\n    <select className={className} onChange={onChange} value={value}>\n      {options.map(([option, text]) => (\n        <option key={option} value={option}>\n          {text}\n        </option>\n      ))}\n    </select>\n  );\n};\n\nexport default Select;\n","import { $isCodeNode } from '@lexical/code';\nimport { $getNodeByKey } from 'lexical';\nimport React, { useCallback, useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst CODE_LANGUAGE_OPTIONS: [string, string][] = [\n  ['', '- Select language -'],\n  ['c', 'C'],\n  ['clike', 'C-like'],\n  ['css', 'CSS'],\n  ['html', 'HTML'],\n  ['js', 'JavaScript'],\n  ['markdown', 'Markdown'],\n  ['objc', 'Objective-C'],\n  ['plain', 'Plain Text'],\n  ['py', 'Python'],\n  ['rust', 'Rust'],\n  ['sql', 'SQL'],\n  ['swift', 'Swift'],\n  ['xml', 'XML'],\n];\n\nconst CodeLanguageDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { selectedElementKey, codeLanguage } = useContext(ToolbarContext);\n  const onCodeLanguageSelect = useCallback(\n    (e) => {\n      activeEditor.update(() => {\n        if (selectedElementKey !== null) {\n          const node = $getNodeByKey(selectedElementKey);\n          if ($isCodeNode(node)) {\n            console.log(e.target.value);\n            node.setLanguage(e.target.value);\n          }\n        }\n      });\n    },\n    [activeEditor, selectedElementKey]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"verbum-toolbar-item code-language\"\n        onChange={onCodeLanguageSelect}\n        options={CODE_LANGUAGE_OPTIONS}\n        value={codeLanguage}\n      />\n      <i className=\"verbum-chevron-down inside\" />\n    </>\n  );\n};\n\nexport default CodeLanguageDropdown;\n","import { $createCodeNode } from '@lexical/code';\nimport {\n  INSERT_CHECK_LIST_COMMAND,\n  INSERT_ORDERED_LIST_COMMAND,\n  INSERT_UNORDERED_LIST_COMMAND,\n  REMOVE_LIST_COMMAND,\n} from '@lexical/list';\nimport { $createHeadingNode, $createQuoteNode } from '@lexical/rich-text';\nimport { $wrapNodes } from '@lexical/selection';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  LexicalEditor,\n} from 'lexical';\nimport React, { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport DropDown from '../../../ui/DropDown';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst BlockFormatDropdown = () => {\n  const { initialEditor } = useContext(EditorContext);\n  const { blockType } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  const formatParagraph = () => {\n    if (blockType !== 'paragraph') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createParagraphNode());\n        }\n      });\n    }\n  };\n\n  const formatHeading = (headingSize) => {\n    if (blockType !== headingSize) {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createHeadingNode(headingSize));\n        }\n      });\n    }\n  };\n\n  const formatBulletList = () => {\n    if (blockType !== 'bullet') {\n      initialEditor.dispatchCommand(INSERT_UNORDERED_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatCheckList = () => {\n    if (blockType !== 'check') {\n      initialEditor.dispatchCommand(INSERT_CHECK_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatNumberedList = () => {\n    if (blockType !== 'number') {\n      initialEditor.dispatchCommand(INSERT_ORDERED_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatQuote = () => {\n    if (blockType !== 'quote') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createQuoteNode());\n        }\n      });\n    }\n  };\n\n  const formatCode = () => {\n    if (blockType !== 'code') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          if (selection.isCollapsed()) {\n            $wrapNodes(selection, () => $createCodeNode());\n          } else {\n            const textContent = selection.getTextContent();\n            const codeNode = $createCodeNode();\n            selection.removeText();\n            selection.insertNodes([codeNode]);\n            selection.insertRawText(textContent);\n          }\n        }\n      });\n    }\n  };\n\n  return (\n    <DropDown\n      buttonLabel={t(`blockFormatDropdown.${blockType}`)}\n      buttonAriaLabel={t('toolbar:blockFormatDropdown.Description')}\n      buttonClassName=\"verbum-toolbar-item verbum-block-controls\"\n      buttonIconClassName={'icon block-type ' + blockType}\n    >\n      <button className=\"verbum-item\" onClick={formatParagraph} type=\"button\">\n        <span className=\"verbum-icon verbum-paragraph\" />\n        <span className=\"verbum-text\">{t('toolbar:blockFormatDropdown.paragraph')}</span>\n        {blockType === 'paragraph' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => formatHeading('h1')}\n        type=\"button\"\n      >\n        <span className=\"verbum-icon verbum-h1\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.h1')}\n        </span>\n        {blockType === 'h1' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => formatHeading('h2')}\n        type=\"button\"\n      >\n        <span className=\"verbum-icon verbum-h2\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.h2')}\n        </span>\n        {blockType === 'h2' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => formatHeading('h3')}\n        type=\"button\"\n      >\n        <span className=\"verbum-icon verbum-h3\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.h3')}\n        </span>\n        {blockType === 'h3' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatBulletList} type=\"button\">\n        <span className=\"verbum-icon verbum-bullet-list\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.bullet')}\n        </span>\n        {blockType === 'bullet' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatNumberedList} type=\"button\">\n        <span className=\"verbum-icon verbum-numbered-list\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.number')}\n        </span>\n        {blockType === 'number' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatCheckList} type=\"button\">\n        <span className=\"verbum-icon verbum-check-list\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.check')}\n        </span>\n        {blockType === 'check' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatQuote} type=\"button\">\n        <span className=\"verbum-icon verbum-quote\" />\n        <span className=\"verbum-text\">{t('toolbar:blockFormatDropdown.quote')}</span>\n        {blockType === 'quote' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatCode} type=\"button\">\n        <span className=\"verbum-icon verbum-code\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.code')}\n        </span>\n        {blockType === 'code' && <span className=\"active\" />}\n      </button>\n    </DropDown>\n  );\n};\n\nexport default BlockFormatDropdown;\n","import React from 'react';\n\nexport default function Divider(): JSX.Element {\n  return <div className=\"divider\" />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {$isCodeNode} from '@lexical/code';\nimport {$isLinkNode, TOGGLE_LINK_COMMAND} from '@lexical/link';\nimport {$isListNode, ListNode} from '@lexical/list';\nimport {$isHeadingNode} from '@lexical/rich-text';\nimport {$getSelectionStyleValueForProperty, $isParentElementRTL, $patchStyleText,} from '@lexical/selection';\nimport {$getNearestNodeOfType, mergeRegister} from '@lexical/utils';\nimport {\n    $getSelection,\n    $isRangeSelection,\n    CAN_REDO_COMMAND,\n    CAN_UNDO_COMMAND,\n    COMMAND_PRIORITY_CRITICAL,\n    SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {useCallback, useContext, useEffect, useState} from 'react';\nimport useChild from 'use-child';\nimport {getSelectedNode} from '../../utils/node.util';\nimport EditorContext from '../../context/EditorContext';\nimport ToolbarContext from '../../context/ToolbarContext';\nimport AlignDropdown from './components/AlignDropdown';\nimport InsertDropdown from './components/InsertDropdown';\nimport './ToolbarPlugin.css';\nimport UndoButton from './components/UndoButton';\nimport RedoButton from './components/RedoButton';\nimport CodeLanguageDropdown from './components/CodeLanguageDropdown';\nimport BlockFormatDropdown from './components/BlockFormatDropdown';\nimport Divider from '../../ui/Divider';\n\nconst supportedBlockTypes = new Set([\n    'paragraph',\n    'quote',\n    'code',\n    'h1',\n    'h2',\n    'h3',\n    'bullet',\n    'number',\n    'check',\n]);\n\nconst CODE_LANGUAGE_MAP = {\n    javascript: 'js',\n    md: 'markdown',\n    plaintext: 'plain',\n    python: 'py',\n    text: 'plain',\n};\n\ninterface IToolbarProps {\n    children?: React.ReactElement | React.ReactElement[];\n    defaultFontSize?: string /** The default selected font size in the toolbar */\n    ;\n    defaultFontColor?: string /** The default selected font color in the toolbar */\n    ;\n    defaultBgColor?: string /** The default selected background color in the toolbar */\n    ;\n    defaultFontFamily?: string /** The default selected font family in the toolbar */\n    ;\n}\n\nconst ToolbarPlugin = ({\n                           children,\n                           defaultFontSize = '15px',\n                           defaultFontColor = '#000',\n                           defaultBgColor = '#fff',\n                           defaultFontFamily = 'Arial',\n                       }: IToolbarProps) => {\n    const [insertExists, InsertComponent] = useChild(children, InsertDropdown);\n    const [alignExists, AlignComponent] = useChild(children, AlignDropdown);\n\n    const {initialEditor, activeEditor, setActiveEditor} =\n        useContext(EditorContext);\n    const [blockType, setBlockType] = useState('paragraph');\n    const [selectedElementKey, setSelectedElementKey] = useState(null);\n    const [fontSize, setFontSize] = useState<string>(defaultFontSize);\n    const [fontColor, setFontColor] = useState<string>(defaultFontColor);\n    const [bgColor, setBgColor] = useState<string>(defaultBgColor);\n    const [fontFamily, setFontFamily] = useState<string>(defaultFontFamily);\n    const [isLink, setIsLink] = useState(false);\n    const [isBold, setIsBold] = useState(false);\n    const [isItalic, setIsItalic] = useState(false);\n    const [isUnderline, setIsUnderline] = useState(false);\n    const [isStrikethrough, setIsStrikethrough] = useState(false);\n    const [isSubscript, setIsSubscript] = useState(false);\n    const [isSuperscript, setIsSuperscript] = useState(false);\n    const [isCode, setIsCode] = useState(false);\n    const [canUndo, setCanUndo] = useState(false);\n    const [canRedo, setCanRedo] = useState(false);\n    const [isRTL, setIsRTL] = useState(false);\n    const [codeLanguage, setCodeLanguage] = useState<string>('');\n\n    const updateToolbar = useCallback(() => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n            const anchorNode = selection.anchor.getNode();\n            const element =\n                anchorNode.getKey() === 'root'\n                    ? anchorNode\n                    : anchorNode.getTopLevelElementOrThrow();\n            const elementKey = element.getKey();\n            const elementDOM = activeEditor.getElementByKey(elementKey);\n\n            // Update text format\n            setIsBold(selection.hasFormat('bold'));\n            setIsItalic(selection.hasFormat('italic'));\n            setIsUnderline(selection.hasFormat('underline'));\n            setIsStrikethrough(selection.hasFormat('strikethrough'));\n            setIsSubscript(selection.hasFormat('subscript'));\n            setIsSuperscript(selection.hasFormat('superscript'));\n            setIsCode(selection.hasFormat('code'));\n            setIsRTL($isParentElementRTL(selection));\n\n            // Update links\n            const node = getSelectedNode(selection);\n            const parent = node.getParent();\n            if ($isLinkNode(parent) || $isLinkNode(node)) {\n                setIsLink(true);\n            } else {\n                setIsLink(false);\n            }\n\n            if (elementDOM !== null) {\n                setSelectedElementKey(elementKey);\n                if ($isListNode(element)) {\n                    const parentList = $getNearestNodeOfType<ListNode>(\n                        anchorNode,\n                        ListNode\n                    );\n                    const type = parentList\n                        ? parentList.getListType()\n                        : element.getListType();\n                    setBlockType(type);\n                } else {\n                    const type = $isHeadingNode(element)\n                        ? element.getTag()\n                        : element.getType();\n                    setBlockType(type);\n                    if ($isCodeNode(element)) {\n                        const language = element.getLanguage();\n                        setCodeLanguage(\n                            language ? CODE_LANGUAGE_MAP[language] || language : ''\n                        );\n                        return;\n                    }\n                }\n            }\n            // Hande buttons\n            setFontSize(\n                $getSelectionStyleValueForProperty(\n                    selection,\n                    'font-size',\n                    defaultFontSize\n                )\n            );\n            setFontColor(\n                $getSelectionStyleValueForProperty(selection, 'color', defaultFontColor)\n            );\n            setBgColor(\n                $getSelectionStyleValueForProperty(\n                    selection,\n                    'background-color',\n                    defaultBgColor\n                )\n            );\n\n            const font = $getSelectionStyleValueForProperty(selection, 'font-family');\n            if ( font ) setFontFamily(font);\n        }\n    }, [activeEditor]);\n\n    useEffect(() => {\n        return initialEditor.registerCommand(\n            SELECTION_CHANGE_COMMAND,\n            (_payload, newEditor) => {\n                updateToolbar();\n                setActiveEditor(newEditor);\n                return false;\n            },\n            COMMAND_PRIORITY_CRITICAL\n        );\n    }, [initialEditor, updateToolbar]);\n\n    useEffect(() => {\n        return mergeRegister(\n            activeEditor.registerUpdateListener(({editorState}) => {\n                editorState.read(() => {\n                    updateToolbar();\n                });\n            }),\n            activeEditor.registerCommand<boolean>(\n                CAN_UNDO_COMMAND,\n                (payload) => {\n                    setCanUndo(payload);\n                    return false;\n                },\n                COMMAND_PRIORITY_CRITICAL\n            ),\n            activeEditor.registerCommand<boolean>(\n                CAN_REDO_COMMAND,\n                (payload) => {\n                    setCanRedo(payload);\n                    return false;\n                },\n                COMMAND_PRIORITY_CRITICAL\n            )\n        );\n    }, [activeEditor, updateToolbar]);\n\n    const applyStyleText = useCallback(\n        (styles: Record<string, string>) => {\n            Object.entries(styles).forEach(([ key, value ]) => {\n                switch ( key ) {\n                    case \"font-family\":\n                        setFontFamily(value)\n                        break\n                    case \"font-size\":\n                        setFontSize(value)\n                        break\n                    case \"background-color\":\n                        setBgColor(value)\n                        break\n                    case \"color\":\n                        setFontColor(value)\n                        break\n                }\n            })\n\n            activeEditor.update(() => {\n                const selection = $getSelection();\n                if ($isRangeSelection(selection)) {\n                    $patchStyleText(selection, styles);\n                }\n            });\n        },\n        [activeEditor]\n    );\n\n    const insertLink = useCallback(() => {\n        if (!isLink) {\n            initialEditor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n        } else {\n            initialEditor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n        }\n    }, [initialEditor, isLink]);\n\n    return (\n        <ToolbarContext.Provider\n            value={{\n                isRTL,\n                canUndo,\n                canRedo,\n                fontFamily,\n                fontSize,\n                fontColor,\n                bgColor,\n                isBold,\n                isItalic,\n                isUnderline,\n                isCode,\n                isLink,\n                applyStyleText,\n                insertLink,\n                isStrikethrough,\n                isSubscript,\n                isSuperscript,\n                selectedElementKey,\n                codeLanguage,\n                blockType,\n            }}\n        >\n            <div className=\"verbum-toolbar\">\n                <UndoButton/>\n                <RedoButton/>\n                <Divider/>\n                {supportedBlockTypes.has(blockType) &&\n                    activeEditor === initialEditor && (\n                        <>\n                            <BlockFormatDropdown/>\n                            <Divider/>\n                        </>\n                    )}\n                {blockType === 'code' ? (\n                    <>\n                        <CodeLanguageDropdown/>\n                        <Divider/>\n                        {alignExists && AlignComponent}\n                    </>\n                ) : (\n                    <>{children}</>\n                )}\n            </div>\n        </ToolbarContext.Provider>\n    );\n};\n\nexport default ToolbarPlugin;\n","import { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  LexicalTypeaheadMenuPlugin,\n  QueryMatch,\n  TypeaheadOption,\n  useBasicTypeaheadTriggerMatch,\n} from '@lexical/react/LexicalTypeaheadMenuPlugin';\nimport { $createTextNode, TextNode } from 'lexical';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport { $createMentionNode } from '../nodes/MentionNode';\nimport { $createAutoLinkNode } from '@lexical/link';\n\nimport './MentionsPlugin.css';\n\ntype SearchData<A> = (p: string) => Promise<A[]>;\n\nconst PUNCTUATION =\n  '\\\\.,\\\\+\\\\*\\\\?\\\\$\\\\@\\\\|#{}\\\\(\\\\)\\\\^\\\\-\\\\[\\\\]\\\\\\\\/!%\\'\"~=<>_:;';\nconst NAME = '\\\\b[A-Z][^\\\\s' + PUNCTUATION + ']';\n\nconst DocumentMentionsRegex = {\n  NAME,\n  PUNCTUATION,\n};\n\nconst CapitalizedNameMentionsRegex = new RegExp(\n  '(^|[^#])((?:' + DocumentMentionsRegex.NAME + '{' + 1 + ',})$)'\n);\n\nconst PUNC = DocumentMentionsRegex.PUNCTUATION;\n\nconst TRIGGERS = ['@'].join('');\n\n// Chars we expect to see in a mention (non-space, non-punctuation).\nconst VALID_CHARS = '[^' + TRIGGERS + PUNC + '\\\\s]';\n\n// Non-standard series of chars. Each series must be preceded and followed by\n// a valid char.\nconst VALID_JOINS =\n  '(?:' +\n  '\\\\.[ |$]|' + // E.g. \"r. \" in \"Mr. Smith\"\n  ' |' + // E.g. \" \" in \"Josh Duck\"\n  '[' +\n  PUNC +\n  ']|' + // E.g. \"-' in \"Salier-Hellendag\"\n  ')';\n\nconst LENGTH_LIMIT = 75;\n\nconst AtSignMentionsRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    VALID_JOINS +\n    '){0,' +\n    LENGTH_LIMIT +\n    '})' +\n    ')$'\n);\n\n// 50 is the longest alias length limit.\nconst ALIAS_LENGTH_LIMIT = 50;\n\n// Regex used to match alias.\nconst AtSignMentionsRegexAliasRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    '){0,' +\n    ALIAS_LENGTH_LIMIT +\n    '})' +\n    ')$'\n);\n\n// At most, 5 suggestions are shown in the popup.\nconst SUGGESTION_LIST_LENGTH_LIMIT = 5;\n\nconst mentionsCache = new Map();\n\nfunction useMentionLookupService<A>(\n  mentionString: string | null,\n  mentionData: SearchData<A>\n) {\n  const [results, setResults] = useState<Array<A>>([]);\n\n  useEffect(() => {\n    const cachedResults = mentionsCache.get(mentionString);\n\n    if (mentionString == null) {\n      setResults([]);\n      return;\n    }\n\n    if (cachedResults === null) {\n      return;\n    } else if (cachedResults !== undefined) {\n      setResults(cachedResults);\n      return;\n    }\n\n    mentionsCache.set(mentionString, null);\n\n    mentionData(mentionString).then((results) => {\n      mentionsCache.set(mentionString, results);\n      setResults(results);\n    });\n  }, [mentionString]);\n\n  return results;\n}\n\nfunction checkForCapitalizedNameMentions(\n  text: string,\n  minMatchLength: number\n): QueryMatch | null {\n  const match = CapitalizedNameMentionsRegex.exec(text);\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[2];\n    if (matchingString != null && matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: matchingString,\n      };\n    }\n  }\n  return null;\n}\n\nfunction checkForAtSignMentions(\n  text: string,\n  minMatchLength: number\n): QueryMatch | null {\n  let match = AtSignMentionsRegex.exec(text);\n\n  if (match === null) {\n    match = AtSignMentionsRegexAliasRegex.exec(text);\n  }\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[3];\n    if (matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: match[2],\n      };\n    }\n  }\n  return null;\n}\n\nfunction getPossibleQueryMatch(text: string): QueryMatch | null {\n  const match = checkForAtSignMentions(text, 1);\n  return match === null ? checkForCapitalizedNameMentions(text, 3) : match;\n}\n\nclass MentionTypeaheadOption extends TypeaheadOption {\n  name: string;\n  picture: JSX.Element;\n  url: string;\n\n  constructor(name: string, picture: JSX.Element, url?: string) {\n    super(name);\n    this.name = name;\n    this.picture = picture;\n    this.url = url;\n  }\n}\n\nfunction MentionsTypeaheadMenuItem({\n  index,\n  isSelected,\n  onClick,\n  onMouseEnter,\n  option,\n}: {\n  index: number;\n  isSelected: boolean;\n  onClick: () => void;\n  onMouseEnter: () => void;\n  option: MentionTypeaheadOption;\n}) {\n  let className = 'item';\n  if (isSelected) {\n    className += ' selected';\n  }\n  return (\n    <li\n      key={option.key}\n      tabIndex={-1}\n      className={className}\n      ref={option.setRefElement}\n      role=\"option\"\n      aria-selected={isSelected}\n      id={'typeahead-item-' + index}\n      onMouseEnter={onMouseEnter}\n      onClick={onClick}\n    >\n      {option.picture}\n      <span className=\"verbum-text\">{option.name}</span>\n    </li>\n  );\n}\n\nexport default function MentionsPlugin<A>(props: {\n  searchData: SearchData<A>;\n  getTypeaheadValues: (result: A) => {\n    url: string;\n    value: string;\n    picture: JSX.Element;\n  };\n}): JSX.Element | null {\n  const { searchData, getTypeaheadValues } = props;\n\n  const [editor] = useLexicalComposerContext();\n\n  const [queryString, setQueryString] = useState<string | null>(null);\n\n  const results = useMentionLookupService(queryString, searchData);\n\n  const checkForSlashTriggerMatch = useBasicTypeaheadTriggerMatch('/', {\n    minLength: 0,\n  });\n\n  const options = useMemo(\n    () =>\n      results\n        .map(\n          (result) =>\n            new MentionTypeaheadOption(\n              getTypeaheadValues(result).value,\n              getTypeaheadValues(result).picture,\n              getTypeaheadValues(result).url\n            )\n        )\n        .slice(0, SUGGESTION_LIST_LENGTH_LIMIT),\n    [results]\n  );\n\n  const onSelectOption = useCallback(\n    (\n      selectedOption: MentionTypeaheadOption,\n      nodeToReplace: TextNode | null,\n      closeMenu: () => void\n    ) => {\n      editor.update(() => {\n        if (nodeToReplace) {\n          const mentionNode = $createMentionNode(`@${selectedOption.name}`);\n          const linkNode = $createAutoLinkNode(selectedOption.url);\n          linkNode.append(mentionNode);\n          nodeToReplace.replace(linkNode);\n          linkNode.select();\n        }\n        closeMenu();\n      });\n    },\n    [editor]\n  );\n\n  const checkForMentionMatch = useCallback(\n    (text: string) => {\n      const mentionMatch = getPossibleQueryMatch(text);\n      const slashMatch = checkForSlashTriggerMatch(text, editor);\n      return !slashMatch && mentionMatch ? mentionMatch : null;\n    },\n    [checkForSlashTriggerMatch, editor]\n  );\n\n  return (\n    <LexicalTypeaheadMenuPlugin<MentionTypeaheadOption>\n      onQueryChange={setQueryString}\n      onSelectOption={onSelectOption}\n      triggerFn={checkForMentionMatch}\n      options={options}\n      menuRenderFn={(\n        anchorElementRef,\n        { selectedIndex, selectOptionAndCleanUp, setHighlightedIndex }\n      ) =>\n        anchorElementRef && results.length\n          ? ReactDOM.createPortal(\n              <div className=\"verbum-typeahead-popover verbum-mentions-menu\">\n                <ul>\n                  {options.map((option, i: number) => (\n                    <MentionsTypeaheadMenuItem\n                      index={i}\n                      isSelected={selectedIndex === i}\n                      onClick={() => {\n                        setHighlightedIndex(i);\n                        selectOptionAndCleanUp(option);\n                      }}\n                      onMouseEnter={() => {\n                        setHighlightedIndex(i);\n                      }}\n                      key={option.key}\n                      option={option}\n                    />\n                  ))}\n                </ul>\n              </div>,\n              anchorElementRef.current\n            )\n          : null\n      }\n    />\n  );\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './ColorPicker.css';\n\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\n\nimport DropDown from './DropDown';\n\ninterface ColorPickerProps {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  color?: string;\n  children?: JSX.Element;\n  onChange?: (color: string) => void;\n  title?: string;\n}\n\nconst basicColors = [\n  '#d0021b',\n  '#f5a623',\n  '#f8e71c',\n  '#8b572a',\n  '#7ed321',\n  '#417505',\n  '#bd10e0',\n  '#9013fe',\n  '#4a90e2',\n  '#50e3c2',\n  '#b8e986',\n  '#000000',\n  '#4a4a4a',\n  '#9b9b9b',\n  '#ffffff',\n];\n\nconst WIDTH = 214;\nconst HEIGHT = 150;\n\nexport default function ColorPicker({\n  color,\n  children,\n  onChange,\n  ...rest\n}: Readonly<ColorPickerProps>): JSX.Element {\n  const [selfColor, setSelfColor] = useState(transformColor('hex', color));\n\n  const saturationPosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.s / 100) * WIDTH,\n      y: ((100 - selfColor.hsv.v) / 100) * HEIGHT,\n    }),\n    [selfColor.hsv.s, selfColor.hsv.v]\n  );\n\n  const huePosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.h / 360) * WIDTH,\n    }),\n    [selfColor.hsv]\n  );\n\n  const onMoveSaturation = ({ x, y }: Position) => {\n    const newHsv = {\n      ...selfColor.hsv,\n      s: (x / WIDTH) * 100,\n      v: 100 - (y / HEIGHT) * 100,\n    };\n    const newColor = transformColor('hsv', newHsv);\n    setSelfColor(newColor);\n  };\n\n  const onMoveHue = ({ x }: Position) => {\n    const newHsv = { ...selfColor.hsv, h: (x / WIDTH) * 360 };\n    const newColor = transformColor('hsv', newHsv);\n\n    setSelfColor(newColor);\n  };\n\n  useEffect(() => {\n    onChange(selfColor.hex);\n  }, [selfColor, onChange]);\n\n  useEffect(() => {\n    if (color === undefined) return;\n    setSelfColor(transformColor('hex', color));\n  }, [color]);\n\n  return (\n    <DropDown {...rest} stopCloseOnClickSelf={true}>\n      <div className=\"verbum-color-picker-wrapper\" style={{ width: WIDTH }}>\n        <div className=\"verbum-color-picker-basic-color\">\n          {basicColors.map((basicColor) => (\n            <button\n              className={basicColor === selfColor.hex ? ' active' : ''}\n              key={basicColor}\n              style={{ backgroundColor: basicColor }}\n              onClick={() => setSelfColor(transformColor('hex', basicColor))}\n              type=\"button\"\n            />\n          ))}\n        </div>\n        <MoveWrapper\n          className=\"verbum-color-picker-saturation\"\n          style={{ backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)` }}\n          onChange={onMoveSaturation}\n        >\n          <div\n            className=\"verbum-color-picker-saturation_cursor\"\n            style={{\n              backgroundColor: selfColor.hex,\n              left: saturationPosition.x,\n              top: saturationPosition.y,\n            }}\n          />\n        </MoveWrapper>\n        <MoveWrapper className=\"verbum-color-picker-hue\" onChange={onMoveHue}>\n          <div\n            className=\"verbum-color-picker-hue_cursor\"\n            style={{\n              backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)`,\n              left: huePosition.x,\n            }}\n          />\n        </MoveWrapper>\n        <div className=\"verbum-color-picker-info\">\n          <span>{selfColor.hex}</span>\n          <div\n            className=\"verbum-color-picker-color\"\n            style={{ backgroundColor: selfColor.hex }}\n          />\n        </div>\n      </div>\n      {children}\n    </DropDown>\n  );\n}\n\nexport interface Position {\n  x: number;\n  y: number;\n}\n\ninterface MoveWrapperProps {\n  className?: string;\n  style?: React.CSSProperties;\n  onChange: (position: Position) => void;\n  children: JSX.Element;\n}\n\nfunction MoveWrapper({\n  className,\n  style,\n  onChange,\n  children,\n}: MoveWrapperProps) {\n  const divRef = useRef<HTMLDivElement>(null);\n\n  const move = (e: React.MouseEvent | MouseEvent): void => {\n    if (divRef.current) {\n      const { current: div } = divRef;\n      const { width, height, left, top } = div.getBoundingClientRect();\n\n      const x = clamp(e.clientX - left, width, 0);\n      const y = clamp(e.clientY - top, height, 0);\n\n      onChange({ x, y });\n    }\n  };\n\n  const onMouseDown = (e: React.MouseEvent): void => {\n    if (e.button !== 0) return;\n\n    move(e);\n\n    const onMouseMove = (_e: MouseEvent): void => {\n      move(_e);\n    };\n\n    const onMouseUp = (_e: MouseEvent): void => {\n      document.removeEventListener('mousemove', onMouseMove, false);\n      document.removeEventListener('mouseup', onMouseUp, false);\n\n      move(_e);\n    };\n\n    document.addEventListener('mousemove', onMouseMove, false);\n    document.addEventListener('mouseup', onMouseUp, false);\n  };\n\n  return (\n    <div\n      ref={divRef}\n      className={className}\n      style={style}\n      onMouseDown={onMouseDown}\n    >\n      {children}\n    </div>\n  );\n}\n\nfunction clamp(value: number, max: number, min: number) {\n  return value > max ? max : value < min ? min : value;\n}\n\ninterface RGB {\n  b: number;\n  g: number;\n  r: number;\n}\ninterface HSV {\n  h: number;\n  s: number;\n  v: number;\n}\ninterface Color {\n  hex: string;\n  hsv: HSV;\n  rgb: RGB;\n}\n\nexport function toHex(value: string): string {\n  if (!value.startsWith('#')) {\n    const ctx = document.createElement('canvas').getContext('2d');\n\n    if (!ctx) {\n      throw new Error('2d context not supported or canvas already initialized');\n    }\n\n    ctx.fillStyle = value;\n\n    return ctx.fillStyle;\n  } else if (value.length === 4 || value.length === 5) {\n    value = value\n      .split('')\n      .map((v, i) => (i ? v + v : '#'))\n      .join('');\n\n    return value;\n  } else if (value.length === 7 || value.length === 9) {\n    return value;\n  }\n\n  return '#000000';\n}\n\nfunction hex2rgb(hex: string): RGB {\n  const rbgArr = hex\n    .replace(\n      /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i,\n      (m, r, g, b) => '#' + r + r + g + g + b + b\n    )\n    .substring(1)\n    .match(/.{2}/g)\n    .map((x) => parseInt(x, 16));\n\n  return {\n    b: rbgArr[2],\n    g: rbgArr[1],\n    r: rbgArr[0],\n  };\n}\n\nfunction rgb2hsv({ r, g, b }: RGB): HSV {\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  const max = Math.max(r, g, b);\n  const d = max - Math.min(r, g, b);\n\n  const h = d\n    ? (max === r\n        ? (g - b) / d + (g < b ? 6 : 0)\n        : max === g\n        ? 2 + (b - r) / d\n        : 4 + (r - g) / d) * 60\n    : 0;\n  const s = max ? (d / max) * 100 : 0;\n  const v = max * 100;\n\n  return { h, s, v };\n}\n\nfunction hsv2rgb({ h, s, v }: HSV): RGB {\n  s /= 100;\n  v /= 100;\n\n  const i = ~~(h / 60);\n  const f = h / 60 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - s * f);\n  const t = v * (1 - s * (1 - f));\n  const index = i % 6;\n\n  const r = Math.round([v, q, p, p, t, v][index] * 255);\n  const g = Math.round([t, v, v, q, p, p][index] * 255);\n  const b = Math.round([p, p, t, v, v, q][index] * 255);\n\n  return { b, g, r };\n}\n\nfunction rgb2hex({ b, g, r }: RGB): string {\n  return '#' + [r, g, b].map((x) => x.toString(16).padStart(2, '0')).join('');\n}\n\nfunction transformColor<M extends keyof Color, C extends Color[M]>(\n  format: M,\n  color: C\n): Color {\n  let hex: Color['hex'] = toHex('#121212');\n  let rgb: Color['rgb'] = hex2rgb(hex);\n  let hsv: Color['hsv'] = rgb2hsv(rgb);\n\n  if (format === 'hex') {\n    const value = color as Color['hex'];\n\n    hex = toHex(value);\n    rgb = hex2rgb(hex);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'rgb') {\n    const value = color as Color['rgb'];\n\n    rgb = value;\n    hex = rgb2hex(rgb);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'hsv') {\n    const value = color as Color['hsv'];\n\n    hsv = value;\n    rgb = hsv2rgb(hsv);\n    hex = rgb2hex(rgb);\n  }\n\n  return { hex, hsv, rgb };\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './LinkPreview.css';\n\nimport * as React from 'react';\nimport { Suspense } from 'react';\n\n// Cached responses or running request promises\nconst PREVIEW_CACHE = {};\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nfunction useSuspenseRequest(url: string) {\n  let cached = PREVIEW_CACHE[url];\n\n  if (!url.match(URL_MATCHER)) {\n    return { preview: null };\n  }\n\n  if (!cached) {\n    cached = PREVIEW_CACHE[url] = fetch(\n      `/api/link-preview?url=${encodeURI(url)}`\n    )\n      .then((response) => response.json())\n      .then((preview) => {\n        PREVIEW_CACHE[url] = preview;\n        return preview;\n      })\n      .catch(() => {\n        PREVIEW_CACHE[url] = { preview: null };\n      });\n  }\n\n  if (cached instanceof Promise) {\n    throw cached;\n  }\n\n  return cached;\n}\n\nfunction LinkPreviewContent({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  const { preview } = useSuspenseRequest(url);\n  if (preview === null) {\n    return null;\n  }\n  return (\n    <div className=\"LinkPreview__container\">\n      {preview.img && (\n        <div className=\"LinkPreview__imageWrapper\">\n          <img\n            src={preview.img}\n            alt={preview.title}\n            className=\"LinkPreview__image\"\n          />\n        </div>\n      )}\n      {preview.domain && (\n        <div className=\"LinkPreview__domain\">{preview.domain}</div>\n      )}\n      {preview.title && (\n        <div className=\"LinkPreview__title\">{preview.title}</div>\n      )}\n      {preview.description && (\n        <div className=\"LinkPreview__description\">{preview.description}</div>\n      )}\n    </div>\n  );\n}\n\nfunction Glimmer(props): JSX.Element {\n  return (\n    <div\n      className=\"LinkPreview__glimmer\"\n      {...props}\n      style={{\n        animationDelay: (props.index || 0) * 300,\n        ...(props.style || {}),\n      }}\n    />\n  );\n}\n\nexport default function LinkPreview({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  return (\n    <Suspense\n      fallback={\n        <>\n          <Glimmer style={{ height: '80px' }} index={0} />\n          <Glimmer style={{ width: '60%' }} index={1} />\n          <Glimmer style={{ width: '80%' }} index={2} />\n        </>\n      }\n    >\n      <LinkPreviewContent url={url} />\n    </Suspense>\n  );\n}\n","import { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { $isAtNodeEnd } from '@lexical/selection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport React from 'react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport LinkPreview from '../../../ui/LinkPreview';\nimport { getSelectedNode } from '../../../utils/node.util';\n\nfunction positionEditorElement(editor, rect) {\n  if (rect === null) {\n    editor.style.opacity = '0';\n    editor.style.top = '-1000px';\n    editor.style.left = '-1000px';\n  } else {\n    editor.style.opacity = '1';\n    editor.style.top = `${rect.top + rect.height + window.pageYOffset + 10}px`;\n    editor.style.left = `${\n      rect.left + window.pageXOffset - editor.offsetWidth / 2 + rect.width / 2\n    }px`;\n  }\n}\n\nfunction FloatingLinkEditor({\n  editor,\n}: {\n  editor: LexicalEditor;\n}): JSX.Element {\n  const editorRef = useRef<HTMLDivElement | null>(null);\n  const inputRef = useRef(null);\n  const [linkUrl, setLinkUrl] = useState('');\n  const [isEditMode, setEditMode] = useState(false);\n  const [lastSelection, setLastSelection] = useState(null);\n\n  const updateLinkEditor = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const node = getSelectedNode(selection);\n      const parent = node.getParent();\n      if ($isLinkNode(parent)) {\n        setLinkUrl(parent.getURL());\n      } else if ($isLinkNode(node)) {\n        setLinkUrl(node.getURL());\n      } else {\n        setLinkUrl('');\n      }\n    }\n    const editorElem = editorRef.current;\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (editorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      let rect;\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      positionEditorElement(editorElem, rect);\n      setLastSelection(selection);\n    } else if (!activeElement || activeElement.className !== 'link-input') {\n      positionEditorElement(editorElem, null);\n      setLastSelection(null);\n      setEditMode(false);\n      setLinkUrl('');\n    }\n\n    return true;\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateLinkEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateLinkEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateLinkEditor();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateLinkEditor();\n    });\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    if (isEditMode && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isEditMode]);\n\n  return (\n    <div ref={editorRef} className=\"verbum-link-editor\">\n      {isEditMode ? (\n        <input\n          ref={inputRef}\n          className=\"link-input\"\n          value={linkUrl}\n          onChange={(event) => {\n            setLinkUrl(event.target.value);\n          }}\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              event.preventDefault();\n              if (lastSelection !== null) {\n                if (linkUrl !== '') {\n                  editor.dispatchCommand(TOGGLE_LINK_COMMAND, linkUrl);\n                }\n                setEditMode(false);\n              }\n            } else if (event.key === 'Escape') {\n              event.preventDefault();\n              setEditMode(false);\n            }\n          }}\n        />\n      ) : (\n        <>\n          <div className=\"link-input\">\n            <a href={linkUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n              {linkUrl}\n            </a>\n            <div\n              className=\"link-edit\"\n              role=\"button\"\n              tabIndex={0}\n              onMouseDown={(event) => event.preventDefault()}\n              onClick={() => {\n                setEditMode(true);\n              }}\n            />\n          </div>\n          <LinkPreview url={linkUrl} />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default FloatingLinkEditor;\n","import React, { useCallback, useContext } from 'react';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { FontOptions } from '../../../types';\n\nconst defaultFontFamilyOptions: FontOptions = [\n  ['Arial', 'Arial'],\n  ['Courier New', 'Courier New'],\n  ['Georgia', 'Georgia'],\n  ['Times New Roman', 'Times New Roman'],\n  ['Trebuchet MS', 'Trebuchet MS'],\n  ['Verdana', 'Verdana'],\n];\n\ninterface IFontFamilyDropdown {\n  fontOptions?: FontOptions;\n}\n\nconst FontFamilyDropdown = ({\n  fontOptions = defaultFontFamilyOptions,\n}: IFontFamilyDropdown) => {\n  const { fontFamily, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontFamilySelect = useCallback(\n    (e) => {\n      applyStyleText({ 'font-family': e.target.value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"verbum-toolbar-item verbum-font-family\"\n        onChange={onFontFamilySelect}\n        options={fontOptions}\n        value={fontFamily}\n      />\n      <i className=\"verbum-chevron-down inside\" />\n    </>\n  );\n};\n\nexport default FontFamilyDropdown;\n","import React, { useCallback, useContext } from 'react';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { FontOptions } from '../../../types';\n\nconst defaultFontSizeOptions: FontOptions = [\n  ['10px', '10px'],\n  ['11px', '11px'],\n  ['12px', '12px'],\n  ['13px', '13px'],\n  ['14px', '14px'],\n  ['15px', '15px'],\n  ['16px', '16px'],\n  ['17px', '17px'],\n  ['18px', '18px'],\n  ['19px', '19px'],\n  ['20px', '20px'],\n];\n\ninterface IFontSizeDropdown {\n  fontSizeOptions?: FontOptions;\n}\n\nconst FontSizeDropdown = ({\n  fontSizeOptions = defaultFontSizeOptions,\n}: IFontSizeDropdown) => {\n  const { fontSize, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontSizeSelect = useCallback(\n    (e) => {\n      applyStyleText({ 'font-size': e.target.value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"verbum-toolbar-item verbum-font-size\"\n        onChange={onFontSizeSelect}\n        options={fontSizeOptions}\n        value={fontSize}\n      />\n      <i className=\"verbum-chevron-down inside\" />\n    </>\n  );\n};\n\nexport default FontSizeDropdown;\n","import type { LexicalEditor, NodeKey } from 'lexical';\n\nimport * as React from 'react';\nimport { Suspense, useRef } from 'react';\n\nconst imageCache = new Set();\n\nfunction useSuspenseImage(src: string) {\n  if (!imageCache.has(src)) {\n    throw new Promise((resolve) => {\n      const img = new Image();\n      img.src = src;\n      img.onload = () => {\n        imageCache.add(src);\n        resolve(null);\n      };\n    });\n  }\n}\n\nfunction LazyImage({\n  altText,\n  className,\n  imageRef,\n  src,\n  width,\n  height,\n  maxWidth,\n}: {\n  altText: string;\n  className: string | null;\n  height: 'inherit' | number;\n  imageRef: { current: null | HTMLImageElement };\n  maxWidth: number;\n  src: string;\n  width: 'inherit' | number;\n}): JSX.Element {\n  useSuspenseImage(src);\n  return (\n    <img\n      className={className || undefined}\n      src={src}\n      alt={altText}\n      ref={imageRef}\n      style={{\n        height,\n        maxWidth,\n        width,\n      }}\n    />\n  );\n}\n\nexport default function ImageComponent({\n  src,\n  altText,\n  width,\n  height,\n  maxWidth,\n}: {\n  altText: string;\n  caption: LexicalEditor;\n  height: 'inherit' | number;\n  maxWidth: number;\n  nodeKey: NodeKey;\n  resizable: boolean;\n  showCaption: boolean;\n  src: string;\n  width: 'inherit' | number;\n  captionsEnabled: boolean;\n}): JSX.Element {\n  const imageRef = useRef<null | HTMLImageElement>(null);\n\n  return (\n    <Suspense fallback={null}>\n      <>\n        <div>\n          <LazyImage\n            className=\"\"\n            src={src}\n            altText={altText}\n            imageRef={imageRef}\n            width={width}\n            height={height}\n            maxWidth={maxWidth}\n          />\n        </div>\n      </>\n    </Suspense>\n  );\n}\n","import React, { useCallback, useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport ColorPicker from '../../../ui/ColorPicker';\nimport { useTranslation } from 'react-i18next';\n\nconst BackgroundColorPicker = () => {\n  const { bgColor, applyStyleText } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  const onBgColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({ 'background-color': value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <ColorPicker\n      buttonClassName=\"verbum-toolbar-item verbum-color-picker\"\n      buttonAriaLabel={t('toolbar:backgroundColorPicker.Description')}\n      buttonIconClassName=\"verbum-icon verbum-bg-color\"\n      color={bgColor}\n      onChange={onBgColorSelect}\n      title=\"bg color\"\n    />\n  );\n};\n\nexport default BackgroundColorPicker;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst BoldButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isBold } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n      }}\n      className={'verbum-toolbar-item spaced ' + (isBold ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:boldButton.Title')} (B)`\n          : `${t('toolbar:boldButton.Title')} (Ctrl + B)`\n      }\n      aria-label={`${t('toolbar:boldButton.Description')} ${\n        IS_APPLE ? 'B' : 'Ctrl+B'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-bold\" />\n    </button>\n  );\n};\n\nexport default BoldButton;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst CodeFormatButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isCode } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n      }}\n      className={'verbum-toolbar-item spaced ' + (isCode ? 'active' : '')}\n      title={t('toolbar:codeFormatButton.Description')}\n      aria-label={t('toolbar:codeFormatButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-code\" />\n    </button>\n  );\n};\n\nexport default CodeFormatButton;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {AutoFocusPlugin} from '@lexical/react/LexicalAutoFocusPlugin';\nimport {CheckListPlugin} from '@lexical/react/LexicalCheckListPlugin';\nimport {ClearEditorPlugin} from '@lexical/react/LexicalClearEditorPlugin';\nimport {HashtagPlugin} from '@lexical/react/LexicalHashtagPlugin';\nimport {LinkPlugin} from '@lexical/react/LexicalLinkPlugin';\nimport {ListPlugin} from '@lexical/react/LexicalListPlugin';\nimport {RichTextPlugin} from '@lexical/react/LexicalRichTextPlugin';\nimport {OnChangePlugin} from '@lexical/react/LexicalOnChangePlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport React, {ReactNode, useEffect, useRef, useState} from 'react';\n\nimport {useSettings} from './context/SettingsContext';\nimport {useSharedHistoryContext} from './context/SharedHistoryContext';\nimport ActionsPlugin from './plugins/ActionsPlugin';\nimport AutoLinkPlugin from './plugins/AutoLinkPlugin';\nimport CharacterStylesPopupPlugin from './plugins/CharacterStylesPopupPlugin';\nimport ClickableLinkPlugin from './plugins/ClickableLinkPlugin';\nimport CodeHighlightPlugin from './plugins/CodeHighlightPlugin';\nimport KeywordsPlugin from './plugins/KeywordsPlugin';\nimport ListMaxIndentLevelPlugin from './plugins/ListMaxIndentLevelPlugin';\nimport MarkdownShortcutPlugin from './plugins/MarkdownShortcutPlugin';\nimport SpeechToTextPlugin from './plugins/SpeechToTextPlugin';\nimport TabFocusPlugin from './plugins/TabFocusPlugin';\nimport ContentEditable from './ui/ContentEditable';\nimport Placeholder from './ui/Placeholder';\nimport {HistoryPlugin} from '@lexical/react/LexicalHistoryPlugin';\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport EditorContext from './context/EditorContext';\nimport {LexicalEditor} from 'lexical';\nimport {useTranslation} from 'react-i18next';\nimport DragDropPaste from './plugins/DragDropPastePlugin';\n\ninterface IEditorProps {\n    children?: ReactNode\n    hashtagsEnabled?: boolean\n    autoFocusEnabled?: boolean\n    autoLinkEnabled?: boolean\n    emojisEnabled?: boolean\n    actionsEnabled?: boolean\n    speechToTextEnabled?: boolean\n    placeholder?: string\n    listMaxIndent?: number\n    isEditable?: boolean\n    locale?: 'en' | 'fr' | 'ptBr' | 'ru' | null\n    onChange?: (editorState: string, editorInstance?: LexicalEditor) => void\n}\n\nconst Editor = (\n    {\n        children,\n        hashtagsEnabled = false,\n        autoFocusEnabled = false,\n        autoLinkEnabled = false,\n        emojisEnabled = false,\n        actionsEnabled = false,\n        speechToTextEnabled = false,\n        listMaxIndent = 7,\n        placeholder = '',\n        isEditable = true,\n        locale = null,\n        onChange,\n    }: IEditorProps\n) => {\n    const [editor] = useLexicalComposerContext();\n    const [activeEditor, setActiveEditor] = useState(editor);\n\n    const editorStateRef = useRef(null);\n    const {historyState} = useSharedHistoryContext();\n    const {\n        settings: {isRichText},\n    } = useSettings();\n    const placeholderComponent = <Placeholder>{placeholder}</Placeholder>;\n\n    const {i18n} = useTranslation();\n\n    useEffect(() => {\n        editor.setEditable(isEditable)\n\n        if (locale) i18n.changeLanguage(locale)\n    }, [])\n\n    return <EditorContext.Provider value={{initialEditor: editor, activeEditor, setActiveEditor}}>\n        {children}\n        <div className={`verbum-editor-container`}>\n            {autoFocusEnabled && <AutoFocusPlugin/>}\n            <ClearEditorPlugin/>\n            {hashtagsEnabled && <HashtagPlugin/>}\n            <KeywordsPlugin/>\n            {speechToTextEnabled && <SpeechToTextPlugin/>}\n            <DragDropPaste/>\n            {autoLinkEnabled && <AutoLinkPlugin/>}\n\n            <>\n                <RichTextPlugin\n                    contentEditable={<ContentEditable/>}\n                    placeholder={placeholderComponent}\n                    ErrorBoundary={LexicalErrorBoundary}\n                />\n                <OnChangePlugin\n                    onChange={(editorState) => {\n                        onChange?.(JSON.stringify(editorState), activeEditor);\n                        return (editorStateRef.current = editorState);\n                    }}\n                />\n                <MarkdownShortcutPlugin/>\n                <CodeHighlightPlugin/>\n                <ListPlugin/>\n                <CheckListPlugin/>\n                <ListMaxIndentLevelPlugin maxDepth={listMaxIndent}/>\n                <LinkPlugin/>\n                <ClickableLinkPlugin/>\n                <CharacterStylesPopupPlugin/>\n                <TabFocusPlugin/>\n            </>\n\n            <HistoryPlugin externalHistoryState={historyState}/>\n            {actionsEnabled && <ActionsPlugin isRichText={isRichText}/>}\n        </div>\n    </EditorContext.Provider>\n}\n\nexport default Editor\n","import {\n  LexicalComposer,\n  InitialEditorStateType,\n} from '@lexical/react/LexicalComposer';\nimport React from 'react';\nimport PlaygroundNodes from './nodes/PlaygroundNodes';\nimport PlaygroundEditorTheme from './themes/PlaygroundEditorTheme';\nimport './EditorComposer.css';\nimport i18n from './locale';\nimport { I18nextProvider } from 'react-i18next';\n\ninterface IEditorComposer {\n  children: React.ReactElement;\n  initialEditorState?: InitialEditorStateType;\n}\n\nconst EditorComposer = ({ children, initialEditorState }: IEditorComposer) => {\n  const initialConfig = {\n    namespace: 'VerbumEditor',\n    nodes: [...PlaygroundNodes],\n    onError: (error) => {\n      throw error;\n    },\n    theme: PlaygroundEditorTheme,\n    editorState: initialEditorState,\n  };\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <I18nextProvider i18n={i18n}>\n          <div className=\"verbum-editor-shell\">{children}</div>\n      </I18nextProvider>\n    </LexicalComposer>\n  );\n};\n\nexport default EditorComposer;\n","import React from 'react';\nimport { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport FloatingLinkEditor from './FloatingLinkEditor';\nimport { createPortal } from 'react-dom';\nimport { useTranslation } from 'react-i18next';\n\nconst InsertLinkButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isLink, insertLink } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <>\n      <button\n        onClick={insertLink}\n        className={'verbum-toolbar-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:insertLinkButton.Description')}\n        title={t('toolbar:insertLinkButton.Description')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-link\" />\n      </button>\n      {isLink &&\n        createPortal(\n          <FloatingLinkEditor editor={activeEditor} />,\n          document.body\n        )}\n    </>\n  );\n};\n\nexport default InsertLinkButton;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst ItalicButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isItalic } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n      }}\n      className={'verbum-toolbar-item spaced ' + (isItalic ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:italicButton.Title')} (I)`\n          : `${t('toolbar:italicButton.Title')} (Ctrl+I)`\n      }\n      aria-label={`${t('toolbar:italicButton.Description')} ${\n        IS_APPLE ? 'I' : 'Ctrl+I'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-italic\" />\n    </button>\n  );\n};\n\nexport default ItalicButton;\n","import React, { useCallback, useContext } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport ColorPicker from '../../../ui/ColorPicker';\n\nconst TextColorPicker = () => {\n  const { fontColor, applyStyleText } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  const onFontColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({ color: value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <ColorPicker\n      buttonClassName=\"verbum-toolbar-item verbum-color-picker\"\n      buttonAriaLabel={t('toolbar:textColorPicker.Description')}\n      buttonIconClassName=\"verbum-icon verbum-font-color\"\n      color={fontColor}\n      onChange={onFontColorSelect}\n      title=\"text color\"\n    />\n  );\n};\n\nexport default TextColorPicker;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React, { useContext } from 'react';\nimport DropDown from '../../../ui/DropDown';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst TextFormatDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isStrikethrough, isSubscript, isSuperscript } =\n    useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <DropDown\n      buttonClassName=\"verbum-toolbar-item spaced\"\n      buttonLabel=\"\"\n      buttonAriaLabel={t('toolbar:textFormatDropdown.Description')}\n      buttonIconClassName=\"verbum-icon verbum-dropdown-more\"\n    >\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={\n          'item ' + (isStrikethrough ? 'active dropdown-item-active' : '')\n        }\n        title={t('toolbar:textFormatDropdown.Options.Strikethrough.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Strikethrough.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-strikethrough\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:textFormatDropdown.Options.Strikethrough.Label')}\n        </span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'item ' + (isSubscript ? 'active dropdown-item-active' : '')}\n        title={t('toolbar:textFormatDropdown.Options.Subscript.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Subscript.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-subscript\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:textFormatDropdown.Options.Subscript.Label')}\n        </span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={\n          'item ' + (isSuperscript ? 'active dropdown-item-active' : '')\n        }\n        title={t('toolbar:textFormatDropdown.Options.Superscript.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Superscript.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-superscript\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:textFormatDropdown.Options.Superscript.Label')}\n        </span>\n      </button>\n    </DropDown>\n  );\n};\n\nexport default TextFormatDropdown;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst UnderlineButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isUnderline } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n      }}\n      className={'verbum-toolbar-item spaced ' + (isUnderline ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:underlineButton.Title')} (U)`\n          : `${t('toolbar:underlineButton.Title')} (Ctrl+U)`\n      }\n      aria-label={`${t('toolbar:underlineButton.Description')} ${\n        IS_APPLE ? 'U' : 'Ctrl+U'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-underline\" />\n    </button>\n  );\n};\n\nexport default UnderlineButton;\n"],"names":["__className","EmojiNode","TextNode","[object Object]","node","__text","__key","constructor","className","text","key","super","createDOM","config","dom","document","createElement","inner","appendChild","updateDOM","prevNode","firstChild","serializedNode","$createEmojiNode","setFormat","format","setDetail","detail","setMode","mode","setStyle","style","exportJSON","this","getClassName","type","getLatest","emojiText","ImageComponent","React","Promise","convertImageElement","domNode","HTMLImageElement","alt","altText","src","width","height","$createImageNode","ImageNode","DecoratorNode","maxWidth","showCaption","caption","captionsEnabled","__src","__altText","__maxWidth","__width","__height","__showCaption","__caption","createEditor","__captionsEnabled","undefined","nestedEditor","editorState","parseEditorState","isEmpty","setEditorState","exportDOM","element","setAttribute","toString","img","conversion","priority","getAltText","toJSON","getSrc","version","setWidthAndHeight","writable","getWritable","setShowCaption","span","theme","image","decorate","Suspense","fallback","nodeKey","getKey","resizable","$applyNodeReplacement","$isImageNode","KeywordNode","$createKeywordNode","cursor","canInsertTextBefore","canInsertTextAfter","isTextEntity","keyword","MentionNode","mentionName","__mention","$createMentionNode","setTextContent","cssText","mentionNode","toggleDirectionless","styleInject","css","ref","insertAt","head","getElementsByTagName","insertBefore","styleSheet","createTextNode","joinClasses","args","filter","Boolean","join","Button","data-test-id","dataTestId","children","onClick","disabled","small","title","createPollOption","uid","Math","random","replace","substr","votes","cloneOption","option","Array","from","PollOptionComponent","index","options","totalVotes","withPollNode","clientID","useCollaborationContext","checkboxRef","useRef","votesArray","checked","indexOf","length","onChange","e","toggleVote","value","setOptionText","target","placeholder","deleteOption","PollComponent","question","editor","useLexicalComposerContext","useMemo","reduce","next","getTotalVotes","cb","update","$getNodeByKey","$isPollNode","map","addOption","convertPollElement","$createPollNode","getAttribute","PollNode","__question","__options","forEach","self","push","splice","clonedOption","votesClone","voteIndex","hasAttribute","elem","display","CAN_USE_DOM","window","useLayoutEffectImpl","useLayoutEffect","useEffect","url","URL","location","href","WEBSOCKET_ID","URLSearchParams","search","get","createWebsocketProvider","id","yjsDocMap","doc","Doc","set","load","WebsocketProvider","WEBSOCKET_SLUG","connect","Context","createContext","historyState","current","redoStack","undoStack","useSharedHistoryContext","useContext","characterLimit","code","codeHighlight","atrule","attr","boolean","builtin","cdata","char","class","class-name","comment","constant","deleted","doctype","entity","function","important","inserted","namespace","number","operator","prolog","property","punctuation","regex","selector","string","symbol","tag","variable","hashtag","heading","h1","h2","h3","h4","h5","link","list","listitem","listitemChecked","listitemUnchecked","nested","olDepth","ul","ltr","mark","markOverlap","paragraph","quote","rtl","table","tableCell","tableCellHeader","bold","italic","strikethrough","subscript","superscript","underline","underlineStrikethrough","baseTheme","LexicalContentEditable","ContentEditable","Placeholder","positionSticky","stickyElem","positioning","rootElementRect","rectLeft","left","top","y","x","StickyComponent","color","stickyContainerRef","positioningRef","isDragging","offsetX","offsetY","isCollab","position","stickyContainer","resizeObserver","ResizeObserver","entries","i","entry","getBoundingClientRect","removeRootListener","registerRootListener","nextRootElem","prevRootElem","unobserve","observe","handleWindowResize","rootElement","getRootElement","addEventListener","removeEventListener","setTimeout","setProperty","handlePointerMove","event","pageX","pageY","handlePointerUp","classList","remove","$isStickyNode","setPosition","onPointerDown","button","stickContainer","clientX","clientY","add","preventDefault","toggleColor","LexicalNestedComposer","initialEditor","initialTheme","StickyEditorTheme","CollaborationPlugin","providerFactory","shouldBootstrap","HistoryPlugin","externalHistoryState","PlainTextPlugin","contentEditable","ErrorBoundary","LexicalErrorBoundary","StickyNode","__x","__y","__color","xOffset","yOffset","div","$setSelection","createPortal","body","isIsolated","TypeaheadNode","$createTypeaheadNode","YouTubeComponent","videoID","BlockWithAlignableContents","frameBorder","allow","allowFullScreen","YouTubeNode","DecoratorBlockNode","__id","__format","$createYouTubeNode","getId","_editor","embedBlockTheme","embedBlock","base","focus","isTopLevel","PlaygroundNodes","HeadingNode","ListNode","ListItemNode","QuoteNode","CodeNode","TableNode","TableCellNode","TableRowNode","HashtagNode","CodeHighlightNode","AutoLinkNode","LinkNode","OverflowNode","HorizontalRuleNode","MarkNode","languageDetector","async","detect","callback","navigator","language","substring","init","cacheUserLanguage","i18n","i18next","ns","resources","ar","de","en","es","fr","it","ja","nl","pl","pt","ptBr","ru","ukr","zh","fallbackLng","debug","interpolation","escapeValue","err","t","use","hostName","hostname","setOption","name","settings","disableBeforeInput","emptyEditor","isAutocomplete","isCharLimit","isCharLimitUtf8","isRichText","measureTypingPerf","showNestedEditorTreeView","showTreeView","PortalImpl","onClose","closeOnClickOutside","modalRef","modalOverlayElement","handler","keyCode","clickOutsideHandler","contains","_modalRef$current","parentElement","role","tabIndex","Modal","useModal","modalContent","setModalContent","useState","useCallback","content","getContent","TABLE_ROW_REG_EXP","TABLE","dependencies","export","exportChildren","$isTableNode","output","row","getChildren","rowOutput","$isTableRowNode","cell","$isElementNode","regExp","parentNode","_1","match","matchCells","mapToTableCells","rows","sibling","getPreviousSibling","maxCells","$isParagraphNode","getChildrenSize","getFirstChild","$isTextNode","cells","getTextContent","max","unshift","previousSibling","$createTableNode","tableRow","$createTableRowNode","append","createTableCell","getTableColumnsSize","selectEnd","textContent","$createTableCellNode","TableCellHeaderStates","NO_STATUS","$createParagraphNode","$createTextNode","trim","split","PLAYGROUND_TRANSFORMERS","$isHorizontalRuleNode","_2","isImport","line","$createHorizontalRuleNode","getNextSibling","selectNext","exportFormat","importRegExp","textNode","imageNode","trigger","CHECK_LIST","ELEMENT_TRANSFORMERS","TEXT_FORMAT_TRANSFORMERS","TEXT_MATCH_TRANSFORMERS","getElement","getElementById","fontSize","transform","padding","background","borderRadius","SPEECH_TO_TEXT_COMMAND","createCommand","VOICE_COMMANDS","\n","_ref","selection","insertParagraph","redo","_ref2","dispatchCommand","REDO_COMMAND","undo","_ref3","UNDO_COMMAND","SUPPORT_SPEECH_RECOGNITION","timer","cleanup","isEnabled","setIsEnabled","SpeechRecognition","webkitSpeechRecognition","recognition","report","clearTimeout","removeChild","console","log","innerHTML","continuous","interimResults","resultItem","results","item","resultIndex","transcript","isFinal","$getSelection","$isRangeSelection","command","toLowerCase","insertText","start","stop","registerCommand","_isEnabled","COMMAND_PRIORITY_EDITOR","ActionsPlugin","isEditable","setIsEditable","isSpeechToText","setIsSpeechToText","connected","setConnected","isEditorEmpty","setIsEditorEmpty","modal","showModal","useTranslation","mergeRegister","registerEditableListener","editable","CONNECTED_COMMAND","payload","registerUpdateListener","getEditorState","read","$getRoot","paragraphChildren","handleMarkdownToggle","root","$isCodeNode","getLanguage","$convertFromMarkdownString","markdown","$convertToMarkdownString","clear","$createCodeNode","importFile","exportFile","fileName","Date","toISOString","source","ShowClearDialog","setEditable","TOGGLE_CONNECT_COMMAND","CLEAR_EDITOR_COMMAND","URL_MATCHER","EMAIL_MATCHER","MATCHERS","exec","LexicalAutoLinkPlugin","AutoLinkPlugin","matchers","INSERT_INLINE_COMMAND","FloatingCharacterStylesEditor","isLink","isBold","isItalic","isUnderline","isCode","isStrikethrough","isSubscript","isSuperscript","popupCharStylesEditorRef","mouseDownRef","insertLink","TOGGLE_LINK_COMMAND","updateCharacterStylesEditor","popupCharStylesEditorElem","nativeSelection","getSelection","isCollapsed","anchorNode","rect","domRange","getRangeAt","firstElementChild","pageYOffset","pageXOffset","offsetWidth","bottom","opacity","setPopupPosition","onResize","SELECTION_CHANGE_COMMAND","COMMAND_PRIORITY_LOW","FORMAT_TEXT_COMMAND","getSelectedNode","anchor","getNode","focusNode","isBackward","$isAtNodeEnd","CharacterStylesPopupPlugin","isText","setIsText","setIsLink","setIsBold","setIsItalic","setIsUnderline","setIsStrikethrough","setIsSubscript","setIsSuperscript","setIsCode","updatePopup","hasFormat","parent","getParent","$isLinkNode","$isCodeHighlightNode","useCharacterStylesPopup","ClickableLinkPlugin","newTab","hasMoved","prevOffsetX","prevOffsetY","onPointerUp","hasMovedDuringClick","linkDomNode","isLinkDomNode","getLinkDomNode","linkNode","maybeLinkNode","$getNearestNodeFromDOMNode","open","metaKey","ctrlKey","prevRootElement","nodeName","CodeHighlightPlugin","registerCodeHighlighting","KEYWORDS_REGEX","KeywordsPlugin","hasNodes","Error","createKeywordNode","getKeywordMatch","matchArr","startOffset","end","useLexicalTextEntity","ListMaxIndentLevelPlugin","maxDepth","INDENT_CONTENT_COMMAND","elementNodesInSelection","nodesInSelection","getNodes","Set","getParentOrThrow","n","getElementNodesInSelection","totalDepth","elementNode","$isListNode","$getListDepth","$isListItemNode","isIndentPermitted","COMMAND_PRIORITY_CRITICAL","MarkdownPlugin","MarkdownShortcutPlugin","transformers","lastTabKeyDownTimestamp","hasRegisteredKeyDownListener","TabFocusPlugin","timeStamp","FOCUS_COMMAND","clone","EditorContext","DialogButtonsList","DialogActions","FileInput","accept","label","files","TextInput","INSERT_IMAGE_COMMAND","InsertImageUriDialogBody","setSrc","setAltText","isDisabled","InsertImageUploadedDialogBody","reader","FileReader","onload","result","readAsDataURL","ImagesPlugin","$insertNodes","$isRootOrShadowRoot","$wrapNodeInElement","DRAGSTART_COMMAND","getImageNodeInSelection","dataTransfer","setData","setDragImage","JSON","stringify","data","onDragStart","COMMAND_PRIORITY_HIGH","DRAGOVER_COMMAND","canDropImage","onDragover","DROP_COMMAND","dragData","_event$dataTransfer","getData","parse","getDragImageData","range","domSelection","nodeType","defaultView","ownerDocument","caretRangeFromPoint","rangeParent","collapse","rangeOffset","getDragSelection","rangeSelection","$createRangeSelection","applyDOMRange","onDrop","$isNodeSelection","HTMLElement","closest","ACCEPTABLE_IMAGE_TYPES","DragDropPaste","DRAG_DROP_PASTE","filesResult","mediaFileReader","flatMap","file","isMimeType","ToolbarContext","DropDown","buttonLabel","buttonAriaLabel","buttonClassName","buttonIconClassName","stopCloseOnClickSelf","dropDownRef","buttonRef","showDropDown","setShowDropDown","dropDown","min","innerWidth","handle","Divider","AlignDropdown","activeEditor","isRTL","FORMAT_ELEMENT_COMMAND","OUTDENT_CONTENT_COMMAND","INSERT_POLL_COMMAND","PollPlugin","pollNode","$isRootNode","insertNodes","INSERT_YOUTUBE_COMMAND","YouTubePlugin","youTubeNode","getTopLevelElementOrThrow","insertAfter","paragraphNode","select","TableCellResizer","targetRef","resizerRef","tableRectRef","mouseStartPosRef","mouseCurrentPos","updateMouseCurrentPos","activeCell","updateActiveCell","isSelectingGrid","updateIsSelectingGrid","draggingDirection","updateDraggingDirection","isGridSelection","DEPRECATED_$isGridSelection","resetState","onMouseMove","getCellFromTarget","tableCellNode","tableNode","$getTableNodeFromLexicalNodeOrThrow","tableElement","getElementByKey","isHeightChanging","direction","updateRowHeight","newHeight","$isTableCellNode","tableRowIndex","$getTableRowIndexFromTableCellNode","tableRows","setHeight","updateColumnWidth","newWidth","tableColumnIndex","$getTableColumnIndexFromTableCellNode","r","tableCells","setWidth","toggleResize","stopPropagation","heightChange","abs","widthChange","resizerStyles","styles","backgroundColor","right","tableRect","getResizers","onMouseDown","onMouseUp","TableCellResizerPlugin","TableActionMenu","_tableCellNode","setIsMenuOpen","contextRef","updateTableCellNode","selectionCounts","updateSelectionCounts","columns","registerMutationListener","nodeMutations","selectionShape","getShape","toX","fromX","toY","fromY","menuButtonElement","dropDownElement","menuButtonRect","handleClickOutside","clearTableSelection","isAttached","tableSelection","getTableSelectionFromTableElement","clearHighlight","markDirty","insertTableRowAtSelection","shouldInsertAfter","grid","$getElementGridForTableNode","$insertTableRow","insertTableColumnAtSelection","$insertTableColumn","deleteTableRowAtSelection","$removeTableRowAtIndex","deleteTableAtSelection","deleteTableColumnAtSelection","$deleteTableColumn","toggleTableRowIsHeader","toggleHeaderStyle","ROW","toggleTableColumnIsHeader","COLUMN","__headerState","TableCellActionMenuContainer","menuButtonRef","menuRootRef","isMenuOpen","setTableMenuCellNode","moveMenu","menu","activeElement","tableCellNodeFromSelection","$getTableCellNodeFromLexicalNode","menuButtonDOM","tableCellNodeDOM","tableCellRect","menuRect","prevTableCellDOM","TableActionMenuPlugin","HorizontalRulePlugin","INSERT_HORIZONTAL_RULE_COMMAND","horizontalRuleNode","YOUTUBE_ID_PARSER","parseYouTubeVideoID","urlMatches","InsertImageDialog","InsertTableDialog","setRows","setColumns","INSERT_TABLE_COMMAND","InsertPollDialog","setQuestion","InsertYouTubeDialog","setText","InsertDropdown","_ref7","enableTable","enableImage","enable","enableYoutube","enablePoll","enableHorizontalRule","enableStickyNote","TablePlugin","TableCellActionMenuPlugin","stickyNode","IS_APPLE","test","platform","UndoButton","canUndo","RedoButton","canRedo","Select","CODE_LANGUAGE_OPTIONS","CodeLanguageDropdown","selectedElementKey","codeLanguage","onCodeLanguageSelect","setLanguage","BlockFormatDropdown","blockType","formatHeading","headingSize","$wrapNodes","$createHeadingNode","INSERT_UNORDERED_LIST_COMMAND","REMOVE_LIST_COMMAND","INSERT_ORDERED_LIST_COMMAND","INSERT_CHECK_LIST_COMMAND","$createQuoteNode","codeNode","removeText","insertRawText","supportedBlockTypes","CODE_LANGUAGE_MAP","javascript","md","plaintext","python","CapitalizedNameMentionsRegex","RegExp","PUNC","TRIGGERS","VALID_CHARS","AtSignMentionsRegex","AtSignMentionsRegexAliasRegex","mentionsCache","Map","MentionTypeaheadOption","TypeaheadOption","picture","MentionsTypeaheadMenuItem","isSelected","onMouseEnter","setRefElement","basicColors","ColorPicker","rest","selfColor","setSelfColor","transformColor","saturationPosition","hsv","s","v","huePosition","h","hex","basicColor","MoveWrapper","newColor","divRef","move","clamp","_e","toHex","startsWith","ctx","getContext","fillStyle","hex2rgb","rbgArr","m","g","b","parseInt","rgb2hsv","d","rgb2hex","padStart","rgb","f","p","q","round","hsv2rgb","PREVIEW_CACHE","LinkPreviewContent","preview","cached","fetch","encodeURI","then","response","json","catch","useSuspenseRequest","domain","description","Glimmer","props","animationDelay","LinkPreview","positionEditorElement","FloatingLinkEditor","editorRef","inputRef","linkUrl","setLinkUrl","isEditMode","setEditMode","lastSelection","setLastSelection","updateLinkEditor","getURL","editorElem","onKeyDown","rel","defaultFontFamilyOptions","defaultFontSizeOptions","imageCache","LazyImage","imageRef","has","resolve","Image","useSuspenseImage","bgColor","applyStyleText","onBgColorSelect","background-color","hashtagsEnabled","autoFocusEnabled","autoLinkEnabled","emojisEnabled","actionsEnabled","speechToTextEnabled","listMaxIndent","locale","setActiveEditor","editorStateRef","placeholderComponent","changeLanguage","Provider","AutoFocusPlugin","ClearEditorPlugin","HashtagPlugin","SpeechToTextPlugin","RichTextPlugin","OnChangePlugin","ListPlugin","CheckListPlugin","LinkPlugin","initialEditorState","initialConfig","nodes","onError","error","PlaygroundEditorTheme","LexicalComposer","I18nextProvider","fontOptions","fontFamily","onFontFamilySelect","font-family","fontSizeOptions","onFontSizeSelect","font-size","hasModifier","altKey","searchData","getTypeaheadValues","queryString","setQueryString","mentionString","mentionData","setResults","cachedResults","useMentionLookupService","checkForSlashTriggerMatch","useBasicTypeaheadTriggerMatch","minLength","slice","onSelectOption","selectedOption","nodeToReplace","closeMenu","$createAutoLinkNode","checkForMentionMatch","mentionMatch","minMatchLength","matchingString","leadOffset","replaceableString","checkForAtSignMentions","checkForCapitalizedNameMentions","getPossibleQueryMatch","LexicalTypeaheadMenuPlugin","onQueryChange","triggerFn","menuRenderFn","anchorElementRef","selectedIndex","selectOptionAndCleanUp","setHighlightedIndex","ReactDOM","fontColor","onFontColorSelect","defaultFontSize","defaultFontColor","defaultBgColor","defaultFontFamily","insertExists","InsertComponent","useChild","alignExists","AlignComponent","setBlockType","setSelectedElementKey","setFontSize","setFontColor","setBgColor","setFontFamily","setCanUndo","setCanRedo","setIsRTL","setCodeLanguage","updateToolbar","elementKey","elementDOM","$isParentElementRTL","parentList","$getNearestNodeOfType","getListType","$isHeadingNode","getTag","getType","$getSelectionStyleValueForProperty","font","_payload","newEditor","CAN_UNDO_COMMAND","CAN_REDO_COMMAND","Object","$patchStyleText"],"mappings":"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"}