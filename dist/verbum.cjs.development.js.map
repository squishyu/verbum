{"version":3,"file":"verbum.cjs.development.js","sources":["../src/nodes/EmojiNode.tsx","../src/nodes/ImageNode.tsx","../src/nodes/KeywordNode.ts","../src/nodes/MentionNode.ts","../src/utils/join-classes.ts","../src/ui/Button.tsx","../src/nodes/PollNode.tsx","../src/shared/src/canUseDOM.ts","../src/shared/src/useLayoutEffect.ts","../src/collaboration.ts","../src/context/SharedHistoryContext.tsx","../src/themes/PlaygroundEditorTheme.ts","../src/themes/StickyEditorTheme.ts","../src/ui/ContentEditable.tsx","../src/ui/Placeholder.tsx","../src/nodes/StickyNode.tsx","../src/nodes/TweetNode.tsx","../src/nodes/TypeaheadNode.ts","../src/nodes/YouTubeNode.tsx","../src/nodes/PlaygroundNodes.ts","../src/locale/index.tsx","../src/EditorComposer.tsx","../src/appSettings.ts","../src/context/SettingsContext.tsx","../src/ui/Modal.tsx","../src/hooks/useModal.tsx","../src/plugins/MarkdownTransformers.ts","../src/hooks/useReport.ts","../src/plugins/SpeechToTextPlugin.ts","../src/plugins/ActionsPlugin.tsx","../src/plugins/AutoLinkPlugin.tsx","../src/plugins/CommentPlugin.tsx","../src/plugins/CharacterStylesPopupPlugin.tsx","../src/plugins/ClickableLinkPlugin.ts","../src/plugins/CodeHighlightPlugin.ts","../src/plugins/KeywordsPlugin.ts","../src/plugins/ListMaxIndentLevelPlugin.ts","../src/plugins/MarkdownShortcutPlugin.tsx","../src/plugins/TabFocusPlugin.tsx","../src/context/EditorContext.tsx","../src/ui/FileInput.tsx","../src/ui/TextInput.tsx","../src/plugins/ImagesPlugin.tsx","../src/plugins/DragDropPastePlugin.tsx","../src/Editor.tsx","../src/utils/node.util.ts","../src/context/ToolbarContext.tsx","../src/ui/DropDown.tsx","../src/plugins/ToolbarPlugin/components/AlignDropdown.tsx","../src/plugins/PollPlugin.ts","../src/plugins/TwitterPlugin.ts","../src/plugins/YouTubePlugin.ts","../src/plugins/TableCellResizer.tsx","../src/plugins/TableActionMenuPlugin.tsx","../src/plugins/HorizontalRulePlugin.ts","../src/plugins/ToolbarPlugin/components/InsertDropdown.tsx","../src/shared/src/environment.ts","../src/plugins/ToolbarPlugin/components/UndoButton.tsx","../src/plugins/ToolbarPlugin/components/RedoButton.tsx","../src/ui/Select.tsx","../src/plugins/ToolbarPlugin/components/CodeLanguageDropdown.tsx","../src/plugins/ToolbarPlugin/components/BlockFormatDropdown.tsx","../src/ui/Divider.tsx","../src/plugins/ToolbarPlugin/ToolbarPlugin.tsx","../src/plugins/MentionsPlugin.tsx","../src/ui/ColorPicker.tsx","../src/plugins/ToolbarPlugin/components/BackgroundColorPicker.tsx","../src/plugins/ToolbarPlugin/components/BoldButton.tsx","../src/plugins/ToolbarPlugin/components/CodeFormatButton.tsx","../src/ui/LinkPreview.tsx","../src/plugins/ToolbarPlugin/components/FloatingLinkEditor.tsx","../src/plugins/ToolbarPlugin/components/FontFamilyDropdown.tsx","../src/plugins/ToolbarPlugin/components/FontSizeDropdown.tsx","../src/plugins/ToolbarPlugin/components/InsertLinkButton.tsx","../src/plugins/ToolbarPlugin/components/ItalicButton.tsx","../src/plugins/ToolbarPlugin/components/TextColorPicker.tsx","../src/plugins/ToolbarPlugin/components/TextFormatDropdown.tsx","../src/plugins/ToolbarPlugin/components/UnderlineButton.tsx","../src/nodes/ImageComponent.tsx"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport React from 'react';\n\nimport type { EditorConfig, LexicalNode, NodeKey } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedEmojiNode = Spread<\n  {\n    className: string;\n    type: 'emoji';\n  },\n  typeof SerializedTextNode\n>;\n\nlet __className: string = 'EmojiNode';\nexport class EmojiNode extends TextNode {\n  static getType(): string {\n    return 'emoji';\n  }\n\n  static clone(node: EmojiNode): EmojiNode {\n    return new EmojiNode(__className, node.__text, node.__key);\n  }\n\n  constructor(className: string, text: string, key?: NodeKey) {\n    super(text, key);\n    __className = className;\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = document.createElement('span');\n    const inner = super.createDOM(config);\n    dom.className = __className;\n    inner.className = 'emoji-inner';\n    dom.appendChild(inner);\n    return dom;\n  }\n\n  updateDOM(\n    prevNode: TextNode,\n    dom: HTMLElement,\n    config: EditorConfig\n  ): boolean {\n    const inner = dom.firstChild;\n    if (inner === null) {\n      return true;\n    }\n    super.updateDOM(prevNode, inner as HTMLElement, config);\n    return false;\n  }\n\n  static importJSON(serializedNode: SerializedEmojiNode): EmojiNode {\n    const node = $createEmojiNode(\n      serializedNode.className,\n      serializedNode.text\n    );\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedEmojiNode {\n    return {\n      ...super.exportJSON(),\n      className: this.getClassName(),\n      type: 'emoji',\n    };\n  }\n\n  getClassName(): string {\n    const self = this.getLatest();\n    return self.__className;\n  }\n}\n\nexport function $isEmojiNode(\n  node: LexicalNode | null | undefined\n): node is EmojiNode {\n  return node instanceof EmojiNode;\n}\n\nexport function $createEmojiNode(\n  className: string,\n  emojiText: string\n): EmojiNode {\n  return new EmojiNode(className, emojiText).setMode('token');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedEditor,\n  SerializedLexicalNode,\n  Spread,\n} from 'lexical';\n\nimport { $applyNodeReplacement, createEditor, DecoratorNode } from 'lexical';\nimport * as React from 'react';\nimport { Suspense } from 'react';\n\nconst ImageComponent = React.lazy(\n  // @ts-ignore\n  () => import('./ImageComponent')\n);\n\nexport interface ImagePayload {\n  altText: string;\n  caption?: LexicalEditor;\n  height?: number;\n  key?: NodeKey;\n  maxWidth?: number;\n  showCaption?: boolean;\n  src: string;\n  width?: number;\n  captionsEnabled?: boolean;\n}\n\nfunction convertImageElement(domNode: Node): null | DOMConversionOutput {\n  if (domNode instanceof HTMLImageElement) {\n    const { alt: altText, src, width, height } = domNode;\n    const node = $createImageNode({ altText, height, src, width });\n    return { node };\n  }\n  return null;\n}\n\nexport type SerializedImageNode = Spread<\n  {\n    altText: string;\n    caption: SerializedEditor;\n    height?: number;\n    maxWidth: number;\n    showCaption: boolean;\n    src: string;\n    width?: number;\n  },\n  SerializedLexicalNode\n>;\n\nexport class ImageNode extends DecoratorNode<JSX.Element> {\n  __src: string;\n  __altText: string;\n  __width: 'inherit' | number;\n  __height: 'inherit' | number;\n  __maxWidth: number;\n  __showCaption: boolean;\n  __caption: LexicalEditor;\n  // Captions cannot yet be used within editor cells\n  __captionsEnabled: boolean;\n\n  static getType(): string {\n    return 'image';\n  }\n\n  static clone(node: ImageNode): ImageNode {\n    return new ImageNode(\n      node.__src,\n      node.__altText,\n      node.__maxWidth,\n      node.__width,\n      node.__height,\n      node.__showCaption,\n      node.__caption,\n      node.__captionsEnabled,\n      node.__key\n    );\n  }\n\n  static importJSON(serializedNode: SerializedImageNode): ImageNode {\n    const { altText, height, width, maxWidth, caption, src, showCaption } =\n      serializedNode;\n    const node = $createImageNode({\n      altText,\n      height,\n      maxWidth,\n      showCaption,\n      src,\n      width,\n    });\n    const nestedEditor = node.__caption;\n    const editorState = nestedEditor.parseEditorState(caption.editorState);\n    if (!editorState.isEmpty()) {\n      nestedEditor.setEditorState(editorState);\n    }\n    return node;\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('img');\n    element.setAttribute('src', this.__src);\n    element.setAttribute('alt', this.__altText);\n    element.setAttribute('width', this.__width.toString());\n    element.setAttribute('height', this.__height.toString());\n    return { element };\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      img: (node: Node) => ({\n        conversion: convertImageElement,\n        priority: 0,\n      }),\n    };\n  }\n\n  constructor(\n    src: string,\n    altText: string,\n    maxWidth: number,\n    width?: 'inherit' | number,\n    height?: 'inherit' | number,\n    showCaption?: boolean,\n    caption?: LexicalEditor,\n    captionsEnabled?: boolean,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__src = src;\n    this.__altText = altText;\n    this.__maxWidth = maxWidth;\n    this.__width = width || 'inherit';\n    this.__height = height || 'inherit';\n    this.__showCaption = showCaption || false;\n    this.__caption = caption || createEditor();\n    this.__captionsEnabled = captionsEnabled || captionsEnabled === undefined;\n  }\n\n  exportJSON(): SerializedImageNode {\n    return {\n      altText: this.getAltText(),\n      caption: this.__caption.toJSON(),\n      height: this.__height === 'inherit' ? 0 : this.__height,\n      maxWidth: this.__maxWidth,\n      showCaption: this.__showCaption,\n      src: this.getSrc(),\n      type: 'image',\n      version: 1,\n      width: this.__width === 'inherit' ? 0 : this.__width,\n    };\n  }\n\n  setWidthAndHeight(\n    width: 'inherit' | number,\n    height: 'inherit' | number\n  ): void {\n    const writable = this.getWritable();\n    writable.__width = width;\n    writable.__height = height;\n  }\n\n  setShowCaption(showCaption: boolean): void {\n    const writable = this.getWritable();\n    writable.__showCaption = showCaption;\n  }\n\n  // View\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const span = document.createElement('span');\n    const theme = config.theme;\n    const className = theme.image;\n    if (className !== undefined) {\n      span.className = className;\n    }\n    return span;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getSrc(): string {\n    return this.__src;\n  }\n\n  getAltText(): string {\n    return this.__altText;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <Suspense fallback={null}>\n        <ImageComponent\n          src={this.__src}\n          altText={this.__altText}\n          width={this.__width}\n          height={this.__height}\n          maxWidth={this.__maxWidth}\n          nodeKey={this.getKey()}\n          showCaption={this.__showCaption}\n          caption={this.__caption}\n          captionsEnabled={this.__captionsEnabled}\n          resizable={true}\n        />\n      </Suspense>\n    );\n  }\n}\n\nexport function $createImageNode({\n  altText,\n  height,\n  maxWidth = 500,\n  captionsEnabled,\n  src,\n  width,\n  showCaption,\n  caption,\n  key,\n}: ImagePayload): ImageNode {\n  return $applyNodeReplacement(\n    new ImageNode(\n      src,\n      altText,\n      maxWidth,\n      width,\n      height,\n      showCaption,\n      caption,\n      captionsEnabled,\n      key\n    )\n  );\n}\n\nexport function $isImageNode(\n  node: LexicalNode | null | undefined\n): node is ImageNode {\n  return node instanceof ImageNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig, LexicalNode } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedKeywordNode = Spread<\n  {\n    type: 'keyword';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nexport class KeywordNode extends TextNode {\n  static getType(): string {\n    return 'keyword';\n  }\n\n  static clone(node: KeywordNode): KeywordNode {\n    return new KeywordNode(node.__text, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedKeywordNode): KeywordNode {\n    const node = $createKeywordNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedKeywordNode {\n    return {\n      ...super.exportJSON(),\n      type: 'keyword',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cursor = 'default';\n    dom.className = 'keyword';\n    return dom;\n  }\n\n  canInsertTextBefore(): boolean {\n    return false;\n  }\n\n  canInsertTextAfter(): boolean {\n    return false;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createKeywordNode(keyword: string): KeywordNode {\n  return new KeywordNode(keyword);\n}\n\nexport function $isKeywordNode(\n  node: LexicalNode | null | undefined | undefined\n): boolean {\n  return node instanceof KeywordNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig, LexicalNode, NodeKey } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedMentionNode = Spread<\n  {\n    mentionName: string;\n    type: 'mention';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nconst mentionStyle = 'background-color: rgba(24, 119, 232, 0.2)';\nexport class MentionNode extends TextNode {\n  __mention: string;\n\n  static getType(): string {\n    return 'mention';\n  }\n\n  static clone(node: MentionNode): MentionNode {\n    return new MentionNode(node.__mention, node.__text, node.__key);\n  }\n  static importJSON(serializedNode: SerializedMentionNode): MentionNode {\n    const node = $createMentionNode(serializedNode.mentionName);\n    node.setTextContent(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  constructor(mentionName: string, text?: string, key?: NodeKey) {\n    super(text ?? mentionName, key);\n    this.__mention = mentionName;\n  }\n\n  exportJSON(): SerializedMentionNode {\n    return {\n      ...super.exportJSON(),\n      mentionName: this.__mention,\n      type: 'mention',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = mentionStyle;\n    dom.className = 'mention';\n    return dom;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createMentionNode(mentionName: string): MentionNode {\n  const mentionNode = new MentionNode(mentionName);\n  mentionNode.setMode('segmented').toggleDirectionless();\n  return mentionNode;\n}\n\nexport function $isMentionNode(\n  node: LexicalNode | null | undefined\n): node is MentionNode {\n  return node instanceof MentionNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport default function joinClasses(...args) {\n  return args.filter(Boolean).join(' ');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Button.css';\n\nimport * as React from 'react';\n\nimport joinClasses from '../utils/join-classes';\n\nexport default function Button({\n  'data-test-id': dataTestId,\n  children,\n  className,\n  onClick,\n  disabled,\n  small,\n  title,\n}: {\n  'data-test-id'?: string;\n  children: JSX.Element | string | (JSX.Element | string)[];\n  className?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  small?: boolean;\n  title?: string;\n}): JSX.Element {\n  return (\n    <button\n      disabled={disabled}\n      className={joinClasses(\n        'Button__root',\n        disabled && 'Button__disabled',\n        small && 'Button__small',\n        className\n      )}\n      onClick={onClick}\n      title={title}\n      aria-label={title}\n      {...(dataTestId && { 'data-test-id': dataTestId })}\n    >\n      {children}\n    </button>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './PollNode.css';\n\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getNodeByKey, DecoratorNode } from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useMemo, useRef } from 'react';\n\nimport Button from '../ui/Button';\nimport joinClasses from '../utils/join-classes';\n\ntype Options = ReadonlyArray<Option>;\n\ntype Option = Readonly<{\n  text: string;\n  uid: string;\n  votes: Array<number>;\n}>;\n\nfunction createUID(): string {\n  return Math.random()\n    .toString(36)\n    .replace(/[^a-z]+/g, '')\n    .substr(0, 5);\n}\n\nfunction createPollOption(text = ''): Option {\n  return {\n    text,\n    uid: createUID(),\n    votes: [],\n  };\n}\n\nfunction cloneOption(\n  option: Option,\n  text: string,\n  votes?: Array<number>\n): Option {\n  return {\n    text,\n    uid: option.uid,\n    votes: votes || Array.from(option.votes),\n  };\n}\n\nfunction getTotalVotes(options: Options): number {\n  return options.reduce((totalVotes, next) => {\n    return totalVotes + next.votes.length;\n  }, 0);\n}\n\nfunction PollOptionComponent({\n  option,\n  index,\n  options,\n  totalVotes,\n  withPollNode,\n}: {\n  index: number;\n  option: Option;\n  options: Options;\n  totalVotes: number;\n  withPollNode: (cb: (PollNode) => void) => void;\n}): JSX.Element {\n  const { clientID } = useCollaborationContext();\n  const checkboxRef = useRef(null);\n  const votesArray = option.votes;\n  const checkedIndex = votesArray.indexOf(clientID);\n  const checked = checkedIndex !== -1;\n  const votes = votesArray.length;\n  const text = option.text;\n\n  return (\n    <div className=\"PollNode__optionContainer\">\n      <div\n        className={joinClasses(\n          'PollNode__optionCheckboxWrapper',\n          checked && 'PollNode__optionCheckboxChecked'\n        )}\n      >\n        <input\n          ref={checkboxRef}\n          className=\"PollNode__optionCheckbox\"\n          type=\"checkbox\"\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.toggleVote(option, clientID);\n            });\n          }}\n          checked={checked}\n        />\n      </div>\n      <div className=\"PollNode__optionInputWrapper\">\n        <div\n          className=\"PollNode__optionInputVotes\"\n          style={{ width: `${votes === 0 ? 0 : (votes / totalVotes) * 100}%` }}\n        />\n        <span className=\"PollNode__optionInputVotesCount\">\n          {votes > 0 && (votes === 1 ? '1 vote' : `${votes} votes`)}\n        </span>\n        <input\n          className=\"PollNode__optionInput\"\n          type=\"text\"\n          value={text}\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.setOptionText(option, e.target.value);\n            });\n          }}\n          placeholder={`Option ${index + 1}`}\n        />\n      </div>\n      <button\n        disabled={options.length < 3}\n        className={joinClasses(\n          'PollNode__optionDelete',\n          options.length < 3 && 'PollNode__optionDeleteDisabled'\n        )}\n        arial-label=\"Remove\"\n        onClick={() => {\n          withPollNode((node) => {\n            node.deleteOption(option);\n          });\n        }}\n      />\n    </div>\n  );\n}\n\nfunction PollComponent({\n  question,\n  options,\n  nodeKey,\n}: {\n  nodeKey: NodeKey;\n  options: Options;\n  question: string;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const totalVotes = useMemo(() => getTotalVotes(options), [options]);\n\n  const withPollNode = (cb: (node: PollNode) => void): void => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isPollNode(node)) {\n        cb(node);\n      }\n    });\n  };\n\n  const addOption = () => {\n    withPollNode((node) => {\n      node.addOption(createPollOption());\n    });\n  };\n\n  return (\n    <div className=\"PollNode__container\">\n      <h2 className=\"PollNode__heading\">{question}</h2>\n      {options.map((option, index) => {\n        const key = option.uid;\n        return (\n          <PollOptionComponent\n            key={key}\n            withPollNode={withPollNode}\n            option={option}\n            index={index}\n            options={options}\n            totalVotes={totalVotes}\n          />\n        );\n      })}\n      <div className=\"PollNode__footer\">\n        <Button onClick={addOption} small={true}>\n          Add Option\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport type SerializedPollNode = Spread<\n  {\n    question: string;\n    options: Options;\n    type: 'poll';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nfunction convertPollElement(domNode: HTMLElement): DOMConversionOutput {\n  const question = domNode.getAttribute('data-lexical-poll-question');\n  const node = $createPollNode(question);\n  return { node };\n}\n\nexport class PollNode extends DecoratorNode<JSX.Element> {\n  __question: string;\n  __options: Options;\n\n  static getType(): string {\n    return 'poll';\n  }\n\n  static clone(node: PollNode): PollNode {\n    return new PollNode(node.__question, node.__options, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedPollNode): PollNode {\n    const node = $createPollNode(serializedNode.question);\n    serializedNode.options.forEach(node.addOption);\n    return node;\n  }\n\n  constructor(question: string, options?: Options, key?: NodeKey) {\n    super(key);\n    this.__question = question;\n    this.__options = options || [createPollOption(), createPollOption()];\n  }\n\n  exportJSON(): SerializedPollNode {\n    return {\n      options: this.__options,\n      question: this.__question,\n      type: 'poll',\n      version: 1,\n    };\n  }\n\n  addOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    options.push(option);\n    self.__options = options;\n  }\n\n  deleteOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options.splice(index, 1);\n    self.__options = options;\n  }\n\n  setOptionText(option: Option, text: string): void {\n    const self = this.getWritable();\n    const clonedOption = cloneOption(option, text);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  toggleVote(option: Option, clientID: number): void {\n    const self = this.getWritable();\n    const votes = option.votes;\n    const votesClone = Array.from(votes);\n    const voteIndex = votes.indexOf(clientID);\n    if (voteIndex === -1) {\n      votesClone.push(clientID);\n    } else {\n      votesClone.splice(voteIndex, 1);\n    }\n    const clonedOption = cloneOption(option, option.text, votesClone);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      span: (domNode: HTMLElement) => {\n        if (!domNode.hasAttribute('data-lexical-poll-question')) {\n          return null;\n        }\n        return {\n          conversion: convertPollElement,\n          priority: 2,\n        };\n      },\n    };\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('span');\n    element.setAttribute('data-lexical-poll-question', this.__question);\n    return { element };\n  }\n\n  createDOM(): HTMLElement {\n    const elem = document.createElement('span');\n    elem.style.display = 'inline-block';\n    return elem;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <PollComponent\n        question={this.__question}\n        options={this.__options}\n        nodeKey={this.__key}\n      />\n    );\n  }\n}\n\nexport function $createPollNode(question: string): PollNode {\n  return new PollNode(question);\n}\n\nexport function $isPollNode(\n  node: LexicalNode | null | undefined\n): node is PollNode {\n  return node instanceof PollNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nimport { useEffect, useLayoutEffect } from 'react';\nimport { CAN_USE_DOM } from './canUseDOM';\n\nconst useLayoutEffectImpl: typeof useLayoutEffect = CAN_USE_DOM\n  ? useLayoutEffect\n  : useEffect;\n\nexport default useLayoutEffectImpl;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {Provider} from '@lexical/yjs';\nimport { WebsocketProvider } from 'y-websocket';\nimport { Doc } from 'yjs';\n\nconst url = new URL(window.location.href);\nconst params = new URLSearchParams(url.search);\nconst WEBSOCKET_ENDPOINT = 'ws://localhost:1234';\nconst WEBSOCKET_SLUG = 'playground';\nconst WEBSOCKET_ID = params.get('collabId') || '0';\n\n// parent dom -> child doc\nexport function createWebsocketProvider(\n  id: string,\n  yjsDocMap: Map<string, Doc>\n): Provider {\n  let doc = yjsDocMap.get(id);\n\n  if (doc === undefined) {\n    doc = new Doc();\n    yjsDocMap.set(id, doc);\n  } else {\n    doc.load();\n  }\n\n  \n  // @ts-ignore\n  return new WebsocketProvider(\n    WEBSOCKET_ENDPOINT,\n    WEBSOCKET_SLUG + '/' + WEBSOCKET_ID + '/' + id,\n    doc,\n    {\n      connect: false,\n    }\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { HistoryState } from '@lexical/react/LexicalHistoryPlugin';\n\nimport { createEmptyHistoryState } from '@lexical/react/LexicalHistoryPlugin';\nimport * as React from 'react';\nimport { createContext, useContext, useMemo } from 'react';\n\ntype ContextShape = {\n  historyState: HistoryState;\n};\n\nconst Context: React.Context<ContextShape> = createContext({\n  historyState: { current: null, redoStack: [], undoStack: [] },\n});\n\nexport const SharedHistoryContext = ({\n  children,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n}): JSX.Element => {\n  const historyContext = useMemo(\n    () => ({ historyState: createEmptyHistoryState() }),\n    []\n  );\n  return <Context.Provider value={historyContext}>{children}</Context.Provider>;\n};\n\nexport const useSharedHistoryContext = (): ContextShape => {\n  return useContext(Context);\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorThemeClasses } from 'lexical';\n\nimport './PlaygroundEditorTheme.css';\n\nconst theme: EditorThemeClasses = {\n  characterLimit: 'PlaygroundEditorTheme__characterLimit',\n  code: 'PlaygroundEditorTheme__code',\n  codeHighlight: {\n    atrule: 'PlaygroundEditorTheme__tokenAttr',\n    attr: 'PlaygroundEditorTheme__tokenAttr',\n    boolean: 'PlaygroundEditorTheme__tokenProperty',\n    builtin: 'PlaygroundEditorTheme__tokenSelector',\n    cdata: 'PlaygroundEditorTheme__tokenComment',\n    char: 'PlaygroundEditorTheme__tokenSelector',\n    class: 'PlaygroundEditorTheme__tokenFunction',\n    'class-name': 'PlaygroundEditorTheme__tokenFunction',\n    comment: 'PlaygroundEditorTheme__tokenComment',\n    constant: 'PlaygroundEditorTheme__tokenProperty',\n    deleted: 'PlaygroundEditorTheme__tokenProperty',\n    doctype: 'PlaygroundEditorTheme__tokenComment',\n    entity: 'PlaygroundEditorTheme__tokenOperator',\n    function: 'PlaygroundEditorTheme__tokenFunction',\n    important: 'PlaygroundEditorTheme__tokenVariable',\n    inserted: 'PlaygroundEditorTheme__tokenSelector',\n    keyword: 'PlaygroundEditorTheme__tokenAttr',\n    namespace: 'PlaygroundEditorTheme__tokenVariable',\n    number: 'PlaygroundEditorTheme__tokenProperty',\n    operator: 'PlaygroundEditorTheme__tokenOperator',\n    prolog: 'PlaygroundEditorTheme__tokenComment',\n    property: 'PlaygroundEditorTheme__tokenProperty',\n    punctuation: 'PlaygroundEditorTheme__tokenPunctuation',\n    regex: 'PlaygroundEditorTheme__tokenVariable',\n    selector: 'PlaygroundEditorTheme__tokenSelector',\n    string: 'PlaygroundEditorTheme__tokenSelector',\n    symbol: 'PlaygroundEditorTheme__tokenProperty',\n    tag: 'PlaygroundEditorTheme__tokenProperty',\n    url: 'PlaygroundEditorTheme__tokenOperator',\n    variable: 'PlaygroundEditorTheme__tokenVariable',\n  },\n  hashtag: 'PlaygroundEditorTheme__hashtag',\n  heading: {\n    h1: 'PlaygroundEditorTheme__h1',\n    h2: 'PlaygroundEditorTheme__h2',\n    h3: 'PlaygroundEditorTheme__h3',\n    h4: 'PlaygroundEditorTheme__h4',\n    h5: 'PlaygroundEditorTheme__h5',\n  },\n  image: 'editor-image',\n  link: 'PlaygroundEditorTheme__link',\n  list: {\n    listitem: 'PlaygroundEditorTheme__listItem',\n    listitemChecked: 'PlaygroundEditorTheme__listItemChecked',\n    listitemUnchecked: 'PlaygroundEditorTheme__listItemUnchecked',\n    nested: {\n      listitem: 'PlaygroundEditorTheme__nestedListItem',\n    },\n    olDepth: [\n      'PlaygroundEditorTheme__ol1',\n      'PlaygroundEditorTheme__ol2',\n      'PlaygroundEditorTheme__ol3',\n      'PlaygroundEditorTheme__ol4',\n      'PlaygroundEditorTheme__ol5',\n    ],\n    ul: 'PlaygroundEditorTheme__ul',\n  },\n  ltr: 'PlaygroundEditorTheme__ltr',\n  mark: 'PlaygroundEditorTheme__mark',\n  markOverlap: 'PlaygroundEditorTheme__markOverlap',\n  paragraph: 'PlaygroundEditorTheme__paragraph',\n  quote: 'PlaygroundEditorTheme__quote',\n  rtl: 'PlaygroundEditorTheme__rtl',\n  table: 'PlaygroundEditorTheme__table',\n  tableCell: 'PlaygroundEditorTheme__tableCell',\n  tableCellHeader: 'PlaygroundEditorTheme__tableCellHeader',\n  text: {\n    bold: 'PlaygroundEditorTheme__textBold',\n    code: 'PlaygroundEditorTheme__textCode',\n    italic: 'PlaygroundEditorTheme__textItalic',\n    strikethrough: 'PlaygroundEditorTheme__textStrikethrough',\n    subscript: 'PlaygroundEditorTheme__textSubscript',\n    superscript: 'PlaygroundEditorTheme__textSuperscript',\n    underline: 'PlaygroundEditorTheme__textUnderline',\n    underlineStrikethrough: 'PlaygroundEditorTheme__textUnderlineStrikethrough',\n  },\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorThemeClasses } from 'lexical';\n\nimport './StickyEditorTheme.css';\n\nimport baseTheme from './PlaygroundEditorTheme';\n\nconst theme: EditorThemeClasses = {\n  ...baseTheme,\n  paragraph: 'StickyEditorTheme__paragraph',\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './ContentEditable.css';\n\nimport { ContentEditable } from '@lexical/react/LexicalContentEditable';\nimport * as React from 'react';\n\nexport default function LexicalContentEditable({\n  className,\n}: {\n  className?: string;\n}): JSX.Element {\n  return <ContentEditable className={className || 'ContentEditable__root'} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Placeholder.css';\n\nimport * as React from 'react';\n\nexport default function Placeholder({\n  children,\n  className,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  className?: string;\n}): JSX.Element {\n  return <div className={className || 'Placeholder__root'}>{children}</div>;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './StickyNode.css';\n\nimport { CollaborationPlugin } from '@lexical/react/LexicalCollaborationPlugin';\n\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { LexicalNestedComposer } from '@lexical/react/LexicalNestedComposer';\nimport { PlainTextPlugin } from '@lexical/react/LexicalPlainTextPlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport {\n  $getNodeByKey,\n  $setSelection,\n  createEditor,\n  DecoratorNode,\n} from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport { createWebsocketProvider } from '../collaboration';\nimport { useSharedHistoryContext } from '../context/SharedHistoryContext';\nimport StickyEditorTheme from '../themes/StickyEditorTheme';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\n\nfunction positionSticky(stickyElem: HTMLElement, positioning): void {\n  const style = stickyElem.style;\n  const rootElementRect = positioning.rootElementRect;\n  const rectLeft = rootElementRect !== null ? rootElementRect.left : 0;\n  const rectTop = rootElementRect !== null ? rootElementRect.top : 0;\n  style.top = rectTop + positioning.y + 'px';\n  style.left = rectLeft + positioning.x + 'px';\n}\n\nfunction StickyComponent({\n  x,\n  y,\n  nodeKey,\n  color,\n  caption,\n}: {\n  caption: LexicalEditor;\n  color: 'pink' | 'yellow';\n  nodeKey: NodeKey;\n  x: number;\n  y: number;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const stickyContainerRef = useRef<null | HTMLDivElement>(null);\n  const positioningRef = useRef<{\n    isDragging: boolean;\n    offsetX: number;\n    offsetY: number;\n    rootElementRect: null | ClientRect;\n    x: number;\n    y: number;\n  }>({\n    isDragging: false,\n    offsetX: 0,\n    offsetY: 0,\n    rootElementRect: null,\n    x: 0,\n    y: 0,\n  });\n  const { yjsDocMap } = useCollaborationContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n\n  useEffect(() => {\n    const position = positioningRef.current;\n    position.x = x;\n    position.y = y;\n\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      positionSticky(stickyContainer, position);\n    }\n  }, [x, y]);\n\n  useLayoutEffect(() => {\n    const position = positioningRef.current;\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (let i = 0; i < entries.length; i++) {\n        const entry = entries[i];\n        const { target } = entry;\n        position.rootElementRect = target.getBoundingClientRect();\n        const stickyContainer = stickyContainerRef.current;\n        if (stickyContainer !== null) {\n          positionSticky(stickyContainer, position);\n        }\n      }\n    });\n\n    const removeRootListener = editor.registerRootListener(\n      (nextRootElem, prevRootElem) => {\n        if (prevRootElem !== null) {\n          resizeObserver.unobserve(prevRootElem);\n        }\n        if (nextRootElem !== null) {\n          resizeObserver.observe(nextRootElem);\n        }\n      }\n    );\n\n    const handleWindowResize = () => {\n      const rootElement = editor.getRootElement();\n      const stickyContainer = stickyContainerRef.current;\n      if (rootElement !== null && stickyContainer !== null) {\n        position.rootElementRect = rootElement.getBoundingClientRect();\n        positionSticky(stickyContainer, position);\n      }\n    };\n\n    window.addEventListener('resize', handleWindowResize);\n\n    return () => {\n      window.removeEventListener('resize', handleWindowResize);\n      removeRootListener();\n    };\n  }, [editor]);\n\n  useEffect(() => {\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      // Delay adding transition so we don't trigger the\n      // transition on load of the sticky.\n      setTimeout(() => {\n        stickyContainer.style.setProperty(\n          'transition',\n          'top 0.3s ease 0s, left 0.3s ease 0s'\n        );\n      }, 500);\n    }\n  }, []);\n\n  const handlePointerMove = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    const rootElementRect = positioning.rootElementRect;\n    if (\n      stickyContainer !== null &&\n      positioning.isDragging &&\n      rootElementRect !== null\n    ) {\n      positioning.x = event.pageX - positioning.offsetX - rootElementRect.left;\n      positioning.y = event.pageY - positioning.offsetY - rootElementRect.top;\n      positionSticky(stickyContainer, positioning);\n    }\n  };\n\n  const handlePointerUp = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    if (stickyContainer !== null) {\n      positioning.isDragging = false;\n      stickyContainer.classList.remove('dragging');\n      editor.update(() => {\n        const node = $getNodeByKey(nodeKey);\n        if ($isStickyNode(node)) {\n          node.setPosition(positioning.x, positioning.y);\n        }\n      });\n    }\n    document.removeEventListener('pointermove', handlePointerMove);\n    document.removeEventListener('pointerup', handlePointerUp);\n  };\n\n  const handleDelete = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.remove();\n      }\n    });\n  };\n\n  const handleColorChange = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.toggleColor();\n      }\n    });\n  };\n\n  const { historyState } = useSharedHistoryContext();\n\n  return (\n    <div ref={stickyContainerRef} className=\"sticky-note-container\">\n      <div\n        className={`sticky-note ${color}`}\n        onPointerDown={(event) => {\n          const stickyContainer = stickyContainerRef.current;\n          if (\n            stickyContainer == null ||\n            event.button === 2 ||\n            event.target !== stickyContainer.firstChild\n          ) {\n            // Right click or click on editor should not work\n            return;\n          }\n          const stickContainer = stickyContainer;\n          const positioning = positioningRef.current;\n          if (stickContainer !== null) {\n            const { top, left } = stickContainer.getBoundingClientRect();\n            positioning.offsetX = event.clientX - left;\n            positioning.offsetY = event.clientY - top;\n            positioning.isDragging = true;\n            stickContainer.classList.add('dragging');\n            document.addEventListener('pointermove', handlePointerMove);\n            document.addEventListener('pointerup', handlePointerUp);\n            event.preventDefault();\n          }\n        }}\n      >\n        <button\n          onClick={handleDelete}\n          className=\"delete\"\n          aria-label=\"Delete sticky note\"\n          title=\"Delete\"\n        >\n          X\n        </button>\n        <button\n          onClick={handleColorChange}\n          className=\"color\"\n          aria-label=\"Change sticky note color\"\n          title=\"Color\"\n        >\n          <i className=\"bucket\" />\n        </button>\n        <LexicalNestedComposer\n          initialEditor={caption}\n          initialTheme={StickyEditorTheme}\n        >\n          {isCollab ? (\n            <CollaborationPlugin\n              id={caption.getKey()}\n              providerFactory={createWebsocketProvider}\n              shouldBootstrap={true}\n            />\n          ) : (\n            <HistoryPlugin externalHistoryState={historyState} />\n          )}\n          <PlainTextPlugin\n            contentEditable={\n              <ContentEditable className=\"StickyNode__contentEditable\" />\n            }\n            placeholder={\n              <Placeholder className=\"StickyNode__placeholder\">\n                What's up?\n              </Placeholder>\n            }\n            ErrorBoundary={LexicalErrorBoundary}\n          />\n        </LexicalNestedComposer>\n      </div>\n    </div>\n  );\n}\n\ntype StickyNoteColor = 'pink' | 'yellow';\n\nexport type SerializedStickyNode = Spread<\n  {\n    xOffset: number;\n    yOffset: number;\n    color: StickyNoteColor;\n    caption: LexicalEditor;\n    type: 'sticky';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nexport class StickyNode extends DecoratorNode<JSX.Element> {\n  __x: number;\n  __y: number;\n  __color: StickyNoteColor;\n  __caption: LexicalEditor;\n\n  static getType(): string {\n    return 'sticky';\n  }\n\n  static clone(node: StickyNode): StickyNode {\n    return new StickyNode(\n      node.__x,\n      node.__y,\n      node.__color,\n      node.__caption,\n      node.__key\n    );\n  }\n  static importJSON(serializedNode: SerializedStickyNode): StickyNode {\n    return new StickyNode(\n      serializedNode.xOffset,\n      serializedNode.yOffset,\n      serializedNode.color,\n      serializedNode.caption\n    );\n  }\n\n  constructor(\n    x: number,\n    y: number,\n    color: 'pink' | 'yellow',\n    caption?: LexicalEditor,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__x = x;\n    this.__y = y;\n    this.__caption = caption || createEditor();\n    this.__color = color;\n  }\n\n  exportJSON(): SerializedStickyNode {\n    return {\n      caption: this.__caption,\n      color: this.__color,\n      type: 'sticky',\n      version: 1,\n      xOffset: this.__x,\n      yOffset: this.__y,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const div = document.createElement('div');\n    div.style.display = 'contents';\n    return div;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  setPosition(x: number, y: number): void {\n    const writable = this.getWritable();\n    writable.__x = x;\n    writable.__y = y;\n    $setSelection(null);\n  }\n\n  toggleColor(): void {\n    const writable = this.getWritable();\n    writable.__color = writable.__color === 'pink' ? 'yellow' : 'pink';\n  }\n\n  decorate(editor: LexicalEditor): JSX.Element {\n    return createPortal(\n      <StickyComponent\n        color={this.__color}\n        x={this.__x}\n        y={this.__y}\n        nodeKey={this.getKey()}\n        caption={this.__caption}\n      />,\n      document.body\n    );\n  }\n\n  isIsolated(): true {\n    return true;\n  }\n}\n\nexport function $isStickyNode(\n  node: LexicalNode | null | undefined\n): node is StickyNode {\n  return node instanceof StickyNode;\n}\n\nexport function $createStickyNode(\n  xOffset: number,\n  yOffset: number\n): StickyNode {\n  return new StickyNode(xOffset, yOffset, 'yellow');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  ElementFormatType,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  Spread,\n} from 'lexical';\n\nimport { BlockWithAlignableContents } from '@lexical/react/LexicalBlockWithAlignableContents';\nimport {\n  DecoratorBlockNode,\n  SerializedDecoratorBlockNode,\n} from '@lexical/react/LexicalDecoratorBlockNode';\nimport * as React from 'react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\n\nconst WIDGET_SCRIPT_URL = 'https://platform.twitter.com/widgets.js';\n\ntype TweetComponentProps = Readonly<{\n  className: Readonly<{\n    base: string;\n    focus: string;\n  }>;\n  format: ElementFormatType | null;\n  loadingComponent?: JSX.Element | string;\n  nodeKey: NodeKey;\n  onError?: (error: string) => void;\n  onLoad?: () => void;\n  tweetID: string;\n}>;\n\nfunction convertTweetElement(\n  domNode: HTMLDivElement\n): DOMConversionOutput | null {\n  const id = domNode.getAttribute('data-lexical-tweet-id');\n  if (id) {\n    const node = $createTweetNode(id);\n    return { node };\n  }\n  return null;\n}\n\nlet isTwitterScriptLoading = true;\n\nfunction TweetComponent({\n  className,\n  format,\n  loadingComponent,\n  nodeKey,\n  onError,\n  onLoad,\n  tweetID,\n}: TweetComponentProps) {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  const previousTweetIDRef = useRef<string>('');\n  const [isTweetLoading, setIsTweetLoading] = useState(false);\n\n  const createTweet = useCallback(async () => {\n    try {\n      // @ts-expect-error Twitter is attached to the window.\n      await window.twttr.widgets.createTweet(tweetID, containerRef.current);\n\n      setIsTweetLoading(false);\n      isTwitterScriptLoading = false;\n\n      if (onLoad) {\n        onLoad();\n      }\n    } catch (error) {\n      if (onError) {\n        onError(String(error));\n      }\n    }\n  }, [onError, onLoad, tweetID]);\n\n  useEffect(() => {\n    if (tweetID !== previousTweetIDRef.current) {\n      setIsTweetLoading(true);\n\n      if (isTwitterScriptLoading) {\n        const script = document.createElement('script');\n        script.src = WIDGET_SCRIPT_URL;\n        script.async = true;\n        document.body?.appendChild(script);\n        script.onload = createTweet;\n        if (onError) {\n          script.onerror = onError as OnErrorEventHandler;\n        }\n      } else {\n        createTweet();\n      }\n\n      if (previousTweetIDRef) {\n        previousTweetIDRef.current = tweetID;\n      }\n    }\n  }, [createTweet, onError, tweetID]);\n\n  return (\n    <BlockWithAlignableContents\n      className={className}\n      format={format}\n      nodeKey={nodeKey}\n    >\n      {isTweetLoading ? loadingComponent : null}\n      <div\n        style={{ display: 'inline-block', width: '550px' }}\n        ref={containerRef}\n      />\n    </BlockWithAlignableContents>\n  );\n}\n\nexport type SerializedTweetNode = Spread<\n  {\n    id: string;\n    type: 'tweet';\n    version: 1;\n  },\n  SerializedDecoratorBlockNode\n>;\n\nexport class TweetNode extends DecoratorBlockNode {\n  __id: string;\n\n  static getType(): string {\n    return 'tweet';\n  }\n\n  static clone(node: TweetNode): TweetNode {\n    return new TweetNode(node.__id, node.__format, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedTweetNode): TweetNode {\n    const node = $createTweetNode(serializedNode.id);\n    node.setFormat(serializedNode.format);\n    return node;\n  }\n\n  exportJSON(): SerializedTweetNode {\n    return {\n      ...super.exportJSON(),\n      id: this.getId(),\n      type: 'tweet',\n      version: 1,\n    };\n  }\n\n  static importDOM(): DOMConversionMap<HTMLDivElement> | null {\n    return {\n      div: (domNode: HTMLDivElement) => {\n        if (!domNode.hasAttribute('data-lexical-tweet-id')) {\n          return null;\n        }\n        return {\n          conversion: convertTweetElement,\n          priority: 2,\n        };\n      },\n    };\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('div');\n    element.setAttribute('data-lexical-tweet-id', this.__id);\n    return { element };\n  }\n\n  constructor(id: string, format?: ElementFormatType, key?: NodeKey) {\n    super(format, key);\n    this.__id = id;\n  }\n\n  getId(): string {\n    return this.__id;\n  }\n\n  decorate(editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    const embedBlockTheme = config.theme.embedBlock || {};\n    const className = {\n      base: embedBlockTheme.base || '',\n      focus: embedBlockTheme.focus || '',\n    };\n    return (\n      <TweetComponent\n        className={className}\n        format={this.__format}\n        loadingComponent=\"Loading...\"\n        nodeKey={this.getKey()}\n        tweetID={this.__id}\n      />\n    );\n  }\n\n  isTopLevel(): true {\n    return true;\n  }\n}\n\nexport function $createTweetNode(tweetID: string): TweetNode {\n  return new TweetNode(tweetID);\n}\n\nexport function $isTweetNode(\n  node: TweetNode | LexicalNode | null | undefined\n): node is TweetNode {\n  return node instanceof TweetNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig } from 'lexical';\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedTypeaheadNode = Spread<\n  {\n    type: 'typeahead';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nexport class TypeaheadNode extends TextNode {\n  static clone(node: TypeaheadNode): TypeaheadNode {\n    return new TypeaheadNode(node.__text, node.__key);\n  }\n\n  static getType(): 'typeahead' {\n    return 'typeahead';\n  }\n\n  static importJSON(serializedNode: SerializedTypeaheadNode): TypeaheadNode {\n    const node = $createTypeaheadNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedTypeaheadNode {\n    return {\n      ...super.exportJSON(),\n      type: 'typeahead',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = 'color: #ccc;';\n    return dom;\n  }\n}\n\nexport function $createTypeaheadNode(text: string): TypeaheadNode {\n  return new TypeaheadNode(text).setMode('token');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  ElementFormatType,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  Spread,\n} from 'lexical';\n\nimport { BlockWithAlignableContents } from '@lexical/react/LexicalBlockWithAlignableContents';\nimport {\n  DecoratorBlockNode,\n  SerializedDecoratorBlockNode,\n} from '@lexical/react/LexicalDecoratorBlockNode';\nimport * as React from 'react';\n\ntype YouTubeComponentProps = Readonly<{\n  className: Readonly<{\n    base: string;\n    focus: string;\n  }>;\n  format: ElementFormatType | null;\n  nodeKey: NodeKey;\n  videoID: string;\n}>;\n\nfunction YouTubeComponent({\n  className,\n  format,\n  nodeKey,\n  videoID,\n}: YouTubeComponentProps) {\n  return (\n    <BlockWithAlignableContents\n      className={className}\n      format={format}\n      nodeKey={nodeKey}\n    >\n      <iframe\n        width=\"560\"\n        height=\"315\"\n        src={`https://www.youtube.com/embed/${videoID}`}\n        frameBorder=\"0\"\n        allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n        allowFullScreen={true}\n        title=\"YouTube video\"\n      />\n    </BlockWithAlignableContents>\n  );\n}\n\nexport type SerializedYouTubeNode = Spread<\n  {\n    videoID: string;\n    type: 'youtube';\n    version: 1;\n  },\n  SerializedDecoratorBlockNode\n>;\n\nexport class YouTubeNode extends DecoratorBlockNode {\n  __id: string;\n\n  static getType(): string {\n    return 'youtube';\n  }\n\n  static clone(node: YouTubeNode): YouTubeNode {\n    return new YouTubeNode(node.__id, node.__format, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedYouTubeNode): YouTubeNode {\n    const node = $createYouTubeNode(serializedNode.videoID);\n    node.setFormat(serializedNode.format);\n    return node;\n  }\n\n  exportJSON(): SerializedYouTubeNode {\n    return {\n      ...super.exportJSON(),\n      type: 'youtube',\n      version: 1,\n      videoID: this.__id,\n    };\n  }\n\n  constructor(id: string, format?: ElementFormatType, key?: NodeKey) {\n    super(format, key);\n    this.__id = id;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getId(): string {\n    return this.__id;\n  }\n\n  decorate(_editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    const embedBlockTheme = config.theme.embedBlock || {};\n    const className = {\n      base: embedBlockTheme.base || '',\n      focus: embedBlockTheme.focus || '',\n    };\n    return (\n      <YouTubeComponent\n        className={className}\n        format={this.__format}\n        nodeKey={this.getKey()}\n        videoID={this.__id}\n      />\n    );\n  }\n\n  isTopLevel(): true {\n    return true;\n  }\n}\n\nexport function $createYouTubeNode(videoID: string): YouTubeNode {\n  return new YouTubeNode(videoID);\n}\n\nexport function $isYouTubeNode(\n  node: YouTubeNode | LexicalNode | null | undefined\n): node is YouTubeNode {\n  return node instanceof YouTubeNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalNode } from 'lexical';\n\nimport { CodeHighlightNode, CodeNode } from '@lexical/code';\nimport { HashtagNode } from '@lexical/hashtag';\nimport { AutoLinkNode, LinkNode } from '@lexical/link';\nimport { ListItemNode, ListNode } from '@lexical/list';\nimport { MarkNode } from '@lexical/mark';\nimport { OverflowNode } from '@lexical/overflow';\nimport { HorizontalRuleNode } from '@lexical/react/LexicalHorizontalRuleNode';\nimport { HeadingNode, QuoteNode } from '@lexical/rich-text';\nimport { TableCellNode, TableNode, TableRowNode } from '@lexical/table';\nimport { Class } from 'utility-types';\n\nimport { EmojiNode } from './EmojiNode';\nimport { ImageNode } from './ImageNode';\nimport { KeywordNode } from './KeywordNode';\nimport { MentionNode } from './MentionNode';\nimport { PollNode } from './PollNode';\nimport { StickyNode } from './StickyNode';\nimport { TweetNode } from './TweetNode';\nimport { TypeaheadNode } from './TypeaheadNode';\nimport { YouTubeNode } from './YouTubeNode';\n\nconst PlaygroundNodes: Array<Class<LexicalNode>> = [\n  HeadingNode,\n  ListNode,\n  ListItemNode,\n  QuoteNode,\n  CodeNode,\n  TableNode,\n  TableCellNode,\n  TableRowNode,\n  HashtagNode,\n  CodeHighlightNode,\n  AutoLinkNode,\n  LinkNode,\n  OverflowNode,\n  PollNode,\n  StickyNode,\n  ImageNode,\n  MentionNode,\n  EmojiNode,\n  TypeaheadNode,\n  KeywordNode,\n  HorizontalRuleNode,\n  TweetNode,\n  YouTubeNode,\n  MarkNode,\n];\n\nexport default PlaygroundNodes;\n","import * as i18next from 'i18next';\nimport EN from './languages/en.json';\nimport FR from './languages/fr.json';\nimport PTBR from './languages/ptBr.json';\nimport RU from './languages/ru.json';\n\nexport const resources = {\n  ar: {},\n  de: {},\n  en: EN,\n  es: {},\n  fr: FR,\n  it: {},\n  ja: {},\n  nl: {},\n  pl: {},\n  pt: {},\n  ptBr: PTBR,\n  ru: RU,\n  ukr: {},\n  zh: {},\n} as const;\n\nexport const languageDetector = {\n  type: 'languageDetector',\n  async: true,\n  detect: (callback) => {\n    const language = navigator.language;\n    callback(language.substring(0, 2));\n  },\n  init: () => {},\n  cacheUserLanguage: () => {},\n};\n\nconst i18n = i18next\n  .createInstance(\n    {\n      ns: ['toolbar', 'action'],\n      resources,\n      fallbackLng: 'en',\n      debug: true,\n      interpolation: {\n        escapeValue: false,\n      },\n    },\n    // We must provide a function as second parameter, otherwise i18next errors\n    (err, t) => {}\n  )\n  .use(languageDetector as i18next.Module);\n\nexport default i18n;\n","import {\n  LexicalComposer,\n  InitialEditorStateType,\n} from '@lexical/react/LexicalComposer';\nimport React from 'react';\nimport PlaygroundNodes from './nodes/PlaygroundNodes';\nimport PlaygroundEditorTheme from './themes/PlaygroundEditorTheme';\nimport './EditorComposer.css';\nimport i18n from './locale';\nimport { I18nextProvider } from 'react-i18next';\n\ninterface IEditorComposer {\n  children: React.ReactElement;\n  initialEditorState?: InitialEditorStateType;\n}\n\nconst EditorComposer = ({ children, initialEditorState }: IEditorComposer) => {\n  const initialConfig = {\n    namespace: 'VerbumEditor',\n    nodes: [...PlaygroundNodes],\n    onError: (error) => {\n      throw error;\n    },\n    theme: PlaygroundEditorTheme,\n    editorState: initialEditorState,\n  };\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <I18nextProvider i18n={i18n}>\n          <div className=\"verbum-editor-shell\">{children}</div>\n      </I18nextProvider>\n    </LexicalComposer>\n  );\n};\n\nexport default EditorComposer;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport type SettingName =\n  | 'disableBeforeInput'\n  | 'measureTypingPerf'\n  | 'isRichText'\n  | 'isCollab'\n  | 'isCharLimit'\n  | 'isCharLimitUtf8'\n  | 'isAutocomplete'\n  | 'showTreeView'\n  | 'showNestedEditorTreeView'\n  | 'emptyEditor';\n\nexport type Settings = Record<SettingName, boolean>;\n\nconst hostName = window.location.hostname;\nexport const isDevPlayground: boolean =\n  hostName !== 'playground.lexical.dev' &&\n  hostName !== 'lexical-playground.vercel.app';\n\nexport const DEFAULT_SETTINGS: Settings = {\n  disableBeforeInput: false,\n  emptyEditor: isDevPlayground,\n  isAutocomplete: false,\n  isCharLimit: false,\n  isCharLimitUtf8: false,\n  isCollab: false,\n  isRichText: true,\n  measureTypingPerf: false,\n  showNestedEditorTreeView: false,\n  showTreeView: true,\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { SettingName } from '../appSettings';\n\nimport * as React from 'react';\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n} from 'react';\n\nimport { DEFAULT_SETTINGS } from '../appSettings';\n\ntype SettingsContextShape = {\n  setOption: (name: SettingName, value: boolean) => void;\n  settings: Record<SettingName, boolean>;\n};\n\nconst Context: React.Context<SettingsContextShape> = createContext({\n  setOption: (name: SettingName, value: boolean) => {\n    return;\n  },\n  settings: DEFAULT_SETTINGS,\n});\n\nexport const SettingsContext = ({\n  children,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n}): JSX.Element => {\n  const [settings, setSettings] = useState(DEFAULT_SETTINGS);\n  const setOption = useCallback((setting: SettingName, value: boolean) => {\n    setSettings((options) => ({\n      ...options,\n      [setting as string]: value,\n    }));\n    if (DEFAULT_SETTINGS[setting] === value) {\n      setURLParam(setting, null);\n    } else {\n      setURLParam(setting, value);\n    }\n  }, []);\n  const contextValue = useMemo(() => {\n    return { setOption, settings };\n  }, [setOption, settings]);\n  return <Context.Provider value={contextValue}>{children}</Context.Provider>;\n};\n\nexport const useSettings = (): SettingsContextShape => {\n  return useContext(Context);\n};\n\nfunction setURLParam(param: SettingName, value: null | boolean) {\n  const url = new URL(window.location.href);\n  const params = new URLSearchParams(url.search);\n  if (value !== null) {\n    if (params.has(param)) {\n      params.set(param, String(value));\n    } else {\n      params.append(param, String(value));\n    }\n  } else {\n    if (params.has(param)) {\n      params.delete(param);\n    }\n  }\n  url.search = params.toString();\n  window.history.pushState(null, '', url.toString());\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Modal.css';\n\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\n\nfunction PortalImpl({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  closeOnClickOutside: boolean;\n  onClose: () => void;\n  title: string;\n}) {\n  const modalRef = useRef<HTMLDivElement>();\n\n  useEffect(() => {\n    if (modalRef.current !== null) {\n      modalRef.current.focus();\n    }\n  }, []);\n\n  useEffect(() => {\n    let modalOverlayElement = null;\n    const handler = (event) => {\n      if (event.keyCode === 27) {\n        onClose();\n      }\n    };\n    const clickOutsideHandler = (event: MouseEvent) => {\n      const target = event.target;\n      if (\n        modalRef.current !== null &&\n        !modalRef.current.contains(target as Node) &&\n        closeOnClickOutside\n      ) {\n        onClose();\n      }\n    };\n    if (modalRef.current !== null) {\n      modalOverlayElement = modalRef.current?.parentElement;\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.addEventListener('click', clickOutsideHandler);\n      }\n    }\n\n    window.addEventListener('keydown', handler);\n\n    return () => {\n      window.removeEventListener('keydown', handler);\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.removeEventListener('click', clickOutsideHandler);\n      }\n    };\n  }, [closeOnClickOutside, onClose]);\n\n  return (\n    <div className=\"Modal__overlay\" role=\"dialog\">\n      <div className=\"Modal__modal\" tabIndex={-1} ref={modalRef}>\n        <h2 className=\"Modal__title\">{title}</h2>\n        <button\n          className=\"Modal__closeButton\"\n          aria-label=\"Close modal\"\n          type=\"button\"\n          onClick={onClose}\n        >\n          X\n        </button>\n        <div className=\"Modal__content\">{children}</div>\n      </div>\n    </div>\n  );\n}\n\nexport default function Modal({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside = false,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  closeOnClickOutside?: boolean;\n  onClose: () => void;\n  title: string;\n}): JSX.Element {\n  return createPortal(\n    <PortalImpl\n      onClose={onClose}\n      title={title}\n      closeOnClickOutside={closeOnClickOutside}\n    >\n      {children}\n    </PortalImpl>,\n    document.body\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCallback, useMemo, useState } from 'react';\nimport * as React from 'react';\n\nimport Modal from '../ui/Modal';\n\nexport default function useModal(): [\n  JSX.Element,\n  (title: string, showModal: (onClose: () => void) => JSX.Element) => void\n] {\n  const [modalContent, setModalContent] = useState<null | {\n    closeOnClickOutside: boolean;\n    content: JSX.Element;\n    title: string;\n  }>(null);\n\n  const onClose = useCallback(() => {\n    setModalContent(null);\n  }, []);\n\n  const modal = useMemo(() => {\n    if (modalContent === null) {\n      return null;\n    }\n    const { title, content, closeOnClickOutside } = modalContent;\n    return (\n      <Modal\n        onClose={onClose}\n        title={title}\n        closeOnClickOutside={closeOnClickOutside}\n      >\n        {content}\n      </Modal>\n    );\n  }, [modalContent, onClose]);\n\n  const showModal = useCallback(\n    (\n      title,\n      // eslint-disable-next-line no-shadow\n      getContent: (onClose: () => void) => JSX.Element,\n      closeOnClickOutside = false\n    ) => {\n      setModalContent({\n        closeOnClickOutside,\n        content: getContent(onClose),\n        title,\n      });\n    },\n    [onClose]\n  );\n\n  return [modal, showModal];\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  ElementTransformer,\n  TextMatchTransformer,\n  Transformer,\n} from '@lexical/markdown';\nimport type { ElementNode, LexicalNode } from 'lexical';\n\nimport {\n  CHECK_LIST,\n  ELEMENT_TRANSFORMERS,\n  TEXT_FORMAT_TRANSFORMERS,\n  TEXT_MATCH_TRANSFORMERS,\n} from '@lexical/markdown';\nimport {\n  $createHorizontalRuleNode,\n  $isHorizontalRuleNode,\n  HorizontalRuleNode,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $createTableCellNode,\n  $createTableNode,\n  $createTableRowNode,\n  $isTableNode,\n  $isTableRowNode,\n  TableCellHeaderStates,\n  TableCellNode,\n  TableNode,\n  TableRowNode,\n} from '@lexical/table';\nimport {\n  $createParagraphNode,\n  $createTextNode,\n  $isElementNode,\n  $isParagraphNode,\n  $isTextNode,\n} from 'lexical';\n\nimport { $createImageNode, $isImageNode, ImageNode } from '../nodes/ImageNode';\nimport { $createTweetNode, $isTweetNode, TweetNode } from '../nodes/TweetNode';\n\nexport const HR: ElementTransformer = {\n  dependencies: [HorizontalRuleNode],\n  export: (node: LexicalNode) => {\n    return $isHorizontalRuleNode(node) ? '***' : null;\n  },\n  regExp: /^(---|\\*\\*\\*|___)\\s?$/,\n  replace: (parentNode, _1, _2, isImport) => {\n    const line = $createHorizontalRuleNode();\n\n    // TODO: Get rid of isImport flag\n    if (isImport || parentNode.getNextSibling() != null) {\n      parentNode.replace(line);\n    } else {\n      parentNode.insertBefore(line);\n    }\n\n    line.selectNext();\n  },\n  type: 'element',\n};\n\nexport const IMAGE: TextMatchTransformer = {\n  dependencies: [ImageNode],\n  export: (node, exportChildren, exportFormat) => {\n    if (!$isImageNode(node)) {\n      return null;\n    }\n\n    return `![${node.getAltText()}](${node.getSrc()})`;\n  },\n  importRegExp: /!(?:\\[([^[]*)\\])(?:\\(([^(]+)\\))/,\n  regExp: /!(?:\\[([^[]*)\\])(?:\\(([^(]+)\\))$/,\n  replace: (textNode, match) => {\n    const [, altText, src] = match;\n    const imageNode = $createImageNode({\n      altText,\n      maxWidth: 800,\n      src,\n    });\n    textNode.replace(imageNode);\n  },\n  trigger: ')',\n  type: 'text-match',\n};\n\nexport const TWEET: ElementTransformer = {\n  dependencies: [TweetNode],\n  export: (node) => {\n    if (!$isTweetNode(node)) {\n      return null;\n    }\n\n    return `<tweet id=\"${node.getId()}\" />`;\n  },\n  regExp: /<tweet id=\"([^\"]+?)\"\\s?\\/>\\s?$/,\n  replace: (textNode, _1, match) => {\n    const [, id] = match;\n    const tweetNode = $createTweetNode(id);\n    textNode.replace(tweetNode);\n  },\n  type: 'element',\n};\n\n// Very primitive table setup\nconst TABLE_ROW_REG_EXP = /^(?:\\|)(.+)(?:\\|)\\s?$/;\n\nexport const TABLE: ElementTransformer = {\n  dependencies: [TableNode, TableRowNode, TableCellNode],\n  export: (\n    node: LexicalNode,\n    exportChildren: (elementNode: ElementNode) => string\n  ) => {\n    if (!$isTableNode(node)) {\n      return null;\n    }\n\n    const output = [];\n\n    for (const row of node.getChildren()) {\n      const rowOutput = [];\n\n      if ($isTableRowNode(row)) {\n        for (const cell of row.getChildren()) {\n          // It's TableCellNode (hence ElementNode) so it's just to make flow happy\n          if ($isElementNode(cell)) {\n            rowOutput.push(exportChildren(cell));\n          }\n        }\n      }\n\n      output.push(`| ${rowOutput.join(' | ')} |`);\n    }\n\n    return output.join('\\n');\n  },\n  regExp: TABLE_ROW_REG_EXP,\n  replace: (parentNode, _1, match) => {\n    const matchCells = mapToTableCells(match[0]);\n\n    if (matchCells == null) {\n      return;\n    }\n\n    const rows = [matchCells];\n    let sibling = parentNode.getPreviousSibling();\n    let maxCells = matchCells.length;\n\n    while (sibling) {\n      if (!$isParagraphNode(sibling)) {\n        break;\n      }\n\n      if (sibling.getChildrenSize() !== 1) {\n        break;\n      }\n\n      const firstChild = sibling.getFirstChild();\n\n      if (!$isTextNode(firstChild)) {\n        break;\n      }\n\n      const cells = mapToTableCells(firstChild.getTextContent());\n\n      if (cells == null) {\n        break;\n      }\n\n      maxCells = Math.max(maxCells, cells.length);\n      rows.unshift(cells);\n      const previousSibling = sibling.getPreviousSibling();\n      sibling.remove();\n      sibling = previousSibling;\n    }\n\n    const table = $createTableNode();\n\n    for (const cells of rows) {\n      const tableRow = $createTableRowNode();\n      table.append(tableRow);\n\n      for (let i = 0; i < maxCells; i++) {\n        tableRow.append(i < cells.length ? cells[i] : createTableCell(null));\n      }\n    }\n\n    const previousSibling = parentNode.getPreviousSibling();\n    if (\n      $isTableNode(previousSibling) &&\n      getTableColumnsSize(previousSibling) === maxCells\n    ) {\n      previousSibling.append(...table.getChildren());\n      parentNode.remove();\n    } else {\n      parentNode.replace(table);\n    }\n\n    table.selectEnd();\n  },\n  type: 'element',\n};\n\nfunction getTableColumnsSize(table: TableNode) {\n  const row = table.getFirstChild();\n  return $isTableRowNode(row) ? row.getChildrenSize() : 0;\n}\n\nconst createTableCell = (\n  textContent: string | null | undefined\n): TableCellNode => {\n  const cell = $createTableCellNode(TableCellHeaderStates.NO_STATUS);\n  const paragraph = $createParagraphNode();\n\n  if (textContent != null) {\n    paragraph.append($createTextNode(textContent.trim()));\n  }\n\n  cell.append(paragraph);\n  return cell;\n};\n\nconst mapToTableCells = (textContent: string): Array<TableCellNode> | null => {\n  // TODO:\n  // For now plain text, single node. Can be expanded to more complex content\n  // including formatted text\n  const match = textContent.match(TABLE_ROW_REG_EXP);\n\n  if (!match || !match[1]) {\n    return null;\n  }\n\n  return match[1].split('|').map((text) => createTableCell(text));\n};\n\nexport const PLAYGROUND_TRANSFORMERS: Array<Transformer> = [\n  TABLE,\n  HR,\n  IMAGE,\n  TWEET,\n  CHECK_LIST,\n  ...ELEMENT_TRANSFORMERS,\n  ...TEXT_FORMAT_TRANSFORMERS,\n  ...TEXT_MATCH_TRANSFORMERS,\n];\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCallback, useEffect, useRef } from 'react';\n\nconst getElement = (): HTMLElement => {\n  let element = document.getElementById('report-container');\n\n  if (element === null) {\n    element = document.createElement('div');\n    element.id = 'report-container';\n    element.style.position = 'fixed';\n    element.style.top = '50%';\n    element.style.left = '50%';\n    element.style.fontSize = '32px';\n    element.style.transform = 'translate(-50%, -50px)';\n    element.style.padding = '20px';\n    element.style.background = 'rgba(240, 240, 240, 0.4)';\n    element.style.borderRadius = '20px';\n\n    if (document.body) {\n      document.body.appendChild(element);\n    }\n  }\n\n  return element;\n};\n\nexport default function useReport(): (arg0: string) => NodeJS.Timeout {\n  const timer = useRef<NodeJS.Timeout | null>(null);\n  const cleanup = useCallback(() => {\n    clearTimeout(timer.current);\n\n    if (document.body) {\n      document.body.removeChild(getElement());\n    }\n  }, []);\n\n  useEffect(() => {\n    return cleanup;\n  }, [cleanup]);\n\n  return useCallback(\n    (content) => {\n      // eslint-disable-next-line no-console\n      console.log(content);\n      const element = getElement();\n      clearTimeout(timer.current);\n      element.innerHTML = content;\n      timer.current = setTimeout(cleanup, 1000);\n      return timer.current;\n    },\n    [cleanup]\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand, LexicalEditor, RangeSelection } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  REDO_COMMAND,\n  UNDO_COMMAND,\n} from 'lexical';\nimport { useEffect, useRef, useState } from 'react';\n\nimport useReport from '../hooks/useReport';\n\nexport const SPEECH_TO_TEXT_COMMAND: LexicalCommand<boolean> = createCommand();\n\nconst VOICE_COMMANDS: Readonly<\n  Record<\n    string,\n    (arg0: { editor: LexicalEditor; selection: RangeSelection }) => void\n  >\n> = {\n  '\\n': ({ selection }) => {\n    selection.insertParagraph();\n  },\n  redo: ({ editor }) => {\n    editor.dispatchCommand(REDO_COMMAND, undefined);\n  },\n  undo: ({ editor }) => {\n    editor.dispatchCommand(UNDO_COMMAND, undefined);\n  },\n};\n\nexport const SUPPORT_SPEECH_RECOGNITION: boolean =\n  'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;\n\nfunction SpeechToTextPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n  const [isEnabled, setIsEnabled] = useState<boolean>(false);\n  const SpeechRecognition =\n    // @ts-ignore\n    window.SpeechRecognition || window.webkitSpeechRecognition;\n  const recognition = useRef<typeof SpeechRecognition | null>(null);\n  const report = useReport();\n\n  useEffect(() => {\n    if (isEnabled && recognition.current === null) {\n      recognition.current = new SpeechRecognition();\n      recognition.current.continuous = true;\n      recognition.current.interimResults = true;\n      recognition.current.addEventListener(\n        'result',\n        (event: typeof SpeechRecognition) => {\n          const resultItem = event.results.item(event.resultIndex);\n          const { transcript } = resultItem.item(0);\n          report(transcript);\n\n          if (!resultItem.isFinal) {\n            return;\n          }\n\n          editor.update(() => {\n            const selection = $getSelection();\n\n            if ($isRangeSelection(selection)) {\n              const command = VOICE_COMMANDS[transcript.toLowerCase().trim()];\n\n              if (command) {\n                command({\n                  editor,\n                  selection,\n                });\n              } else if (transcript.match(/\\s*\\n\\s*/)) {\n                selection.insertParagraph();\n              } else {\n                selection.insertText(transcript);\n              }\n            }\n          });\n        }\n      );\n    }\n\n    if (recognition.current) {\n      if (isEnabled) {\n        recognition.current.start();\n      } else {\n        recognition.current.stop();\n      }\n    }\n\n    return () => {\n      if (recognition.current !== null) {\n        recognition.current.stop();\n      }\n    };\n  }, [SpeechRecognition, editor, isEnabled, report]);\n  useEffect(() => {\n    return editor.registerCommand(\n      SPEECH_TO_TEXT_COMMAND,\n      (_isEnabled: boolean) => {\n        setIsEnabled(_isEnabled);\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n\nexport default (SUPPORT_SPEECH_RECOGNITION\n  ? SpeechToTextPlugin\n  : () => null) as () => null;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalEditor } from 'lexical';\n\nimport { $createCodeNode, $isCodeNode } from '@lexical/code';\nimport { exportFile, importFile } from '@lexical/file';\nimport {\n  $convertFromMarkdownString,\n  $convertToMarkdownString,\n} from '@lexical/markdown';\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { mergeRegister } from '@lexical/utils';\nimport { CONNECTED_COMMAND, TOGGLE_CONNECT_COMMAND } from '@lexical/yjs';\nimport {\n  $createTextNode,\n  $getRoot,\n  $isParagraphNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport * as React from 'react';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport useModal from '../hooks/useModal';\nimport Button from '../ui/Button';\nimport { PLAYGROUND_TRANSFORMERS } from './MarkdownTransformers';\nimport {\n  SPEECH_TO_TEXT_COMMAND,\n  SUPPORT_SPEECH_RECOGNITION,\n} from './SpeechToTextPlugin';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nexport default function ActionsPlugin({\n  isRichText,\n}: {\n  isRichText: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [isEditable, setIsEditable] = useState(() => editor.isEditable());\n  const [isSpeechToText, setIsSpeechToText] = useState(false);\n  const [connected, setConnected] = useState(false);\n  const [isEditorEmpty, setIsEditorEmpty] = useState(true);\n  const [modal, showModal] = useModal();\n  const { yjsDocMap } = useCollaborationContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n  const { t } = useTranslation(['action']);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerEditableListener((editable) => {\n        setIsEditable(editable);\n      }),\n      editor.registerCommand<boolean>(\n        CONNECTED_COMMAND,\n        (payload) => {\n          const isConnected = payload;\n          setConnected(isConnected);\n          return false;\n        },\n        COMMAND_PRIORITY_EDITOR\n      )\n    );\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        const root = $getRoot();\n        const children = root.getChildren();\n\n        if (children.length > 1) {\n          setIsEditorEmpty(false);\n        } else {\n          if ($isParagraphNode(children[0])) {\n            const paragraphChildren = children[0].getChildren();\n            setIsEditorEmpty(paragraphChildren.length === 0);\n          } else {\n            setIsEditorEmpty(false);\n          }\n        }\n      });\n    });\n  }, [editor]);\n\n  const handleMarkdownToggle = useCallback(() => {\n    editor.update(() => {\n      const root = $getRoot();\n      const firstChild = root.getFirstChild();\n      if ($isCodeNode(firstChild) && firstChild.getLanguage() === 'markdown') {\n        $convertFromMarkdownString(\n          firstChild.getTextContent(),\n          PLAYGROUND_TRANSFORMERS\n        );\n      } else {\n        const markdown = $convertToMarkdownString(PLAYGROUND_TRANSFORMERS);\n        root\n          .clear()\n          .append(\n            $createCodeNode('markdown').append($createTextNode(markdown))\n          );\n      }\n      root.selectEnd();\n    });\n  }, [editor]);\n\n  return (\n    <div className=\"verbum-actions\">\n      {SUPPORT_SPEECH_RECOGNITION && (\n        <button\n          onClick={() => {\n            editor.dispatchCommand(SPEECH_TO_TEXT_COMMAND, !isSpeechToText);\n            setIsSpeechToText(!isSpeechToText);\n          }}\n          className={\n            'action-button action-button-mic ' +\n            (isSpeechToText ? 'active' : '')\n          }\n          title={t('action:Speech_To_Text')}\n          aria-label={`${\n            isSpeechToText ? t('action:Enable') : t('action:Disable')\n          } ${t('action:speech_To_Text')}`}\n          type=\"button\"\n        >\n          <i className=\"verbum-mic\" />\n        </button>\n      )}\n      <button\n        className=\"verbum-action-button import\"\n        onClick={() => importFile(editor)}\n        title={t('action:Import')}\n        aria-label={t('action:Import_Description')}\n        type=\"button\"\n      >\n        <i className=\"verbum-import\" />\n      </button>\n      <button\n        className=\"verbum-action-button export\"\n        onClick={() =>\n          exportFile(editor, {\n            fileName: `Playground ${new Date().toISOString()}`,\n            source: 'Playground',\n          })\n        }\n        title={t('action:Export')}\n        aria-label={t('action:Export_Description')}\n        type=\"button\"\n      >\n        <i className=\"verbum-export\" />\n      </button>\n      <button\n        className=\"verbum-action-button clear\"\n        disabled={isEditorEmpty}\n        onClick={() => {\n          showModal(t('action:Clear_Editor'), (onClose) => (\n            <ShowClearDialog editor={editor} onClose={onClose} t={t} />\n          ));\n        }}\n        title={t('action:Clear')}\n        aria-label={t('action:Clear_Description')}\n        type=\"button\"\n      >\n        <i className=\"clear\" />\n      </button>\n      <button\n        className={`verbum-action-button ${isEditable ? 'unlock' : 'lock'}`}\n        onClick={() => {\n          editor.setEditable(!editor.isEditable());\n        }}\n        title={t('action:Read-Only_Mode')}\n        aria-label={`${isEditable ? t('action:Unlock') : t('action:Lock')} ${t(\n          'action:Read-Only_Mode'\n        )}`}\n        type=\"button\"\n      >\n        <i className={isEditable ? 'unlock' : 'lock'} />\n      </button>\n      <button\n        className=\"verbum-action-button\"\n        onClick={handleMarkdownToggle}\n        title={t('action:Convert_From_Markdown')}\n        aria-label={t('action:Convert_From_Markdown_Description')}\n        type=\"button\"\n      >\n        <i className=\"verbum-markdown\" />\n      </button>\n      {isCollab && (\n        <button\n          className=\"verbum-action-button connect\"\n          onClick={() => {\n            editor.dispatchCommand(TOGGLE_CONNECT_COMMAND, !connected);\n          }}\n          title={`${\n            connected ? t('action:Disconnect') : t('action:Connect')\n          } ${t('action:Collaborative')}`}\n          aria-label={`${\n            connected ? t('action:Disconnect_From') : t('action:Connect_To')\n          } ${t('action:Server')}`}\n          type=\"button\"\n        >\n          <i\n            className={connected ? t('action:disconnect') : t('action:connect')}\n          />\n        </button>\n      )}\n      {modal}\n    </div>\n  );\n}\n\nfunction ShowClearDialog({\n  editor,\n  onClose,\n  t,\n}: {\n  editor: LexicalEditor;\n  onClose: () => void;\n  t: TFunction;\n}): JSX.Element {\n  return (\n    <>\n      {t('action:Confirm_Clear')}\n      <div className=\"Modal__content\">\n        <Button\n          onClick={() => {\n            editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n            editor.focus();\n            onClose();\n          }}\n        >\n          {t('action:Clear')}\n        </Button>{' '}\n        <Button\n          onClick={() => {\n            editor.focus();\n            onClose();\n          }}\n        >\n          {t('action:Cancel')}\n        </Button>\n      </div>\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { AutoLinkPlugin } from '@lexical/react/LexicalAutoLinkPlugin';\nimport * as React from 'react';\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nconst EMAIL_MATCHER =\n  /(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))/;\n\nconst MATCHERS = [\n  (text) => {\n    const match = URL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: match[0],\n      }\n    );\n  },\n  (text) => {\n    const match = EMAIL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: `mailto:${match[0]}`,\n      }\n    );\n  },\n];\n\nexport default function LexicalAutoLinkPlugin(): JSX.Element {\n  return <AutoLinkPlugin matchers={MATCHERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {\n  Comment,\n  Comments,\n  CommentStore,\n  createComment,\n  createThread,\n  Thread,\n  useCommentStore,\n} from '../commenting';\nimport type {\n  EditorState,\n  LexicalCommand,\n  LexicalEditor,\n  NodeKey,\n} from 'lexical';\n\nimport './CommentPlugin.css';\n\nimport {\n  $createMarkNode,\n  $getMarkIDs,\n  $isMarkNode,\n  $unwrapMarkNode,\n  $wrapSelectionInMarkNode,\n  MarkNode,\n} from '@lexical/mark';\nimport { AutoFocusPlugin } from '@lexical/react/LexicalAutoFocusPlugin';\nimport { ClearEditorPlugin } from '@lexical/react/LexicalClearEditorPlugin';\nimport { LexicalComposer } from '@lexical/react/LexicalComposer';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { OnChangePlugin } from '@lexical/react/LexicalOnChangePlugin';\nimport { PlainTextPlugin } from '@lexical/react/LexicalPlainTextPlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport { createDOMRange, createRectsFromDOMRange } from '@lexical/selection';\nimport { $isRootTextContentEmpty, $rootTextContent } from '@lexical/text';\nimport { mergeRegister, registerNestedElementResolver } from '@lexical/utils';\nimport {\n  $getNodeByKey,\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  KEY_ESCAPE_COMMAND,\n} from 'lexical';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport useModal from '../hooks/useModal';\nimport CommentEditorTheme from '../themes/CommentEditorTheme';\nimport Button from '../ui/Button';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\nimport type { Doc } from 'yjs';\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { WebsocketProvider } from 'y-websocket';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nexport const INSERT_INLINE_COMMAND: LexicalCommand<void> = createCommand();\n\nfunction AddCommentBox({\n  anchorKey,\n  editor,\n  onAddComment,\n}: {\n  anchorKey: NodeKey;\n  editor: LexicalEditor;\n  onAddComment: () => void;\n}): JSX.Element {\n  const boxRef = useRef<HTMLDivElement>(null);\n\n  const updatePosition = useCallback(() => {\n    const boxElem = boxRef.current;\n    const rootElement = editor.getRootElement();\n    const anchorElement = editor.getElementByKey(anchorKey);\n\n    if (boxElem !== null && rootElement !== null && anchorElement !== null) {\n      const { right } = rootElement.getBoundingClientRect();\n      const { top } = anchorElement.getBoundingClientRect();\n      boxElem.style.left = `${right - 20}px`;\n      boxElem.style.top = `${top - 30}px`;\n    }\n  }, [anchorKey, editor]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updatePosition);\n\n    return () => {\n      window.removeEventListener('resize', updatePosition);\n    };\n  }, [editor, updatePosition]);\n\n  useLayoutEffect(() => {\n    updatePosition();\n  }, [anchorKey, editor, updatePosition]);\n\n  return (\n    <div className=\"CommentPlugin_AddCommentBox\" ref={boxRef}>\n      <button\n        className=\"CommentPlugin_AddCommentBox_button\"\n        onClick={onAddComment}\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-add-comment\" />\n      </button>\n    </div>\n  );\n}\n\nfunction EditorRefPlugin({\n  editorRef,\n}: {\n  editorRef: { current: null | LexicalEditor };\n}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useLayoutEffect(() => {\n    editorRef.current = editor;\n    return () => {\n      editorRef.current = null;\n    };\n  }, [editor, editorRef]);\n\n  return null;\n}\n\nfunction EscapeHandlerPlugin({\n  onEscape,\n}: {\n  onEscape: (e: KeyboardEvent) => boolean;\n}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      KEY_ESCAPE_COMMAND,\n      (event: KeyboardEvent) => {\n        return onEscape(event);\n      },\n      2\n    );\n  }, [editor, onEscape]);\n\n  return null;\n}\n\nfunction PlainTextEditor({\n  className,\n  autoFocus,\n  onEscape,\n  onChange,\n  editorRef,\n  placeholder = 'Type a comment...',\n}: {\n  autoFocus?: boolean;\n  className?: string;\n  editorRef?: { current: null | LexicalEditor };\n  onChange: (editorState: EditorState, editor: LexicalEditor) => void;\n  onEscape: (e: KeyboardEvent) => boolean;\n  placeholder?: string;\n}) {\n  const initialConfig = {\n    namespace: 'Commenting',\n    nodes: [],\n    onError: (error: Error) => {\n      throw error;\n    },\n    theme: CommentEditorTheme,\n  };\n\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <div className=\"CommentPlugin_CommentInputBox_EditorContainer\">\n        <PlainTextPlugin\n          contentEditable={<ContentEditable className={className} />}\n          placeholder={<Placeholder>{placeholder}</Placeholder>}\n          ErrorBoundary={LexicalErrorBoundary}\n        />\n        <OnChangePlugin onChange={onChange} />\n        <HistoryPlugin />\n        {autoFocus !== false && <AutoFocusPlugin />}\n        <EscapeHandlerPlugin onEscape={onEscape} />\n        <ClearEditorPlugin />\n        {editorRef !== undefined && <EditorRefPlugin editorRef={editorRef} />}\n      </div>\n    </LexicalComposer>\n  );\n}\n\nfunction useOnChange(\n  setContent: (text: string) => void,\n  setCanSubmit: (canSubmit: boolean) => void\n) {\n  return useCallback(\n    (editorState: EditorState, _editor: LexicalEditor) => {\n      editorState.read(() => {\n        setContent($rootTextContent());\n        setCanSubmit(!$isRootTextContentEmpty(_editor.isComposing(), true));\n      });\n    },\n    [setCanSubmit, setContent]\n  );\n}\n\nfunction CommentInputBox({\n  editor,\n  cancelAddComment,\n  submitAddComment,\n  t,\n}: {\n  cancelAddComment: () => void;\n  editor: LexicalEditor;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean\n  ) => void;\n  t: TFunction;\n}) {\n  const [content, setContent] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n  const boxRef = useRef<HTMLDivElement>(null);\n  const selectionState = useMemo(\n    () => ({\n      container: document.createElement('div'),\n      elements: [],\n    }),\n    []\n  );\n  const author = useCollabAuthorName();\n\n  const updateLocation = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n      if ($isRangeSelection(selection)) {\n        const anchor = selection.anchor;\n        const focus = selection.focus;\n        const range = createDOMRange(\n          editor,\n          anchor.getNode(),\n          anchor.offset,\n          focus.getNode(),\n          focus.offset\n        );\n        const boxElem = boxRef.current;\n        if (range !== null && boxElem !== null) {\n          const { left, bottom, width } = range.getBoundingClientRect();\n          const selectionRects = createRectsFromDOMRange(editor, range);\n          let correctedLeft =\n            selectionRects.length === 1 ? left + width / 2 - 125 : left - 125;\n          if (correctedLeft < 10) {\n            correctedLeft = 10;\n          }\n          boxElem.style.left = `${correctedLeft}px`;\n          boxElem.style.top = `${bottom + 20}px`;\n          const selectionRectsLength = selectionRects.length;\n          const { container } = selectionState;\n          const elements: Array<HTMLSpanElement> = selectionState.elements;\n          const elementsLength = elements.length;\n\n          for (let i = 0; i < selectionRectsLength; i++) {\n            const selectionRect = selectionRects[i];\n            let elem: HTMLSpanElement = elements[i];\n            if (elem === undefined) {\n              elem = document.createElement('span');\n              elements[i] = elem;\n              container.appendChild(elem);\n            }\n            const color = '255, 212, 0';\n            const style = `position:absolute;top:${selectionRect.top}px;left:${selectionRect.left}px;height:${selectionRect.height}px;width:${selectionRect.width}px;background-color:rgba(${color}, 0.3);pointer-events:none;z-index:5;`;\n            elem.style.cssText = style;\n          }\n          for (let i = elementsLength - 1; i >= selectionRectsLength; i--) {\n            const elem = elements[i];\n            container.removeChild(elem);\n            elements.pop();\n          }\n        }\n      }\n    });\n  }, [editor, selectionState]);\n\n  useLayoutEffect(() => {\n    updateLocation();\n    const container = selectionState.container;\n    const body = document.body;\n    if (body !== null) {\n      body.appendChild(container);\n      return () => {\n        body.removeChild(container);\n      };\n    }\n  }, [selectionState.container, updateLocation]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updateLocation);\n\n    return () => {\n      window.removeEventListener('resize', updateLocation);\n    };\n  }, [updateLocation]);\n\n  const onEscape = (event: KeyboardEvent): boolean => {\n    event.preventDefault();\n    cancelAddComment();\n    return true;\n  };\n\n  const submitComment = () => {\n    if (canSubmit) {\n      let quote = editor.getEditorState().read(() => {\n        const selection = $getSelection();\n        return selection !== null ? selection.getTextContent() : '';\n      });\n      if (quote.length > 100) {\n        quote = quote.slice(0, 99) + '';\n      }\n      submitAddComment(\n        createThread(quote, [createComment(content, author)]),\n        true\n      );\n    }\n  };\n\n  const onChange = useOnChange(setContent, setCanSubmit);\n\n  return (\n    <div className=\"CommentPlugin_CommentInputBox\" ref={boxRef}>\n      <PlainTextEditor\n        className=\"CommentPlugin_CommentInputBox_Editor\"\n        onEscape={onEscape}\n        onChange={onChange}\n      />\n      <div className=\"CommentPlugin_CommentInputBox_Buttons\">\n        <Button\n          onClick={cancelAddComment}\n          className=\"CommentPlugin_CommentInputBox_Button\"\n        >\n          {t('action:Cancel')}\n        </Button>\n        <Button\n          onClick={submitComment}\n          disabled={!canSubmit}\n          className=\"CommentPlugin_CommentInputBox_Button primary\"\n        >\n          {t('action:Comment')}\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nfunction CommentsComposer({\n  submitAddComment,\n  thread,\n  placeholder,\n}: {\n  placeholder?: string;\n  submitAddComment: (\n    commentOrThread: Comment,\n    isInlineComment: boolean,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  thread?: Thread;\n}) {\n  const [content, setContent] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n  const editorRef = useRef<LexicalEditor>(null);\n  const author = useCollabAuthorName();\n\n  const onChange = useOnChange(setContent, setCanSubmit);\n\n  const submitComment = () => {\n    if (canSubmit) {\n      submitAddComment(createComment(content, author), false, thread);\n      const editor = editorRef.current;\n      if (editor !== null) {\n        editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n      }\n    }\n  };\n\n  return (\n    <>\n      <PlainTextEditor\n        className=\"CommentPlugin_CommentsPanel_Editor\"\n        autoFocus={false}\n        onEscape={() => {\n          return true;\n        }}\n        onChange={onChange}\n        editorRef={editorRef}\n        placeholder={placeholder}\n      />\n      <Button\n        className=\"CommentPlugin_CommentsPanel_SendButton\"\n        onClick={submitComment}\n        disabled={!canSubmit}\n      >\n        <i className=\"send\" />\n      </Button>\n    </>\n  );\n}\n\nfunction ShowDeleteCommentOrThreadDialog({\n  commentOrThread,\n  deleteCommentOrThread,\n  onClose,\n  thread = undefined,\n  t,\n}: {\n  commentOrThread: Comment | Thread;\n\n  deleteCommentOrThread: (\n    comment: Comment | Thread,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  onClose: () => void;\n  thread?: Thread;\n  t: TFunction;\n}): JSX.Element {\n  return (\n    <>\n      {`${t('toolbar:commentPlugin.Delete_Comment_Description')} ${\n        commentOrThread.type\n      }?`}\n      <div className=\"Modal__content\">\n        <Button\n          onClick={() => {\n            deleteCommentOrThread(commentOrThread, thread);\n            onClose();\n          }}\n        >\n          {t('action:Delete')}\n        </Button>{' '}\n        <Button\n          onClick={() => {\n            onClose();\n          }}\n        >\n          {t('action:Cancel')}\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction CommentsPanelListComment({\n  comment,\n  deleteComment,\n  thread,\n  rtf,\n  t,\n}: {\n  comment: Comment;\n  deleteComment: (\n    commentOrThread: Comment | Thread,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  thread?: Thread;\n  rtf: null; //FIXME: Intl.RelativeTimeFormat gives build error;\n  t: TFunction;\n}): JSX.Element {\n  const seconds = Math.round((comment.timeStamp - performance.now()) / 1000);\n  const minutes = Math.round(seconds / 60);\n  const [modal, showModal] = useModal();\n\n  return (\n    <li className=\"CommentPlugin_CommentsPanel_List_Comment\">\n      <div className=\"CommentPlugin_CommentsPanel_List_Details\">\n        <span className=\"CommentPlugin_CommentsPanel_List_Comment_Author\">\n          {comment.author}\n        </span>\n        <span className=\"CommentPlugin_CommentsPanel_List_Comment_Time\">\n          {/*  {seconds > -10 ? 'Just now' : rtf.format(minutes, 'minute')} */}\n        </span>\n      </div>\n      <p\n        className={\n          comment.deleted ? 'CommentPlugin_CommentsPanel_DeletedComment' : ''\n        }\n      >\n        {comment.content}\n      </p>\n      {!comment.deleted && (\n        <>\n          <Button\n            onClick={() => {\n              showModal(\n                t('toolbar:commentPlugin.Delete_Comment'),\n                (onClose) => (\n                  <ShowDeleteCommentOrThreadDialog\n                    commentOrThread={comment}\n                    deleteCommentOrThread={deleteComment}\n                    thread={thread}\n                    onClose={onClose}\n                    t={t}\n                  />\n                )\n              );\n            }}\n            className=\"CommentPlugin_CommentsPanel_List_DeleteButton\"\n          >\n            <i className=\"delete\" />\n          </Button>\n          {modal}\n        </>\n      )}\n    </li>\n  );\n}\n\nfunction CommentsPanelList({\n  activeIDs,\n  comments,\n  deleteCommentOrThread,\n  listRef,\n  markNodeMap,\n  submitAddComment,\n  t,\n}: {\n  activeIDs: Array<string>;\n  comments: Comments;\n  deleteCommentOrThread: (\n    commentOrThread: Comment | Thread,\n    thread?: Thread\n  ) => void;\n  listRef: { current: null | HTMLUListElement };\n  markNodeMap: Map<string, Set<NodeKey>>;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean,\n    thread?: Thread\n  ) => void;\n  t: TFunction;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [counter, setCounter] = useState(0);\n  const [modal, showModal] = useModal();\n  // const rtf = useMemo(\n  //   () =>\n  //     new Intl.RelativeTimeFormat('en', {\n  //       localeMatcher: 'best fit',\n  //       numeric: 'auto',\n  //       style: 'short',\n  //     }),\n  //   []\n  // ); //FIXME: it is closed to fix a build error\n  const rtf = null;\n\n  useEffect(() => {\n    // Used to keep the time stamp up to date\n    const id = setTimeout(() => {\n      setCounter(counter + 1);\n    }, 10000);\n\n    return () => {\n      clearTimeout(id);\n    };\n  }, [counter]);\n\n  return (\n    <ul className=\"CommentPlugin_CommentsPanel_List\" ref={listRef}>\n      {comments.map((commentOrThread) => {\n        const id = commentOrThread.id;\n        if (commentOrThread.type === 'thread') {\n          const handleClickThread = () => {\n            const markNodeKeys = markNodeMap.get(id);\n            if (\n              markNodeKeys !== undefined &&\n              (activeIDs === null || activeIDs.indexOf(id) === -1)\n            ) {\n              const activeElement = document.activeElement;\n              // Move selection to the start of the mark, so that we\n              // update the UI with the selected thread.\n              editor.update(\n                () => {\n                  const markNodeKey = Array.from(markNodeKeys)[0];\n                  const markNode = $getNodeByKey<MarkNode>(markNodeKey);\n                  if ($isMarkNode(markNode)) {\n                    markNode.selectStart();\n                  }\n                },\n                {\n                  onUpdate() {\n                    // Restore selection to the previous element\n                    if (activeElement !== null) {\n                      (activeElement as HTMLElement).focus();\n                    }\n                  },\n                }\n              );\n            }\n          };\n\n          return (\n            // eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions\n            <li\n              key={id}\n              onClick={handleClickThread}\n              className={`CommentPlugin_CommentsPanel_List_Thread ${\n                markNodeMap.has(id) ? 'interactive' : ''\n              } ${activeIDs.indexOf(id) === -1 ? '' : 'active'}`}\n            >\n              <div className=\"CommentPlugin_CommentsPanel_List_Thread_QuoteBox\">\n                <blockquote className=\"CommentPlugin_CommentsPanel_List_Thread_Quote\">\n                  {'> '}\n                  <span>{commentOrThread.quote}</span>\n                </blockquote>\n                {/* INTRODUCE DELETE THREAD HERE*/}\n                <Button\n                  onClick={() => {\n                    showModal(\n                      t('toolbar:commentPlugin.Delete_Thread'),\n                      (onClose) => (\n                        <ShowDeleteCommentOrThreadDialog\n                          commentOrThread={commentOrThread}\n                          deleteCommentOrThread={deleteCommentOrThread}\n                          onClose={onClose}\n                          t={t}\n                        />\n                      )\n                    );\n                  }}\n                  className=\"CommentPlugin_CommentsPanel_List_DeleteButton\"\n                >\n                  <i className=\"delete\" />\n                </Button>\n                {modal}\n              </div>\n              <ul className=\"CommentPlugin_CommentsPanel_List_Thread_Comments\">\n                {commentOrThread.comments.map((comment) => (\n                  <CommentsPanelListComment\n                    key={comment.id}\n                    comment={comment}\n                    deleteComment={deleteCommentOrThread}\n                    thread={commentOrThread}\n                    rtf={rtf}\n                    t={t}\n                  />\n                ))}\n              </ul>\n              <div className=\"CommentPlugin_CommentsPanel_List_Thread_Editor\">\n                <CommentsComposer\n                  submitAddComment={submitAddComment}\n                  thread={commentOrThread}\n                  placeholder={t('toolbar:commentPlugin.Reply_to_comment')}\n                />\n              </div>\n            </li>\n          );\n        }\n        return (\n          <CommentsPanelListComment\n            key={id}\n            comment={commentOrThread}\n            deleteComment={deleteCommentOrThread}\n            rtf={rtf}\n            t={t}\n          />\n        );\n      })}\n    </ul>\n  );\n}\n\nfunction CommentsPanel({\n  activeIDs,\n  deleteCommentOrThread,\n  comments,\n  markNodeMap,\n  submitAddComment,\n  t,\n}: {\n  activeIDs: Array<string>;\n  comments: Comments;\n  deleteCommentOrThread: (\n    commentOrThread: Comment | Thread,\n    thread?: Thread\n  ) => void;\n  markNodeMap: Map<string, Set<NodeKey>>;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean,\n    thread?: Thread\n  ) => void;\n  t: TFunction;\n}): JSX.Element {\n  const listRef = useRef<HTMLUListElement>(null);\n  const isEmpty = comments.length === 0;\n\n  return (\n    <div className=\"CommentPlugin_CommentsPanel\">\n      <h2 className=\"CommentPlugin_CommentsPanel_Heading\">\n        {t('toolbar:commentPlugin.Comments')}\n      </h2>\n      {isEmpty ? (\n        <div className=\"CommentPlugin_CommentsPanel_Empty\">\n          {t('toolbar:commentPlugin.No_Comments')}\n        </div>\n      ) : (\n        <CommentsPanelList\n          activeIDs={activeIDs}\n          comments={comments}\n          deleteCommentOrThread={deleteCommentOrThread}\n          listRef={listRef}\n          submitAddComment={submitAddComment}\n          markNodeMap={markNodeMap}\n          t={t}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction useCollabAuthorName(): string {\n  const collabContext = useCollaborationContext();\n  const { yjsDocMap, name } = collabContext;\n  return yjsDocMap.has('comments') ? name : 'Playground User';\n}\n\nexport default function CommentPlugin({\n  providerFactory,\n}: {\n  providerFactory?: (\n    id: string,\n    yjsDocMap: Map<string, Doc>\n  ) => WebsocketProvider;\n}): JSX.Element {\n  const collabContext = useCollaborationContext();\n  const [editor] = useLexicalComposerContext();\n  const commentStore = useMemo(() => new CommentStore(editor), [editor]);\n  const comments = useCommentStore(commentStore);\n  const markNodeMap = useMemo<Map<string, Set<NodeKey>>>(() => {\n    return new Map();\n  }, []);\n  const [activeAnchorKey, setActiveAnchorKey] = useState<NodeKey | null>();\n  const [activeIDs, setActiveIDs] = useState<Array<string>>([]);\n  const [showCommentInput, setShowCommentInput] = useState(false);\n  const [showComments, setShowComments] = useState(false);\n  const { yjsDocMap } = collabContext;\n  const { t } = useTranslation(['toolbar']);\n\n  useEffect(() => {\n    if (providerFactory) {\n      const provider = providerFactory('comments', yjsDocMap);\n      return commentStore.registerCollaboration(provider);\n    }\n  }, [commentStore, providerFactory, yjsDocMap]);\n\n  const cancelAddComment = useCallback(() => {\n    editor.update(() => {\n      const selection = $getSelection();\n      // Restore selection\n      if (selection !== null) {\n        selection.dirty = true;\n      }\n    });\n    setShowCommentInput(false);\n  }, [editor]);\n\n  const deleteCommentOrThread = useCallback(\n    (comment: Comment | Thread, thread?: Thread) => {\n      if (comment.type === 'comment') {\n        const deletionInfo = commentStore.deleteCommentOrThread(\n          comment,\n          thread\n        );\n        if (!deletionInfo) return;\n        const { markedComment, index } = deletionInfo;\n        commentStore.addComment(markedComment, thread, index);\n      } else {\n        commentStore.deleteCommentOrThread(comment);\n        // Remove ids from associated marks\n        const id = thread !== undefined ? thread.id : comment.id;\n        const markNodeKeys = markNodeMap.get(id);\n        if (markNodeKeys !== undefined) {\n          // Do async to avoid causing a React infinite loop\n          setTimeout(() => {\n            editor.update(() => {\n              for (const key of markNodeKeys) {\n                const node: null | MarkNode = $getNodeByKey(key);\n                if ($isMarkNode(node)) {\n                  node.deleteID(id);\n                  if (node.getIDs().length === 0) {\n                    $unwrapMarkNode(node);\n                  }\n                }\n              }\n            });\n          });\n        }\n      }\n    },\n    [commentStore, editor, markNodeMap]\n  );\n\n  const submitAddComment = useCallback(\n    (\n      commentOrThread: Comment | Thread,\n      isInlineComment: boolean,\n      thread?: Thread\n    ) => {\n      commentStore.addComment(commentOrThread, thread);\n      if (isInlineComment) {\n        editor.update(() => {\n          const selection = $getSelection();\n          if ($isRangeSelection(selection)) {\n            const focus = selection.focus;\n            const anchor = selection.anchor;\n            const isBackward = selection.isBackward();\n            const id = commentOrThread.id;\n\n            // Wrap content in a MarkNode\n            $wrapSelectionInMarkNode(selection, isBackward, id);\n\n            // Make selection collapsed at the end\n            if (isBackward) {\n              focus.set(anchor.key, anchor.offset, anchor.type);\n            } else {\n              anchor.set(focus.key, focus.offset, focus.type);\n            }\n          }\n        });\n        setShowCommentInput(false);\n      }\n    },\n    [commentStore, editor]\n  );\n\n  useEffect(() => {\n    const changedElems: Array<HTMLElement> = [];\n    for (let i = 0; i < activeIDs.length; i++) {\n      const id = activeIDs[i];\n      const keys = markNodeMap.get(id);\n      if (keys !== undefined) {\n        for (const key of keys) {\n          const elem = editor.getElementByKey(key);\n          if (elem !== null) {\n            elem.classList.add('selected');\n            changedElems.push(elem);\n            setShowComments(true);\n          }\n        }\n      }\n    }\n    return () => {\n      for (let i = 0; i < changedElems.length; i++) {\n        const changedElem = changedElems[i];\n        changedElem.classList.remove('selected');\n      }\n    };\n  }, [activeIDs, editor, markNodeMap]);\n\n  useEffect(() => {\n    const markNodeKeysToIDs: Map<NodeKey, Array<string>> = new Map();\n\n    return mergeRegister(\n      registerNestedElementResolver<MarkNode>(\n        editor,\n        MarkNode,\n        (from: MarkNode) => {\n          return $createMarkNode(from.getIDs());\n        },\n        (from: MarkNode, to: MarkNode) => {\n          // Merge the IDs\n          const ids = from.getIDs();\n          ids.forEach((id) => {\n            to.addID(id);\n          });\n        }\n      ),\n      editor.registerMutationListener(MarkNode, (mutations) => {\n        editor.getEditorState().read(() => {\n          for (const [key, mutation] of mutations) {\n            const node: null | MarkNode = $getNodeByKey(key);\n            let ids: NodeKey[] = [];\n\n            if (mutation === 'destroyed') {\n              ids = markNodeKeysToIDs.get(key) || [];\n            } else if ($isMarkNode(node)) {\n              ids = node.getIDs();\n            }\n\n            for (let i = 0; i < ids.length; i++) {\n              const id = ids[i];\n              let markNodeKeys = markNodeMap.get(id);\n              markNodeKeysToIDs.set(key, ids);\n\n              if (mutation === 'destroyed') {\n                if (markNodeKeys !== undefined) {\n                  markNodeKeys.delete(key);\n                  if (markNodeKeys.size === 0) {\n                    markNodeMap.delete(id);\n                  }\n                }\n              } else {\n                if (markNodeKeys === undefined) {\n                  markNodeKeys = new Set();\n                  markNodeMap.set(id, markNodeKeys);\n                }\n                if (!markNodeKeys.has(key)) {\n                  markNodeKeys.add(key);\n                }\n              }\n            }\n          }\n        });\n      }),\n      editor.registerUpdateListener(({ editorState, tags }) => {\n        editorState.read(() => {\n          const selection = $getSelection();\n          let hasActiveIds = false;\n          let hasAnchorKey = false;\n\n          if ($isRangeSelection(selection)) {\n            const anchorNode = selection.anchor.getNode();\n\n            if ($isTextNode(anchorNode)) {\n              const commentIDs = $getMarkIDs(\n                anchorNode,\n                selection.anchor.offset\n              );\n              if (commentIDs !== null) {\n                setActiveIDs(commentIDs);\n                hasActiveIds = true;\n              }\n              if (!selection.isCollapsed()) {\n                setActiveAnchorKey(anchorNode.getKey());\n                hasAnchorKey = true;\n              }\n            }\n          }\n          if (!hasActiveIds) {\n            setActiveIDs((_activeIds) =>\n              _activeIds.length === 0 ? _activeIds : []\n            );\n          }\n          if (!hasAnchorKey) {\n            setActiveAnchorKey(null);\n          }\n        });\n        if (!tags.has('collaboration')) {\n          setShowCommentInput(false);\n        }\n      }),\n      editor.registerCommand(\n        INSERT_INLINE_COMMAND,\n        () => {\n          const domSelection = window.getSelection();\n          if (domSelection !== null) {\n            domSelection.removeAllRanges();\n          }\n          setShowCommentInput(true);\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR\n      )\n    );\n  }, [editor, markNodeMap]);\n\n  const onAddComment = () => {\n    editor.dispatchCommand(INSERT_INLINE_COMMAND, undefined);\n  };\n\n  return (\n    <>\n      {showCommentInput &&\n        createPortal(\n          <CommentInputBox\n            editor={editor}\n            cancelAddComment={cancelAddComment}\n            submitAddComment={submitAddComment}\n            t={t}\n          />,\n          document.body\n        )}\n      {activeAnchorKey !== null &&\n        activeAnchorKey !== undefined &&\n        !showCommentInput &&\n        createPortal(\n          <AddCommentBox\n            anchorKey={activeAnchorKey}\n            editor={editor}\n            onAddComment={onAddComment}\n          />,\n          document.body\n        )}\n      {createPortal(\n        <Button\n          className={`CommentPlugin_ShowCommentsButton ${\n            showComments ? 'active' : ''\n          }`}\n          onClick={() => setShowComments(!showComments)}\n          title={\n            showComments\n              ? t('toolbar:commentPlugin.Hide_Comments')\n              : t('toolbar:commentPlugin.Show_Comments')\n          }\n        >\n          <i className=\"comments\" />\n        </Button>,\n        document.body\n      )}\n      {showComments &&\n        createPortal(\n          <CommentsPanel\n            comments={comments}\n            submitAddComment={submitAddComment}\n            deleteCommentOrThread={deleteCommentOrThread}\n            activeIDs={activeIDs}\n            markNodeMap={markNodeMap}\n            t={t}\n          />,\n          document.body\n        )}\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { $isCodeHighlightNode } from '@lexical/code';\nimport { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $isAtNodeEnd } from '@lexical/selection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  FORMAT_TEXT_COMMAND,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\n\nimport { INSERT_INLINE_COMMAND } from './CommentPlugin';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nfunction setPopupPosition(\n  editor: HTMLElement,\n  rect: ClientRect,\n  rootElementRect: ClientRect\n): void {\n  let top = rect.top - 8 + window.pageYOffset;\n  let left =\n    rect.left + 340 + window.pageXOffset - editor.offsetWidth + rect.width;\n  if (\n    rect.width >= rootElementRect.width - 20 ||\n    left > rootElementRect.width - 150\n  ) {\n    left = rect.left;\n    top = rect.top - 50 + window.pageYOffset;\n  }\n  if (top < rootElementRect.top) {\n    top = rect.bottom + 20;\n  }\n  editor.style.opacity = '1';\n  editor.style.top = `${top}px`;\n  editor.style.left = `${left}px`;\n}\n\nfunction FloatingCharacterStylesEditor({\n  editor,\n  isLink,\n  isBold,\n  isItalic,\n  isUnderline,\n  isCode,\n  isStrikethrough,\n  isSubscript,\n  isSuperscript,\n  t,\n}: {\n  editor: LexicalEditor;\n  isBold: boolean;\n  isCode: boolean;\n  isItalic: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  isUnderline: boolean;\n  t: TFunction;\n}): JSX.Element {\n  const popupCharStylesEditorRef = useRef<HTMLDivElement | null>(null);\n  const mouseDownRef = useRef(false);\n\n  const insertLink = useCallback(() => {\n    if (!isLink) {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n    } else {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n    }\n  }, [editor, isLink]);\n\n  const insertComment = () => {\n    editor.dispatchCommand(INSERT_INLINE_COMMAND, null);\n  };\n\n  const updateCharacterStylesEditor = useCallback(() => {\n    const selection = $getSelection();\n\n    const popupCharStylesEditorElem = popupCharStylesEditorRef.current;\n    const nativeSelection = window.getSelection();\n\n    if (popupCharStylesEditorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      nativeSelection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      const rootElementRect = rootElement.getBoundingClientRect();\n      let rect;\n\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      if (!mouseDownRef.current) {\n        setPopupPosition(popupCharStylesEditorElem, rect, rootElementRect);\n      }\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateCharacterStylesEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateCharacterStylesEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateCharacterStylesEditor();\n    });\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateCharacterStylesEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateCharacterStylesEditor();\n          return false;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, updateCharacterStylesEditor]);\n\n  return (\n    <div ref={popupCharStylesEditorRef} className=\"verbum-character-style-popup\">\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n        }}\n        className={'verbum-popup-item spaced ' + (isBold ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_text_as_bold')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-bold\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n        }}\n        className={'verbum-popup-item spaced ' + (isItalic ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_as_italics'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-italic\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n        }}\n        className={'verbum-popup-item spaced ' + (isUnderline ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_to_underlined'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-underline\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={'verbum-popup-item spaced ' + (isStrikethrough ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_with_a_strikethrough'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-strikethrough\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'verbum-popup-item spaced ' + (isSubscript ? 'active' : '')}\n        title=\"Subscript\"\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_Subscript')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-subscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={'verbum-popup-item spaced ' + (isSuperscript ? 'active' : '')}\n        title=\"Superscript\"\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_Superscript')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-superscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n        }}\n        className={'verbum-popup-item spaced ' + (isCode ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Insert_code_block')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-code\" />\n      </button>\n      <button\n        onClick={insertLink}\n        className={'verbum-popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Insert_link')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-link\" />\n      </button>\n      <button\n        onClick={insertComment}\n        className={'verbum-popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Add_comment')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-add-comment\" />\n      </button>\n    </div>\n  );\n}\n\nfunction getSelectedNode(selection: RangeSelection): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n\nfunction useCharacterStylesPopup(editor: LexicalEditor): JSX.Element | null {\n  const [isText, setIsText] = useState(false);\n  const [isLink, setIsLink] = useState(false);\n  const [isBold, setIsBold] = useState(false);\n  const [isItalic, setIsItalic] = useState(false);\n  const [isUnderline, setIsUnderline] = useState(false);\n  const [isStrikethrough, setIsStrikethrough] = useState(false);\n  const [isSubscript, setIsSubscript] = useState(false);\n  const [isSuperscript, setIsSuperscript] = useState(false);\n  const [isCode, setIsCode] = useState(false);\n  const { t } = useTranslation(['toolbar']);\n\n  const updatePopup = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n      const nativeSelection = window.getSelection();\n      const rootElement = editor.getRootElement();\n\n      if (\n        nativeSelection !== null &&\n        (!$isRangeSelection(selection) ||\n          rootElement === null ||\n          !rootElement.contains(nativeSelection.anchorNode))\n      ) {\n        setIsText(false);\n        return;\n      }\n\n      if (!$isRangeSelection(selection)) {\n        return;\n      }\n\n      const node = getSelectedNode(selection);\n\n      // Update text format\n      setIsBold(selection.hasFormat('bold'));\n      setIsItalic(selection.hasFormat('italic'));\n      setIsUnderline(selection.hasFormat('underline'));\n      setIsStrikethrough(selection.hasFormat('strikethrough'));\n      setIsSubscript(selection.hasFormat('subscript'));\n      setIsSuperscript(selection.hasFormat('superscript'));\n      setIsCode(selection.hasFormat('code'));\n\n      // Update links\n      const parent = node.getParent();\n      if ($isLinkNode(parent) || $isLinkNode(node)) {\n        setIsLink(true);\n      } else {\n        setIsLink(false);\n      }\n\n      if (\n        !$isCodeHighlightNode(selection.anchor.getNode()) &&\n        selection.getTextContent() !== ''\n      ) {\n        setIsText($isTextNode(node));\n      } else {\n        setIsText(false);\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    document.addEventListener('selectionchange', updatePopup);\n    return () => {\n      document.removeEventListener('selectionchange', updatePopup);\n    };\n  }, [updatePopup]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      updatePopup();\n    });\n  }, [editor, updatePopup]);\n\n  if (!isText || isLink) {\n    return null;\n  }\n\n  return createPortal(\n    <FloatingCharacterStylesEditor\n      editor={editor}\n      isLink={isLink}\n      isBold={isBold}\n      isItalic={isItalic}\n      isStrikethrough={isStrikethrough}\n      isSubscript={isSubscript}\n      isSuperscript={isSuperscript}\n      isUnderline={isUnderline}\n      isCode={isCode}\n      t={t}\n    />,\n    document.body\n  );\n}\n\nexport default function CharacterStylesPopupPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n  return useCharacterStylesPopup(editor);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LinkNode } from '@lexical/link';\nimport type { LexicalEditor } from 'lexical';\n\nimport { $isLinkNode } from '@lexical/link';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getNearestNodeFromDOMNode } from 'lexical';\nimport { useEffect, useRef } from 'react';\n\ntype LinkFilter = (event: MouseEvent, linkNode: LinkNode) => boolean;\nexport default function ClickableLinkPlugin({\n  filter,\n  newTab = true,\n}: {\n  filter?: LinkFilter;\n  newTab?: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const hasMoved = useRef(false);\n  useEffect(() => {\n    let prevOffsetX;\n    let prevOffsetY;\n\n    function onPointerDown(event: PointerEvent) {\n      prevOffsetX = event.offsetX;\n      prevOffsetY = event.offsetY;\n    }\n\n    function onPointerUp(event: PointerEvent) {\n      hasMoved.current =\n        event.offsetX !== prevOffsetX || event.offsetY !== prevOffsetY;\n    }\n\n    function onClick(e: Event) {\n      // Based on pointerdown/up we can check if cursor moved during click event,\n      // and ignore clicks with moves (to allow link text selection)\n      const hasMovedDuringClick = hasMoved.current;\n      hasMoved.current = false;\n      // $FlowExpectedError[incompatible-cast] onClick handler will get MouseEvent, safe to cast\n      const event = e as MouseEvent;\n      const linkDomNode = getLinkDomNode(event, editor);\n\n      if (linkDomNode === null) {\n        return;\n      }\n\n      const href = linkDomNode.getAttribute('href');\n\n      if (\n        linkDomNode.getAttribute('contenteditable') === 'false' ||\n        href === undefined\n      ) {\n        return;\n      }\n\n      let linkNode = null;\n      editor.update(() => {\n        const maybeLinkNode = $getNearestNodeFromDOMNode(linkDomNode);\n\n        if ($isLinkNode(maybeLinkNode)) {\n          linkNode = maybeLinkNode;\n        }\n      });\n\n      if (\n        linkNode === null ||\n        (filter !== undefined && !filter(event, linkNode))\n      ) {\n        return;\n      }\n\n      if (hasMovedDuringClick) {\n        return;\n      }\n\n      try {\n        window.open(\n          href,\n          newTab || event.metaKey || event.ctrlKey ? '_blank' : '_self'\n        );\n      } catch {\n        // It didn't work, which is better than throwing an exception!\n      }\n    }\n\n    return editor.registerRootListener(\n      (\n        rootElement: null | HTMLElement,\n        prevRootElement: null | HTMLElement\n      ) => {\n        if (prevRootElement !== null) {\n          prevRootElement.removeEventListener('pointerdown', onPointerDown);\n          prevRootElement.removeEventListener('pointerup', onPointerUp);\n          prevRootElement.removeEventListener('click', onClick);\n        }\n\n        if (rootElement !== null) {\n          rootElement.addEventListener('click', onClick);\n          rootElement.addEventListener('pointerdown', onPointerDown);\n          rootElement.addEventListener('pointerup', onPointerUp);\n        }\n      }\n    );\n  }, [editor, filter, newTab]);\n  return null;\n}\n\nfunction isLinkDomNode(domNode: Node): boolean {\n  return domNode.nodeName.toLowerCase() === 'a';\n}\n\nfunction getLinkDomNode(\n  event: MouseEvent,\n  editor: LexicalEditor\n): HTMLAnchorElement | null {\n  return editor.getEditorState().read(() => {\n    // $FlowExpectedError[incompatible-cast]\n    const domNode = event.target as Node;\n\n    if (isLinkDomNode(domNode)) {\n      // $FlowExpectedError[incompatible-cast]\n      return domNode as HTMLAnchorElement;\n    }\n\n    if (domNode.parentNode && isLinkDomNode(domNode.parentNode)) {\n      // $FlowExpectedError[incompatible-cast]\n      return domNode.parentNode as HTMLAnchorElement;\n    }\n\n    return null;\n  });\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { registerCodeHighlighting } from '@lexical/code';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useEffect } from 'react';\n\nexport default function CodeHighlightPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return registerCodeHighlighting(editor);\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { TextNode } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useLexicalTextEntity } from '@lexical/react/useLexicalTextEntity';\nimport { useCallback, useEffect } from 'react';\n\nimport { $createKeywordNode, KeywordNode } from '../nodes/KeywordNode';\n\nconst KEYWORDS_REGEX =\n  /(^|$|[^A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------])(congrats|congratulations|gratuluju|gratuluji|gratulujeme|blahopeju|blahopeji|blahopejeme|Til lykke|Tillykke|Glckwunsch|Gratuliere|felicitaciones|enhorabuena|paljon onnea|onnittelut|Flicitations|gratula|gratullok|gratullunk|congratulazioni|complimenti|||||gratulerer|Gefeliciteerd|gratulacje|Parabns|parabns|felicitaes|felicitri| |||gratulujem|blahoelm|||tebrikler|tebrik ederim||||||baie geluk|veels geluk||estitam|estitke|estitamo||||badhai|||| |hongera|||||Chc mng| |mazel tov|mazal tov)(^|$|[^A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------])/i;\n\nexport default function KeywordsPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([KeywordNode])) {\n      throw new Error('KeywordsPlugin: KeywordNode not registered on editor');\n    }\n  }, [editor]);\n\n  const createKeywordNode = useCallback((textNode: TextNode): KeywordNode => {\n    return $createKeywordNode(textNode.getTextContent());\n  }, []);\n\n  const getKeywordMatch = useCallback((text: string) => {\n    const matchArr = KEYWORDS_REGEX.exec(text);\n\n    if (matchArr === null) {\n      return null;\n    }\n\n    const hashtagLength = matchArr[2].length;\n    const startOffset = matchArr.index + matchArr[1].length;\n    const endOffset = startOffset + hashtagLength;\n    return {\n      end: endOffset,\n      start: startOffset,\n    };\n  }, []);\n\n  useLexicalTextEntity<KeywordNode>(\n    getKeywordMatch,\n    KeywordNode,\n    createKeywordNode\n  );\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { RangeSelection } from 'lexical';\n\nimport { $getListDepth, $isListItemNode, $isListNode } from '@lexical/list';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isElementNode,\n  $isRangeSelection,\n  COMMAND_PRIORITY_CRITICAL,\n  ElementNode,\n  INDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport { useEffect } from 'react';\n\ntype Props = Readonly<{\n  maxDepth: number | null | undefined;\n}>;\n\nfunction getElementNodesInSelection(\n  selection: RangeSelection\n): Set<ElementNode> {\n  const nodesInSelection = selection.getNodes();\n\n  if (nodesInSelection.length === 0) {\n    return new Set([\n      selection.anchor.getNode().getParentOrThrow(),\n      selection.focus.getNode().getParentOrThrow(),\n    ]);\n  }\n\n  return new Set(\n    nodesInSelection.map((n) => ($isElementNode(n) ? n : n.getParentOrThrow()))\n  );\n}\n\nfunction isIndentPermitted(maxDepth: number): boolean {\n  const selection = $getSelection();\n\n  if (!$isRangeSelection(selection)) {\n    return false;\n  }\n\n  const elementNodesInSelection: Set<ElementNode> =\n    getElementNodesInSelection(selection);\n\n  let totalDepth = 0;\n\n  for (const elementNode of elementNodesInSelection) {\n    if ($isListNode(elementNode)) {\n      totalDepth = Math.max($getListDepth(elementNode) + 1, totalDepth);\n    } else if ($isListItemNode(elementNode)) {\n      const parent = elementNode.getParent();\n\n      if (!$isListNode(parent)) {\n        throw new Error(\n          'ListMaxIndentLevelPlugin: A ListItemNode must have a ListNode for a parent.'\n        );\n      }\n\n      totalDepth = Math.max($getListDepth(parent) + 1, totalDepth);\n    }\n  }\n\n  return totalDepth <= maxDepth;\n}\n\nexport default function ListMaxIndentLevelPlugin({ maxDepth }: Props): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INDENT_CONTENT_COMMAND,\n      () => !isIndentPermitted(maxDepth ?? 7),\n      COMMAND_PRIORITY_CRITICAL\n    );\n  }, [editor, maxDepth]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n *\n */\n\nimport { MarkdownShortcutPlugin } from '@lexical/react/LexicalMarkdownShortcutPlugin';\nimport * as React from 'react';\n\nimport { PLAYGROUND_TRANSFORMERS } from './MarkdownTransformers';\n\nexport default function MarkdownPlugin(): JSX.Element {\n  return <MarkdownShortcutPlugin transformers={PLAYGROUND_TRANSFORMERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $setSelection,\n  FOCUS_COMMAND,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nconst COMMAND_PRIORITY_LOW = 1;\nconst TAB_TO_FOCUS_INTERVAL = 100;\n\nlet lastTabKeyDownTimestamp = 0;\nlet hasRegisteredKeyDownListener = false;\n\nfunction registerKeyTimeStampTracker() {\n  window.addEventListener(\n    'keydown',\n    (event: KeyboardEvent) => {\n      // Tab\n      if (event.keyCode === 9) {\n        lastTabKeyDownTimestamp = event.timeStamp;\n      }\n    },\n    true\n  );\n}\n\nexport default function TabFocusPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!hasRegisteredKeyDownListener) {\n      registerKeyTimeStampTracker();\n      hasRegisteredKeyDownListener = true;\n    }\n\n    return editor.registerCommand(\n      FOCUS_COMMAND,\n      (event: FocusEvent) => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n          if (\n            lastTabKeyDownTimestamp + TAB_TO_FOCUS_INTERVAL >\n            event.timeStamp\n          ) {\n            $setSelection(selection.clone());\n          }\n        }\n        return false;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n  }, [editor]);\n\n  return null;\n}\n","import { LexicalEditor } from 'lexical';\nimport React, { createContext } from 'react';\n\ninterface IEditorContext {\n  initialEditor: LexicalEditor;\n  activeEditor: LexicalEditor;\n  setActiveEditor: React.Dispatch<React.SetStateAction<LexicalEditor>>;\n}\n\nconst EditorContext = createContext<IEditorContext | null>(null);\n\nexport default EditorContext;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  accept?: string;\n  label: string;\n  onChange: (files: FileList) => void;\n}>;\n\nexport default function FileInput({\n  accept,\n  label,\n  onChange,\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"file\"\n        accept={accept}\n        className=\"Input__input\"\n        onChange={(e) => onChange(e.target.files)}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  label: string;\n  onChange: (string) => void;\n  placeholder?: string;\n  value: string;\n}>;\n\nexport default function TextInput({\n  label,\n  value,\n  onChange,\n  placeholder = '',\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"text\"\n        className=\"Input__input\"\n        placeholder={placeholder}\n        value={value}\n        onChange={(e) => {\n          onChange(e.target.value);\n        }}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $wrapNodeInElement, mergeRegister } from '@lexical/utils';\nimport {\n  $createParagraphNode,\n  $createRangeSelection,\n  $getSelection,\n  $insertNodes,\n  $isNodeSelection,\n  $isRootOrShadowRoot,\n  $setSelection,\n  COMMAND_PRIORITY_EDITOR,\n  COMMAND_PRIORITY_HIGH,\n  COMMAND_PRIORITY_LOW,\n  createCommand,\n  DRAGOVER_COMMAND,\n  DRAGSTART_COMMAND,\n  DROP_COMMAND,\n  LexicalCommand,\n  LexicalEditor,\n} from 'lexical';\nimport { useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\n\nimport {\n  $createImageNode,\n  $isImageNode,\n  ImageNode,\n  ImagePayload,\n} from '../nodes/ImageNode';\nimport Button from '../ui/Button';\nimport { DialogActions, DialogButtonsList } from '../ui/Dialog';\nimport FileInput from '../ui/FileInput';\nimport TextInput from '../ui/TextInput';\n\nexport type InsertImagePayload = Readonly<ImagePayload>;\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n\nconst getDOMSelection = (targetWindow: Window | null): Selection | null =>\n  CAN_USE_DOM ? (targetWindow || window).getSelection() : null;\n\nexport const INSERT_IMAGE_COMMAND: LexicalCommand<InsertImagePayload> =\n  createCommand('INSERT_IMAGE_COMMAND');\n\nexport function InsertImageUriDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  return (\n    <>\n      <TextInput\n        label=\"Image URL\"\n        placeholder=\"i.e. https://source.unsplash.com/random\"\n        onChange={setSrc}\n        value={src}\n        data-test-id=\"image-modal-url-input\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Random unsplash image\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <DialogActions>\n        <Button\n          data-test-id=\"image-modal-confirm-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </DialogActions>\n    </>\n  );\n}\n\nexport function InsertImageUploadedDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  const loadImage = (files: FileList | null) => {\n    const reader = new FileReader();\n    reader.onload = function () {\n      if (typeof reader.result === 'string') {\n        setSrc(reader.result);\n      }\n      return '';\n    };\n    if (files !== null) {\n      reader.readAsDataURL(files[0]);\n    }\n  };\n\n  return (\n    <>\n      <FileInput\n        label=\"Image Upload\"\n        onChange={loadImage}\n        accept=\"image/*\"\n        data-test-id=\"image-modal-file-upload\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Descriptive alternative text\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <DialogActions>\n        <Button\n          data-test-id=\"image-modal-file-upload-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </DialogActions>\n    </>\n  );\n}\n\nexport const InsertImageDialog = ({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element => {\n  const [mode, setMode] = useState<null | 'url' | 'file'>(null);\n  const hasModifier = useRef(false);\n\n  useEffect(() => {\n    hasModifier.current = false;\n    const handler = (e: KeyboardEvent) => {\n      hasModifier.current = e.altKey;\n    };\n    document.addEventListener('keydown', handler);\n    return () => {\n      document.removeEventListener('keydown', handler);\n    };\n  }, [activeEditor]);\n\n  const onClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n    onClose();\n  };\n\n  return (\n    <>\n      {!mode && (\n        <DialogButtonsList>\n          <Button\n            data-test-id=\"image-modal-option-url\"\n            onClick={() => setMode('url')}\n          >\n            URL\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-file\"\n            onClick={() => setMode('file')}\n          >\n            File\n          </Button>\n        </DialogButtonsList>\n      )}\n      {mode === 'url' && <InsertImageUriDialogBody onClick={onClick} />}\n      {mode === 'file' && <InsertImageUploadedDialogBody onClick={onClick} />}\n    </>\n  );\n}\n\nexport default function ImagesPlugin({\n  captionsEnabled,\n  maxWidth,\n}: {\n  captionsEnabled?: boolean;\n  maxWidth?: number;\n}): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([ImageNode])) {\n      throw new Error('ImagesPlugin: ImageNode not registered on editor');\n    }\n\n    return mergeRegister(\n      editor.registerCommand<InsertImagePayload>(\n        INSERT_IMAGE_COMMAND,\n        (payload) => {\n          const imageNode = $createImageNode({\n            ...payload,\n            maxWidth: maxWidth,\n          });\n          $insertNodes([imageNode]);\n          if ($isRootOrShadowRoot(imageNode.getParentOrThrow())) {\n            $wrapNodeInElement(imageNode, $createParagraphNode).selectEnd();\n          }\n\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGSTART_COMMAND,\n        (event) => {\n          return onDragStart(event);\n        },\n        COMMAND_PRIORITY_HIGH\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGOVER_COMMAND,\n        (event) => {\n          return onDragover(event);\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand<DragEvent>(\n        DROP_COMMAND,\n        (event) => {\n          return onDrop(event, editor);\n        },\n        COMMAND_PRIORITY_HIGH\n      )\n    );\n  }, [captionsEnabled, editor]);\n\n  return null;\n}\n\nconst TRANSPARENT_IMAGE =\n  'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\nconst img = document.createElement('img');\nimg.src = TRANSPARENT_IMAGE;\n\nfunction onDragStart(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const dataTransfer = event.dataTransfer;\n  if (!dataTransfer) {\n    return false;\n  }\n  dataTransfer.setData('text/plain', '_');\n  dataTransfer.setDragImage(img, 0, 0);\n  dataTransfer.setData(\n    'application/x-lexical-drag',\n    JSON.stringify({\n      data: {\n        altText: node.__altText,\n        caption: node.__caption,\n        height: node.__height,\n        key: node.getKey(),\n        maxWidth: node.__maxWidth,\n        showCaption: node.__showCaption,\n        src: node.__src,\n        width: node.__width,\n      },\n      type: 'image',\n    })\n  );\n\n  return true;\n}\n\nfunction onDragover(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  if (!canDropImage(event)) {\n    event.preventDefault();\n  }\n  return true;\n}\n\nfunction onDrop(event: DragEvent, editor: LexicalEditor): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const data = getDragImageData(event);\n  if (!data) {\n    return false;\n  }\n  event.preventDefault();\n  if (canDropImage(event)) {\n    const range = getDragSelection(event);\n    node.remove();\n    const rangeSelection = $createRangeSelection();\n    if (range !== null && range !== undefined) {\n      rangeSelection.applyDOMRange(range);\n    }\n    $setSelection(rangeSelection);\n    editor.dispatchCommand(INSERT_IMAGE_COMMAND, data);\n  }\n  return true;\n}\n\nfunction getImageNodeInSelection(): ImageNode | null {\n  const selection = $getSelection();\n  if (!$isNodeSelection(selection)) {\n    return null;\n  }\n  const nodes = selection.getNodes();\n  const node = nodes[0];\n  return $isImageNode(node) ? node : null;\n}\n\nfunction getDragImageData(event: DragEvent): null | InsertImagePayload {\n  const dragData = event.dataTransfer?.getData('application/x-lexical-drag');\n  if (!dragData) {\n    return null;\n  }\n  const { type, data } = JSON.parse(dragData);\n  if (type !== 'image') {\n    return null;\n  }\n\n  return data;\n}\n\ndeclare global {\n  interface DragEvent {\n    rangeOffset?: number;\n    rangeParent?: Node;\n  }\n}\n\nfunction canDropImage(event: DragEvent): boolean {\n  const target = event.target;\n  return !!(\n    target &&\n    target instanceof HTMLElement &&\n    !target.closest('code, span.editor-image') &&\n    target.parentElement &&\n    target.parentElement.closest('div.ContentEditable__root')\n  );\n}\n\nfunction getDragSelection(event: DragEvent): Range | null | undefined {\n  let range;\n  const target = event.target as null | Element | Document;\n  const targetWindow =\n    target == null\n      ? null\n      : target.nodeType === 9\n      ? (target as Document).defaultView\n      : (target as Element).ownerDocument.defaultView;\n  const domSelection = getDOMSelection(targetWindow);\n  if (document.caretRangeFromPoint) {\n    range = document.caretRangeFromPoint(event.clientX, event.clientY);\n  } else if (event.rangeParent && domSelection !== null) {\n    domSelection.collapse(event.rangeParent, event.rangeOffset || 0);\n    range = domSelection.getRangeAt(0);\n  } else {\n    throw Error(`Cannot get the selection when dragging`);\n  }\n\n  return range;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { DRAG_DROP_PASTE } from '@lexical/rich-text';\nimport { isMimeType, mediaFileReader } from '@lexical/utils';\nimport { COMMAND_PRIORITY_LOW } from 'lexical';\nimport { useEffect } from 'react';\n\nimport { INSERT_IMAGE_COMMAND } from './ImagesPlugin';\n\nconst ACCEPTABLE_IMAGE_TYPES = [\n  'image/',\n  'image/heic',\n  'image/heif',\n  'image/gif',\n  'image/webp',\n];\n\nexport default function DragDropPaste(): null {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    return editor.registerCommand(\n      DRAG_DROP_PASTE,\n      (files) => {\n        (async () => {\n          const filesResult = await mediaFileReader(\n            files,\n            [ACCEPTABLE_IMAGE_TYPES].flatMap((x) => x)\n          );\n          for (const { file, result } of filesResult) {\n            if (isMimeType(file, ACCEPTABLE_IMAGE_TYPES)) {\n              editor.dispatchCommand(INSERT_IMAGE_COMMAND, {\n                altText: file.name,\n                src: result,\n              });\n            }\n          }\n        })();\n        return true;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n  }, [editor]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { AutoFocusPlugin } from '@lexical/react/LexicalAutoFocusPlugin';\nimport { CheckListPlugin } from '@lexical/react/LexicalCheckListPlugin';\nimport { ClearEditorPlugin } from '@lexical/react/LexicalClearEditorPlugin';\nimport { HashtagPlugin } from '@lexical/react/LexicalHashtagPlugin';\nimport { LinkPlugin } from '@lexical/react/LexicalLinkPlugin';\nimport { ListPlugin } from '@lexical/react/LexicalListPlugin';\nimport { RichTextPlugin } from '@lexical/react/LexicalRichTextPlugin';\nimport { OnChangePlugin } from '@lexical/react/LexicalOnChangePlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport React, { ReactNode, useEffect, useState } from 'react';\nimport { useRef } from 'react';\n\nimport { useSettings } from './context/SettingsContext';\nimport { useSharedHistoryContext } from './context/SharedHistoryContext';\nimport ActionsPlugin from './plugins/ActionsPlugin';\nimport AutoLinkPlugin from './plugins/AutoLinkPlugin';\nimport CharacterStylesPopupPlugin from './plugins/CharacterStylesPopupPlugin';\nimport ClickableLinkPlugin from './plugins/ClickableLinkPlugin';\nimport CodeHighlightPlugin from './plugins/CodeHighlightPlugin';\nimport EmojisPlugin from './plugins/EmojisPlugin';\nimport KeywordsPlugin from './plugins/KeywordsPlugin';\nimport ListMaxIndentLevelPlugin from './plugins/ListMaxIndentLevelPlugin';\nimport MarkdownShortcutPlugin from './plugins/MarkdownShortcutPlugin';\nimport SpeechToTextPlugin from './plugins/SpeechToTextPlugin';\nimport TabFocusPlugin from './plugins/TabFocusPlugin';\nimport ContentEditable from './ui/ContentEditable';\nimport Placeholder from './ui/Placeholder';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport EditorContext from './context/EditorContext';\nimport { LexicalEditor } from 'lexical';\nimport { useTranslation } from 'react-i18next';\nimport DragDropPaste from './plugins/DragDropPastePlugin';\n\ninterface IEditorProps {\n  children?: ReactNode;\n  hashtagsEnabled?: boolean;\n  autoLinkEnabled?: boolean;\n  emojisEnabled?: boolean;\n  actionsEnabled?: boolean;\n  placeholder?: string;\n  listMaxIndent?: number;\n  isEditable?: boolean;\n  locale?: 'en' | 'fr' | 'ptBr' | 'ru' | null;\n  onChange?: (editorState: string, editorInstance?: LexicalEditor) => void;\n}\n\nconst Editor = ({\n  children,\n  hashtagsEnabled = false,\n  autoLinkEnabled = false,\n  emojisEnabled = false,\n  actionsEnabled = false,\n  listMaxIndent = 7,\n  placeholder = '',\n  isEditable = true,\n  locale = null,\n  onChange,\n}: IEditorProps) => {\n  const [editor] = useLexicalComposerContext();\n  const [activeEditor, setActiveEditor] = useState(editor);\n\n  const editorStateRef = useRef(null);\n  const { historyState } = useSharedHistoryContext();\n  const {\n    settings: { isRichText },\n  } = useSettings();\n  const placeholderComponent = <Placeholder>{placeholder}</Placeholder>;\n\n  const { i18n } = useTranslation();\n\n  useEffect(() => {\n    editor.setEditable(isEditable);\n\n    if (locale) i18n.changeLanguage(locale);\n  }, []);\n\n  return (\n    <EditorContext.Provider\n      value={{ initialEditor: editor, activeEditor, setActiveEditor }}\n    >\n      {children}\n      <div className={`verbum-editor-container`}>\n        <AutoFocusPlugin />\n        <ClearEditorPlugin />\n        {hashtagsEnabled && <HashtagPlugin />}\n        <KeywordsPlugin />\n        <SpeechToTextPlugin />\n        <DragDropPaste />\n        {autoLinkEnabled && <AutoLinkPlugin />}\n\n        <>\n          <RichTextPlugin\n            contentEditable={<ContentEditable />}\n            placeholder={placeholderComponent}\n            ErrorBoundary={LexicalErrorBoundary}\n          />\n          <OnChangePlugin\n            onChange={(editorState) => {\n              onChange?.(JSON.stringify(editorState), activeEditor);\n              return (editorStateRef.current = editorState);\n            }}\n          />\n          <MarkdownShortcutPlugin />\n          <CodeHighlightPlugin />\n          <ListPlugin />\n          <CheckListPlugin />\n          <ListMaxIndentLevelPlugin maxDepth={listMaxIndent} />\n          <LinkPlugin />\n          <ClickableLinkPlugin />\n          <CharacterStylesPopupPlugin />\n          <TabFocusPlugin />\n        </>\n\n        <HistoryPlugin externalHistoryState={historyState} />\n        {actionsEnabled && <ActionsPlugin isRichText={isRichText} />}\n      </div>\n    </EditorContext.Provider>\n  );\n};\n\nexport default Editor;\n","import { $isAtNodeEnd } from '@lexical/selection';\nimport { ElementNode, RangeSelection, TextNode } from 'lexical';\n\nexport function getSelectedNode(\n  selection: RangeSelection\n): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n","import { LexicalEditor } from 'lexical';\nimport React, { createContext } from 'react';\n\ninterface IToolbarContext {\n  isRTL: boolean;\n  isBold: boolean;\n  isItalic: boolean;\n  isUnderline: boolean;\n  isCode: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  canUndo: boolean;\n  canRedo: boolean;\n  fontFamily: string;\n  fontSize: string;\n  fontColor: string;\n  bgColor: string;\n  blockType: string;\n  codeLanguage: string;\n  selectedElementKey: string;\n  applyStyleText: (styles: Record<string, string>) => void;\n  insertLink: () => void;\n}\n\nconst ToolbarContext = createContext<IToolbarContext | null>(null);\n\nexport default ToolbarContext;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\n\nexport default function DropDown({\n  buttonLabel,\n  buttonAriaLabel,\n  buttonClassName,\n  buttonIconClassName,\n  children,\n  stopCloseOnClickSelf,\n}: {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  children: JSX.Element | string | (JSX.Element | string)[];\n  stopCloseOnClickSelf?: boolean;\n}): JSX.Element {\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const buttonRef = useRef<HTMLButtonElement | null>(null);\n  const [showDropDown, setShowDropDown] = useState(false);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n    const dropDown = dropDownRef.current;\n\n    if (showDropDown && button !== null && dropDown !== null) {\n      const { top, left } = button.getBoundingClientRect();\n      dropDown.style.top = `${top + 40}px`;\n      dropDown.style.left = `${Math.min(\n        left,\n        window.innerWidth - dropDown.offsetWidth - 20\n      )}px`;\n    }\n  }, [dropDownRef, buttonRef, showDropDown]);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n\n    if (button !== null && showDropDown) {\n      const handle = (event: MouseEvent) => {\n        const target = event.target;\n        if (stopCloseOnClickSelf) {\n          if (dropDownRef.current.contains(target as Node)) return;\n        }\n        if (!button.contains(target as Node)) {\n          setShowDropDown(false);\n        }\n      };\n      document.addEventListener('click', handle);\n\n      return () => {\n        document.removeEventListener('click', handle);\n      };\n    }\n  }, [dropDownRef, buttonRef, showDropDown, stopCloseOnClickSelf]);\n\n  return (\n    <>\n      <button\n        aria-label={buttonAriaLabel || buttonLabel}\n        className={buttonClassName}\n        onClick={() => setShowDropDown(!showDropDown)}\n        ref={buttonRef}\n        type=\"button\"\n      >\n        {buttonIconClassName && <span className={buttonIconClassName} />}\n        {buttonLabel && (\n          <span className=\"verbum-text verbum-dropdown-button-text\">{buttonLabel}</span>\n        )}\n        <i className=\"verbum-chevron-down\" />\n      </button>\n\n      {showDropDown &&\n        createPortal(\n          <div className=\"verbum-dropdown\" ref={dropDownRef}>\n            {children}\n          </div>,\n          document.body\n        )}\n    </>\n  );\n}\n","import React, { useContext } from 'react';\nimport DropDown from '../../../ui/DropDown';\n\nimport {\n  FORMAT_ELEMENT_COMMAND,\n  INDENT_CONTENT_COMMAND,\n  LexicalEditor,\n  OUTDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nfunction Divider(): JSX.Element {\n  return <div className=\"verbum-divider\" />;\n}\n\nconst AlignDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isRTL } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <DropDown\n      buttonLabel={t('toolbar:alignDropdown.Title')}\n      buttonAriaLabel={t('toolbar:alignDropdown.Description')}\n      buttonClassName=\"verbum-toolbar-item spaced alignment\"\n      buttonIconClassName=\"verbum-icon verbum-left-align\"\n    >\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'left');\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-left-align\" />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.LeftAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'center');\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-center-align\" />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.CenterAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'right');\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-right-align\" />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.RightAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'justify');\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-justify-align\" />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.JustifyAlign')}</span>\n      </button>\n      <Divider />\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(OUTDENT_CONTENT_COMMAND, undefined);\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className={'icon ' + (isRTL ? 'indent' : 'outdent')} />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.Outdent')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(INDENT_CONTENT_COMMAND, undefined);\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className={'icon ' + (isRTL ? 'outdent' : 'indent')} />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.Indent')}</span>\n      </button>\n    </DropDown>\n  );\n};\n\nexport default AlignDropdown;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isRootNode,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createPollNode, PollNode } from '../nodes/PollNode';\n\nexport const INSERT_POLL_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function PollPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    if (!editor.hasNodes([PollNode])) {\n      throw new Error('PollPlugin: PollNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_POLL_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const question = payload;\n          const pollNode = $createPollNode(question);\n\n          if ($isRootNode(selection.anchor.getNode())) {\n            selection.insertParagraph();\n          }\n\n          selection.insertNodes([pollNode]);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createTweetNode, TweetNode } from '../nodes/TweetNode';\n\nexport const INSERT_TWEET_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function TwitterPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([TweetNode])) {\n      throw new Error('TwitterPlugin: TweetNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_TWEET_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const focusNode = selection.focus.getNode();\n\n          if (focusNode !== null) {\n            const tweetNode = $createTweetNode(payload);\n            selection.focus\n              .getNode()\n              .getTopLevelElementOrThrow()\n              .insertAfter(tweetNode);\n            const paragraphNode = $createParagraphNode();\n            tweetNode.insertAfter(paragraphNode);\n            paragraphNode.select();\n          }\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createYouTubeNode, YouTubeNode } from '../nodes/YouTubeNode';\n\nexport const INSERT_YOUTUBE_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function YouTubePlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([YouTubeNode])) {\n      throw new Error('YouTubePlugin: YouTubeNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_YOUTUBE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const focusNode = selection.focus.getNode();\n\n          if (focusNode !== null) {\n            const youTubeNode = $createYouTubeNode(payload);\n            selection.focus\n              .getNode()\n              .getTopLevelElementOrThrow()\n              .insertAfter(youTubeNode);\n            const paragraphNode = $createParagraphNode();\n            youTubeNode.insertAfter(paragraphNode);\n            paragraphNode.select();\n          }\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport type { Cell } from '@lexical/table';\nimport type { LexicalEditor } from 'lexical';\n\nimport './TableCellResizer.css';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $isTableCellNode,\n  $isTableRowNode,\n  getCellFromTarget,\n} from '@lexical/table';\nimport {\n  $getNearestNodeFromDOMNode,\n  $getSelection,\n  DEPRECATED_$isGridSelection,\n  COMMAND_PRIORITY_HIGH,\n  SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {\n  ReactPortal,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { createPortal } from 'react-dom';\n\ntype MousePosition = {\n  x: number;\n  y: number;\n};\n\ntype MouseDraggingDirection = 'right' | 'bottom';\n\nconst MIN_ROW_HEIGHT = 33;\nconst MIN_COLUMN_WIDTH = 50;\n\nfunction TableCellResizer({ editor }: { editor: LexicalEditor }): JSX.Element {\n  const targetRef = useRef<HTMLElement | null>(null);\n  const resizerRef = useRef<HTMLDivElement | null>(null);\n  const tableRectRef = useRef<ClientRect | null>(null);\n\n  const mouseStartPosRef = useRef<MousePosition | null>(null);\n  const [mouseCurrentPos, updateMouseCurrentPos] =\n    useState<MousePosition | null>(null);\n\n  const [activeCell, updateActiveCell] = useState<Cell | null>(null);\n  const [isSelectingGrid, updateIsSelectingGrid] = useState<boolean>(false);\n  const [draggingDirection, updateDraggingDirection] =\n    useState<MouseDraggingDirection | null>(null);\n\n  useEffect(() => {\n    return editor.registerCommand(\n      SELECTION_CHANGE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n        const isGridSelection = DEPRECATED_$isGridSelection(selection);\n\n        if (isSelectingGrid !== isGridSelection) {\n          updateIsSelectingGrid(isGridSelection);\n        }\n\n        return false;\n      },\n      COMMAND_PRIORITY_HIGH\n    );\n  });\n\n  const resetState = useCallback(() => {\n    updateActiveCell(null);\n    targetRef.current = null;\n    updateDraggingDirection(null);\n    mouseStartPosRef.current = null;\n    tableRectRef.current = null;\n  }, []);\n\n  useEffect(() => {\n    const onMouseMove = (event: MouseEvent) => {\n      setTimeout(() => {\n        const target = event.target;\n\n        if (draggingDirection) {\n          updateMouseCurrentPos({\n            x: event.clientX,\n            y: event.clientY,\n          });\n          return;\n        }\n\n        if (resizerRef.current && resizerRef.current.contains(target as Node)) {\n          return;\n        }\n\n        if (targetRef.current !== target) {\n          targetRef.current = target as HTMLElement;\n          const cell = getCellFromTarget(target as HTMLElement);\n\n          if (cell && activeCell !== cell) {\n            editor.update(() => {\n              const tableCellNode = $getNearestNodeFromDOMNode(cell.elem);\n              if (!tableCellNode) {\n                throw new Error('TableCellResizer: Table cell node not found.');\n              }\n\n              const tableNode =\n                $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n              const tableElement = editor.getElementByKey(tableNode.getKey());\n\n              if (!tableElement) {\n                throw new Error('TableCellResizer: Table element not found.');\n              }\n\n              targetRef.current = target as HTMLElement;\n              tableRectRef.current = tableElement.getBoundingClientRect();\n              updateActiveCell(cell);\n            });\n          } else if (cell == null) {\n            resetState();\n          }\n        }\n      }, 0);\n    };\n\n    document.addEventListener('mousemove', onMouseMove);\n\n    return () => {\n      document.removeEventListener('mousemove', onMouseMove);\n    };\n  }, [activeCell, draggingDirection, editor, resetState]);\n\n  const isHeightChanging = (direction: MouseDraggingDirection) => {\n    if (direction === 'bottom') return true;\n    return false;\n  };\n\n  const updateRowHeight = useCallback(\n    (newHeight: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableRow = tableRows[tableRowIndex];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        tableRow.setHeight(newHeight);\n      });\n    },\n    [activeCell, editor]\n  );\n\n  const updateColumnWidth = useCallback(\n    (newWidth: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableColumnIndex =\n          $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        for (let r = 0; r < tableRows.length; r++) {\n          const tableRow = tableRows[r];\n\n          if (!$isTableRowNode(tableRow)) {\n            throw new Error('Expected table row');\n          }\n\n          const tableCells = tableRow.getChildren();\n\n          if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n            throw new Error('Expected table cell to be inside of table row.');\n          }\n\n          const tableCell = tableCells[tableColumnIndex];\n\n          if (!$isTableCellNode(tableCell)) {\n            throw new Error('Expected table cell');\n          }\n\n          tableCell.setWidth(newWidth);\n        }\n      });\n    },\n    [activeCell, editor]\n  );\n\n  const toggleResize = useCallback(\n    (direction) => (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      if (draggingDirection === direction && mouseStartPosRef.current) {\n        const { x, y } = mouseStartPosRef.current;\n\n        if (!activeCell) {\n          return;\n        }\n\n        const { height, width } = activeCell.elem.getBoundingClientRect();\n\n        if (isHeightChanging(direction)) {\n          const heightChange = Math.abs(event.clientY - y);\n\n          const isShrinking = direction === 'bottom' && y > event.clientY;\n\n          updateRowHeight(\n            Math.max(\n              isShrinking ? height - heightChange : heightChange + height,\n              MIN_ROW_HEIGHT\n            )\n          );\n        } else {\n          const widthChange = Math.abs(event.clientX - x);\n\n          const isShrinking = direction === 'right' && x > event.clientX;\n\n          updateColumnWidth(\n            Math.max(\n              isShrinking ? width - widthChange : widthChange + width,\n              MIN_COLUMN_WIDTH\n            )\n          );\n        }\n\n        resetState();\n      } else {\n        mouseStartPosRef.current = {\n          x: event.clientX,\n          y: event.clientY,\n        };\n        updateMouseCurrentPos(mouseStartPosRef.current);\n        updateDraggingDirection(direction);\n      }\n    },\n    [\n      activeCell,\n      draggingDirection,\n      resetState,\n      updateColumnWidth,\n      updateRowHeight,\n    ]\n  );\n\n  const getResizers = useCallback(() => {\n    if (activeCell) {\n      const { height, width, top, left } =\n        activeCell.elem.getBoundingClientRect();\n\n      const styles = {\n        bottom: {\n          backgroundColor: 'none',\n          cursor: 'row-resize',\n          height: '10px',\n          left: `${window.pageXOffset + left}px`,\n          top: `${window.pageYOffset + top + height}px`,\n          width: `${width}px`,\n        },\n        right: {\n          backgroundColor: 'none',\n          cursor: 'col-resize',\n          height: `${height}px`,\n          left: `${window.pageXOffset + left + width}px`,\n          top: `${window.pageYOffset + top}px`,\n          width: '10px',\n        },\n      };\n\n      const tableRect = tableRectRef.current;\n\n      if (draggingDirection && mouseCurrentPos && tableRect) {\n        if (isHeightChanging(draggingDirection)) {\n          styles[draggingDirection].left = `${\n            window.pageXOffset + tableRect.left\n          }px`;\n          styles[draggingDirection].top = `${\n            window.pageYOffset + mouseCurrentPos.y\n          }px`;\n          styles[draggingDirection].height = '3px';\n          styles[draggingDirection].width = `${tableRect.width}px`;\n        } else {\n          styles[draggingDirection].top = `${\n            window.pageYOffset + tableRect.top\n          }px`;\n          styles[draggingDirection].left = `${\n            window.pageXOffset + mouseCurrentPos.x\n          }px`;\n          styles[draggingDirection].width = '3px';\n          styles[draggingDirection].height = `${tableRect.height}px`;\n        }\n\n        styles[draggingDirection].backgroundColor = '#adf';\n      }\n\n      return styles;\n    }\n\n    return {\n      bottom: null,\n      left: null,\n      right: null,\n      top: null,\n    };\n  }, [activeCell, draggingDirection, mouseCurrentPos]);\n\n  const resizerStyles = getResizers();\n\n  return (\n    <div ref={resizerRef}>\n      {activeCell != null && !isSelectingGrid && (\n        <>\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.right}\n            onMouseDown={toggleResize('right')}\n            onMouseUp={toggleResize('right')}\n          />\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.bottom}\n            onMouseDown={toggleResize('bottom')}\n            onMouseUp={toggleResize('bottom')}\n          />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableCellResizerPlugin(): ReactPortal {\n  const [editor] = useLexicalComposerContext();\n\n  return useMemo(\n    () => createPortal(<TableCellResizer editor={editor} />, document.body),\n    [editor]\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $deleteTableColumn,\n  $getElementGridForTableNode,\n  $getTableCellNodeFromLexicalNode,\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $insertTableColumn,\n  $insertTableRow,\n  $isTableCellNode,\n  $isTableRowNode,\n  $removeTableRowAtIndex,\n  getTableSelectionFromTableElement,\n  HTMLTableElementWithWithTableSelectionState,\n  TableCellHeaderStates,\n  TableCellNode,\n} from '@lexical/table';\nimport { TFunction } from 'i18next';\nimport {\n  $getSelection,\n  DEPRECATED_$isGridSelection,\n  $isRangeSelection,\n  $setSelection,\n} from 'lexical';\nimport * as React from 'react';\nimport { ReactPortal, useCallback, useEffect, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useTranslation } from 'react-i18next';\n\ntype TableCellActionMenuProps = Readonly<{\n  contextRef: { current: null | HTMLElement };\n  onClose: () => void;\n  setIsMenuOpen: (isOpen: boolean) => void;\n  tableCellNode: TableCellNode;\n  t: TFunction;\n}>;\n\nfunction TableActionMenu({\n  onClose,\n  tableCellNode: _tableCellNode,\n  setIsMenuOpen,\n  contextRef,\n  t,\n}: TableCellActionMenuProps) {\n  const [editor] = useLexicalComposerContext();\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const [tableCellNode, updateTableCellNode] = useState(_tableCellNode);\n  const [selectionCounts, updateSelectionCounts] = useState({\n    columns: 1,\n    rows: 1,\n  });\n\n  useEffect(() => {\n    return editor.registerMutationListener(TableCellNode, (nodeMutations) => {\n      const nodeUpdated =\n        nodeMutations.get(tableCellNode.getKey()) === 'updated';\n\n      if (nodeUpdated) {\n        editor.getEditorState().read(() => {\n          updateTableCellNode(tableCellNode.getLatest());\n        });\n      }\n    });\n  }, [editor, tableCellNode]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n      if (DEPRECATED_$isGridSelection(selection)) {\n        const selectionShape = selection.getShape();\n\n        updateSelectionCounts({\n          columns: selectionShape.toX - selectionShape.fromX + 1,\n          rows: selectionShape.toY - selectionShape.fromY + 1,\n        });\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    const menuButtonElement = contextRef.current;\n    const dropDownElement = dropDownRef.current;\n\n    if (menuButtonElement != null && dropDownElement != null) {\n      const menuButtonRect = menuButtonElement.getBoundingClientRect();\n\n      dropDownElement.style.opacity = '1';\n\n      dropDownElement.style.left = `${\n        menuButtonRect.left + menuButtonRect.width + window.pageXOffset + 5\n      }px`;\n\n      dropDownElement.style.top = `${\n        menuButtonRect.top + window.pageYOffset\n      }px`;\n    }\n  }, [contextRef, dropDownRef]);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (\n        dropDownRef.current != null &&\n        contextRef.current != null &&\n        !dropDownRef.current.contains(event.target as Node) &&\n        !contextRef.current.contains(event.target as Node)\n      ) {\n        setIsMenuOpen(false);\n      }\n    }\n\n    window.addEventListener('click', handleClickOutside);\n\n    return () => window.removeEventListener('click', handleClickOutside);\n  }, [setIsMenuOpen, contextRef]);\n\n  const clearTableSelection = useCallback(() => {\n    editor.update(() => {\n      if (tableCellNode.isAttached()) {\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n        const tableElement = editor.getElementByKey(\n          tableNode.getKey()\n        ) as HTMLTableElementWithWithTableSelectionState;\n\n        if (!tableElement) {\n          throw new Error('Expected to find tableElement in DOM');\n        }\n\n        const tableSelection = getTableSelectionFromTableElement(tableElement);\n        if (tableSelection !== null) {\n          tableSelection.clearHighlight();\n        }\n\n        tableNode.markDirty();\n        updateTableCellNode(tableCellNode.getLatest());\n      }\n\n      $setSelection(null);\n    });\n  }, [editor, tableCellNode]);\n\n  const insertTableRowAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableRowIndex;\n\n        if (DEPRECATED_$isGridSelection(selection)) {\n          const selectionShape = selection.getShape();\n          tableRowIndex = shouldInsertAfter\n            ? selectionShape.toY\n            : selectionShape.fromY;\n        } else {\n          tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n        }\n\n        const grid = $getElementGridForTableNode(editor, tableNode);\n\n        $insertTableRow(\n          tableNode,\n          tableRowIndex,\n          shouldInsertAfter,\n          selectionCounts.rows,\n          grid\n        );\n\n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [editor, tableCellNode, selectionCounts.rows, clearTableSelection, onClose]\n  );\n\n  const insertTableColumnAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableColumnIndex;\n\n        if (DEPRECATED_$isGridSelection(selection)) {\n          const selectionShape = selection.getShape();\n          tableColumnIndex = shouldInsertAfter\n            ? selectionShape.toX\n            : selectionShape.fromX;\n        } else {\n          tableColumnIndex =\n            $getTableColumnIndexFromTableCellNode(tableCellNode);\n        }\n\n        const grid = $getElementGridForTableNode(editor, tableNode);\n\n        $insertTableColumn(\n          tableNode,\n          tableColumnIndex,\n          shouldInsertAfter,\n          selectionCounts.columns,\n          grid\n        );\n\n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [\n      editor,\n      tableCellNode,\n      selectionCounts.columns,\n      clearTableSelection,\n      onClose,\n    ]\n  );\n\n  const deleteTableRowAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      $removeTableRowAtIndex(tableNode, tableRowIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      tableNode.remove();\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableColumnAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      $deleteTableColumn(tableNode, tableColumnIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableRowIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n        throw new Error('Expected table cell to be inside of table row.');\n      }\n\n      const tableRow = tableRows[tableRowIndex];\n\n      if (!$isTableRowNode(tableRow)) {\n        throw new Error('Expected table row');\n      }\n\n      tableRow.getChildren().forEach((tableCell) => {\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.ROW);\n      });\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableColumnIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      for (let r = 0; r < tableRows.length; r++) {\n        const tableRow = tableRows[r];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        const tableCells = tableRow.getChildren();\n\n        if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableCell = tableCells[tableColumnIndex];\n\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.COLUMN);\n      }\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  return createPortal(\n    // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n    <div\n      className=\"verbum-dropdown\"\n      ref={dropDownRef}\n      onClick={(e) => {\n        e.stopPropagation();\n      }}\n    >\n      <button\n        className=\"verbum-item\"\n        onClick={() => insertTableRowAtSelection(false)}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.rows === 1\n            ? t('toolbar:tableActionMenuPlugin.row')\n            : `${selectionCounts.rows} ${t(\n                'toolbar:tableActionMenuPlugin.rows'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.above')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => insertTableRowAtSelection(true)}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.rows === 1\n            ? t('toolbar:tableActionMenuPlugin.row')\n            : `${selectionCounts.rows} ${t(\n                'toolbar:tableActionMenuPlugin.rows'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.below')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"verbum-item\"\n        onClick={() => insertTableColumnAtSelection(false)}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.columns === 1\n            ? t('toolbar:tableActionMenuPlugin.column')\n            : `${selectionCounts.columns} ${t(\n                'toolbar:tableActionMenuPlugin.columns'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.left')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => insertTableColumnAtSelection(true)}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.columns === 1\n            ? t('toolbar:tableActionMenuPlugin.column')\n            : `${selectionCounts.columns} ${t(\n                'toolbar:tableActionMenuPlugin.columns'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.right')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"verbum-item\"\n        onClick={() => deleteTableColumnAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_column')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => deleteTableRowAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_row')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => deleteTableAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_table')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"verbum-item\"\n        onClick={() => toggleTableRowIsHeader()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.ROW) ===\n          TableCellHeaderStates.ROW\n            ? t('action:Remove')\n            : t('action:Add')}{' '}\n          {t('toolbar:tableActionMenuPlugin.row_header')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => toggleTableColumnIsHeader()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.COLUMN) ===\n          TableCellHeaderStates.COLUMN\n            ? t('action:Remove')\n            : t('action:Add ')}{' '}\n          {t('toolbar:tableActionMenuPlugin.column_header')}\n        </span>\n      </button>\n    </div>,\n    document.body\n  );\n}\n\nfunction TableCellActionMenuContainer(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  const menuButtonRef = useRef(null);\n  const menuRootRef = useRef(null);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n\n  const [tableCellNode, setTableMenuCellNode] = useState<TableCellNode | null>(\n    null\n  );\n  const { t } = useTranslation(['toolbar', 'action']);\n\n  const moveMenu = useCallback(() => {\n    const menu = menuButtonRef.current;\n    const selection = $getSelection();\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (selection == null || menu == null) {\n      setTableMenuCellNode(null);\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n\n    if (\n      $isRangeSelection(selection) &&\n      rootElement !== null &&\n      nativeSelection !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const tableCellNodeFromSelection = $getTableCellNodeFromLexicalNode(\n        selection.anchor.getNode()\n      );\n\n      if (tableCellNodeFromSelection == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      const tableCellParentNodeDOM = editor.getElementByKey(\n        tableCellNodeFromSelection.getKey()\n      );\n\n      if (tableCellParentNodeDOM == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      setTableMenuCellNode(tableCellNodeFromSelection);\n    } else if (!activeElement) {\n      setTableMenuCellNode(null);\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        moveMenu();\n      });\n    });\n  });\n\n  useEffect(() => {\n    const menuButtonDOM = menuButtonRef.current as HTMLButtonElement | null;\n\n    if (menuButtonDOM != null && tableCellNode != null) {\n      const tableCellNodeDOM = editor.getElementByKey(tableCellNode.getKey());\n\n      if (tableCellNodeDOM != null) {\n        const tableCellRect = tableCellNodeDOM.getBoundingClientRect();\n        const menuRect = menuButtonDOM.getBoundingClientRect();\n\n        menuButtonDOM.style.opacity = '1';\n\n        menuButtonDOM.style.left = `${\n          tableCellRect.left +\n          window.pageXOffset -\n          menuRect.width +\n          tableCellRect.width -\n          10\n        }px`;\n\n        menuButtonDOM.style.top = `${\n          tableCellRect.top + window.pageYOffset + 5\n        }px`;\n      } else {\n        menuButtonDOM.style.opacity = '0';\n      }\n    }\n  }, [menuButtonRef, tableCellNode, editor]);\n\n  const prevTableCellDOM = useRef(tableCellNode);\n\n  useEffect(() => {\n    if (prevTableCellDOM.current !== tableCellNode) {\n      setIsMenuOpen(false);\n    }\n\n    prevTableCellDOM.current = tableCellNode;\n  }, [prevTableCellDOM, tableCellNode]);\n\n  return (\n    <div className=\"verbum-table-cell-action-button-container\" ref={menuButtonRef}>\n      {tableCellNode != null && (\n        <>\n          <button\n            className=\"verbum-table-cell-action-button chevron-down\"\n            onClick={(e) => {\n              e.stopPropagation();\n              setIsMenuOpen(!isMenuOpen);\n            }}\n            ref={menuRootRef}\n            type=\"button\"\n          >\n            <i className=\"verbum-chevron-down\" />\n          </button>\n          {isMenuOpen && (\n            <TableActionMenu\n              contextRef={menuRootRef}\n              setIsMenuOpen={setIsMenuOpen}\n              onClose={() => setIsMenuOpen(false)}\n              tableCellNode={tableCellNode}\n              t={t}\n            />\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableActionMenuPlugin(): ReactPortal {\n  return createPortal(<TableCellActionMenuContainer />, document.body);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createHorizontalRuleNode,\n  INSERT_HORIZONTAL_RULE_COMMAND,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nexport default function HorizontalRulePlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INSERT_HORIZONTAL_RULE_COMMAND,\n      (type) => {\n        const selection = $getSelection();\n\n        if (!$isRangeSelection(selection)) {\n          return false;\n        }\n\n        const focusNode = selection.focus.getNode();\n\n        if (focusNode !== null) {\n          const horizontalRuleNode = $createHorizontalRuleNode();\n          selection.insertParagraph();\n          selection.focus\n            .getNode()\n            .getTopLevelElementOrThrow()\n            .insertBefore(horizontalRuleNode);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","import React, { useState, useCallback, useContext } from 'react';\nimport { $getRoot, LexicalEditor, RangeSelection } from 'lexical';\nimport DropDown from '../../../ui/DropDown';\nimport Button from '../../../ui/Button';\nimport TextInput from '../../../ui/TextInput';\nimport FileInput from '../../../ui/FileInput';\nimport ImagesPlugin, {\n  INSERT_IMAGE_COMMAND,\n  InsertImagePayload,\n} from '../../ImagesPlugin';\nimport { INSERT_TABLE_COMMAND } from '@lexical/table';\nimport { INSERT_HORIZONTAL_RULE_COMMAND } from '@lexical/react/LexicalHorizontalRuleNode';\nimport PollPlugin, { INSERT_POLL_COMMAND } from '../../PollPlugin';\nimport TwitterPlugin, { INSERT_TWEET_COMMAND } from '../../TwitterPlugin';\nimport YouTubePlugin, { INSERT_YOUTUBE_COMMAND } from '../../YouTubePlugin';\nimport { $createStickyNode } from '../../../nodes/StickyNode';\nimport useModal from '../../../hooks/useModal';\nimport TableCellResizer from '../../TableCellResizer';\nimport { TablePlugin } from '@lexical/react/LexicalTablePlugin';\nimport TableCellActionMenuPlugin from '../../TableActionMenuPlugin';\nimport HorizontalRulePlugin from '../../HorizontalRulePlugin';\nimport EditorContext from '../../../context/EditorContext';\n\n// Taken from https://stackoverflow.com/a/9102270\nconst YOUTUBE_ID_PARSER =\n  /^.*(youtu\\.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/;\n\nconst parseYouTubeVideoID = (url: string) => {\n  const urlMatches = url.match(YOUTUBE_ID_PARSER);\n\n  return urlMatches?.[2].length === 11 ? urlMatches[2] : null;\n};\n\n//#region Inserting different modules\nfunction InsertImageDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [mode, setMode] = useState<null | 'url' | 'file'>(null);\n\n  const onClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n    onClose();\n  };\n\n  return (\n    <>\n      {!mode && (\n        <div className=\"ToolbarPlugin__dialogButtonsList\">\n          <Button\n            data-test-id=\"image-modal-option-url\"\n            onClick={() => setMode('url')}\n          >\n            URL\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-file\"\n            onClick={() => setMode('file')}\n          >\n            File\n          </Button>\n        </div>\n      )}\n      {mode === 'url' && <InsertImageUriDialogBody onClick={onClick} />}\n      {mode === 'file' && <InsertImageUploadedDialogBody onClick={onClick} />}\n    </>\n  );\n}\n\nfunction InsertTableDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [rows, setRows] = useState('5');\n  const [columns, setColumns] = useState('5');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_TABLE_COMMAND, { columns, rows });\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"No of rows\" onChange={setRows} value={rows} />\n      <TextInput label=\"No of columns\" onChange={setColumns} value={columns} />\n      <div\n        className=\"ToolbarPlugin__dialogActions\"\n        data-test-id=\"table-model-confirm-insert\"\n      >\n        <Button onClick={onClick}>Confirm</Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertPollDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [question, setQuestion] = useState('');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_POLL_COMMAND, question);\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"Question\" onChange={setQuestion} value={question} />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button disabled={question.trim() === ''} onClick={onClick}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nconst VALID_TWITTER_URL = /twitter.com\\/[0-9a-zA-Z]{1,20}\\/status\\/([0-9]*)/g;\n\nfunction InsertTweetDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [text, setText] = useState('');\n\n  const onClick = () => {\n    const tweetID = text.split('status/')?.[1]?.split('?')?.[0];\n    activeEditor.dispatchCommand(INSERT_TWEET_COMMAND, tweetID);\n    onClose();\n  };\n\n  const isDisabled = text === '' || !text.match(VALID_TWITTER_URL);\n\n  return (\n    <>\n      <TextInput\n        label=\"Tweet URL\"\n        placeholder=\"i.e. https://twitter.com/jack/status/20\"\n        onChange={setText}\n        value={text}\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button disabled={isDisabled} onClick={onClick}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageUriDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  return (\n    <>\n      <TextInput\n        label=\"Image URL\"\n        placeholder=\"i.e. https://source.unsplash.com/random\"\n        onChange={setSrc}\n        value={src}\n        data-test-id=\"image-modal-url-input\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Random unsplash image\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-confirm-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageUploadedDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  const loadImage = (files: FileList) => {\n    const reader = new FileReader();\n    reader.onload = function () {\n      if (typeof reader.result === 'string') {\n        setSrc(reader.result);\n      }\n      return '';\n    };\n    reader.readAsDataURL(files[0]);\n  };\n\n  return (\n    <>\n      <FileInput\n        label=\"Image Upload\"\n        onChange={loadImage}\n        accept=\"image/*\"\n        data-test-id=\"image-modal-file-upload\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Descriptive alternative text\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-file-upload-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertYouTubeDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [text, setText] = useState('');\n\n  const onClick = () => {\n    const videoID = parseYouTubeVideoID(text);\n    if (videoID) {\n      activeEditor.dispatchCommand(INSERT_YOUTUBE_COMMAND, videoID);\n    }\n    onClose();\n  };\n\n  const isDisabled = text === '' || !parseYouTubeVideoID(text);\n\n  return (\n    <>\n      <TextInput\n        data-test-id=\"youtube-embed-modal-url\"\n        label=\"YouTube URL\"\n        placeholder=\"i.e. https://www.youtube.com/watch?v=jNQXAC9IVRw\"\n        onChange={setText}\n        value={text}\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"youtube-embed-modal-submit-btn\"\n          disabled={isDisabled}\n          onClick={onClick}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\n//#endregion Inserting different modules\n\nexport interface IInsertDropdownProps {\n  enableTable?: boolean;\n  enableYoutube?: boolean;\n  enableTwitter?: boolean;\n  enablePoll?: boolean;\n  enableImage?: { enable: boolean; maxWidth: number };\n  enableEquations?: boolean;\n  enableExcalidraw?: boolean;\n  enableHorizontalRule?: boolean;\n  enableStickyNote?: boolean;\n}\n\nconst InsertDropdown: React.FC<IInsertDropdownProps> = ({\n  enableTable = true,\n  enableImage = { enable: true, maxWidth: 1000 },\n  enableYoutube = false,\n  enableTwitter = false,\n  enablePoll = false,\n  enableHorizontalRule = false,\n  enableStickyNote = false,\n}: IInsertDropdownProps) => {\n  const { initialEditor, activeEditor } = useContext(EditorContext);\n  const [modal, showModal] = useModal();\n\n  return (\n    <div>\n      {enableTable && (\n        <>\n          <TablePlugin />\n          <TableCellActionMenuPlugin />\n          <TableCellResizer />\n        </>\n      )}\n      {enableYoutube && <YouTubePlugin />}\n      {enableTwitter && <TwitterPlugin />}\n      {enablePoll && <PollPlugin />}\n      {enableImage.enable && <ImagesPlugin maxWidth={enableImage.maxWidth} />}\n      {enableHorizontalRule && <HorizontalRulePlugin />}\n\n      <DropDown\n        buttonClassName=\"verbum-toolbar-item spaced\"\n        buttonLabel=\"Insert\"\n        buttonAriaLabel=\"Insert specialized editor node\"\n        buttonIconClassName=\"verbum-icon verbum-plus\"\n      >\n        {enableHorizontalRule && (\n          <button\n            onClick={() => {\n              activeEditor.dispatchCommand(\n                INSERT_HORIZONTAL_RULE_COMMAND,\n                undefined\n              );\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-horizontal-rule\" />\n            <span className=\"verbum-text\">Horizontal Rule</span>\n          </button>\n        )}\n        {enableImage.enable && (\n          <button\n            onClick={() => {\n              showModal('Insert Image', (onClose) => (\n                <InsertImageDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-image\" />\n            <span className=\"verbum-text\">Image</span>\n          </button>\n        )}\n        {enableTable && (\n          <div>\n            <button\n              onClick={() => {\n                showModal('Insert Table', (onClose) => (\n                  <InsertTableDialog\n                    activeEditor={activeEditor}\n                    onClose={onClose}\n                  />\n                ));\n              }}\n              className=\"verbum-item\"\n              type=\"button\"\n            >\n              <i className=\"verbum-icon verbum-table\" />\n              <span className=\"verbum-text\">Table</span>\n            </button>\n          </div>\n        )}\n        {enablePoll && (\n          <button\n            onClick={() => {\n              showModal('Insert Poll', (onClose) => (\n                <InsertPollDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-poll\" />\n            <span className=\"verbum-text\">Poll</span>\n          </button>\n        )}\n        {enableTwitter && (\n          <button\n            onClick={() => {\n              showModal('Insert Tweet', (onClose) => (\n                <InsertTweetDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-tweet\" />\n            <span className=\"verbum-text\">Tweet</span>\n          </button>\n        )}\n        {enableYoutube && (\n          <button\n            onClick={() => {\n              showModal('Insert YouTube Video', (onClose) => (\n                <InsertYouTubeDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-youtube\" />\n            <span className=\"verbum-text\">YouTube Video</span>\n          </button>\n        )}\n        {enableStickyNote && (\n          <button\n            onClick={() => {\n              initialEditor.update(() => {\n                const root = $getRoot();\n                const stickyNode = $createStickyNode(0, 0);\n                root.append(stickyNode);\n              });\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-sticky\" />\n            <span className=\"verbum-text\">Sticky Note</span>\n          </button>\n        )}\n      </DropDown>\n      {modal}\n    </div>\n  );\n};\n\nexport default InsertDropdown;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nimport { CAN_USE_DOM } from './canUseDOM';\n\nconst documentMode =\n  // @ts-ignore\n  CAN_USE_DOM && 'documentMode' in document ? document.documentMode : null;\n\nexport const IS_APPLE: boolean =\n  CAN_USE_DOM && /Mac|iPod|iPhone|iPad/.test(navigator.platform);\n\nexport const IS_FIREFOX: boolean =\n  CAN_USE_DOM && /^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);\n\nexport const CAN_USE_BEFORE_INPUT: boolean =\n  CAN_USE_DOM && 'InputEvent' in window && !documentMode\n    ? 'getTargetRanges' in new window.InputEvent('input')\n    : false;\n\nexport const IS_SAFARI: boolean =\n  CAN_USE_DOM && /Version\\/[\\d\\.]+.*Safari/.test(navigator.userAgent);\n\nexport const IS_IOS: boolean =\n  CAN_USE_DOM &&\n  /iPad|iPhone|iPod/.test(navigator.userAgent) &&\n  !(window as any).MSStream;\n\n// Keep these in case we need to use them in the future.\n// export const IS_WINDOWS: boolean = CAN_USE_DOM && /Win/.test(navigator.platform);\n// export const IS_CHROME: boolean = CAN_USE_DOM && /^(?=.*Chrome).*/i.test(navigator.userAgent);\n// export const canUseTextInputEvent: boolean = CAN_USE_DOM && 'TextEvent' in window && !documentMode;\n","import * as React from 'react';\nimport { useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { UNDO_COMMAND } from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport { useTranslation } from 'react-i18next';\n\nconst UndoButton = () => {\n  const { canUndo } = useContext(ToolbarContext);\n  const { activeEditor } = useContext(EditorContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <button\n      disabled={!canUndo}\n      onClick={() => {\n        activeEditor.dispatchCommand(UNDO_COMMAND, undefined);\n      }}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:undoButton.Title')} (Z)`\n          : `${t('toolbar:undoButton.Title')} (Ctrl+Z)`\n      }\n      className=\"verbum-toolbar-item spaced\"\n      aria-label={t('toolbar:undoButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-undo\" />\n    </button>\n  );\n};\n\nexport default UndoButton;\n","import * as React from 'react';\nimport { useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { REDO_COMMAND } from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport { useTranslation } from 'react-i18next';\n\nconst RedoButton = () => {\n  const { canRedo } = useContext(ToolbarContext);\n  const { activeEditor } = useContext(EditorContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <button\n      disabled={!canRedo}\n      onClick={() => {\n        activeEditor.dispatchCommand(REDO_COMMAND, undefined);\n      }}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:redoButton.Title')} (Y)`\n          : `${t('toolbar:redoButton.Title')} (Ctrl+Y)`\n      }\n      className=\"verbum-toolbar-item\"\n      aria-label={t('toolbar:redoButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-redo\" />\n    </button>\n  );\n};\n\nexport default RedoButton;\n","import React from 'react';\n\nconst Select = ({\n  onChange,\n  className,\n  options,\n  value,\n}: {\n  className: string;\n  onChange: (event: { target: { value: string } }) => void;\n  options: [string, string][];\n  value: string;\n}): JSX.Element => {\n  return (\n    <select className={className} onChange={onChange} value={value}>\n      {options.map(([option, text]) => (\n        <option key={option} value={option}>\n          {text}\n        </option>\n      ))}\n    </select>\n  );\n};\n\nexport default Select;\n","import { $isCodeNode } from '@lexical/code';\nimport { $getNodeByKey } from 'lexical';\nimport React, { useCallback, useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst CODE_LANGUAGE_OPTIONS: [string, string][] = [\n  ['', '- Select language -'],\n  ['c', 'C'],\n  ['clike', 'C-like'],\n  ['css', 'CSS'],\n  ['html', 'HTML'],\n  ['js', 'JavaScript'],\n  ['markdown', 'Markdown'],\n  ['objc', 'Objective-C'],\n  ['plain', 'Plain Text'],\n  ['py', 'Python'],\n  ['rust', 'Rust'],\n  ['sql', 'SQL'],\n  ['swift', 'Swift'],\n  ['xml', 'XML'],\n];\n\nconst CodeLanguageDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { selectedElementKey, codeLanguage } = useContext(ToolbarContext);\n  const onCodeLanguageSelect = useCallback(\n    (e) => {\n      activeEditor.update(() => {\n        if (selectedElementKey !== null) {\n          const node = $getNodeByKey(selectedElementKey);\n          if ($isCodeNode(node)) {\n            console.log(e.target.value);\n            node.setLanguage(e.target.value);\n          }\n        }\n      });\n    },\n    [activeEditor, selectedElementKey]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"verbum-toolbar-item code-language\"\n        onChange={onCodeLanguageSelect}\n        options={CODE_LANGUAGE_OPTIONS}\n        value={codeLanguage}\n      />\n      <i className=\"verbum-chevron-down inside\" />\n    </>\n  );\n};\n\nexport default CodeLanguageDropdown;\n","import { $createCodeNode } from '@lexical/code';\nimport {\n  INSERT_CHECK_LIST_COMMAND,\n  INSERT_ORDERED_LIST_COMMAND,\n  INSERT_UNORDERED_LIST_COMMAND,\n  REMOVE_LIST_COMMAND,\n} from '@lexical/list';\nimport { $createHeadingNode, $createQuoteNode } from '@lexical/rich-text';\nimport { $wrapNodes } from '@lexical/selection';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  LexicalEditor,\n} from 'lexical';\nimport React, { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport DropDown from '../../../ui/DropDown';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst BlockFormatDropdown = () => {\n  const { initialEditor } = useContext(EditorContext);\n  const { blockType } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  const formatParagraph = () => {\n    if (blockType !== 'paragraph') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createParagraphNode());\n        }\n      });\n    }\n  };\n\n  const formatHeading = (headingSize) => {\n    if (blockType !== headingSize) {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createHeadingNode(headingSize));\n        }\n      });\n    }\n  };\n\n  const formatBulletList = () => {\n    if (blockType !== 'bullet') {\n      initialEditor.dispatchCommand(INSERT_UNORDERED_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatCheckList = () => {\n    if (blockType !== 'check') {\n      initialEditor.dispatchCommand(INSERT_CHECK_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatNumberedList = () => {\n    if (blockType !== 'number') {\n      initialEditor.dispatchCommand(INSERT_ORDERED_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatQuote = () => {\n    if (blockType !== 'quote') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createQuoteNode());\n        }\n      });\n    }\n  };\n\n  const formatCode = () => {\n    if (blockType !== 'code') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          if (selection.isCollapsed()) {\n            $wrapNodes(selection, () => $createCodeNode());\n          } else {\n            const textContent = selection.getTextContent();\n            const codeNode = $createCodeNode();\n            selection.removeText();\n            selection.insertNodes([codeNode]);\n            selection.insertRawText(textContent);\n          }\n        }\n      });\n    }\n  };\n\n  return (\n    <DropDown\n      buttonLabel={t(`blockFormatDropdown.${blockType}`)}\n      buttonAriaLabel={t('toolbar:blockFormatDropdown.Description')}\n      buttonClassName=\"verbum-toolbar-item verbum-block-controls\"\n      buttonIconClassName={'icon block-type ' + blockType}\n    >\n      <button className=\"verbum-item\" onClick={formatParagraph} type=\"button\">\n        <span className=\"verbum-icon verbum-paragraph\" />\n        <span className=\"verbum-text\">{t('toolbar:blockFormatDropdown.paragraph')}</span>\n        {blockType === 'paragraph' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => formatHeading('h1')}\n        type=\"button\"\n      >\n        <span className=\"verbum-icon verbum-h1\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.h1')}\n        </span>\n        {blockType === 'h1' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => formatHeading('h2')}\n        type=\"button\"\n      >\n        <span className=\"verbum-icon verbum-h2\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.h2')}\n        </span>\n        {blockType === 'h2' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => formatHeading('h3')}\n        type=\"button\"\n      >\n        <span className=\"verbum-icon verbum-h3\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.h3')}\n        </span>\n        {blockType === 'h3' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatBulletList} type=\"button\">\n        <span className=\"verbum-icon verbum-bullet-list\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.bullet')}\n        </span>\n        {blockType === 'bullet' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatNumberedList} type=\"button\">\n        <span className=\"verbum-icon verbum-numbered-list\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.number')}\n        </span>\n        {blockType === 'number' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatCheckList} type=\"button\">\n        <span className=\"verbum-icon verbum-check-list\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.check')}\n        </span>\n        {blockType === 'check' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatQuote} type=\"button\">\n        <span className=\"verbum-icon verbum-quote\" />\n        <span className=\"verbum-text\">{t('toolbar:blockFormatDropdown.quote')}</span>\n        {blockType === 'quote' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatCode} type=\"button\">\n        <span className=\"verbum-icon verbum-code\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.code')}\n        </span>\n        {blockType === 'code' && <span className=\"active\" />}\n      </button>\n    </DropDown>\n  );\n};\n\nexport default BlockFormatDropdown;\n","import React from 'react';\n\nexport default function Divider(): JSX.Element {\n  return <div className=\"divider\" />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {$isCodeNode} from '@lexical/code';\nimport {$isLinkNode, TOGGLE_LINK_COMMAND} from '@lexical/link';\nimport {$isListNode, ListNode} from '@lexical/list';\nimport {$isHeadingNode} from '@lexical/rich-text';\nimport {$getSelectionStyleValueForProperty, $isParentElementRTL, $patchStyleText,} from '@lexical/selection';\nimport {$getNearestNodeOfType, mergeRegister} from '@lexical/utils';\nimport {\n    $getSelection,\n    $isRangeSelection,\n    CAN_REDO_COMMAND,\n    CAN_UNDO_COMMAND,\n    COMMAND_PRIORITY_CRITICAL,\n    SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {useCallback, useContext, useEffect, useState} from 'react';\nimport useChild from 'use-child';\nimport {getSelectedNode} from '../../utils/node.util';\nimport EditorContext from '../../context/EditorContext';\nimport ToolbarContext from '../../context/ToolbarContext';\nimport AlignDropdown from './components/AlignDropdown';\nimport InsertDropdown from './components/InsertDropdown';\nimport './ToolbarPlugin.css';\nimport UndoButton from './components/UndoButton';\nimport RedoButton from './components/RedoButton';\nimport CodeLanguageDropdown from './components/CodeLanguageDropdown';\nimport BlockFormatDropdown from './components/BlockFormatDropdown';\nimport Divider from '../../ui/Divider';\n\nconst supportedBlockTypes = new Set([\n    'paragraph',\n    'quote',\n    'code',\n    'h1',\n    'h2',\n    'h3',\n    'bullet',\n    'number',\n    'check',\n]);\n\nconst CODE_LANGUAGE_MAP = {\n    javascript: 'js',\n    md: 'markdown',\n    plaintext: 'plain',\n    python: 'py',\n    text: 'plain',\n};\n\ninterface IToolbarProps {\n    children?: React.ReactElement | React.ReactElement[];\n    defaultFontSize?: string /** The default selected font size in the toolbar */\n    ;\n    defaultFontColor?: string /** The default selected font color in the toolbar */\n    ;\n    defaultBgColor?: string /** The default selected background color in the toolbar */\n    ;\n    defaultFontFamily?: string /** The default selected font family in the toolbar */\n    ;\n}\n\nconst ToolbarPlugin = ({\n                           children,\n                           defaultFontSize = '15px',\n                           defaultFontColor = '#000',\n                           defaultBgColor = '#fff',\n                           defaultFontFamily = 'Arial',\n                       }: IToolbarProps) => {\n    const [insertExists, InsertComponent] = useChild(children, InsertDropdown);\n    const [alignExists, AlignComponent] = useChild(children, AlignDropdown);\n\n    const {initialEditor, activeEditor, setActiveEditor} =\n        useContext(EditorContext);\n    const [blockType, setBlockType] = useState('paragraph');\n    const [selectedElementKey, setSelectedElementKey] = useState(null);\n    const [fontSize, setFontSize] = useState<string>(defaultFontSize);\n    const [fontColor, setFontColor] = useState<string>(defaultFontColor);\n    const [bgColor, setBgColor] = useState<string>(defaultBgColor);\n    const [fontFamily, setFontFamily] = useState<string>(defaultFontFamily);\n    const [isLink, setIsLink] = useState(false);\n    const [isBold, setIsBold] = useState(false);\n    const [isItalic, setIsItalic] = useState(false);\n    const [isUnderline, setIsUnderline] = useState(false);\n    const [isStrikethrough, setIsStrikethrough] = useState(false);\n    const [isSubscript, setIsSubscript] = useState(false);\n    const [isSuperscript, setIsSuperscript] = useState(false);\n    const [isCode, setIsCode] = useState(false);\n    const [canUndo, setCanUndo] = useState(false);\n    const [canRedo, setCanRedo] = useState(false);\n    const [isRTL, setIsRTL] = useState(false);\n    const [codeLanguage, setCodeLanguage] = useState<string>('');\n\n    const updateToolbar = useCallback(() => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n            const anchorNode = selection.anchor.getNode();\n            const element =\n                anchorNode.getKey() === 'root'\n                    ? anchorNode\n                    : anchorNode.getTopLevelElementOrThrow();\n            const elementKey = element.getKey();\n            const elementDOM = activeEditor.getElementByKey(elementKey);\n\n            // Update text format\n            setIsBold(selection.hasFormat('bold'));\n            setIsItalic(selection.hasFormat('italic'));\n            setIsUnderline(selection.hasFormat('underline'));\n            setIsStrikethrough(selection.hasFormat('strikethrough'));\n            setIsSubscript(selection.hasFormat('subscript'));\n            setIsSuperscript(selection.hasFormat('superscript'));\n            setIsCode(selection.hasFormat('code'));\n            setIsRTL($isParentElementRTL(selection));\n\n            // Update links\n            const node = getSelectedNode(selection);\n            const parent = node.getParent();\n            if ($isLinkNode(parent) || $isLinkNode(node)) {\n                setIsLink(true);\n            } else {\n                setIsLink(false);\n            }\n\n            if (elementDOM !== null) {\n                setSelectedElementKey(elementKey);\n                if ($isListNode(element)) {\n                    const parentList = $getNearestNodeOfType<ListNode>(\n                        anchorNode,\n                        ListNode\n                    );\n                    const type = parentList\n                        ? parentList.getListType()\n                        : element.getListType();\n                    setBlockType(type);\n                } else {\n                    const type = $isHeadingNode(element)\n                        ? element.getTag()\n                        : element.getType();\n                    setBlockType(type);\n                    if ($isCodeNode(element)) {\n                        const language = element.getLanguage();\n                        setCodeLanguage(\n                            language ? CODE_LANGUAGE_MAP[language] || language : ''\n                        );\n                        return;\n                    }\n                }\n            }\n            // Hande buttons\n            setFontSize(\n                $getSelectionStyleValueForProperty(\n                    selection,\n                    'font-size',\n                    defaultFontSize\n                )\n            );\n            setFontColor(\n                $getSelectionStyleValueForProperty(selection, 'color', defaultFontColor)\n            );\n            setBgColor(\n                $getSelectionStyleValueForProperty(\n                    selection,\n                    'background-color',\n                    defaultBgColor\n                )\n            );\n\n            setFontFamily(\n                $getSelectionStyleValueForProperty(\n                    selection,\n                    'font-family',\n                    defaultFontFamily\n                )\n            );\n        }\n    }, [activeEditor]);\n\n    useEffect(() => {\n        return initialEditor.registerCommand(\n            SELECTION_CHANGE_COMMAND,\n            (_payload, newEditor) => {\n                updateToolbar();\n                setActiveEditor(newEditor);\n                return false;\n            },\n            COMMAND_PRIORITY_CRITICAL\n        );\n    }, [initialEditor, updateToolbar]);\n\n    useEffect(() => {\n        return mergeRegister(\n            activeEditor.registerUpdateListener(({editorState}) => {\n                editorState.read(() => {\n                    updateToolbar();\n                });\n            }),\n            activeEditor.registerCommand<boolean>(\n                CAN_UNDO_COMMAND,\n                (payload) => {\n                    setCanUndo(payload);\n                    return false;\n                },\n                COMMAND_PRIORITY_CRITICAL\n            ),\n            activeEditor.registerCommand<boolean>(\n                CAN_REDO_COMMAND,\n                (payload) => {\n                    setCanRedo(payload);\n                    return false;\n                },\n                COMMAND_PRIORITY_CRITICAL\n            )\n        );\n    }, [activeEditor, updateToolbar]);\n\n    const applyStyleText = useCallback(\n        (styles: Record<string, string>) => {\n            activeEditor.update(() => {\n                const selection = $getSelection();\n                if ($isRangeSelection(selection)) {\n                    $patchStyleText(selection, styles);\n                }\n            });\n        },\n        [activeEditor]\n    );\n\n    const insertLink = useCallback(() => {\n        if (!isLink) {\n            initialEditor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n        } else {\n            initialEditor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n        }\n    }, [initialEditor, isLink]);\n\n    return (\n        <ToolbarContext.Provider\n            value={{\n                isRTL,\n                canUndo,\n                canRedo,\n                fontFamily,\n                fontSize,\n                fontColor,\n                bgColor,\n                isBold,\n                isItalic,\n                isUnderline,\n                isCode,\n                isLink,\n                applyStyleText,\n                insertLink,\n                isStrikethrough,\n                isSubscript,\n                isSuperscript,\n                selectedElementKey,\n                codeLanguage,\n                blockType,\n            }}\n        >\n            <div className=\"verbum-toolbar\">\n                <UndoButton/>\n                <RedoButton/>\n                <Divider/>\n                {supportedBlockTypes.has(blockType) &&\n                    activeEditor === initialEditor && (\n                        <>\n                            <BlockFormatDropdown/>\n                            <Divider/>\n                        </>\n                    )}\n                {blockType === 'code' ? (\n                    <>\n                        <CodeLanguageDropdown/>\n                        <Divider/>\n                        {alignExists && AlignComponent}\n                    </>\n                ) : (\n                    <>{children}</>\n                )}\n            </div>\n        </ToolbarContext.Provider>\n    );\n};\n\nexport default ToolbarPlugin;\n","import { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  LexicalTypeaheadMenuPlugin,\n  QueryMatch,\n  TypeaheadOption,\n  useBasicTypeaheadTriggerMatch,\n} from '@lexical/react/LexicalTypeaheadMenuPlugin';\nimport { $createTextNode, TextNode } from 'lexical';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport { $createMentionNode } from '../nodes/MentionNode';\nimport { $createAutoLinkNode } from '@lexical/link';\n\nimport './MentionsPlugin.css';\n\ntype SearchData<A> = (p: string) => Promise<A[]>;\n\nconst PUNCTUATION =\n  '\\\\.,\\\\+\\\\*\\\\?\\\\$\\\\@\\\\|#{}\\\\(\\\\)\\\\^\\\\-\\\\[\\\\]\\\\\\\\/!%\\'\"~=<>_:;';\nconst NAME = '\\\\b[A-Z][^\\\\s' + PUNCTUATION + ']';\n\nconst DocumentMentionsRegex = {\n  NAME,\n  PUNCTUATION,\n};\n\nconst CapitalizedNameMentionsRegex = new RegExp(\n  '(^|[^#])((?:' + DocumentMentionsRegex.NAME + '{' + 1 + ',})$)'\n);\n\nconst PUNC = DocumentMentionsRegex.PUNCTUATION;\n\nconst TRIGGERS = ['@'].join('');\n\n// Chars we expect to see in a mention (non-space, non-punctuation).\nconst VALID_CHARS = '[^' + TRIGGERS + PUNC + '\\\\s]';\n\n// Non-standard series of chars. Each series must be preceded and followed by\n// a valid char.\nconst VALID_JOINS =\n  '(?:' +\n  '\\\\.[ |$]|' + // E.g. \"r. \" in \"Mr. Smith\"\n  ' |' + // E.g. \" \" in \"Josh Duck\"\n  '[' +\n  PUNC +\n  ']|' + // E.g. \"-' in \"Salier-Hellendag\"\n  ')';\n\nconst LENGTH_LIMIT = 75;\n\nconst AtSignMentionsRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    VALID_JOINS +\n    '){0,' +\n    LENGTH_LIMIT +\n    '})' +\n    ')$'\n);\n\n// 50 is the longest alias length limit.\nconst ALIAS_LENGTH_LIMIT = 50;\n\n// Regex used to match alias.\nconst AtSignMentionsRegexAliasRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    '){0,' +\n    ALIAS_LENGTH_LIMIT +\n    '})' +\n    ')$'\n);\n\n// At most, 5 suggestions are shown in the popup.\nconst SUGGESTION_LIST_LENGTH_LIMIT = 5;\n\nconst mentionsCache = new Map();\n\nfunction useMentionLookupService<A>(\n  mentionString: string | null,\n  mentionData: SearchData<A>\n) {\n  const [results, setResults] = useState<Array<A>>([]);\n\n  useEffect(() => {\n    const cachedResults = mentionsCache.get(mentionString);\n\n    if (mentionString == null) {\n      setResults([]);\n      return;\n    }\n\n    if (cachedResults === null) {\n      return;\n    } else if (cachedResults !== undefined) {\n      setResults(cachedResults);\n      return;\n    }\n\n    mentionsCache.set(mentionString, null);\n\n    mentionData(mentionString).then((results) => {\n      mentionsCache.set(mentionString, results);\n      setResults(results);\n    });\n  }, [mentionString]);\n\n  return results;\n}\n\nfunction checkForCapitalizedNameMentions(\n  text: string,\n  minMatchLength: number\n): QueryMatch | null {\n  const match = CapitalizedNameMentionsRegex.exec(text);\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[2];\n    if (matchingString != null && matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: matchingString,\n      };\n    }\n  }\n  return null;\n}\n\nfunction checkForAtSignMentions(\n  text: string,\n  minMatchLength: number\n): QueryMatch | null {\n  let match = AtSignMentionsRegex.exec(text);\n\n  if (match === null) {\n    match = AtSignMentionsRegexAliasRegex.exec(text);\n  }\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[3];\n    if (matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: match[2],\n      };\n    }\n  }\n  return null;\n}\n\nfunction getPossibleQueryMatch(text: string): QueryMatch | null {\n  const match = checkForAtSignMentions(text, 1);\n  return match === null ? checkForCapitalizedNameMentions(text, 3) : match;\n}\n\nclass MentionTypeaheadOption extends TypeaheadOption {\n  name: string;\n  picture: JSX.Element;\n  url: string;\n\n  constructor(name: string, picture: JSX.Element, url?: string) {\n    super(name);\n    this.name = name;\n    this.picture = picture;\n    this.url = url;\n  }\n}\n\nfunction MentionsTypeaheadMenuItem({\n  index,\n  isSelected,\n  onClick,\n  onMouseEnter,\n  option,\n}: {\n  index: number;\n  isSelected: boolean;\n  onClick: () => void;\n  onMouseEnter: () => void;\n  option: MentionTypeaheadOption;\n}) {\n  let className = 'item';\n  if (isSelected) {\n    className += ' selected';\n  }\n  return (\n    <li\n      key={option.key}\n      tabIndex={-1}\n      className={className}\n      ref={option.setRefElement}\n      role=\"option\"\n      aria-selected={isSelected}\n      id={'typeahead-item-' + index}\n      onMouseEnter={onMouseEnter}\n      onClick={onClick}\n    >\n      {option.picture}\n      <span className=\"verbum-text\">{option.name}</span>\n    </li>\n  );\n}\n\nexport default function MentionsPlugin<A>(props: {\n  searchData: SearchData<A>;\n  getTypeaheadValues: (result: A) => {\n    url: string;\n    value: string;\n    picture: JSX.Element;\n  };\n}): JSX.Element | null {\n  const { searchData, getTypeaheadValues } = props;\n\n  const [editor] = useLexicalComposerContext();\n\n  const [queryString, setQueryString] = useState<string | null>(null);\n\n  const results = useMentionLookupService(queryString, searchData);\n\n  const checkForSlashTriggerMatch = useBasicTypeaheadTriggerMatch('/', {\n    minLength: 0,\n  });\n\n  const options = useMemo(\n    () =>\n      results\n        .map(\n          (result) =>\n            new MentionTypeaheadOption(\n              getTypeaheadValues(result).value,\n              getTypeaheadValues(result).picture,\n              getTypeaheadValues(result).url\n            )\n        )\n        .slice(0, SUGGESTION_LIST_LENGTH_LIMIT),\n    [results]\n  );\n\n  const onSelectOption = useCallback(\n    (\n      selectedOption: MentionTypeaheadOption,\n      nodeToReplace: TextNode | null,\n      closeMenu: () => void\n    ) => {\n      editor.update(() => {\n        if (nodeToReplace) {\n          const mentionNode = $createMentionNode(`@${selectedOption.name}`);\n          const linkNode = $createAutoLinkNode(selectedOption.url);\n          linkNode.append(mentionNode);\n          nodeToReplace.replace(linkNode);\n          linkNode.select();\n        }\n        closeMenu();\n      });\n    },\n    [editor]\n  );\n\n  const checkForMentionMatch = useCallback(\n    (text: string) => {\n      const mentionMatch = getPossibleQueryMatch(text);\n      const slashMatch = checkForSlashTriggerMatch(text, editor);\n      return !slashMatch && mentionMatch ? mentionMatch : null;\n    },\n    [checkForSlashTriggerMatch, editor]\n  );\n\n  return (\n    <LexicalTypeaheadMenuPlugin<MentionTypeaheadOption>\n      onQueryChange={setQueryString}\n      onSelectOption={onSelectOption}\n      triggerFn={checkForMentionMatch}\n      options={options}\n      menuRenderFn={(\n        anchorElementRef,\n        { selectedIndex, selectOptionAndCleanUp, setHighlightedIndex }\n      ) =>\n        anchorElementRef && results.length\n          ? ReactDOM.createPortal(\n              <div className=\"verbum-typeahead-popover verbum-mentions-menu\">\n                <ul>\n                  {options.map((option, i: number) => (\n                    <MentionsTypeaheadMenuItem\n                      index={i}\n                      isSelected={selectedIndex === i}\n                      onClick={() => {\n                        setHighlightedIndex(i);\n                        selectOptionAndCleanUp(option);\n                      }}\n                      onMouseEnter={() => {\n                        setHighlightedIndex(i);\n                      }}\n                      key={option.key}\n                      option={option}\n                    />\n                  ))}\n                </ul>\n              </div>,\n              anchorElementRef.current\n            )\n          : null\n      }\n    />\n  );\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './ColorPicker.css';\n\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\n\nimport DropDown from './DropDown';\n\ninterface ColorPickerProps {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  color?: string;\n  children?: JSX.Element;\n  onChange?: (color: string) => void;\n  title?: string;\n}\n\nconst basicColors = [\n  '#d0021b',\n  '#f5a623',\n  '#f8e71c',\n  '#8b572a',\n  '#7ed321',\n  '#417505',\n  '#bd10e0',\n  '#9013fe',\n  '#4a90e2',\n  '#50e3c2',\n  '#b8e986',\n  '#000000',\n  '#4a4a4a',\n  '#9b9b9b',\n  '#ffffff',\n];\n\nconst WIDTH = 214;\nconst HEIGHT = 150;\n\nexport default function ColorPicker({\n  color,\n  children,\n  onChange,\n  ...rest\n}: Readonly<ColorPickerProps>): JSX.Element {\n  const [selfColor, setSelfColor] = useState(transformColor('hex', color));\n\n  const saturationPosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.s / 100) * WIDTH,\n      y: ((100 - selfColor.hsv.v) / 100) * HEIGHT,\n    }),\n    [selfColor.hsv.s, selfColor.hsv.v]\n  );\n\n  const huePosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.h / 360) * WIDTH,\n    }),\n    [selfColor.hsv]\n  );\n\n  const onMoveSaturation = ({ x, y }: Position) => {\n    const newHsv = {\n      ...selfColor.hsv,\n      s: (x / WIDTH) * 100,\n      v: 100 - (y / HEIGHT) * 100,\n    };\n    const newColor = transformColor('hsv', newHsv);\n    setSelfColor(newColor);\n  };\n\n  const onMoveHue = ({ x }: Position) => {\n    const newHsv = { ...selfColor.hsv, h: (x / WIDTH) * 360 };\n    const newColor = transformColor('hsv', newHsv);\n\n    setSelfColor(newColor);\n  };\n\n  useEffect(() => {\n    onChange(selfColor.hex);\n  }, [selfColor, onChange]);\n\n  useEffect(() => {\n    if (color === undefined) return;\n    setSelfColor(transformColor('hex', color));\n  }, [color]);\n\n  return (\n    <DropDown {...rest} stopCloseOnClickSelf={true}>\n      <div className=\"verbum-color-picker-wrapper\" style={{ width: WIDTH }}>\n        <div className=\"verbum-color-picker-basic-color\">\n          {basicColors.map((basicColor) => (\n            <button\n              className={basicColor === selfColor.hex ? ' active' : ''}\n              key={basicColor}\n              style={{ backgroundColor: basicColor }}\n              onClick={() => setSelfColor(transformColor('hex', basicColor))}\n              type=\"button\"\n            />\n          ))}\n        </div>\n        <MoveWrapper\n          className=\"verbum-color-picker-saturation\"\n          style={{ backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)` }}\n          onChange={onMoveSaturation}\n        >\n          <div\n            className=\"verbum-color-picker-saturation_cursor\"\n            style={{\n              backgroundColor: selfColor.hex,\n              left: saturationPosition.x,\n              top: saturationPosition.y,\n            }}\n          />\n        </MoveWrapper>\n        <MoveWrapper className=\"verbum-color-picker-hue\" onChange={onMoveHue}>\n          <div\n            className=\"verbum-color-picker-hue_cursor\"\n            style={{\n              backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)`,\n              left: huePosition.x,\n            }}\n          />\n        </MoveWrapper>\n        <div className=\"verbum-color-picker-info\">\n          <span>{selfColor.hex}</span>\n          <div\n            className=\"verbum-color-picker-color\"\n            style={{ backgroundColor: selfColor.hex }}\n          />\n        </div>\n      </div>\n      {children}\n    </DropDown>\n  );\n}\n\nexport interface Position {\n  x: number;\n  y: number;\n}\n\ninterface MoveWrapperProps {\n  className?: string;\n  style?: React.CSSProperties;\n  onChange: (position: Position) => void;\n  children: JSX.Element;\n}\n\nfunction MoveWrapper({\n  className,\n  style,\n  onChange,\n  children,\n}: MoveWrapperProps) {\n  const divRef = useRef<HTMLDivElement>(null);\n\n  const move = (e: React.MouseEvent | MouseEvent): void => {\n    if (divRef.current) {\n      const { current: div } = divRef;\n      const { width, height, left, top } = div.getBoundingClientRect();\n\n      const x = clamp(e.clientX - left, width, 0);\n      const y = clamp(e.clientY - top, height, 0);\n\n      onChange({ x, y });\n    }\n  };\n\n  const onMouseDown = (e: React.MouseEvent): void => {\n    if (e.button !== 0) return;\n\n    move(e);\n\n    const onMouseMove = (_e: MouseEvent): void => {\n      move(_e);\n    };\n\n    const onMouseUp = (_e: MouseEvent): void => {\n      document.removeEventListener('mousemove', onMouseMove, false);\n      document.removeEventListener('mouseup', onMouseUp, false);\n\n      move(_e);\n    };\n\n    document.addEventListener('mousemove', onMouseMove, false);\n    document.addEventListener('mouseup', onMouseUp, false);\n  };\n\n  return (\n    <div\n      ref={divRef}\n      className={className}\n      style={style}\n      onMouseDown={onMouseDown}\n    >\n      {children}\n    </div>\n  );\n}\n\nfunction clamp(value: number, max: number, min: number) {\n  return value > max ? max : value < min ? min : value;\n}\n\ninterface RGB {\n  b: number;\n  g: number;\n  r: number;\n}\ninterface HSV {\n  h: number;\n  s: number;\n  v: number;\n}\ninterface Color {\n  hex: string;\n  hsv: HSV;\n  rgb: RGB;\n}\n\nexport function toHex(value: string): string {\n  if (!value.startsWith('#')) {\n    const ctx = document.createElement('canvas').getContext('2d');\n\n    if (!ctx) {\n      throw new Error('2d context not supported or canvas already initialized');\n    }\n\n    ctx.fillStyle = value;\n\n    return ctx.fillStyle;\n  } else if (value.length === 4 || value.length === 5) {\n    value = value\n      .split('')\n      .map((v, i) => (i ? v + v : '#'))\n      .join('');\n\n    return value;\n  } else if (value.length === 7 || value.length === 9) {\n    return value;\n  }\n\n  return '#000000';\n}\n\nfunction hex2rgb(hex: string): RGB {\n  const rbgArr = hex\n    .replace(\n      /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i,\n      (m, r, g, b) => '#' + r + r + g + g + b + b\n    )\n    .substring(1)\n    .match(/.{2}/g)\n    .map((x) => parseInt(x, 16));\n\n  return {\n    b: rbgArr[2],\n    g: rbgArr[1],\n    r: rbgArr[0],\n  };\n}\n\nfunction rgb2hsv({ r, g, b }: RGB): HSV {\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  const max = Math.max(r, g, b);\n  const d = max - Math.min(r, g, b);\n\n  const h = d\n    ? (max === r\n        ? (g - b) / d + (g < b ? 6 : 0)\n        : max === g\n        ? 2 + (b - r) / d\n        : 4 + (r - g) / d) * 60\n    : 0;\n  const s = max ? (d / max) * 100 : 0;\n  const v = max * 100;\n\n  return { h, s, v };\n}\n\nfunction hsv2rgb({ h, s, v }: HSV): RGB {\n  s /= 100;\n  v /= 100;\n\n  const i = ~~(h / 60);\n  const f = h / 60 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - s * f);\n  const t = v * (1 - s * (1 - f));\n  const index = i % 6;\n\n  const r = Math.round([v, q, p, p, t, v][index] * 255);\n  const g = Math.round([t, v, v, q, p, p][index] * 255);\n  const b = Math.round([p, p, t, v, v, q][index] * 255);\n\n  return { b, g, r };\n}\n\nfunction rgb2hex({ b, g, r }: RGB): string {\n  return '#' + [r, g, b].map((x) => x.toString(16).padStart(2, '0')).join('');\n}\n\nfunction transformColor<M extends keyof Color, C extends Color[M]>(\n  format: M,\n  color: C\n): Color {\n  let hex: Color['hex'] = toHex('#121212');\n  let rgb: Color['rgb'] = hex2rgb(hex);\n  let hsv: Color['hsv'] = rgb2hsv(rgb);\n\n  if (format === 'hex') {\n    const value = color as Color['hex'];\n\n    hex = toHex(value);\n    rgb = hex2rgb(hex);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'rgb') {\n    const value = color as Color['rgb'];\n\n    rgb = value;\n    hex = rgb2hex(rgb);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'hsv') {\n    const value = color as Color['hsv'];\n\n    hsv = value;\n    rgb = hsv2rgb(hsv);\n    hex = rgb2hex(rgb);\n  }\n\n  return { hex, hsv, rgb };\n}\n","import React, { useCallback, useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport ColorPicker from '../../../ui/ColorPicker';\nimport { useTranslation } from 'react-i18next';\n\nconst BackgroundColorPicker = () => {\n  const { bgColor, applyStyleText } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  const onBgColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({ 'background-color': value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <ColorPicker\n      buttonClassName=\"verbum-toolbar-item verbum-color-picker\"\n      buttonAriaLabel={t('toolbar:backgroundColorPicker.Description')}\n      buttonIconClassName=\"verbum-icon verbum-bg-color\"\n      color={bgColor}\n      onChange={onBgColorSelect}\n      title=\"bg color\"\n    />\n  );\n};\n\nexport default BackgroundColorPicker;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst BoldButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isBold } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n      }}\n      className={'verbum-toolbar-item spaced ' + (isBold ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:boldButton.Title')} (B)`\n          : `${t('toolbar:boldButton.Title')} (Ctrl + B)`\n      }\n      aria-label={`${t('toolbar:boldButton.Description')} ${\n        IS_APPLE ? 'B' : 'Ctrl+B'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-bold\" />\n    </button>\n  );\n};\n\nexport default BoldButton;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst CodeFormatButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isCode } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n      }}\n      className={'verbum-toolbar-item spaced ' + (isCode ? 'active' : '')}\n      title={t('toolbar:codeFormatButton.Description')}\n      aria-label={t('toolbar:codeFormatButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-code\" />\n    </button>\n  );\n};\n\nexport default CodeFormatButton;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './LinkPreview.css';\n\nimport * as React from 'react';\nimport { Suspense } from 'react';\n\n// Cached responses or running request promises\nconst PREVIEW_CACHE = {};\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nfunction useSuspenseRequest(url: string) {\n  let cached = PREVIEW_CACHE[url];\n\n  if (!url.match(URL_MATCHER)) {\n    return { preview: null };\n  }\n\n  if (!cached) {\n    cached = PREVIEW_CACHE[url] = fetch(\n      `/api/link-preview?url=${encodeURI(url)}`\n    )\n      .then((response) => response.json())\n      .then((preview) => {\n        PREVIEW_CACHE[url] = preview;\n        return preview;\n      })\n      .catch(() => {\n        PREVIEW_CACHE[url] = { preview: null };\n      });\n  }\n\n  if (cached instanceof Promise) {\n    throw cached;\n  }\n\n  return cached;\n}\n\nfunction LinkPreviewContent({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  const { preview } = useSuspenseRequest(url);\n  if (preview === null) {\n    return null;\n  }\n  return (\n    <div className=\"LinkPreview__container\">\n      {preview.img && (\n        <div className=\"LinkPreview__imageWrapper\">\n          <img\n            src={preview.img}\n            alt={preview.title}\n            className=\"LinkPreview__image\"\n          />\n        </div>\n      )}\n      {preview.domain && (\n        <div className=\"LinkPreview__domain\">{preview.domain}</div>\n      )}\n      {preview.title && (\n        <div className=\"LinkPreview__title\">{preview.title}</div>\n      )}\n      {preview.description && (\n        <div className=\"LinkPreview__description\">{preview.description}</div>\n      )}\n    </div>\n  );\n}\n\nfunction Glimmer(props): JSX.Element {\n  return (\n    <div\n      className=\"LinkPreview__glimmer\"\n      {...props}\n      style={{\n        animationDelay: (props.index || 0) * 300,\n        ...(props.style || {}),\n      }}\n    />\n  );\n}\n\nexport default function LinkPreview({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  return (\n    <Suspense\n      fallback={\n        <>\n          <Glimmer style={{ height: '80px' }} index={0} />\n          <Glimmer style={{ width: '60%' }} index={1} />\n          <Glimmer style={{ width: '80%' }} index={2} />\n        </>\n      }\n    >\n      <LinkPreviewContent url={url} />\n    </Suspense>\n  );\n}\n","import { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { $isAtNodeEnd } from '@lexical/selection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport React from 'react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport LinkPreview from '../../../ui/LinkPreview';\nimport { getSelectedNode } from '../../../utils/node.util';\n\nfunction positionEditorElement(editor, rect) {\n  if (rect === null) {\n    editor.style.opacity = '0';\n    editor.style.top = '-1000px';\n    editor.style.left = '-1000px';\n  } else {\n    editor.style.opacity = '1';\n    editor.style.top = `${rect.top + rect.height + window.pageYOffset + 10}px`;\n    editor.style.left = `${\n      rect.left + window.pageXOffset - editor.offsetWidth / 2 + rect.width / 2\n    }px`;\n  }\n}\n\nfunction FloatingLinkEditor({\n  editor,\n}: {\n  editor: LexicalEditor;\n}): JSX.Element {\n  const editorRef = useRef<HTMLDivElement | null>(null);\n  const inputRef = useRef(null);\n  const [linkUrl, setLinkUrl] = useState('');\n  const [isEditMode, setEditMode] = useState(false);\n  const [lastSelection, setLastSelection] = useState(null);\n\n  const updateLinkEditor = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const node = getSelectedNode(selection);\n      const parent = node.getParent();\n      if ($isLinkNode(parent)) {\n        setLinkUrl(parent.getURL());\n      } else if ($isLinkNode(node)) {\n        setLinkUrl(node.getURL());\n      } else {\n        setLinkUrl('');\n      }\n    }\n    const editorElem = editorRef.current;\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (editorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      let rect;\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      positionEditorElement(editorElem, rect);\n      setLastSelection(selection);\n    } else if (!activeElement || activeElement.className !== 'link-input') {\n      positionEditorElement(editorElem, null);\n      setLastSelection(null);\n      setEditMode(false);\n      setLinkUrl('');\n    }\n\n    return true;\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateLinkEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateLinkEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateLinkEditor();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateLinkEditor();\n    });\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    if (isEditMode && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isEditMode]);\n\n  return (\n    <div ref={editorRef} className=\"verbum-link-editor\">\n      {isEditMode ? (\n        <input\n          ref={inputRef}\n          className=\"link-input\"\n          value={linkUrl}\n          onChange={(event) => {\n            setLinkUrl(event.target.value);\n          }}\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              event.preventDefault();\n              if (lastSelection !== null) {\n                if (linkUrl !== '') {\n                  editor.dispatchCommand(TOGGLE_LINK_COMMAND, linkUrl);\n                }\n                setEditMode(false);\n              }\n            } else if (event.key === 'Escape') {\n              event.preventDefault();\n              setEditMode(false);\n            }\n          }}\n        />\n      ) : (\n        <>\n          <div className=\"link-input\">\n            <a href={linkUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n              {linkUrl}\n            </a>\n            <div\n              className=\"link-edit\"\n              role=\"button\"\n              tabIndex={0}\n              onMouseDown={(event) => event.preventDefault()}\n              onClick={() => {\n                setEditMode(true);\n              }}\n            />\n          </div>\n          <LinkPreview url={linkUrl} />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default FloatingLinkEditor;\n","import React, { useCallback, useContext } from 'react';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { FontOptions } from '../../../types';\n\nconst defaultFontFamilyOptions: FontOptions = [\n  ['Arial', 'Arial'],\n  ['Courier New', 'Courier New'],\n  ['Georgia', 'Georgia'],\n  ['Times New Roman', 'Times New Roman'],\n  ['Trebuchet MS', 'Trebuchet MS'],\n  ['Verdana', 'Verdana'],\n];\n\ninterface IFontFamilyDropdown {\n  fontOptions?: FontOptions;\n}\n\nconst FontFamilyDropdown = ({\n  fontOptions = defaultFontFamilyOptions,\n}: IFontFamilyDropdown) => {\n  const { fontFamily, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontFamilySelect = useCallback(\n    (e) => {\n      applyStyleText({ 'font-family': e.target.value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"verbum-toolbar-item verbum-font-family\"\n        onChange={onFontFamilySelect}\n        options={fontOptions}\n        value={fontFamily}\n      />\n      <i className=\"verbum-chevron-down inside\" />\n    </>\n  );\n};\n\nexport default FontFamilyDropdown;\n","import React, { useCallback, useContext } from 'react';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { FontOptions } from '../../../types';\n\nconst defaultFontSizeOptions: FontOptions = [\n  ['10px', '10px'],\n  ['11px', '11px'],\n  ['12px', '12px'],\n  ['13px', '13px'],\n  ['14px', '14px'],\n  ['15px', '15px'],\n  ['16px', '16px'],\n  ['17px', '17px'],\n  ['18px', '18px'],\n  ['19px', '19px'],\n  ['20px', '20px'],\n];\n\ninterface IFontSizeDropdown {\n  fontSizeOptions?: FontOptions;\n}\n\nconst FontSizeDropdown = ({\n  fontSizeOptions = defaultFontSizeOptions,\n}: IFontSizeDropdown) => {\n  const { fontSize, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontSizeSelect = useCallback(\n    (e) => {\n      applyStyleText({ 'font-size': e.target.value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"verbum-toolbar-item verbum-font-size\"\n        onChange={onFontSizeSelect}\n        options={fontSizeOptions}\n        value={fontSize}\n      />\n      <i className=\"verbum-chevron-down inside\" />\n    </>\n  );\n};\n\nexport default FontSizeDropdown;\n","import React from 'react';\nimport { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport FloatingLinkEditor from './FloatingLinkEditor';\nimport { createPortal } from 'react-dom';\nimport { useTranslation } from 'react-i18next';\n\nconst InsertLinkButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isLink, insertLink } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <>\n      <button\n        onClick={insertLink}\n        className={'verbum-toolbar-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:insertLinkButton.Description')}\n        title={t('toolbar:insertLinkButton.Description')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-link\" />\n      </button>\n      {isLink &&\n        createPortal(\n          <FloatingLinkEditor editor={activeEditor} />,\n          document.body\n        )}\n    </>\n  );\n};\n\nexport default InsertLinkButton;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst ItalicButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isItalic } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n      }}\n      className={'verbum-toolbar-item spaced ' + (isItalic ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:italicButton.Title')} (I)`\n          : `${t('toolbar:italicButton.Title')} (Ctrl+I)`\n      }\n      aria-label={`${t('toolbar:italicButton.Description')} ${\n        IS_APPLE ? 'I' : 'Ctrl+I'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-italic\" />\n    </button>\n  );\n};\n\nexport default ItalicButton;\n","import React, { useCallback, useContext } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport ColorPicker from '../../../ui/ColorPicker';\n\nconst TextColorPicker = () => {\n  const { fontColor, applyStyleText } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  const onFontColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({ color: value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <ColorPicker\n      buttonClassName=\"verbum-toolbar-item verbum-color-picker\"\n      buttonAriaLabel={t('toolbar:textColorPicker.Description')}\n      buttonIconClassName=\"verbum-icon verbum-font-color\"\n      color={fontColor}\n      onChange={onFontColorSelect}\n      title=\"text color\"\n    />\n  );\n};\n\nexport default TextColorPicker;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React, { useContext } from 'react';\nimport DropDown from '../../../ui/DropDown';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst TextFormatDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isStrikethrough, isSubscript, isSuperscript } =\n    useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <DropDown\n      buttonClassName=\"verbum-toolbar-item spaced\"\n      buttonLabel=\"\"\n      buttonAriaLabel={t('toolbar:textFormatDropdown.Description')}\n      buttonIconClassName=\"verbum-icon verbum-dropdown-more\"\n    >\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={\n          'item ' + (isStrikethrough ? 'active dropdown-item-active' : '')\n        }\n        title={t('toolbar:textFormatDropdown.Options.Strikethrough.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Strikethrough.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-strikethrough\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:textFormatDropdown.Options.Strikethrough.Label')}\n        </span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'item ' + (isSubscript ? 'active dropdown-item-active' : '')}\n        title={t('toolbar:textFormatDropdown.Options.Subscript.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Subscript.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-subscript\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:textFormatDropdown.Options.Subscript.Label')}\n        </span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={\n          'item ' + (isSuperscript ? 'active dropdown-item-active' : '')\n        }\n        title={t('toolbar:textFormatDropdown.Options.Superscript.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Superscript.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-superscript\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:textFormatDropdown.Options.Superscript.Label')}\n        </span>\n      </button>\n    </DropDown>\n  );\n};\n\nexport default TextFormatDropdown;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst UnderlineButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isUnderline } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n      }}\n      className={'verbum-toolbar-item spaced ' + (isUnderline ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:underlineButton.Title')} (U)`\n          : `${t('toolbar:underlineButton.Title')} (Ctrl+U)`\n      }\n      aria-label={`${t('toolbar:underlineButton.Description')} ${\n        IS_APPLE ? 'U' : 'Ctrl+U'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-underline\" />\n    </button>\n  );\n};\n\nexport default UnderlineButton;\n","import type { LexicalEditor, NodeKey } from 'lexical';\n\nimport * as React from 'react';\nimport { Suspense, useRef } from 'react';\n\nconst imageCache = new Set();\n\nfunction useSuspenseImage(src: string) {\n  if (!imageCache.has(src)) {\n    throw new Promise((resolve) => {\n      const img = new Image();\n      img.src = src;\n      img.onload = () => {\n        imageCache.add(src);\n        resolve(null);\n      };\n    });\n  }\n}\n\nfunction LazyImage({\n  altText,\n  className,\n  imageRef,\n  src,\n  width,\n  height,\n  maxWidth,\n}: {\n  altText: string;\n  className: string | null;\n  height: 'inherit' | number;\n  imageRef: { current: null | HTMLImageElement };\n  maxWidth: number;\n  src: string;\n  width: 'inherit' | number;\n}): JSX.Element {\n  useSuspenseImage(src);\n  return (\n    <img\n      className={className || undefined}\n      src={src}\n      alt={altText}\n      ref={imageRef}\n      style={{\n        height,\n        maxWidth,\n        width,\n      }}\n    />\n  );\n}\n\nexport default function ImageComponent({\n  src,\n  altText,\n  width,\n  height,\n  maxWidth,\n}: {\n  altText: string;\n  caption: LexicalEditor;\n  height: 'inherit' | number;\n  maxWidth: number;\n  nodeKey: NodeKey;\n  resizable: boolean;\n  showCaption: boolean;\n  src: string;\n  width: 'inherit' | number;\n  captionsEnabled: boolean;\n}): JSX.Element {\n  const imageRef = useRef<null | HTMLImageElement>(null);\n\n  return (\n    <Suspense fallback={null}>\n      <>\n        <div>\n          <LazyImage\n            className=\"\"\n            src={src}\n            altText={altText}\n            imageRef={imageRef}\n            width={width}\n            height={height}\n            maxWidth={maxWidth}\n          />\n        </div>\n      </>\n    </Suspense>\n  );\n}\n"],"names":["__className","EmojiNode","TextNode","getType","clone","node","__text","__key","constructor","className","text","key","createDOM","config","dom","document","createElement","inner","appendChild","updateDOM","prevNode","firstChild","importJSON","serializedNode","$createEmojiNode","setFormat","format","setDetail","detail","setMode","mode","setStyle","style","exportJSON","getClassName","type","self","getLatest","emojiText","ImageComponent","React","convertImageElement","domNode","HTMLImageElement","alt","altText","src","width","height","$createImageNode","ImageNode","DecoratorNode","maxWidth","showCaption","caption","captionsEnabled","__src","__altText","__maxWidth","__width","__height","__showCaption","__caption","createEditor","__captionsEnabled","undefined","nestedEditor","editorState","parseEditorState","isEmpty","setEditorState","exportDOM","element","setAttribute","toString","importDOM","img","conversion","priority","getAltText","toJSON","getSrc","version","setWidthAndHeight","writable","getWritable","setShowCaption","span","theme","image","decorate","Suspense","fallback","nodeKey","getKey","resizable","$applyNodeReplacement","$isImageNode","KeywordNode","$createKeywordNode","cursor","canInsertTextBefore","canInsertTextAfter","isTextEntity","keyword","mentionStyle","MentionNode","mentionName","__mention","$createMentionNode","setTextContent","cssText","mentionNode","toggleDirectionless","joinClasses","args","filter","Boolean","join","Button","dataTestId","children","onClick","disabled","small","title","createUID","Math","random","replace","substr","createPollOption","uid","votes","cloneOption","option","Array","from","getTotalVotes","options","reduce","totalVotes","next","length","PollOptionComponent","index","withPollNode","clientID","useCollaborationContext","checkboxRef","useRef","votesArray","checkedIndex","indexOf","checked","ref","onChange","e","toggleVote","value","setOptionText","target","placeholder","deleteOption","PollComponent","question","editor","useLexicalComposerContext","useMemo","cb","update","$getNodeByKey","$isPollNode","addOption","map","convertPollElement","getAttribute","$createPollNode","PollNode","__question","__options","forEach","push","splice","clonedOption","votesClone","voteIndex","hasAttribute","elem","display","CAN_USE_DOM","window","useLayoutEffectImpl","useLayoutEffect","useEffect","url","URL","location","href","params","URLSearchParams","search","WEBSOCKET_ENDPOINT","WEBSOCKET_SLUG","WEBSOCKET_ID","get","createWebsocketProvider","id","yjsDocMap","doc","Doc","set","load","WebsocketProvider","connect","Context","createContext","historyState","current","redoStack","undoStack","useSharedHistoryContext","useContext","characterLimit","code","codeHighlight","atrule","attr","boolean","builtin","cdata","char","class","comment","constant","deleted","doctype","entity","function","important","inserted","namespace","number","operator","prolog","property","punctuation","regex","selector","string","symbol","tag","variable","hashtag","heading","h1","h2","h3","h4","h5","link","list","listitem","listitemChecked","listitemUnchecked","nested","olDepth","ul","ltr","mark","markOverlap","paragraph","quote","rtl","table","tableCell","tableCellHeader","bold","italic","strikethrough","subscript","superscript","underline","underlineStrikethrough","baseTheme","LexicalContentEditable","ContentEditable","Placeholder","positionSticky","stickyElem","positioning","rootElementRect","rectLeft","left","rectTop","top","y","x","StickyComponent","color","stickyContainerRef","positioningRef","isDragging","offsetX","offsetY","isCollab","position","stickyContainer","resizeObserver","ResizeObserver","entries","i","entry","getBoundingClientRect","removeRootListener","registerRootListener","nextRootElem","prevRootElem","unobserve","observe","handleWindowResize","rootElement","getRootElement","addEventListener","removeEventListener","setTimeout","setProperty","handlePointerMove","event","pageX","pageY","handlePointerUp","classList","remove","$isStickyNode","setPosition","handleDelete","handleColorChange","toggleColor","onPointerDown","button","stickContainer","clientX","clientY","add","preventDefault","LexicalNestedComposer","initialEditor","initialTheme","StickyEditorTheme","CollaborationPlugin","providerFactory","shouldBootstrap","HistoryPlugin","externalHistoryState","PlainTextPlugin","contentEditable","ErrorBoundary","LexicalErrorBoundary","StickyNode","__x","__y","__color","xOffset","yOffset","div","$setSelection","createPortal","body","isIsolated","$createStickyNode","WIDGET_SCRIPT_URL","convertTweetElement","$createTweetNode","isTwitterScriptLoading","TweetComponent","loadingComponent","onError","onLoad","tweetID","containerRef","previousTweetIDRef","isTweetLoading","setIsTweetLoading","useState","createTweet","useCallback","twttr","widgets","error","String","script","async","onload","onerror","BlockWithAlignableContents","TweetNode","DecoratorBlockNode","__id","__format","getId","embedBlockTheme","embedBlock","base","focus","isTopLevel","$isTweetNode","TypeaheadNode","$createTypeaheadNode","YouTubeComponent","videoID","frameBorder","allow","allowFullScreen","YouTubeNode","$createYouTubeNode","_editor","PlaygroundNodes","HeadingNode","ListNode","ListItemNode","QuoteNode","CodeNode","TableNode","TableCellNode","TableRowNode","HashtagNode","CodeHighlightNode","AutoLinkNode","LinkNode","OverflowNode","HorizontalRuleNode","MarkNode","resources","ar","de","en","EN","es","fr","FR","it","ja","nl","pl","pt","ptBr","PTBR","ru","RU","ukr","zh","languageDetector","detect","callback","language","navigator","substring","init","cacheUserLanguage","i18n","i18next","ns","fallbackLng","debug","interpolation","escapeValue","err","t","use","EditorComposer","initialEditorState","initialConfig","nodes","PlaygroundEditorTheme","LexicalComposer","I18nextProvider","hostName","hostname","isDevPlayground","DEFAULT_SETTINGS","disableBeforeInput","emptyEditor","isAutocomplete","isCharLimit","isCharLimitUtf8","isRichText","measureTypingPerf","showNestedEditorTreeView","showTreeView","setOption","name","settings","useSettings","PortalImpl","onClose","closeOnClickOutside","modalRef","modalOverlayElement","handler","keyCode","clickOutsideHandler","contains","parentElement","role","tabIndex","Modal","useModal","modalContent","setModalContent","modal","content","showModal","getContent","HR","dependencies","export","$isHorizontalRuleNode","regExp","parentNode","_1","_2","isImport","line","$createHorizontalRuleNode","getNextSibling","insertBefore","selectNext","IMAGE","exportChildren","exportFormat","importRegExp","textNode","match","imageNode","trigger","TWEET","tweetNode","TABLE_ROW_REG_EXP","TABLE","$isTableNode","output","row","getChildren","rowOutput","$isTableRowNode","cell","$isElementNode","matchCells","mapToTableCells","rows","sibling","getPreviousSibling","maxCells","$isParagraphNode","getChildrenSize","getFirstChild","$isTextNode","cells","getTextContent","max","unshift","previousSibling","$createTableNode","tableRow","$createTableRowNode","append","createTableCell","getTableColumnsSize","selectEnd","textContent","$createTableCellNode","TableCellHeaderStates","NO_STATUS","$createParagraphNode","$createTextNode","trim","split","PLAYGROUND_TRANSFORMERS","CHECK_LIST","ELEMENT_TRANSFORMERS","TEXT_FORMAT_TRANSFORMERS","TEXT_MATCH_TRANSFORMERS","getElement","getElementById","fontSize","transform","padding","background","borderRadius","useReport","timer","cleanup","clearTimeout","removeChild","console","log","innerHTML","SPEECH_TO_TEXT_COMMAND","createCommand","VOICE_COMMANDS","selection","insertParagraph","redo","dispatchCommand","REDO_COMMAND","undo","UNDO_COMMAND","SUPPORT_SPEECH_RECOGNITION","SpeechToTextPlugin","isEnabled","setIsEnabled","SpeechRecognition","webkitSpeechRecognition","recognition","report","continuous","interimResults","resultItem","results","item","resultIndex","transcript","isFinal","$getSelection","$isRangeSelection","command","toLowerCase","insertText","start","stop","registerCommand","_isEnabled","COMMAND_PRIORITY_EDITOR","ActionsPlugin","isEditable","setIsEditable","isSpeechToText","setIsSpeechToText","connected","setConnected","isEditorEmpty","setIsEditorEmpty","useTranslation","mergeRegister","registerEditableListener","editable","CONNECTED_COMMAND","payload","isConnected","registerUpdateListener","getEditorState","read","root","$getRoot","paragraphChildren","handleMarkdownToggle","$isCodeNode","getLanguage","$convertFromMarkdownString","markdown","$convertToMarkdownString","clear","$createCodeNode","importFile","exportFile","fileName","Date","toISOString","source","ShowClearDialog","setEditable","TOGGLE_CONNECT_COMMAND","CLEAR_EDITOR_COMMAND","URL_MATCHER","EMAIL_MATCHER","MATCHERS","exec","LexicalAutoLinkPlugin","AutoLinkPlugin","matchers","INSERT_INLINE_COMMAND","setPopupPosition","rect","pageYOffset","pageXOffset","offsetWidth","bottom","opacity","FloatingCharacterStylesEditor","isLink","isBold","isItalic","isUnderline","isCode","isStrikethrough","isSubscript","isSuperscript","popupCharStylesEditorRef","mouseDownRef","insertLink","TOGGLE_LINK_COMMAND","insertComment","updateCharacterStylesEditor","popupCharStylesEditorElem","nativeSelection","getSelection","isCollapsed","anchorNode","domRange","getRangeAt","firstElementChild","onResize","SELECTION_CHANGE_COMMAND","COMMAND_PRIORITY_LOW","FORMAT_TEXT_COMMAND","getSelectedNode","anchor","getNode","focusNode","isBackward","$isAtNodeEnd","useCharacterStylesPopup","isText","setIsText","setIsLink","setIsBold","setIsItalic","setIsUnderline","setIsStrikethrough","setIsSubscript","setIsSuperscript","setIsCode","updatePopup","hasFormat","parent","getParent","$isLinkNode","$isCodeHighlightNode","CharacterStylesPopupPlugin","ClickableLinkPlugin","newTab","hasMoved","prevOffsetX","prevOffsetY","onPointerUp","hasMovedDuringClick","linkDomNode","getLinkDomNode","linkNode","maybeLinkNode","$getNearestNodeFromDOMNode","open","metaKey","ctrlKey","prevRootElement","isLinkDomNode","nodeName","CodeHighlightPlugin","registerCodeHighlighting","KEYWORDS_REGEX","KeywordsPlugin","hasNodes","Error","createKeywordNode","getKeywordMatch","matchArr","hashtagLength","startOffset","endOffset","end","useLexicalTextEntity","getElementNodesInSelection","nodesInSelection","getNodes","Set","getParentOrThrow","n","isIndentPermitted","maxDepth","elementNodesInSelection","totalDepth","elementNode","$isListNode","$getListDepth","$isListItemNode","ListMaxIndentLevelPlugin","INDENT_CONTENT_COMMAND","COMMAND_PRIORITY_CRITICAL","MarkdownPlugin","MarkdownShortcutPlugin","transformers","TAB_TO_FOCUS_INTERVAL","lastTabKeyDownTimestamp","hasRegisteredKeyDownListener","registerKeyTimeStampTracker","timeStamp","TabFocusPlugin","FOCUS_COMMAND","EditorContext","FileInput","accept","label","files","TextInput","getDOMSelection","targetWindow","INSERT_IMAGE_COMMAND","ImagesPlugin","$insertNodes","$isRootOrShadowRoot","$wrapNodeInElement","DRAGSTART_COMMAND","onDragStart","COMMAND_PRIORITY_HIGH","DRAGOVER_COMMAND","onDragover","DROP_COMMAND","onDrop","TRANSPARENT_IMAGE","getImageNodeInSelection","dataTransfer","setData","setDragImage","JSON","stringify","data","canDropImage","getDragImageData","range","getDragSelection","rangeSelection","$createRangeSelection","applyDOMRange","$isNodeSelection","dragData","getData","parse","HTMLElement","closest","nodeType","defaultView","ownerDocument","domSelection","caretRangeFromPoint","rangeParent","collapse","rangeOffset","ACCEPTABLE_IMAGE_TYPES","DragDropPaste","DRAG_DROP_PASTE","filesResult","mediaFileReader","flatMap","file","result","isMimeType","Editor","hashtagsEnabled","autoLinkEnabled","emojisEnabled","actionsEnabled","listMaxIndent","locale","activeEditor","setActiveEditor","editorStateRef","placeholderComponent","changeLanguage","Provider","AutoFocusPlugin","ClearEditorPlugin","HashtagPlugin","RichTextPlugin","OnChangePlugin","ListPlugin","CheckListPlugin","LinkPlugin","ToolbarContext","DropDown","buttonLabel","buttonAriaLabel","buttonClassName","buttonIconClassName","stopCloseOnClickSelf","dropDownRef","buttonRef","showDropDown","setShowDropDown","dropDown","min","innerWidth","handle","Divider","AlignDropdown","isRTL","FORMAT_ELEMENT_COMMAND","OUTDENT_CONTENT_COMMAND","INSERT_POLL_COMMAND","PollPlugin","pollNode","$isRootNode","insertNodes","INSERT_TWEET_COMMAND","TwitterPlugin","getTopLevelElementOrThrow","insertAfter","paragraphNode","select","INSERT_YOUTUBE_COMMAND","YouTubePlugin","youTubeNode","MIN_ROW_HEIGHT","MIN_COLUMN_WIDTH","TableCellResizer","targetRef","resizerRef","tableRectRef","mouseStartPosRef","mouseCurrentPos","updateMouseCurrentPos","activeCell","updateActiveCell","isSelectingGrid","updateIsSelectingGrid","draggingDirection","updateDraggingDirection","isGridSelection","DEPRECATED_$isGridSelection","resetState","onMouseMove","getCellFromTarget","tableCellNode","tableNode","$getTableNodeFromLexicalNodeOrThrow","tableElement","getElementByKey","isHeightChanging","direction","updateRowHeight","newHeight","$isTableCellNode","tableRowIndex","$getTableRowIndexFromTableCellNode","tableRows","setHeight","updateColumnWidth","newWidth","tableColumnIndex","$getTableColumnIndexFromTableCellNode","r","tableCells","setWidth","toggleResize","stopPropagation","heightChange","abs","isShrinking","widthChange","getResizers","styles","backgroundColor","right","tableRect","resizerStyles","onMouseDown","onMouseUp","TableCellResizerPlugin","TableActionMenu","_tableCellNode","setIsMenuOpen","contextRef","updateTableCellNode","selectionCounts","updateSelectionCounts","columns","registerMutationListener","nodeMutations","nodeUpdated","selectionShape","getShape","toX","fromX","toY","fromY","menuButtonElement","dropDownElement","menuButtonRect","handleClickOutside","clearTableSelection","isAttached","tableSelection","getTableSelectionFromTableElement","clearHighlight","markDirty","insertTableRowAtSelection","shouldInsertAfter","grid","$getElementGridForTableNode","$insertTableRow","insertTableColumnAtSelection","$insertTableColumn","deleteTableRowAtSelection","$removeTableRowAtIndex","deleteTableAtSelection","deleteTableColumnAtSelection","$deleteTableColumn","toggleTableRowIsHeader","toggleHeaderStyle","ROW","toggleTableColumnIsHeader","COLUMN","__headerState","TableCellActionMenuContainer","menuButtonRef","menuRootRef","isMenuOpen","setTableMenuCellNode","moveMenu","menu","activeElement","tableCellNodeFromSelection","$getTableCellNodeFromLexicalNode","tableCellParentNodeDOM","menuButtonDOM","tableCellNodeDOM","tableCellRect","menuRect","prevTableCellDOM","TableActionMenuPlugin","HorizontalRulePlugin","INSERT_HORIZONTAL_RULE_COMMAND","horizontalRuleNode","YOUTUBE_ID_PARSER","parseYouTubeVideoID","urlMatches","InsertImageDialog","InsertImageUriDialogBody","InsertImageUploadedDialogBody","InsertTableDialog","setRows","setColumns","INSERT_TABLE_COMMAND","InsertPollDialog","setQuestion","VALID_TWITTER_URL","InsertTweetDialog","setText","isDisabled","setSrc","setAltText","loadImage","reader","FileReader","readAsDataURL","InsertYouTubeDialog","InsertDropdown","enableTable","enableImage","enable","enableYoutube","enableTwitter","enablePoll","enableHorizontalRule","enableStickyNote","TablePlugin","TableCellActionMenuPlugin","stickyNode","IS_APPLE","test","platform","UndoButton","canUndo","RedoButton","canRedo","Select","CODE_LANGUAGE_OPTIONS","CodeLanguageDropdown","selectedElementKey","codeLanguage","onCodeLanguageSelect","setLanguage","BlockFormatDropdown","blockType","formatParagraph","$wrapNodes","formatHeading","headingSize","$createHeadingNode","formatBulletList","INSERT_UNORDERED_LIST_COMMAND","REMOVE_LIST_COMMAND","formatCheckList","INSERT_CHECK_LIST_COMMAND","formatNumberedList","INSERT_ORDERED_LIST_COMMAND","formatQuote","$createQuoteNode","formatCode","codeNode","removeText","insertRawText","supportedBlockTypes","CODE_LANGUAGE_MAP","javascript","md","plaintext","python","ToolbarPlugin","defaultFontSize","defaultFontColor","defaultBgColor","defaultFontFamily","insertExists","InsertComponent","useChild","alignExists","AlignComponent","setBlockType","setSelectedElementKey","setFontSize","fontColor","setFontColor","bgColor","setBgColor","fontFamily","setFontFamily","setCanUndo","setCanRedo","setIsRTL","setCodeLanguage","updateToolbar","elementKey","elementDOM","$isParentElementRTL","parentList","$getNearestNodeOfType","getListType","$isHeadingNode","getTag","$getSelectionStyleValueForProperty","_payload","newEditor","CAN_UNDO_COMMAND","CAN_REDO_COMMAND","applyStyleText","$patchStyleText","has","PUNCTUATION","NAME","DocumentMentionsRegex","CapitalizedNameMentionsRegex","RegExp","PUNC","TRIGGERS","VALID_CHARS","VALID_JOINS","LENGTH_LIMIT","AtSignMentionsRegex","ALIAS_LENGTH_LIMIT","AtSignMentionsRegexAliasRegex","SUGGESTION_LIST_LENGTH_LIMIT","mentionsCache","Map","useMentionLookupService","mentionString","mentionData","setResults","cachedResults","then","checkForCapitalizedNameMentions","minMatchLength","maybeLeadingWhitespace","matchingString","leadOffset","replaceableString","checkForAtSignMentions","getPossibleQueryMatch","MentionTypeaheadOption","TypeaheadOption","picture","MentionsTypeaheadMenuItem","isSelected","onMouseEnter","setRefElement","MentionsPlugin","props","searchData","getTypeaheadValues","queryString","setQueryString","checkForSlashTriggerMatch","useBasicTypeaheadTriggerMatch","minLength","slice","onSelectOption","selectedOption","nodeToReplace","closeMenu","$createAutoLinkNode","checkForMentionMatch","mentionMatch","slashMatch","LexicalTypeaheadMenuPlugin","onQueryChange","triggerFn","menuRenderFn","anchorElementRef","selectedIndex","selectOptionAndCleanUp","setHighlightedIndex","ReactDOM","basicColors","WIDTH","HEIGHT","ColorPicker","rest","selfColor","setSelfColor","transformColor","saturationPosition","hsv","s","v","huePosition","h","onMoveSaturation","newHsv","newColor","onMoveHue","hex","basicColor","MoveWrapper","divRef","move","clamp","_e","toHex","startsWith","ctx","getContext","fillStyle","hex2rgb","rbgArr","m","g","b","parseInt","rgb2hsv","d","hsv2rgb","f","p","q","round","rgb2hex","padStart","rgb","BackgroundColorPicker","onBgColorSelect","BoldButton","CodeFormatButton","PREVIEW_CACHE","useSuspenseRequest","cached","preview","fetch","encodeURI","response","json","catch","Promise","LinkPreviewContent","domain","description","Glimmer","animationDelay","LinkPreview","positionEditorElement","FloatingLinkEditor","editorRef","inputRef","linkUrl","setLinkUrl","isEditMode","setEditMode","lastSelection","setLastSelection","updateLinkEditor","getURL","editorElem","onKeyDown","rel","defaultFontFamilyOptions","FontFamilyDropdown","fontOptions","onFontFamilySelect","defaultFontSizeOptions","FontSizeDropdown","fontSizeOptions","onFontSizeSelect","InsertLinkButton","ItalicButton","TextColorPicker","onFontColorSelect","TextFormatDropdown","UnderlineButton","imageCache","useSuspenseImage","resolve","Image","LazyImage","imageRef"],"mappings":"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"}