{"version":3,"file":"verbum.cjs.development.js","sources":["../src/nodes/EmojiNode.tsx","../src/nodes/ImageNode.tsx","../src/nodes/KeywordNode.ts","../src/nodes/MentionNode.ts","../src/utils/join-classes.ts","../src/ui/Button.tsx","../src/nodes/PollNode.tsx","../src/shared/src/canUseDOM.ts","../src/shared/src/useLayoutEffect.ts","../src/collaboration.ts","../src/context/SharedHistoryContext.tsx","../src/themes/PlaygroundEditorTheme.ts","../src/themes/StickyEditorTheme.ts","../src/ui/ContentEditable.tsx","../src/ui/Placeholder.tsx","../src/nodes/StickyNode.tsx","../src/nodes/TypeaheadNode.ts","../src/nodes/YouTubeNode.tsx","../src/nodes/PlaygroundNodes.ts","../src/locale/index.tsx","../src/EditorComposer.tsx","../src/appSettings.ts","../src/context/SettingsContext.tsx","../src/ui/Modal.tsx","../src/hooks/useModal.tsx","../src/plugins/MarkdownTransformers.ts","../src/hooks/useReport.ts","../src/plugins/SpeechToTextPlugin.ts","../src/plugins/ActionsPlugin.tsx","../src/plugins/AutoLinkPlugin.tsx","../src/plugins/CommentPlugin.tsx","../src/plugins/CharacterStylesPopupPlugin.tsx","../src/plugins/ClickableLinkPlugin.ts","../src/plugins/CodeHighlightPlugin.ts","../src/plugins/KeywordsPlugin.ts","../src/plugins/ListMaxIndentLevelPlugin.ts","../src/plugins/MarkdownShortcutPlugin.tsx","../src/plugins/TabFocusPlugin.tsx","../src/context/EditorContext.tsx","../src/ui/Dialog.tsx","../src/ui/FileInput.tsx","../src/ui/TextInput.tsx","../src/plugins/ImagesPlugin.tsx","../src/plugins/DragDropPastePlugin.tsx","../src/Editor.tsx","../src/utils/node.util.ts","../src/context/ToolbarContext.tsx","../src/ui/DropDown.tsx","../src/plugins/ToolbarPlugin/components/AlignDropdown.tsx","../src/shared/src/environment.ts","../src/plugins/ToolbarPlugin/components/UndoButton.tsx","../src/plugins/ToolbarPlugin/components/RedoButton.tsx","../src/ui/Select.tsx","../src/plugins/ToolbarPlugin/components/CodeLanguageDropdown.tsx","../src/plugins/ToolbarPlugin/components/BlockFormatDropdown.tsx","../src/ui/Divider.tsx","../src/plugins/ToolbarPlugin/ToolbarPlugin.tsx","../src/plugins/MentionsPlugin.tsx","../src/ui/ColorPicker.tsx","../src/plugins/ToolbarPlugin/components/BackgroundColorPicker.tsx","../src/plugins/ToolbarPlugin/components/BoldButton.tsx","../src/plugins/ToolbarPlugin/components/CodeFormatButton.tsx","../src/ui/LinkPreview.tsx","../src/plugins/ToolbarPlugin/components/FloatingLinkEditor.tsx","../src/plugins/ToolbarPlugin/components/FontFamilyDropdown.tsx","../src/plugins/ToolbarPlugin/components/FontSizeDropdown.tsx","../src/plugins/PollPlugin.ts","../src/plugins/YouTubePlugin.ts","../src/plugins/TableCellResizer.tsx","../src/plugins/TableActionMenuPlugin.tsx","../src/plugins/HorizontalRulePlugin.ts","../src/plugins/ToolbarPlugin/components/InsertDropdown.tsx","../src/plugins/ToolbarPlugin/components/InsertLinkButton.tsx","../src/plugins/ToolbarPlugin/components/ItalicButton.tsx","../src/plugins/ToolbarPlugin/components/TextColorPicker.tsx","../src/plugins/ToolbarPlugin/components/TextFormatDropdown.tsx","../src/plugins/ToolbarPlugin/components/UnderlineButton.tsx","../src/nodes/ImageComponent.tsx"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport React from 'react';\n\nimport type { EditorConfig, LexicalNode, NodeKey } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedEmojiNode = Spread<\n  {\n    className: string;\n    type: 'emoji';\n  },\n  typeof SerializedTextNode\n>;\n\nlet __className: string = 'EmojiNode';\nexport class EmojiNode extends TextNode {\n  static getType(): string {\n    return 'emoji';\n  }\n\n  static clone(node: EmojiNode): EmojiNode {\n    return new EmojiNode(__className, node.__text, node.__key);\n  }\n\n  constructor(className: string, text: string, key?: NodeKey) {\n    super(text, key);\n    __className = className;\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = document.createElement('span');\n    const inner = super.createDOM(config);\n    dom.className = __className;\n    inner.className = 'emoji-inner';\n    dom.appendChild(inner);\n    return dom;\n  }\n\n  updateDOM(\n    prevNode: TextNode,\n    dom: HTMLElement,\n    config: EditorConfig\n  ): boolean {\n    const inner = dom.firstChild;\n    if (inner === null) {\n      return true;\n    }\n    super.updateDOM(prevNode, inner as HTMLElement, config);\n    return false;\n  }\n\n  static importJSON(serializedNode: SerializedEmojiNode): EmojiNode {\n    const node = $createEmojiNode(\n      serializedNode.className,\n      serializedNode.text\n    );\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedEmojiNode {\n    return {\n      ...super.exportJSON(),\n      className: this.getClassName(),\n      type: 'emoji',\n    };\n  }\n\n  getClassName(): string {\n    const self = this.getLatest();\n    return self.__className;\n  }\n}\n\nexport function $isEmojiNode(\n  node: LexicalNode | null | undefined\n): node is EmojiNode {\n  return node instanceof EmojiNode;\n}\n\nexport function $createEmojiNode(\n  className: string,\n  emojiText: string\n): EmojiNode {\n  return new EmojiNode(className, emojiText).setMode('token');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedEditor,\n  SerializedLexicalNode,\n  Spread,\n} from 'lexical';\n\nimport { $applyNodeReplacement, createEditor, DecoratorNode } from 'lexical';\nimport * as React from 'react';\nimport { Suspense } from 'react';\n\nconst ImageComponent = React.lazy(\n  // @ts-ignore\n  () => import('./ImageComponent')\n);\n\nexport interface ImagePayload {\n  altText: string;\n  caption?: LexicalEditor;\n  height?: number;\n  key?: NodeKey;\n  maxWidth?: number;\n  showCaption?: boolean;\n  src: string;\n  width?: number;\n  captionsEnabled?: boolean;\n}\n\nfunction convertImageElement(domNode: Node): null | DOMConversionOutput {\n  if (domNode instanceof HTMLImageElement) {\n    const { alt: altText, src, width, height } = domNode;\n    const node = $createImageNode({ altText, height, src, width });\n    return { node };\n  }\n  return null;\n}\n\nexport type SerializedImageNode = Spread<\n  {\n    altText: string;\n    caption: SerializedEditor;\n    height?: number;\n    maxWidth: number;\n    showCaption: boolean;\n    src: string;\n    width?: number;\n  },\n  SerializedLexicalNode\n>;\n\nexport class ImageNode extends DecoratorNode<JSX.Element> {\n  __src: string;\n  __altText: string;\n  __width: 'inherit' | number;\n  __height: 'inherit' | number;\n  __maxWidth: number;\n  __showCaption: boolean;\n  __caption: LexicalEditor;\n  // Captions cannot yet be used within editor cells\n  __captionsEnabled: boolean;\n\n  static getType(): string {\n    return 'image';\n  }\n\n  static clone(node: ImageNode): ImageNode {\n    return new ImageNode(\n      node.__src,\n      node.__altText,\n      node.__maxWidth,\n      node.__width,\n      node.__height,\n      node.__showCaption,\n      node.__caption,\n      node.__captionsEnabled,\n      node.__key\n    );\n  }\n\n  static importJSON(serializedNode: SerializedImageNode): ImageNode {\n    const { altText, height, width, maxWidth, caption, src, showCaption } =\n      serializedNode;\n    const node = $createImageNode({\n      altText,\n      height,\n      maxWidth,\n      showCaption,\n      src,\n      width,\n    });\n    const nestedEditor = node.__caption;\n    const editorState = nestedEditor.parseEditorState(caption.editorState);\n    if (!editorState.isEmpty()) {\n      nestedEditor.setEditorState(editorState);\n    }\n    return node;\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('img');\n    element.setAttribute('src', this.__src);\n    element.setAttribute('alt', this.__altText);\n    element.setAttribute('width', this.__width.toString());\n    element.setAttribute('height', this.__height.toString());\n    return { element };\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      img: (node: Node) => ({\n        conversion: convertImageElement,\n        priority: 0,\n      }),\n    };\n  }\n\n  constructor(\n    src: string,\n    altText: string,\n    maxWidth: number,\n    width?: 'inherit' | number,\n    height?: 'inherit' | number,\n    showCaption?: boolean,\n    caption?: LexicalEditor,\n    captionsEnabled?: boolean,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__src = src;\n    this.__altText = altText;\n    this.__maxWidth = maxWidth;\n    this.__width = width || 'inherit';\n    this.__height = height || 'inherit';\n    this.__showCaption = showCaption || false;\n    this.__caption = caption || createEditor();\n    this.__captionsEnabled = captionsEnabled || captionsEnabled === undefined;\n  }\n\n  exportJSON(): SerializedImageNode {\n    return {\n      altText: this.getAltText(),\n      caption: this.__caption.toJSON(),\n      height: this.__height === 'inherit' ? 0 : this.__height,\n      maxWidth: this.__maxWidth,\n      showCaption: this.__showCaption,\n      src: this.getSrc(),\n      type: 'image',\n      version: 1,\n      width: this.__width === 'inherit' ? 0 : this.__width,\n    };\n  }\n\n  setWidthAndHeight(\n    width: 'inherit' | number,\n    height: 'inherit' | number\n  ): void {\n    const writable = this.getWritable();\n    writable.__width = width;\n    writable.__height = height;\n  }\n\n  setShowCaption(showCaption: boolean): void {\n    const writable = this.getWritable();\n    writable.__showCaption = showCaption;\n  }\n\n  // View\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const span = document.createElement('span');\n    const theme = config.theme;\n    const className = theme.image;\n    if (className !== undefined) {\n      span.className = className;\n    }\n    return span;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getSrc(): string {\n    return this.__src;\n  }\n\n  getAltText(): string {\n    return this.__altText;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <Suspense fallback={null}>\n        <ImageComponent\n          src={this.__src}\n          altText={this.__altText}\n          width={this.__width}\n          height={this.__height}\n          maxWidth={this.__maxWidth}\n          nodeKey={this.getKey()}\n          showCaption={this.__showCaption}\n          caption={this.__caption}\n          captionsEnabled={this.__captionsEnabled}\n          resizable={true}\n        />\n      </Suspense>\n    );\n  }\n}\n\nexport function $createImageNode({\n  altText,\n  height,\n  maxWidth = 500,\n  captionsEnabled,\n  src,\n  width,\n  showCaption,\n  caption,\n  key,\n}: ImagePayload): ImageNode {\n  return $applyNodeReplacement(\n    new ImageNode(\n      src,\n      altText,\n      maxWidth,\n      width,\n      height,\n      showCaption,\n      caption,\n      captionsEnabled,\n      key\n    )\n  );\n}\n\nexport function $isImageNode(\n  node: LexicalNode | null | undefined\n): node is ImageNode {\n  return node instanceof ImageNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig, LexicalNode } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedKeywordNode = Spread<\n  {\n    type: 'keyword';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nexport class KeywordNode extends TextNode {\n  static getType(): string {\n    return 'keyword';\n  }\n\n  static clone(node: KeywordNode): KeywordNode {\n    return new KeywordNode(node.__text, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedKeywordNode): KeywordNode {\n    const node = $createKeywordNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedKeywordNode {\n    return {\n      ...super.exportJSON(),\n      type: 'keyword',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cursor = 'default';\n    dom.className = 'keyword';\n    return dom;\n  }\n\n  canInsertTextBefore(): boolean {\n    return false;\n  }\n\n  canInsertTextAfter(): boolean {\n    return false;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createKeywordNode(keyword: string): KeywordNode {\n  return new KeywordNode(keyword);\n}\n\nexport function $isKeywordNode(\n  node: LexicalNode | null | undefined | undefined\n): boolean {\n  return node instanceof KeywordNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig, LexicalNode, NodeKey } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedMentionNode = Spread<\n  {\n    mentionName: string;\n    type: 'mention';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nconst mentionStyle = 'background-color: rgba(24, 119, 232, 0.2)';\nexport class MentionNode extends TextNode {\n  __mention: string;\n\n  static getType(): string {\n    return 'mention';\n  }\n\n  static clone(node: MentionNode): MentionNode {\n    return new MentionNode(node.__mention, node.__text, node.__key);\n  }\n  static importJSON(serializedNode: SerializedMentionNode): MentionNode {\n    const node = $createMentionNode(serializedNode.mentionName);\n    node.setTextContent(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  constructor(mentionName: string, text?: string, key?: NodeKey) {\n    super(text ?? mentionName, key);\n    this.__mention = mentionName;\n  }\n\n  exportJSON(): SerializedMentionNode {\n    return {\n      ...super.exportJSON(),\n      mentionName: this.__mention,\n      type: 'mention',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = mentionStyle;\n    dom.className = 'mention';\n    return dom;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createMentionNode(mentionName: string): MentionNode {\n  const mentionNode = new MentionNode(mentionName);\n  mentionNode.setMode('segmented').toggleDirectionless();\n  return mentionNode;\n}\n\nexport function $isMentionNode(\n  node: LexicalNode | null | undefined\n): node is MentionNode {\n  return node instanceof MentionNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport default function joinClasses(...args) {\n  return args.filter(Boolean).join(' ');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Button.css';\n\nimport * as React from 'react';\n\nimport joinClasses from '../utils/join-classes';\n\nexport default function Button({\n  'data-test-id': dataTestId,\n  children,\n  className,\n  onClick,\n  disabled,\n  small,\n  title,\n}: {\n  'data-test-id'?: string;\n  children: JSX.Element | string | (JSX.Element | string)[];\n  className?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  small?: boolean;\n  title?: string;\n}): JSX.Element {\n  return (\n    <button\n      disabled={disabled}\n      className={joinClasses(\n        'Button__root',\n        disabled && 'Button__disabled',\n        small && 'Button__small',\n        className\n      )}\n      onClick={onClick}\n      title={title}\n      aria-label={title}\n      {...(dataTestId && { 'data-test-id': dataTestId })}\n    >\n      {children}\n    </button>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './PollNode.css';\n\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getNodeByKey, DecoratorNode } from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useMemo, useRef } from 'react';\n\nimport Button from '../ui/Button';\nimport joinClasses from '../utils/join-classes';\n\ntype Options = ReadonlyArray<Option>;\n\ntype Option = Readonly<{\n  text: string;\n  uid: string;\n  votes: Array<number>;\n}>;\n\nfunction createUID(): string {\n  return Math.random()\n    .toString(36)\n    .replace(/[^a-z]+/g, '')\n    .substr(0, 5);\n}\n\nfunction createPollOption(text = ''): Option {\n  return {\n    text,\n    uid: createUID(),\n    votes: [],\n  };\n}\n\nfunction cloneOption(\n  option: Option,\n  text: string,\n  votes?: Array<number>\n): Option {\n  return {\n    text,\n    uid: option.uid,\n    votes: votes || Array.from(option.votes),\n  };\n}\n\nfunction getTotalVotes(options: Options): number {\n  return options.reduce((totalVotes, next) => {\n    return totalVotes + next.votes.length;\n  }, 0);\n}\n\nfunction PollOptionComponent({\n  option,\n  index,\n  options,\n  totalVotes,\n  withPollNode,\n}: {\n  index: number;\n  option: Option;\n  options: Options;\n  totalVotes: number;\n  withPollNode: (cb: (PollNode) => void) => void;\n}): JSX.Element {\n  const { clientID } = useCollaborationContext();\n  const checkboxRef = useRef(null);\n  const votesArray = option.votes;\n  const checkedIndex = votesArray.indexOf(clientID);\n  const checked = checkedIndex !== -1;\n  const votes = votesArray.length;\n  const text = option.text;\n\n  return (\n    <div className=\"PollNode__optionContainer\">\n      <div\n        className={joinClasses(\n          'PollNode__optionCheckboxWrapper',\n          checked && 'PollNode__optionCheckboxChecked'\n        )}\n      >\n        <input\n          ref={checkboxRef}\n          className=\"PollNode__optionCheckbox\"\n          type=\"checkbox\"\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.toggleVote(option, clientID);\n            });\n          }}\n          checked={checked}\n        />\n      </div>\n      <div className=\"PollNode__optionInputWrapper\">\n        <div\n          className=\"PollNode__optionInputVotes\"\n          style={{ width: `${votes === 0 ? 0 : (votes / totalVotes) * 100}%` }}\n        />\n        <span className=\"PollNode__optionInputVotesCount\">\n          {votes > 0 && (votes === 1 ? '1 vote' : `${votes} votes`)}\n        </span>\n        <input\n          className=\"PollNode__optionInput\"\n          type=\"text\"\n          value={text}\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.setOptionText(option, e.target.value);\n            });\n          }}\n          placeholder={`Option ${index + 1}`}\n        />\n      </div>\n      <button\n        disabled={options.length < 3}\n        className={joinClasses(\n          'PollNode__optionDelete',\n          options.length < 3 && 'PollNode__optionDeleteDisabled'\n        )}\n        arial-label=\"Remove\"\n        onClick={() => {\n          withPollNode((node) => {\n            node.deleteOption(option);\n          });\n        }}\n      />\n    </div>\n  );\n}\n\nfunction PollComponent({\n  question,\n  options,\n  nodeKey,\n}: {\n  nodeKey: NodeKey;\n  options: Options;\n  question: string;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const totalVotes = useMemo(() => getTotalVotes(options), [options]);\n\n  const withPollNode = (cb: (node: PollNode) => void): void => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isPollNode(node)) {\n        cb(node);\n      }\n    });\n  };\n\n  const addOption = () => {\n    withPollNode((node) => {\n      node.addOption(createPollOption());\n    });\n  };\n\n  return (\n    <div className=\"PollNode__container\">\n      <h2 className=\"PollNode__heading\">{question}</h2>\n      {options.map((option, index) => {\n        const key = option.uid;\n        return (\n          <PollOptionComponent\n            key={key}\n            withPollNode={withPollNode}\n            option={option}\n            index={index}\n            options={options}\n            totalVotes={totalVotes}\n          />\n        );\n      })}\n      <div className=\"PollNode__footer\">\n        <Button onClick={addOption} small={true}>\n          Add Option\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport type SerializedPollNode = Spread<\n  {\n    question: string;\n    options: Options;\n    type: 'poll';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nfunction convertPollElement(domNode: HTMLElement): DOMConversionOutput {\n  const question = domNode.getAttribute('data-lexical-poll-question');\n  const node = $createPollNode(question);\n  return { node };\n}\n\nexport class PollNode extends DecoratorNode<JSX.Element> {\n  __question: string;\n  __options: Options;\n\n  static getType(): string {\n    return 'poll';\n  }\n\n  static clone(node: PollNode): PollNode {\n    return new PollNode(node.__question, node.__options, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedPollNode): PollNode {\n    const node = $createPollNode(serializedNode.question);\n    serializedNode.options.forEach(node.addOption);\n    return node;\n  }\n\n  constructor(question: string, options?: Options, key?: NodeKey) {\n    super(key);\n    this.__question = question;\n    this.__options = options || [createPollOption(), createPollOption()];\n  }\n\n  exportJSON(): SerializedPollNode {\n    return {\n      options: this.__options,\n      question: this.__question,\n      type: 'poll',\n      version: 1,\n    };\n  }\n\n  addOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    options.push(option);\n    self.__options = options;\n  }\n\n  deleteOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options.splice(index, 1);\n    self.__options = options;\n  }\n\n  setOptionText(option: Option, text: string): void {\n    const self = this.getWritable();\n    const clonedOption = cloneOption(option, text);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  toggleVote(option: Option, clientID: number): void {\n    const self = this.getWritable();\n    const votes = option.votes;\n    const votesClone = Array.from(votes);\n    const voteIndex = votes.indexOf(clientID);\n    if (voteIndex === -1) {\n      votesClone.push(clientID);\n    } else {\n      votesClone.splice(voteIndex, 1);\n    }\n    const clonedOption = cloneOption(option, option.text, votesClone);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      span: (domNode: HTMLElement) => {\n        if (!domNode.hasAttribute('data-lexical-poll-question')) {\n          return null;\n        }\n        return {\n          conversion: convertPollElement,\n          priority: 2,\n        };\n      },\n    };\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('span');\n    element.setAttribute('data-lexical-poll-question', this.__question);\n    return { element };\n  }\n\n  createDOM(): HTMLElement {\n    const elem = document.createElement('span');\n    elem.style.display = 'inline-block';\n    return elem;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <PollComponent\n        question={this.__question}\n        options={this.__options}\n        nodeKey={this.__key}\n      />\n    );\n  }\n}\n\nexport function $createPollNode(question: string): PollNode {\n  return new PollNode(question);\n}\n\nexport function $isPollNode(\n  node: LexicalNode | null | undefined\n): node is PollNode {\n  return node instanceof PollNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nimport { useEffect, useLayoutEffect } from 'react';\nimport { CAN_USE_DOM } from './canUseDOM';\n\nconst useLayoutEffectImpl: typeof useLayoutEffect = CAN_USE_DOM\n  ? useLayoutEffect\n  : useEffect;\n\nexport default useLayoutEffectImpl;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {Provider} from '@lexical/yjs';\nimport { WebsocketProvider } from 'y-websocket';\nimport { Doc } from 'yjs';\n\nconst url = new URL(window.location.href);\nconst params = new URLSearchParams(url.search);\nconst WEBSOCKET_ENDPOINT = 'ws://localhost:1234';\nconst WEBSOCKET_SLUG = 'playground';\nconst WEBSOCKET_ID = params.get('collabId') || '0';\n\n// parent dom -> child doc\nexport function createWebsocketProvider(\n  id: string,\n  yjsDocMap: Map<string, Doc>\n): Provider {\n  let doc = yjsDocMap.get(id);\n\n  if (doc === undefined) {\n    doc = new Doc();\n    yjsDocMap.set(id, doc);\n  } else {\n    doc.load();\n  }\n\n  \n  // @ts-ignore\n  return new WebsocketProvider(\n    WEBSOCKET_ENDPOINT,\n    WEBSOCKET_SLUG + '/' + WEBSOCKET_ID + '/' + id,\n    doc,\n    {\n      connect: false,\n    }\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { HistoryState } from '@lexical/react/LexicalHistoryPlugin';\n\nimport { createEmptyHistoryState } from '@lexical/react/LexicalHistoryPlugin';\nimport * as React from 'react';\nimport { createContext, useContext, useMemo } from 'react';\n\ntype ContextShape = {\n  historyState: HistoryState;\n};\n\nconst Context: React.Context<ContextShape> = createContext({\n  historyState: { current: null, redoStack: [], undoStack: [] },\n});\n\nexport const SharedHistoryContext = ({\n  children,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n}): JSX.Element => {\n  const historyContext = useMemo(\n    () => ({ historyState: createEmptyHistoryState() }),\n    []\n  );\n  return <Context.Provider value={historyContext}>{children}</Context.Provider>;\n};\n\nexport const useSharedHistoryContext = (): ContextShape => {\n  return useContext(Context);\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorThemeClasses } from 'lexical';\n\nimport './PlaygroundEditorTheme.css';\n\nconst theme: EditorThemeClasses = {\n  characterLimit: 'PlaygroundEditorTheme__characterLimit',\n  code: 'PlaygroundEditorTheme__code',\n  codeHighlight: {\n    atrule: 'PlaygroundEditorTheme__tokenAttr',\n    attr: 'PlaygroundEditorTheme__tokenAttr',\n    boolean: 'PlaygroundEditorTheme__tokenProperty',\n    builtin: 'PlaygroundEditorTheme__tokenSelector',\n    cdata: 'PlaygroundEditorTheme__tokenComment',\n    char: 'PlaygroundEditorTheme__tokenSelector',\n    class: 'PlaygroundEditorTheme__tokenFunction',\n    'class-name': 'PlaygroundEditorTheme__tokenFunction',\n    comment: 'PlaygroundEditorTheme__tokenComment',\n    constant: 'PlaygroundEditorTheme__tokenProperty',\n    deleted: 'PlaygroundEditorTheme__tokenProperty',\n    doctype: 'PlaygroundEditorTheme__tokenComment',\n    entity: 'PlaygroundEditorTheme__tokenOperator',\n    function: 'PlaygroundEditorTheme__tokenFunction',\n    important: 'PlaygroundEditorTheme__tokenVariable',\n    inserted: 'PlaygroundEditorTheme__tokenSelector',\n    keyword: 'PlaygroundEditorTheme__tokenAttr',\n    namespace: 'PlaygroundEditorTheme__tokenVariable',\n    number: 'PlaygroundEditorTheme__tokenProperty',\n    operator: 'PlaygroundEditorTheme__tokenOperator',\n    prolog: 'PlaygroundEditorTheme__tokenComment',\n    property: 'PlaygroundEditorTheme__tokenProperty',\n    punctuation: 'PlaygroundEditorTheme__tokenPunctuation',\n    regex: 'PlaygroundEditorTheme__tokenVariable',\n    selector: 'PlaygroundEditorTheme__tokenSelector',\n    string: 'PlaygroundEditorTheme__tokenSelector',\n    symbol: 'PlaygroundEditorTheme__tokenProperty',\n    tag: 'PlaygroundEditorTheme__tokenProperty',\n    url: 'PlaygroundEditorTheme__tokenOperator',\n    variable: 'PlaygroundEditorTheme__tokenVariable',\n  },\n  hashtag: 'PlaygroundEditorTheme__hashtag',\n  heading: {\n    h1: 'PlaygroundEditorTheme__h1',\n    h2: 'PlaygroundEditorTheme__h2',\n    h3: 'PlaygroundEditorTheme__h3',\n    h4: 'PlaygroundEditorTheme__h4',\n    h5: 'PlaygroundEditorTheme__h5',\n  },\n  image: 'editor-image',\n  link: 'PlaygroundEditorTheme__link',\n  list: {\n    listitem: 'PlaygroundEditorTheme__listItem',\n    listitemChecked: 'PlaygroundEditorTheme__listItemChecked',\n    listitemUnchecked: 'PlaygroundEditorTheme__listItemUnchecked',\n    nested: {\n      listitem: 'PlaygroundEditorTheme__nestedListItem',\n    },\n    olDepth: [\n      'PlaygroundEditorTheme__ol1',\n      'PlaygroundEditorTheme__ol2',\n      'PlaygroundEditorTheme__ol3',\n      'PlaygroundEditorTheme__ol4',\n      'PlaygroundEditorTheme__ol5',\n    ],\n    ul: 'PlaygroundEditorTheme__ul',\n  },\n  ltr: 'PlaygroundEditorTheme__ltr',\n  mark: 'PlaygroundEditorTheme__mark',\n  markOverlap: 'PlaygroundEditorTheme__markOverlap',\n  paragraph: 'PlaygroundEditorTheme__paragraph',\n  quote: 'PlaygroundEditorTheme__quote',\n  rtl: 'PlaygroundEditorTheme__rtl',\n  table: 'PlaygroundEditorTheme__table',\n  tableCell: 'PlaygroundEditorTheme__tableCell',\n  tableCellHeader: 'PlaygroundEditorTheme__tableCellHeader',\n  text: {\n    bold: 'PlaygroundEditorTheme__textBold',\n    code: 'PlaygroundEditorTheme__textCode',\n    italic: 'PlaygroundEditorTheme__textItalic',\n    strikethrough: 'PlaygroundEditorTheme__textStrikethrough',\n    subscript: 'PlaygroundEditorTheme__textSubscript',\n    superscript: 'PlaygroundEditorTheme__textSuperscript',\n    underline: 'PlaygroundEditorTheme__textUnderline',\n    underlineStrikethrough: 'PlaygroundEditorTheme__textUnderlineStrikethrough',\n  },\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorThemeClasses } from 'lexical';\n\nimport './StickyEditorTheme.css';\n\nimport baseTheme from './PlaygroundEditorTheme';\n\nconst theme: EditorThemeClasses = {\n  ...baseTheme,\n  paragraph: 'StickyEditorTheme__paragraph',\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './ContentEditable.css';\n\nimport { ContentEditable } from '@lexical/react/LexicalContentEditable';\nimport * as React from 'react';\n\nexport default function LexicalContentEditable({\n  className,\n}: {\n  className?: string;\n}): JSX.Element {\n  return <ContentEditable className={className || 'ContentEditable__root'} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Placeholder.css';\n\nimport * as React from 'react';\n\nexport default function Placeholder({\n  children,\n  className,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  className?: string;\n}): JSX.Element {\n  return <div className={className || 'Placeholder__root'}>{children}</div>;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './StickyNode.css';\n\nimport { CollaborationPlugin } from '@lexical/react/LexicalCollaborationPlugin';\n\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { LexicalNestedComposer } from '@lexical/react/LexicalNestedComposer';\nimport { PlainTextPlugin } from '@lexical/react/LexicalPlainTextPlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport {\n  $getNodeByKey,\n  $setSelection,\n  createEditor,\n  DecoratorNode,\n} from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport { createWebsocketProvider } from '../collaboration';\nimport { useSharedHistoryContext } from '../context/SharedHistoryContext';\nimport StickyEditorTheme from '../themes/StickyEditorTheme';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\n\nfunction positionSticky(stickyElem: HTMLElement, positioning): void {\n  const style = stickyElem.style;\n  const rootElementRect = positioning.rootElementRect;\n  const rectLeft = rootElementRect !== null ? rootElementRect.left : 0;\n  const rectTop = rootElementRect !== null ? rootElementRect.top : 0;\n  style.top = rectTop + positioning.y + 'px';\n  style.left = rectLeft + positioning.x + 'px';\n}\n\nfunction StickyComponent({\n  x,\n  y,\n  nodeKey,\n  color,\n  caption,\n}: {\n  caption: LexicalEditor;\n  color: 'pink' | 'yellow';\n  nodeKey: NodeKey;\n  x: number;\n  y: number;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const stickyContainerRef = useRef<null | HTMLDivElement>(null);\n  const positioningRef = useRef<{\n    isDragging: boolean;\n    offsetX: number;\n    offsetY: number;\n    rootElementRect: null | ClientRect;\n    x: number;\n    y: number;\n  }>({\n    isDragging: false,\n    offsetX: 0,\n    offsetY: 0,\n    rootElementRect: null,\n    x: 0,\n    y: 0,\n  });\n  const { yjsDocMap } = useCollaborationContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n\n  useEffect(() => {\n    const position = positioningRef.current;\n    position.x = x;\n    position.y = y;\n\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      positionSticky(stickyContainer, position);\n    }\n  }, [x, y]);\n\n  useLayoutEffect(() => {\n    const position = positioningRef.current;\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (let i = 0; i < entries.length; i++) {\n        const entry = entries[i];\n        const { target } = entry;\n        position.rootElementRect = target.getBoundingClientRect();\n        const stickyContainer = stickyContainerRef.current;\n        if (stickyContainer !== null) {\n          positionSticky(stickyContainer, position);\n        }\n      }\n    });\n\n    const removeRootListener = editor.registerRootListener(\n      (nextRootElem, prevRootElem) => {\n        if (prevRootElem !== null) {\n          resizeObserver.unobserve(prevRootElem);\n        }\n        if (nextRootElem !== null) {\n          resizeObserver.observe(nextRootElem);\n        }\n      }\n    );\n\n    const handleWindowResize = () => {\n      const rootElement = editor.getRootElement();\n      const stickyContainer = stickyContainerRef.current;\n      if (rootElement !== null && stickyContainer !== null) {\n        position.rootElementRect = rootElement.getBoundingClientRect();\n        positionSticky(stickyContainer, position);\n      }\n    };\n\n    window.addEventListener('resize', handleWindowResize);\n\n    return () => {\n      window.removeEventListener('resize', handleWindowResize);\n      removeRootListener();\n    };\n  }, [editor]);\n\n  useEffect(() => {\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      // Delay adding transition so we don't trigger the\n      // transition on load of the sticky.\n      setTimeout(() => {\n        stickyContainer.style.setProperty(\n          'transition',\n          'top 0.3s ease 0s, left 0.3s ease 0s'\n        );\n      }, 500);\n    }\n  }, []);\n\n  const handlePointerMove = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    const rootElementRect = positioning.rootElementRect;\n    if (\n      stickyContainer !== null &&\n      positioning.isDragging &&\n      rootElementRect !== null\n    ) {\n      positioning.x = event.pageX - positioning.offsetX - rootElementRect.left;\n      positioning.y = event.pageY - positioning.offsetY - rootElementRect.top;\n      positionSticky(stickyContainer, positioning);\n    }\n  };\n\n  const handlePointerUp = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    if (stickyContainer !== null) {\n      positioning.isDragging = false;\n      stickyContainer.classList.remove('dragging');\n      editor.update(() => {\n        const node = $getNodeByKey(nodeKey);\n        if ($isStickyNode(node)) {\n          node.setPosition(positioning.x, positioning.y);\n        }\n      });\n    }\n    document.removeEventListener('pointermove', handlePointerMove);\n    document.removeEventListener('pointerup', handlePointerUp);\n  };\n\n  const handleDelete = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.remove();\n      }\n    });\n  };\n\n  const handleColorChange = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.toggleColor();\n      }\n    });\n  };\n\n  const { historyState } = useSharedHistoryContext();\n\n  return (\n    <div ref={stickyContainerRef} className=\"sticky-note-container\">\n      <div\n        className={`sticky-note ${color}`}\n        onPointerDown={(event) => {\n          const stickyContainer = stickyContainerRef.current;\n          if (\n            stickyContainer == null ||\n            event.button === 2 ||\n            event.target !== stickyContainer.firstChild\n          ) {\n            // Right click or click on editor should not work\n            return;\n          }\n          const stickContainer = stickyContainer;\n          const positioning = positioningRef.current;\n          if (stickContainer !== null) {\n            const { top, left } = stickContainer.getBoundingClientRect();\n            positioning.offsetX = event.clientX - left;\n            positioning.offsetY = event.clientY - top;\n            positioning.isDragging = true;\n            stickContainer.classList.add('dragging');\n            document.addEventListener('pointermove', handlePointerMove);\n            document.addEventListener('pointerup', handlePointerUp);\n            event.preventDefault();\n          }\n        }}\n      >\n        <button\n          onClick={handleDelete}\n          className=\"delete\"\n          aria-label=\"Delete sticky note\"\n          title=\"Delete\"\n        >\n          X\n        </button>\n        <button\n          onClick={handleColorChange}\n          className=\"color\"\n          aria-label=\"Change sticky note color\"\n          title=\"Color\"\n        >\n          <i className=\"bucket\" />\n        </button>\n        <LexicalNestedComposer\n          initialEditor={caption}\n          initialTheme={StickyEditorTheme}\n        >\n          {isCollab ? (\n            <CollaborationPlugin\n              id={caption.getKey()}\n              providerFactory={createWebsocketProvider}\n              shouldBootstrap={true}\n            />\n          ) : (\n            <HistoryPlugin externalHistoryState={historyState} />\n          )}\n          <PlainTextPlugin\n            contentEditable={\n              <ContentEditable className=\"StickyNode__contentEditable\" />\n            }\n            placeholder={\n              <Placeholder className=\"StickyNode__placeholder\">\n                What's up?\n              </Placeholder>\n            }\n            ErrorBoundary={LexicalErrorBoundary}\n          />\n        </LexicalNestedComposer>\n      </div>\n    </div>\n  );\n}\n\ntype StickyNoteColor = 'pink' | 'yellow';\n\nexport type SerializedStickyNode = Spread<\n  {\n    xOffset: number;\n    yOffset: number;\n    color: StickyNoteColor;\n    caption: LexicalEditor;\n    type: 'sticky';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nexport class StickyNode extends DecoratorNode<JSX.Element> {\n  __x: number;\n  __y: number;\n  __color: StickyNoteColor;\n  __caption: LexicalEditor;\n\n  static getType(): string {\n    return 'sticky';\n  }\n\n  static clone(node: StickyNode): StickyNode {\n    return new StickyNode(\n      node.__x,\n      node.__y,\n      node.__color,\n      node.__caption,\n      node.__key\n    );\n  }\n  static importJSON(serializedNode: SerializedStickyNode): StickyNode {\n    return new StickyNode(\n      serializedNode.xOffset,\n      serializedNode.yOffset,\n      serializedNode.color,\n      serializedNode.caption\n    );\n  }\n\n  constructor(\n    x: number,\n    y: number,\n    color: 'pink' | 'yellow',\n    caption?: LexicalEditor,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__x = x;\n    this.__y = y;\n    this.__caption = caption || createEditor();\n    this.__color = color;\n  }\n\n  exportJSON(): SerializedStickyNode {\n    return {\n      caption: this.__caption,\n      color: this.__color,\n      type: 'sticky',\n      version: 1,\n      xOffset: this.__x,\n      yOffset: this.__y,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const div = document.createElement('div');\n    div.style.display = 'contents';\n    return div;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  setPosition(x: number, y: number): void {\n    const writable = this.getWritable();\n    writable.__x = x;\n    writable.__y = y;\n    $setSelection(null);\n  }\n\n  toggleColor(): void {\n    const writable = this.getWritable();\n    writable.__color = writable.__color === 'pink' ? 'yellow' : 'pink';\n  }\n\n  decorate(editor: LexicalEditor): JSX.Element {\n    return createPortal(\n      <StickyComponent\n        color={this.__color}\n        x={this.__x}\n        y={this.__y}\n        nodeKey={this.getKey()}\n        caption={this.__caption}\n      />,\n      document.body\n    );\n  }\n\n  isIsolated(): true {\n    return true;\n  }\n}\n\nexport function $isStickyNode(\n  node: LexicalNode | null | undefined\n): node is StickyNode {\n  return node instanceof StickyNode;\n}\n\nexport function $createStickyNode(\n  xOffset: number,\n  yOffset: number\n): StickyNode {\n  return new StickyNode(xOffset, yOffset, 'yellow');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig } from 'lexical';\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedTypeaheadNode = Spread<\n  {\n    type: 'typeahead';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nexport class TypeaheadNode extends TextNode {\n  static clone(node: TypeaheadNode): TypeaheadNode {\n    return new TypeaheadNode(node.__text, node.__key);\n  }\n\n  static getType(): 'typeahead' {\n    return 'typeahead';\n  }\n\n  static importJSON(serializedNode: SerializedTypeaheadNode): TypeaheadNode {\n    const node = $createTypeaheadNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedTypeaheadNode {\n    return {\n      ...super.exportJSON(),\n      type: 'typeahead',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = 'color: #ccc;';\n    return dom;\n  }\n}\n\nexport function $createTypeaheadNode(text: string): TypeaheadNode {\n  return new TypeaheadNode(text).setMode('token');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  ElementFormatType,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  Spread,\n} from 'lexical';\n\nimport { BlockWithAlignableContents } from '@lexical/react/LexicalBlockWithAlignableContents';\nimport {\n  DecoratorBlockNode,\n  SerializedDecoratorBlockNode,\n} from '@lexical/react/LexicalDecoratorBlockNode';\nimport * as React from 'react';\n\ntype YouTubeComponentProps = Readonly<{\n  className: Readonly<{\n    base: string;\n    focus: string;\n  }>;\n  format: ElementFormatType | null;\n  nodeKey: NodeKey;\n  videoID: string;\n}>;\n\nfunction YouTubeComponent({\n  className,\n  format,\n  nodeKey,\n  videoID,\n}: YouTubeComponentProps) {\n  return (\n    <BlockWithAlignableContents\n      className={className}\n      format={format}\n      nodeKey={nodeKey}\n    >\n      <iframe\n        width=\"560\"\n        height=\"315\"\n        src={`https://www.youtube.com/embed/${videoID}`}\n        frameBorder=\"0\"\n        allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n        allowFullScreen={true}\n        title=\"YouTube video\"\n      />\n    </BlockWithAlignableContents>\n  );\n}\n\nexport type SerializedYouTubeNode = Spread<\n  {\n    videoID: string;\n    type: 'youtube';\n    version: 1;\n  },\n  SerializedDecoratorBlockNode\n>;\n\nexport class YouTubeNode extends DecoratorBlockNode {\n  __id: string;\n\n  static getType(): string {\n    return 'youtube';\n  }\n\n  static clone(node: YouTubeNode): YouTubeNode {\n    return new YouTubeNode(node.__id, node.__format, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedYouTubeNode): YouTubeNode {\n    const node = $createYouTubeNode(serializedNode.videoID);\n    node.setFormat(serializedNode.format);\n    return node;\n  }\n\n  exportJSON(): SerializedYouTubeNode {\n    return {\n      ...super.exportJSON(),\n      type: 'youtube',\n      version: 1,\n      videoID: this.__id,\n    };\n  }\n\n  constructor(id: string, format?: ElementFormatType, key?: NodeKey) {\n    super(format, key);\n    this.__id = id;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getId(): string {\n    return this.__id;\n  }\n\n  decorate(_editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    const embedBlockTheme = config.theme.embedBlock || {};\n    const className = {\n      base: embedBlockTheme.base || '',\n      focus: embedBlockTheme.focus || '',\n    };\n    return (\n      <YouTubeComponent\n        className={className}\n        format={this.__format}\n        nodeKey={this.getKey()}\n        videoID={this.__id}\n      />\n    );\n  }\n\n  isTopLevel(): true {\n    return true;\n  }\n}\n\nexport function $createYouTubeNode(videoID: string): YouTubeNode {\n  return new YouTubeNode(videoID);\n}\n\nexport function $isYouTubeNode(\n  node: YouTubeNode | LexicalNode | null | undefined\n): node is YouTubeNode {\n  return node instanceof YouTubeNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalNode } from 'lexical';\n\nimport { CodeHighlightNode, CodeNode } from '@lexical/code';\nimport { HashtagNode } from '@lexical/hashtag';\nimport { AutoLinkNode, LinkNode } from '@lexical/link';\nimport { ListItemNode, ListNode } from '@lexical/list';\nimport { MarkNode } from '@lexical/mark';\nimport { OverflowNode } from '@lexical/overflow';\nimport { HorizontalRuleNode } from '@lexical/react/LexicalHorizontalRuleNode';\nimport { HeadingNode, QuoteNode } from '@lexical/rich-text';\nimport { TableCellNode, TableNode, TableRowNode } from '@lexical/table';\nimport { Class } from 'utility-types';\n\nimport { EmojiNode } from './EmojiNode';\nimport { ImageNode } from './ImageNode';\nimport { KeywordNode } from './KeywordNode';\nimport { MentionNode } from './MentionNode';\nimport { PollNode } from './PollNode';\nimport { StickyNode } from './StickyNode';\nimport { TypeaheadNode } from './TypeaheadNode';\nimport { YouTubeNode } from './YouTubeNode';\n\nconst PlaygroundNodes: Array<Class<LexicalNode>> = [\n  HeadingNode,\n  ListNode,\n  ListItemNode,\n  QuoteNode,\n  CodeNode,\n  TableNode,\n  TableCellNode,\n  TableRowNode,\n  HashtagNode,\n  CodeHighlightNode,\n  AutoLinkNode,\n  LinkNode,\n  OverflowNode,\n  PollNode,\n  StickyNode,\n  ImageNode,\n  MentionNode,\n  EmojiNode,\n  TypeaheadNode,\n  KeywordNode,\n  HorizontalRuleNode,\n  YouTubeNode,\n  MarkNode,\n];\n\nexport default PlaygroundNodes;\n","import * as i18next from 'i18next';\nimport EN from './languages/en.json';\nimport FR from './languages/fr.json';\nimport PTBR from './languages/ptBr.json';\nimport RU from './languages/ru.json';\n\nexport const resources = {\n  ar: {},\n  de: {},\n  en: EN,\n  es: {},\n  fr: FR,\n  it: {},\n  ja: {},\n  nl: {},\n  pl: {},\n  pt: {},\n  ptBr: PTBR,\n  ru: RU,\n  ukr: {},\n  zh: {},\n} as const;\n\nexport const languageDetector = {\n  type: 'languageDetector',\n  async: true,\n  detect: (callback) => {\n    const language = navigator.language;\n    callback(language.substring(0, 2));\n  },\n  init: () => {},\n  cacheUserLanguage: () => {},\n};\n\nconst i18n = i18next\n  .createInstance(\n    {\n      ns: ['toolbar', 'action'],\n      resources,\n      fallbackLng: 'en',\n      debug: true,\n      interpolation: {\n        escapeValue: false,\n      },\n    },\n    // We must provide a function as second parameter, otherwise i18next errors\n    (err, t) => {}\n  )\n  .use(languageDetector as i18next.Module);\n\nexport default i18n;\n","import {\n  LexicalComposer,\n  InitialEditorStateType,\n} from '@lexical/react/LexicalComposer';\nimport React from 'react';\nimport PlaygroundNodes from './nodes/PlaygroundNodes';\nimport PlaygroundEditorTheme from './themes/PlaygroundEditorTheme';\nimport './EditorComposer.css';\nimport i18n from './locale';\nimport { I18nextProvider } from 'react-i18next';\n\ninterface IEditorComposer {\n  children: React.ReactElement;\n  initialEditorState?: InitialEditorStateType;\n}\n\nconst EditorComposer = ({ children, initialEditorState }: IEditorComposer) => {\n  const initialConfig = {\n    namespace: 'VerbumEditor',\n    nodes: [...PlaygroundNodes],\n    onError: (error) => {\n      throw error;\n    },\n    theme: PlaygroundEditorTheme,\n    editorState: initialEditorState,\n  };\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <I18nextProvider i18n={i18n}>\n          <div className=\"verbum-editor-shell\">{children}</div>\n      </I18nextProvider>\n    </LexicalComposer>\n  );\n};\n\nexport default EditorComposer;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport type SettingName =\n  | 'disableBeforeInput'\n  | 'measureTypingPerf'\n  | 'isRichText'\n  | 'isCollab'\n  | 'isCharLimit'\n  | 'isCharLimitUtf8'\n  | 'isAutocomplete'\n  | 'showTreeView'\n  | 'showNestedEditorTreeView'\n  | 'emptyEditor';\n\nexport type Settings = Record<SettingName, boolean>;\n\nconst hostName = window.location.hostname;\nexport const isDevPlayground: boolean =\n  hostName !== 'playground.lexical.dev' &&\n  hostName !== 'lexical-playground.vercel.app';\n\nexport const DEFAULT_SETTINGS: Settings = {\n  disableBeforeInput: false,\n  emptyEditor: isDevPlayground,\n  isAutocomplete: false,\n  isCharLimit: false,\n  isCharLimitUtf8: false,\n  isCollab: false,\n  isRichText: true,\n  measureTypingPerf: false,\n  showNestedEditorTreeView: false,\n  showTreeView: true,\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { SettingName } from '../appSettings';\n\nimport * as React from 'react';\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n} from 'react';\n\nimport { DEFAULT_SETTINGS } from '../appSettings';\n\ntype SettingsContextShape = {\n  setOption: (name: SettingName, value: boolean) => void;\n  settings: Record<SettingName, boolean>;\n};\n\nconst Context: React.Context<SettingsContextShape> = createContext({\n  setOption: (name: SettingName, value: boolean) => {\n    return;\n  },\n  settings: DEFAULT_SETTINGS,\n});\n\nexport const SettingsContext = ({\n  children,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n}): JSX.Element => {\n  const [settings, setSettings] = useState(DEFAULT_SETTINGS);\n  const setOption = useCallback((setting: SettingName, value: boolean) => {\n    setSettings((options) => ({\n      ...options,\n      [setting as string]: value,\n    }));\n    if (DEFAULT_SETTINGS[setting] === value) {\n      setURLParam(setting, null);\n    } else {\n      setURLParam(setting, value);\n    }\n  }, []);\n  const contextValue = useMemo(() => {\n    return { setOption, settings };\n  }, [setOption, settings]);\n  return <Context.Provider value={contextValue}>{children}</Context.Provider>;\n};\n\nexport const useSettings = (): SettingsContextShape => {\n  return useContext(Context);\n};\n\nfunction setURLParam(param: SettingName, value: null | boolean) {\n  const url = new URL(window.location.href);\n  const params = new URLSearchParams(url.search);\n  if (value !== null) {\n    if (params.has(param)) {\n      params.set(param, String(value));\n    } else {\n      params.append(param, String(value));\n    }\n  } else {\n    if (params.has(param)) {\n      params.delete(param);\n    }\n  }\n  url.search = params.toString();\n  window.history.pushState(null, '', url.toString());\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Modal.css';\n\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\n\nfunction PortalImpl({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  closeOnClickOutside: boolean;\n  onClose: () => void;\n  title: string;\n}) {\n  const modalRef = useRef<HTMLDivElement>();\n\n  useEffect(() => {\n    if (modalRef.current !== null) {\n      modalRef.current.focus();\n    }\n  }, []);\n\n  useEffect(() => {\n    let modalOverlayElement = null;\n    const handler = (event) => {\n      if (event.keyCode === 27) {\n        onClose();\n      }\n    };\n    const clickOutsideHandler = (event: MouseEvent) => {\n      const target = event.target;\n      if (\n        modalRef.current !== null &&\n        !modalRef.current.contains(target as Node) &&\n        closeOnClickOutside\n      ) {\n        onClose();\n      }\n    };\n    if (modalRef.current !== null) {\n      modalOverlayElement = modalRef.current?.parentElement;\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.addEventListener('click', clickOutsideHandler);\n      }\n    }\n\n    window.addEventListener('keydown', handler);\n\n    return () => {\n      window.removeEventListener('keydown', handler);\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.removeEventListener('click', clickOutsideHandler);\n      }\n    };\n  }, [closeOnClickOutside, onClose]);\n\n  return (\n    <div className=\"Modal__overlay\" role=\"dialog\">\n      <div className=\"Modal__modal\" tabIndex={-1} ref={modalRef}>\n        <h2 className=\"Modal__title\">{title}</h2>\n        <button\n          className=\"Modal__closeButton\"\n          aria-label=\"Close modal\"\n          type=\"button\"\n          onClick={onClose}\n        >\n          X\n        </button>\n        <div className=\"Modal__content\">{children}</div>\n      </div>\n    </div>\n  );\n}\n\nexport default function Modal({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside = false,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  closeOnClickOutside?: boolean;\n  onClose: () => void;\n  title: string;\n}): JSX.Element {\n  return createPortal(\n    <PortalImpl\n      onClose={onClose}\n      title={title}\n      closeOnClickOutside={closeOnClickOutside}\n    >\n      {children}\n    </PortalImpl>,\n    document.body\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCallback, useMemo, useState } from 'react';\nimport * as React from 'react';\n\nimport Modal from '../ui/Modal';\n\nexport default function useModal(): [\n  JSX.Element,\n  (title: string, showModal: (onClose: () => void) => JSX.Element) => void\n] {\n  const [modalContent, setModalContent] = useState<null | {\n    closeOnClickOutside: boolean;\n    content: JSX.Element;\n    title: string;\n  }>(null);\n\n  const onClose = useCallback(() => {\n    setModalContent(null);\n  }, []);\n\n  const modal = useMemo(() => {\n    if (modalContent === null) {\n      return null;\n    }\n    const { title, content, closeOnClickOutside } = modalContent;\n    return (\n      <Modal\n        onClose={onClose}\n        title={title}\n        closeOnClickOutside={closeOnClickOutside}\n      >\n        {content}\n      </Modal>\n    );\n  }, [modalContent, onClose]);\n\n  const showModal = useCallback(\n    (\n      title,\n      // eslint-disable-next-line no-shadow\n      getContent: (onClose: () => void) => JSX.Element,\n      closeOnClickOutside = false\n    ) => {\n      setModalContent({\n        closeOnClickOutside,\n        content: getContent(onClose),\n        title,\n      });\n    },\n    [onClose]\n  );\n\n  return [modal, showModal];\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  ElementTransformer,\n  TextMatchTransformer,\n  Transformer,\n} from '@lexical/markdown';\nimport type { ElementNode, LexicalNode } from 'lexical';\n\nimport {\n  CHECK_LIST,\n  ELEMENT_TRANSFORMERS,\n  TEXT_FORMAT_TRANSFORMERS,\n  TEXT_MATCH_TRANSFORMERS,\n} from '@lexical/markdown';\nimport {\n  $createHorizontalRuleNode,\n  $isHorizontalRuleNode,\n  HorizontalRuleNode,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $createTableCellNode,\n  $createTableNode,\n  $createTableRowNode,\n  $isTableNode,\n  $isTableRowNode,\n  TableCellHeaderStates,\n  TableCellNode,\n  TableNode,\n  TableRowNode,\n} from '@lexical/table';\nimport {\n  $createParagraphNode,\n  $createTextNode,\n  $isElementNode,\n  $isParagraphNode,\n  $isTextNode,\n} from 'lexical';\n\nimport { $createImageNode, $isImageNode, ImageNode } from '../nodes/ImageNode';\n\nexport const HR: ElementTransformer = {\n  dependencies: [HorizontalRuleNode],\n  export: (node: LexicalNode) => {\n    return $isHorizontalRuleNode(node) ? '***' : null;\n  },\n  regExp: /^(---|\\*\\*\\*|___)\\s?$/,\n  replace: (parentNode, _1, _2, isImport) => {\n    const line = $createHorizontalRuleNode();\n\n    // TODO: Get rid of isImport flag\n    if (isImport || parentNode.getNextSibling() != null) {\n      parentNode.replace(line);\n    } else {\n      parentNode.insertBefore(line);\n    }\n\n    line.selectNext();\n  },\n  type: 'element',\n};\n\nexport const IMAGE: TextMatchTransformer = {\n  dependencies: [ImageNode],\n  export: (node, exportChildren, exportFormat) => {\n    if (!$isImageNode(node)) {\n      return null;\n    }\n\n    return `![${node.getAltText()}](${node.getSrc()})`;\n  },\n  importRegExp: /!(?:\\[([^[]*)\\])(?:\\(([^(]+)\\))/,\n  regExp: /!(?:\\[([^[]*)\\])(?:\\(([^(]+)\\))$/,\n  replace: (textNode, match) => {\n    const [, altText, src] = match;\n    const imageNode = $createImageNode({\n      altText,\n      maxWidth: 800,\n      src,\n    });\n    textNode.replace(imageNode);\n  },\n  trigger: ')',\n  type: 'text-match',\n};\n\n// Very primitive table setup\nconst TABLE_ROW_REG_EXP = /^(?:\\|)(.+)(?:\\|)\\s?$/;\n\nexport const TABLE: ElementTransformer = {\n  dependencies: [TableNode, TableRowNode, TableCellNode],\n  export: (\n    node: LexicalNode,\n    exportChildren: (elementNode: ElementNode) => string\n  ) => {\n    if (!$isTableNode(node)) {\n      return null;\n    }\n\n    const output = [];\n\n    for (const row of node.getChildren()) {\n      const rowOutput = [];\n\n      if ($isTableRowNode(row)) {\n        for (const cell of row.getChildren()) {\n          // It's TableCellNode (hence ElementNode) so it's just to make flow happy\n          if ($isElementNode(cell)) {\n            rowOutput.push(exportChildren(cell));\n          }\n        }\n      }\n\n      output.push(`| ${rowOutput.join(' | ')} |`);\n    }\n\n    return output.join('\\n');\n  },\n  regExp: TABLE_ROW_REG_EXP,\n  replace: (parentNode, _1, match) => {\n    const matchCells = mapToTableCells(match[0]);\n\n    if (matchCells == null) {\n      return;\n    }\n\n    const rows = [matchCells];\n    let sibling = parentNode.getPreviousSibling();\n    let maxCells = matchCells.length;\n\n    while (sibling) {\n      if (!$isParagraphNode(sibling)) {\n        break;\n      }\n\n      if (sibling.getChildrenSize() !== 1) {\n        break;\n      }\n\n      const firstChild = sibling.getFirstChild();\n\n      if (!$isTextNode(firstChild)) {\n        break;\n      }\n\n      const cells = mapToTableCells(firstChild.getTextContent());\n\n      if (cells == null) {\n        break;\n      }\n\n      maxCells = Math.max(maxCells, cells.length);\n      rows.unshift(cells);\n      const previousSibling = sibling.getPreviousSibling();\n      sibling.remove();\n      sibling = previousSibling;\n    }\n\n    const table = $createTableNode();\n\n    for (const cells of rows) {\n      const tableRow = $createTableRowNode();\n      table.append(tableRow);\n\n      for (let i = 0; i < maxCells; i++) {\n        tableRow.append(i < cells.length ? cells[i] : createTableCell(null));\n      }\n    }\n\n    const previousSibling = parentNode.getPreviousSibling();\n    if (\n      $isTableNode(previousSibling) &&\n      getTableColumnsSize(previousSibling) === maxCells\n    ) {\n      previousSibling.append(...table.getChildren());\n      parentNode.remove();\n    } else {\n      parentNode.replace(table);\n    }\n\n    table.selectEnd();\n  },\n  type: 'element',\n};\n\nfunction getTableColumnsSize(table: TableNode) {\n  const row = table.getFirstChild();\n  return $isTableRowNode(row) ? row.getChildrenSize() : 0;\n}\n\nconst createTableCell = (\n  textContent: string | null | undefined\n): TableCellNode => {\n  const cell = $createTableCellNode(TableCellHeaderStates.NO_STATUS);\n  const paragraph = $createParagraphNode();\n\n  if (textContent != null) {\n    paragraph.append($createTextNode(textContent.trim()));\n  }\n\n  cell.append(paragraph);\n  return cell;\n};\n\nconst mapToTableCells = (textContent: string): Array<TableCellNode> | null => {\n  // TODO:\n  // For now plain text, single node. Can be expanded to more complex content\n  // including formatted text\n  const match = textContent.match(TABLE_ROW_REG_EXP);\n\n  if (!match || !match[1]) {\n    return null;\n  }\n\n  return match[1].split('|').map((text) => createTableCell(text));\n};\n\nexport const PLAYGROUND_TRANSFORMERS: Array<Transformer> = [\n  TABLE,\n  HR,\n  IMAGE,\n  CHECK_LIST,\n  ...ELEMENT_TRANSFORMERS,\n  ...TEXT_FORMAT_TRANSFORMERS,\n  ...TEXT_MATCH_TRANSFORMERS,\n];\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCallback, useEffect, useRef } from 'react';\n\nconst getElement = (): HTMLElement => {\n  let element = document.getElementById('report-container');\n\n  if (element === null) {\n    element = document.createElement('div');\n    element.id = 'report-container';\n    element.style.position = 'fixed';\n    element.style.top = '50%';\n    element.style.left = '50%';\n    element.style.fontSize = '32px';\n    element.style.transform = 'translate(-50%, -50px)';\n    element.style.padding = '20px';\n    element.style.background = 'rgba(240, 240, 240, 0.4)';\n    element.style.borderRadius = '20px';\n\n    if (document.body) {\n      document.body.appendChild(element);\n    }\n  }\n\n  return element;\n};\n\nexport default function useReport(): (arg0: string) => NodeJS.Timeout {\n  const timer = useRef<NodeJS.Timeout | null>(null);\n  const cleanup = useCallback(() => {\n    clearTimeout(timer.current);\n\n    if (document.body) {\n      document.body.removeChild(getElement());\n    }\n  }, []);\n\n  useEffect(() => {\n    return cleanup;\n  }, [cleanup]);\n\n  return useCallback(\n    (content) => {\n      // eslint-disable-next-line no-console\n      console.log(content);\n      const element = getElement();\n      clearTimeout(timer.current);\n      element.innerHTML = content;\n      timer.current = setTimeout(cleanup, 1000);\n      return timer.current;\n    },\n    [cleanup]\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand, LexicalEditor, RangeSelection } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  REDO_COMMAND,\n  UNDO_COMMAND,\n} from 'lexical';\nimport { useEffect, useRef, useState } from 'react';\n\nimport useReport from '../hooks/useReport';\n\nexport const SPEECH_TO_TEXT_COMMAND: LexicalCommand<boolean> = createCommand();\n\nconst VOICE_COMMANDS: Readonly<\n  Record<\n    string,\n    (arg0: { editor: LexicalEditor; selection: RangeSelection }) => void\n  >\n> = {\n  '\\n': ({ selection }) => {\n    selection.insertParagraph();\n  },\n  redo: ({ editor }) => {\n    editor.dispatchCommand(REDO_COMMAND, undefined);\n  },\n  undo: ({ editor }) => {\n    editor.dispatchCommand(UNDO_COMMAND, undefined);\n  },\n};\n\nexport const SUPPORT_SPEECH_RECOGNITION: boolean =\n  'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;\n\nfunction SpeechToTextPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n  const [isEnabled, setIsEnabled] = useState<boolean>(false);\n  const SpeechRecognition =\n    // @ts-ignore\n    window.SpeechRecognition || window.webkitSpeechRecognition;\n  const recognition = useRef<typeof SpeechRecognition | null>(null);\n  const report = useReport();\n\n  useEffect(() => {\n    if (isEnabled && recognition.current === null) {\n      recognition.current = new SpeechRecognition();\n      recognition.current.continuous = true;\n      recognition.current.interimResults = true;\n      recognition.current.addEventListener(\n        'result',\n        (event: typeof SpeechRecognition) => {\n          const resultItem = event.results.item(event.resultIndex);\n          const { transcript } = resultItem.item(0);\n          report(transcript);\n\n          if (!resultItem.isFinal) {\n            return;\n          }\n\n          editor.update(() => {\n            const selection = $getSelection();\n\n            if ($isRangeSelection(selection)) {\n              const command = VOICE_COMMANDS[transcript.toLowerCase().trim()];\n\n              if (command) {\n                command({\n                  editor,\n                  selection,\n                });\n              } else if (transcript.match(/\\s*\\n\\s*/)) {\n                selection.insertParagraph();\n              } else {\n                selection.insertText(transcript);\n              }\n            }\n          });\n        }\n      );\n    }\n\n    if (recognition.current) {\n      if (isEnabled) {\n        recognition.current.start();\n      } else {\n        recognition.current.stop();\n      }\n    }\n\n    return () => {\n      if (recognition.current !== null) {\n        recognition.current.stop();\n      }\n    };\n  }, [SpeechRecognition, editor, isEnabled, report]);\n  useEffect(() => {\n    return editor.registerCommand(\n      SPEECH_TO_TEXT_COMMAND,\n      (_isEnabled: boolean) => {\n        setIsEnabled(_isEnabled);\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n\nexport default (SUPPORT_SPEECH_RECOGNITION\n  ? SpeechToTextPlugin\n  : () => null) as () => null;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalEditor } from 'lexical';\n\nimport { $createCodeNode, $isCodeNode } from '@lexical/code';\nimport { exportFile, importFile } from '@lexical/file';\nimport {\n  $convertFromMarkdownString,\n  $convertToMarkdownString,\n} from '@lexical/markdown';\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { mergeRegister } from '@lexical/utils';\nimport { CONNECTED_COMMAND, TOGGLE_CONNECT_COMMAND } from '@lexical/yjs';\nimport {\n  $createTextNode,\n  $getRoot,\n  $isParagraphNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport * as React from 'react';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport useModal from '../hooks/useModal';\nimport Button from '../ui/Button';\nimport { PLAYGROUND_TRANSFORMERS } from './MarkdownTransformers';\nimport {\n  SPEECH_TO_TEXT_COMMAND,\n  SUPPORT_SPEECH_RECOGNITION,\n} from './SpeechToTextPlugin';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nexport default function ActionsPlugin({\n  isRichText,\n}: {\n  isRichText: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [isEditable, setIsEditable] = useState(() => editor.isEditable());\n  const [isSpeechToText, setIsSpeechToText] = useState(false);\n  const [connected, setConnected] = useState(false);\n  const [isEditorEmpty, setIsEditorEmpty] = useState(true);\n  const [modal, showModal] = useModal();\n  const { yjsDocMap } = useCollaborationContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n  const { t } = useTranslation(['action']);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerEditableListener((editable) => {\n        setIsEditable(editable);\n      }),\n      editor.registerCommand<boolean>(\n        CONNECTED_COMMAND,\n        (payload) => {\n          const isConnected = payload;\n          setConnected(isConnected);\n          return false;\n        },\n        COMMAND_PRIORITY_EDITOR\n      )\n    );\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        const root = $getRoot();\n        const children = root.getChildren();\n\n        if (children.length > 1) {\n          setIsEditorEmpty(false);\n        } else {\n          if ($isParagraphNode(children[0])) {\n            const paragraphChildren = children[0].getChildren();\n            setIsEditorEmpty(paragraphChildren.length === 0);\n          } else {\n            setIsEditorEmpty(false);\n          }\n        }\n      });\n    });\n  }, [editor]);\n\n  const handleMarkdownToggle = useCallback(() => {\n    editor.update(() => {\n      const root = $getRoot();\n      const firstChild = root.getFirstChild();\n      if ($isCodeNode(firstChild) && firstChild.getLanguage() === 'markdown') {\n        $convertFromMarkdownString(\n          firstChild.getTextContent(),\n          PLAYGROUND_TRANSFORMERS\n        );\n      } else {\n        const markdown = $convertToMarkdownString(PLAYGROUND_TRANSFORMERS);\n        root\n          .clear()\n          .append(\n            $createCodeNode('markdown').append($createTextNode(markdown))\n          );\n      }\n      root.selectEnd();\n    });\n  }, [editor]);\n\n  return (\n    <div className=\"verbum-actions\">\n      {SUPPORT_SPEECH_RECOGNITION && (\n        <button\n          onClick={() => {\n            editor.dispatchCommand(SPEECH_TO_TEXT_COMMAND, !isSpeechToText);\n            setIsSpeechToText(!isSpeechToText);\n          }}\n          className={\n            'action-button action-button-mic ' +\n            (isSpeechToText ? 'active' : '')\n          }\n          title={t('action:Speech_To_Text')}\n          aria-label={`${\n            isSpeechToText ? t('action:Enable') : t('action:Disable')\n          } ${t('action:speech_To_Text')}`}\n          type=\"button\"\n        >\n          <i className=\"verbum-mic\" />\n        </button>\n      )}\n      <button\n        className=\"verbum-action-button import\"\n        onClick={() => importFile(editor)}\n        title={t('action:Import')}\n        aria-label={t('action:Import_Description')}\n        type=\"button\"\n      >\n        <i className=\"verbum-import\" />\n      </button>\n      <button\n        className=\"verbum-action-button export\"\n        onClick={() =>\n          exportFile(editor, {\n            fileName: `Playground ${new Date().toISOString()}`,\n            source: 'Playground',\n          })\n        }\n        title={t('action:Export')}\n        aria-label={t('action:Export_Description')}\n        type=\"button\"\n      >\n        <i className=\"verbum-export\" />\n      </button>\n      <button\n        className=\"verbum-action-button clear\"\n        disabled={isEditorEmpty}\n        onClick={() => {\n          showModal(t('action:Clear_Editor'), (onClose) => (\n            <ShowClearDialog editor={editor} onClose={onClose} t={t} />\n          ));\n        }}\n        title={t('action:Clear')}\n        aria-label={t('action:Clear_Description')}\n        type=\"button\"\n      >\n        <i className=\"clear\" />\n      </button>\n      <button\n        className={`verbum-action-button ${isEditable ? 'unlock' : 'lock'}`}\n        onClick={() => {\n          editor.setEditable(!editor.isEditable());\n        }}\n        title={t('action:Read-Only_Mode')}\n        aria-label={`${isEditable ? t('action:Unlock') : t('action:Lock')} ${t(\n          'action:Read-Only_Mode'\n        )}`}\n        type=\"button\"\n      >\n        <i className={isEditable ? 'unlock' : 'lock'} />\n      </button>\n      <button\n        className=\"verbum-action-button\"\n        onClick={handleMarkdownToggle}\n        title={t('action:Convert_From_Markdown')}\n        aria-label={t('action:Convert_From_Markdown_Description')}\n        type=\"button\"\n      >\n        <i className=\"verbum-markdown\" />\n      </button>\n      {isCollab && (\n        <button\n          className=\"verbum-action-button connect\"\n          onClick={() => {\n            editor.dispatchCommand(TOGGLE_CONNECT_COMMAND, !connected);\n          }}\n          title={`${\n            connected ? t('action:Disconnect') : t('action:Connect')\n          } ${t('action:Collaborative')}`}\n          aria-label={`${\n            connected ? t('action:Disconnect_From') : t('action:Connect_To')\n          } ${t('action:Server')}`}\n          type=\"button\"\n        >\n          <i\n            className={connected ? t('action:disconnect') : t('action:connect')}\n          />\n        </button>\n      )}\n      {modal}\n    </div>\n  );\n}\n\nfunction ShowClearDialog({\n  editor,\n  onClose,\n  t,\n}: {\n  editor: LexicalEditor;\n  onClose: () => void;\n  t: TFunction;\n}): JSX.Element {\n  return (\n    <>\n      {t('action:Confirm_Clear')}\n      <div className=\"Modal__content\">\n        <Button\n          onClick={() => {\n            editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n            editor.focus();\n            onClose();\n          }}\n        >\n          {t('action:Clear')}\n        </Button>{' '}\n        <Button\n          onClick={() => {\n            editor.focus();\n            onClose();\n          }}\n        >\n          {t('action:Cancel')}\n        </Button>\n      </div>\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { AutoLinkPlugin } from '@lexical/react/LexicalAutoLinkPlugin';\nimport * as React from 'react';\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nconst EMAIL_MATCHER =\n  /(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))/;\n\nconst MATCHERS = [\n  (text) => {\n    const match = URL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: match[0],\n      }\n    );\n  },\n  (text) => {\n    const match = EMAIL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: `mailto:${match[0]}`,\n      }\n    );\n  },\n];\n\nexport default function LexicalAutoLinkPlugin(): JSX.Element {\n  return <AutoLinkPlugin matchers={MATCHERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {\n  Comment,\n  Comments,\n  CommentStore,\n  createComment,\n  createThread,\n  Thread,\n  useCommentStore,\n} from '../commenting';\nimport type {\n  EditorState,\n  LexicalCommand,\n  LexicalEditor,\n  NodeKey,\n} from 'lexical';\n\nimport './CommentPlugin.css';\n\nimport {\n  $createMarkNode,\n  $getMarkIDs,\n  $isMarkNode,\n  $unwrapMarkNode,\n  $wrapSelectionInMarkNode,\n  MarkNode,\n} from '@lexical/mark';\nimport { AutoFocusPlugin } from '@lexical/react/LexicalAutoFocusPlugin';\nimport { ClearEditorPlugin } from '@lexical/react/LexicalClearEditorPlugin';\nimport { LexicalComposer } from '@lexical/react/LexicalComposer';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { OnChangePlugin } from '@lexical/react/LexicalOnChangePlugin';\nimport { PlainTextPlugin } from '@lexical/react/LexicalPlainTextPlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport { createDOMRange, createRectsFromDOMRange } from '@lexical/selection';\nimport { $isRootTextContentEmpty, $rootTextContent } from '@lexical/text';\nimport { mergeRegister, registerNestedElementResolver } from '@lexical/utils';\nimport {\n  $getNodeByKey,\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  KEY_ESCAPE_COMMAND,\n} from 'lexical';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport useModal from '../hooks/useModal';\nimport CommentEditorTheme from '../themes/CommentEditorTheme';\nimport Button from '../ui/Button';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\nimport type { Doc } from 'yjs';\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { WebsocketProvider } from 'y-websocket';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nexport const INSERT_INLINE_COMMAND: LexicalCommand<void> = createCommand();\n\nfunction AddCommentBox({\n  anchorKey,\n  editor,\n  onAddComment,\n}: {\n  anchorKey: NodeKey;\n  editor: LexicalEditor;\n  onAddComment: () => void;\n}): JSX.Element {\n  const boxRef = useRef<HTMLDivElement>(null);\n\n  const updatePosition = useCallback(() => {\n    const boxElem = boxRef.current;\n    const rootElement = editor.getRootElement();\n    const anchorElement = editor.getElementByKey(anchorKey);\n\n    if (boxElem !== null && rootElement !== null && anchorElement !== null) {\n      const { right } = rootElement.getBoundingClientRect();\n      const { top } = anchorElement.getBoundingClientRect();\n      boxElem.style.left = `${right - 20}px`;\n      boxElem.style.top = `${top - 30}px`;\n    }\n  }, [anchorKey, editor]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updatePosition);\n\n    return () => {\n      window.removeEventListener('resize', updatePosition);\n    };\n  }, [editor, updatePosition]);\n\n  useLayoutEffect(() => {\n    updatePosition();\n  }, [anchorKey, editor, updatePosition]);\n\n  return (\n    <div className=\"CommentPlugin_AddCommentBox\" ref={boxRef}>\n      <button\n        className=\"CommentPlugin_AddCommentBox_button\"\n        onClick={onAddComment}\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-add-comment\" />\n      </button>\n    </div>\n  );\n}\n\nfunction EditorRefPlugin({\n  editorRef,\n}: {\n  editorRef: { current: null | LexicalEditor };\n}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useLayoutEffect(() => {\n    editorRef.current = editor;\n    return () => {\n      editorRef.current = null;\n    };\n  }, [editor, editorRef]);\n\n  return null;\n}\n\nfunction EscapeHandlerPlugin({\n  onEscape,\n}: {\n  onEscape: (e: KeyboardEvent) => boolean;\n}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      KEY_ESCAPE_COMMAND,\n      (event: KeyboardEvent) => {\n        return onEscape(event);\n      },\n      2\n    );\n  }, [editor, onEscape]);\n\n  return null;\n}\n\nfunction PlainTextEditor({\n  className,\n  autoFocus,\n  onEscape,\n  onChange,\n  editorRef,\n  placeholder = 'Type a comment...',\n}: {\n  autoFocus?: boolean;\n  className?: string;\n  editorRef?: { current: null | LexicalEditor };\n  onChange: (editorState: EditorState, editor: LexicalEditor) => void;\n  onEscape: (e: KeyboardEvent) => boolean;\n  placeholder?: string;\n}) {\n  const initialConfig = {\n    namespace: 'Commenting',\n    nodes: [],\n    onError: (error: Error) => {\n      throw error;\n    },\n    theme: CommentEditorTheme,\n  };\n\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <div className=\"CommentPlugin_CommentInputBox_EditorContainer\">\n        <PlainTextPlugin\n          contentEditable={<ContentEditable className={className} />}\n          placeholder={<Placeholder>{placeholder}</Placeholder>}\n          ErrorBoundary={LexicalErrorBoundary}\n        />\n        <OnChangePlugin onChange={onChange} />\n        <HistoryPlugin />\n        {autoFocus !== false && <AutoFocusPlugin />}\n        <EscapeHandlerPlugin onEscape={onEscape} />\n        <ClearEditorPlugin />\n        {editorRef !== undefined && <EditorRefPlugin editorRef={editorRef} />}\n      </div>\n    </LexicalComposer>\n  );\n}\n\nfunction useOnChange(\n  setContent: (text: string) => void,\n  setCanSubmit: (canSubmit: boolean) => void\n) {\n  return useCallback(\n    (editorState: EditorState, _editor: LexicalEditor) => {\n      editorState.read(() => {\n        setContent($rootTextContent());\n        setCanSubmit(!$isRootTextContentEmpty(_editor.isComposing(), true));\n      });\n    },\n    [setCanSubmit, setContent]\n  );\n}\n\nfunction CommentInputBox({\n  editor,\n  cancelAddComment,\n  submitAddComment,\n  t,\n}: {\n  cancelAddComment: () => void;\n  editor: LexicalEditor;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean\n  ) => void;\n  t: TFunction;\n}) {\n  const [content, setContent] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n  const boxRef = useRef<HTMLDivElement>(null);\n  const selectionState = useMemo(\n    () => ({\n      container: document.createElement('div'),\n      elements: [],\n    }),\n    []\n  );\n  const author = useCollabAuthorName();\n\n  const updateLocation = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n      if ($isRangeSelection(selection)) {\n        const anchor = selection.anchor;\n        const focus = selection.focus;\n        const range = createDOMRange(\n          editor,\n          anchor.getNode(),\n          anchor.offset,\n          focus.getNode(),\n          focus.offset\n        );\n        const boxElem = boxRef.current;\n        if (range !== null && boxElem !== null) {\n          const { left, bottom, width } = range.getBoundingClientRect();\n          const selectionRects = createRectsFromDOMRange(editor, range);\n          let correctedLeft =\n            selectionRects.length === 1 ? left + width / 2 - 125 : left - 125;\n          if (correctedLeft < 10) {\n            correctedLeft = 10;\n          }\n          boxElem.style.left = `${correctedLeft}px`;\n          boxElem.style.top = `${bottom + 20}px`;\n          const selectionRectsLength = selectionRects.length;\n          const { container } = selectionState;\n          const elements: Array<HTMLSpanElement> = selectionState.elements;\n          const elementsLength = elements.length;\n\n          for (let i = 0; i < selectionRectsLength; i++) {\n            const selectionRect = selectionRects[i];\n            let elem: HTMLSpanElement = elements[i];\n            if (elem === undefined) {\n              elem = document.createElement('span');\n              elements[i] = elem;\n              container.appendChild(elem);\n            }\n            const color = '255, 212, 0';\n            const style = `position:absolute;top:${selectionRect.top}px;left:${selectionRect.left}px;height:${selectionRect.height}px;width:${selectionRect.width}px;background-color:rgba(${color}, 0.3);pointer-events:none;z-index:5;`;\n            elem.style.cssText = style;\n          }\n          for (let i = elementsLength - 1; i >= selectionRectsLength; i--) {\n            const elem = elements[i];\n            container.removeChild(elem);\n            elements.pop();\n          }\n        }\n      }\n    });\n  }, [editor, selectionState]);\n\n  useLayoutEffect(() => {\n    updateLocation();\n    const container = selectionState.container;\n    const body = document.body;\n    if (body !== null) {\n      body.appendChild(container);\n      return () => {\n        body.removeChild(container);\n      };\n    }\n  }, [selectionState.container, updateLocation]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updateLocation);\n\n    return () => {\n      window.removeEventListener('resize', updateLocation);\n    };\n  }, [updateLocation]);\n\n  const onEscape = (event: KeyboardEvent): boolean => {\n    event.preventDefault();\n    cancelAddComment();\n    return true;\n  };\n\n  const submitComment = () => {\n    if (canSubmit) {\n      let quote = editor.getEditorState().read(() => {\n        const selection = $getSelection();\n        return selection !== null ? selection.getTextContent() : '';\n      });\n      if (quote.length > 100) {\n        quote = quote.slice(0, 99) + '…';\n      }\n      submitAddComment(\n        createThread(quote, [createComment(content, author)]),\n        true\n      );\n    }\n  };\n\n  const onChange = useOnChange(setContent, setCanSubmit);\n\n  return (\n    <div className=\"CommentPlugin_CommentInputBox\" ref={boxRef}>\n      <PlainTextEditor\n        className=\"CommentPlugin_CommentInputBox_Editor\"\n        onEscape={onEscape}\n        onChange={onChange}\n      />\n      <div className=\"CommentPlugin_CommentInputBox_Buttons\">\n        <Button\n          onClick={cancelAddComment}\n          className=\"CommentPlugin_CommentInputBox_Button\"\n        >\n          {t('action:Cancel')}\n        </Button>\n        <Button\n          onClick={submitComment}\n          disabled={!canSubmit}\n          className=\"CommentPlugin_CommentInputBox_Button primary\"\n        >\n          {t('action:Comment')}\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nfunction CommentsComposer({\n  submitAddComment,\n  thread,\n  placeholder,\n}: {\n  placeholder?: string;\n  submitAddComment: (\n    commentOrThread: Comment,\n    isInlineComment: boolean,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  thread?: Thread;\n}) {\n  const [content, setContent] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n  const editorRef = useRef<LexicalEditor>(null);\n  const author = useCollabAuthorName();\n\n  const onChange = useOnChange(setContent, setCanSubmit);\n\n  const submitComment = () => {\n    if (canSubmit) {\n      submitAddComment(createComment(content, author), false, thread);\n      const editor = editorRef.current;\n      if (editor !== null) {\n        editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n      }\n    }\n  };\n\n  return (\n    <>\n      <PlainTextEditor\n        className=\"CommentPlugin_CommentsPanel_Editor\"\n        autoFocus={false}\n        onEscape={() => {\n          return true;\n        }}\n        onChange={onChange}\n        editorRef={editorRef}\n        placeholder={placeholder}\n      />\n      <Button\n        className=\"CommentPlugin_CommentsPanel_SendButton\"\n        onClick={submitComment}\n        disabled={!canSubmit}\n      >\n        <i className=\"send\" />\n      </Button>\n    </>\n  );\n}\n\nfunction ShowDeleteCommentOrThreadDialog({\n  commentOrThread,\n  deleteCommentOrThread,\n  onClose,\n  thread = undefined,\n  t,\n}: {\n  commentOrThread: Comment | Thread;\n\n  deleteCommentOrThread: (\n    comment: Comment | Thread,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  onClose: () => void;\n  thread?: Thread;\n  t: TFunction;\n}): JSX.Element {\n  return (\n    <>\n      {`${t('toolbar:commentPlugin.Delete_Comment_Description')} ${\n        commentOrThread.type\n      }?`}\n      <div className=\"Modal__content\">\n        <Button\n          onClick={() => {\n            deleteCommentOrThread(commentOrThread, thread);\n            onClose();\n          }}\n        >\n          {t('action:Delete')}\n        </Button>{' '}\n        <Button\n          onClick={() => {\n            onClose();\n          }}\n        >\n          {t('action:Cancel')}\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction CommentsPanelListComment({\n  comment,\n  deleteComment,\n  thread,\n  rtf,\n  t,\n}: {\n  comment: Comment;\n  deleteComment: (\n    commentOrThread: Comment | Thread,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  thread?: Thread;\n  rtf: null; //FIXME: Intl.RelativeTimeFormat gives build error;\n  t: TFunction;\n}): JSX.Element {\n  const seconds = Math.round((comment.timeStamp - performance.now()) / 1000);\n  const minutes = Math.round(seconds / 60);\n  const [modal, showModal] = useModal();\n\n  return (\n    <li className=\"CommentPlugin_CommentsPanel_List_Comment\">\n      <div className=\"CommentPlugin_CommentsPanel_List_Details\">\n        <span className=\"CommentPlugin_CommentsPanel_List_Comment_Author\">\n          {comment.author}\n        </span>\n        <span className=\"CommentPlugin_CommentsPanel_List_Comment_Time\">\n          {/* · {seconds > -10 ? 'Just now' : rtf.format(minutes, 'minute')} */}\n        </span>\n      </div>\n      <p\n        className={\n          comment.deleted ? 'CommentPlugin_CommentsPanel_DeletedComment' : ''\n        }\n      >\n        {comment.content}\n      </p>\n      {!comment.deleted && (\n        <>\n          <Button\n            onClick={() => {\n              showModal(\n                t('toolbar:commentPlugin.Delete_Comment'),\n                (onClose) => (\n                  <ShowDeleteCommentOrThreadDialog\n                    commentOrThread={comment}\n                    deleteCommentOrThread={deleteComment}\n                    thread={thread}\n                    onClose={onClose}\n                    t={t}\n                  />\n                )\n              );\n            }}\n            className=\"CommentPlugin_CommentsPanel_List_DeleteButton\"\n          >\n            <i className=\"delete\" />\n          </Button>\n          {modal}\n        </>\n      )}\n    </li>\n  );\n}\n\nfunction CommentsPanelList({\n  activeIDs,\n  comments,\n  deleteCommentOrThread,\n  listRef,\n  markNodeMap,\n  submitAddComment,\n  t,\n}: {\n  activeIDs: Array<string>;\n  comments: Comments;\n  deleteCommentOrThread: (\n    commentOrThread: Comment | Thread,\n    thread?: Thread\n  ) => void;\n  listRef: { current: null | HTMLUListElement };\n  markNodeMap: Map<string, Set<NodeKey>>;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean,\n    thread?: Thread\n  ) => void;\n  t: TFunction;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [counter, setCounter] = useState(0);\n  const [modal, showModal] = useModal();\n  // const rtf = useMemo(\n  //   () =>\n  //     new Intl.RelativeTimeFormat('en', {\n  //       localeMatcher: 'best fit',\n  //       numeric: 'auto',\n  //       style: 'short',\n  //     }),\n  //   []\n  // ); //FIXME: it is closed to fix a build error\n  const rtf = null;\n\n  useEffect(() => {\n    // Used to keep the time stamp up to date\n    const id = setTimeout(() => {\n      setCounter(counter + 1);\n    }, 10000);\n\n    return () => {\n      clearTimeout(id);\n    };\n  }, [counter]);\n\n  return (\n    <ul className=\"CommentPlugin_CommentsPanel_List\" ref={listRef}>\n      {comments.map((commentOrThread) => {\n        const id = commentOrThread.id;\n        if (commentOrThread.type === 'thread') {\n          const handleClickThread = () => {\n            const markNodeKeys = markNodeMap.get(id);\n            if (\n              markNodeKeys !== undefined &&\n              (activeIDs === null || activeIDs.indexOf(id) === -1)\n            ) {\n              const activeElement = document.activeElement;\n              // Move selection to the start of the mark, so that we\n              // update the UI with the selected thread.\n              editor.update(\n                () => {\n                  const markNodeKey = Array.from(markNodeKeys)[0];\n                  const markNode = $getNodeByKey<MarkNode>(markNodeKey);\n                  if ($isMarkNode(markNode)) {\n                    markNode.selectStart();\n                  }\n                },\n                {\n                  onUpdate() {\n                    // Restore selection to the previous element\n                    if (activeElement !== null) {\n                      (activeElement as HTMLElement).focus();\n                    }\n                  },\n                }\n              );\n            }\n          };\n\n          return (\n            // eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions\n            <li\n              key={id}\n              onClick={handleClickThread}\n              className={`CommentPlugin_CommentsPanel_List_Thread ${\n                markNodeMap.has(id) ? 'interactive' : ''\n              } ${activeIDs.indexOf(id) === -1 ? '' : 'active'}`}\n            >\n              <div className=\"CommentPlugin_CommentsPanel_List_Thread_QuoteBox\">\n                <blockquote className=\"CommentPlugin_CommentsPanel_List_Thread_Quote\">\n                  {'> '}\n                  <span>{commentOrThread.quote}</span>\n                </blockquote>\n                {/* INTRODUCE DELETE THREAD HERE*/}\n                <Button\n                  onClick={() => {\n                    showModal(\n                      t('toolbar:commentPlugin.Delete_Thread'),\n                      (onClose) => (\n                        <ShowDeleteCommentOrThreadDialog\n                          commentOrThread={commentOrThread}\n                          deleteCommentOrThread={deleteCommentOrThread}\n                          onClose={onClose}\n                          t={t}\n                        />\n                      )\n                    );\n                  }}\n                  className=\"CommentPlugin_CommentsPanel_List_DeleteButton\"\n                >\n                  <i className=\"delete\" />\n                </Button>\n                {modal}\n              </div>\n              <ul className=\"CommentPlugin_CommentsPanel_List_Thread_Comments\">\n                {commentOrThread.comments.map((comment) => (\n                  <CommentsPanelListComment\n                    key={comment.id}\n                    comment={comment}\n                    deleteComment={deleteCommentOrThread}\n                    thread={commentOrThread}\n                    rtf={rtf}\n                    t={t}\n                  />\n                ))}\n              </ul>\n              <div className=\"CommentPlugin_CommentsPanel_List_Thread_Editor\">\n                <CommentsComposer\n                  submitAddComment={submitAddComment}\n                  thread={commentOrThread}\n                  placeholder={t('toolbar:commentPlugin.Reply_to_comment')}\n                />\n              </div>\n            </li>\n          );\n        }\n        return (\n          <CommentsPanelListComment\n            key={id}\n            comment={commentOrThread}\n            deleteComment={deleteCommentOrThread}\n            rtf={rtf}\n            t={t}\n          />\n        );\n      })}\n    </ul>\n  );\n}\n\nfunction CommentsPanel({\n  activeIDs,\n  deleteCommentOrThread,\n  comments,\n  markNodeMap,\n  submitAddComment,\n  t,\n}: {\n  activeIDs: Array<string>;\n  comments: Comments;\n  deleteCommentOrThread: (\n    commentOrThread: Comment | Thread,\n    thread?: Thread\n  ) => void;\n  markNodeMap: Map<string, Set<NodeKey>>;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean,\n    thread?: Thread\n  ) => void;\n  t: TFunction;\n}): JSX.Element {\n  const listRef = useRef<HTMLUListElement>(null);\n  const isEmpty = comments.length === 0;\n\n  return (\n    <div className=\"CommentPlugin_CommentsPanel\">\n      <h2 className=\"CommentPlugin_CommentsPanel_Heading\">\n        {t('toolbar:commentPlugin.Comments')}\n      </h2>\n      {isEmpty ? (\n        <div className=\"CommentPlugin_CommentsPanel_Empty\">\n          {t('toolbar:commentPlugin.No_Comments')}\n        </div>\n      ) : (\n        <CommentsPanelList\n          activeIDs={activeIDs}\n          comments={comments}\n          deleteCommentOrThread={deleteCommentOrThread}\n          listRef={listRef}\n          submitAddComment={submitAddComment}\n          markNodeMap={markNodeMap}\n          t={t}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction useCollabAuthorName(): string {\n  const collabContext = useCollaborationContext();\n  const { yjsDocMap, name } = collabContext;\n  return yjsDocMap.has('comments') ? name : 'Playground User';\n}\n\nexport default function CommentPlugin({\n  providerFactory,\n}: {\n  providerFactory?: (\n    id: string,\n    yjsDocMap: Map<string, Doc>\n  ) => WebsocketProvider;\n}): JSX.Element {\n  const collabContext = useCollaborationContext();\n  const [editor] = useLexicalComposerContext();\n  const commentStore = useMemo(() => new CommentStore(editor), [editor]);\n  const comments = useCommentStore(commentStore);\n  const markNodeMap = useMemo<Map<string, Set<NodeKey>>>(() => {\n    return new Map();\n  }, []);\n  const [activeAnchorKey, setActiveAnchorKey] = useState<NodeKey | null>();\n  const [activeIDs, setActiveIDs] = useState<Array<string>>([]);\n  const [showCommentInput, setShowCommentInput] = useState(false);\n  const [showComments, setShowComments] = useState(false);\n  const { yjsDocMap } = collabContext;\n  const { t } = useTranslation(['toolbar']);\n\n  useEffect(() => {\n    if (providerFactory) {\n      const provider = providerFactory('comments', yjsDocMap);\n      return commentStore.registerCollaboration(provider);\n    }\n  }, [commentStore, providerFactory, yjsDocMap]);\n\n  const cancelAddComment = useCallback(() => {\n    editor.update(() => {\n      const selection = $getSelection();\n      // Restore selection\n      if (selection !== null) {\n        selection.dirty = true;\n      }\n    });\n    setShowCommentInput(false);\n  }, [editor]);\n\n  const deleteCommentOrThread = useCallback(\n    (comment: Comment | Thread, thread?: Thread) => {\n      if (comment.type === 'comment') {\n        const deletionInfo = commentStore.deleteCommentOrThread(\n          comment,\n          thread\n        );\n        if (!deletionInfo) return;\n        const { markedComment, index } = deletionInfo;\n        commentStore.addComment(markedComment, thread, index);\n      } else {\n        commentStore.deleteCommentOrThread(comment);\n        // Remove ids from associated marks\n        const id = thread !== undefined ? thread.id : comment.id;\n        const markNodeKeys = markNodeMap.get(id);\n        if (markNodeKeys !== undefined) {\n          // Do async to avoid causing a React infinite loop\n          setTimeout(() => {\n            editor.update(() => {\n              for (const key of markNodeKeys) {\n                const node: null | MarkNode = $getNodeByKey(key);\n                if ($isMarkNode(node)) {\n                  node.deleteID(id);\n                  if (node.getIDs().length === 0) {\n                    $unwrapMarkNode(node);\n                  }\n                }\n              }\n            });\n          });\n        }\n      }\n    },\n    [commentStore, editor, markNodeMap]\n  );\n\n  const submitAddComment = useCallback(\n    (\n      commentOrThread: Comment | Thread,\n      isInlineComment: boolean,\n      thread?: Thread\n    ) => {\n      commentStore.addComment(commentOrThread, thread);\n      if (isInlineComment) {\n        editor.update(() => {\n          const selection = $getSelection();\n          if ($isRangeSelection(selection)) {\n            const focus = selection.focus;\n            const anchor = selection.anchor;\n            const isBackward = selection.isBackward();\n            const id = commentOrThread.id;\n\n            // Wrap content in a MarkNode\n            $wrapSelectionInMarkNode(selection, isBackward, id);\n\n            // Make selection collapsed at the end\n            if (isBackward) {\n              focus.set(anchor.key, anchor.offset, anchor.type);\n            } else {\n              anchor.set(focus.key, focus.offset, focus.type);\n            }\n          }\n        });\n        setShowCommentInput(false);\n      }\n    },\n    [commentStore, editor]\n  );\n\n  useEffect(() => {\n    const changedElems: Array<HTMLElement> = [];\n    for (let i = 0; i < activeIDs.length; i++) {\n      const id = activeIDs[i];\n      const keys = markNodeMap.get(id);\n      if (keys !== undefined) {\n        for (const key of keys) {\n          const elem = editor.getElementByKey(key);\n          if (elem !== null) {\n            elem.classList.add('selected');\n            changedElems.push(elem);\n            setShowComments(true);\n          }\n        }\n      }\n    }\n    return () => {\n      for (let i = 0; i < changedElems.length; i++) {\n        const changedElem = changedElems[i];\n        changedElem.classList.remove('selected');\n      }\n    };\n  }, [activeIDs, editor, markNodeMap]);\n\n  useEffect(() => {\n    const markNodeKeysToIDs: Map<NodeKey, Array<string>> = new Map();\n\n    return mergeRegister(\n      registerNestedElementResolver<MarkNode>(\n        editor,\n        MarkNode,\n        (from: MarkNode) => {\n          return $createMarkNode(from.getIDs());\n        },\n        (from: MarkNode, to: MarkNode) => {\n          // Merge the IDs\n          const ids = from.getIDs();\n          ids.forEach((id) => {\n            to.addID(id);\n          });\n        }\n      ),\n      editor.registerMutationListener(MarkNode, (mutations) => {\n        editor.getEditorState().read(() => {\n          for (const [key, mutation] of mutations) {\n            const node: null | MarkNode = $getNodeByKey(key);\n            let ids: NodeKey[] = [];\n\n            if (mutation === 'destroyed') {\n              ids = markNodeKeysToIDs.get(key) || [];\n            } else if ($isMarkNode(node)) {\n              ids = node.getIDs();\n            }\n\n            for (let i = 0; i < ids.length; i++) {\n              const id = ids[i];\n              let markNodeKeys = markNodeMap.get(id);\n              markNodeKeysToIDs.set(key, ids);\n\n              if (mutation === 'destroyed') {\n                if (markNodeKeys !== undefined) {\n                  markNodeKeys.delete(key);\n                  if (markNodeKeys.size === 0) {\n                    markNodeMap.delete(id);\n                  }\n                }\n              } else {\n                if (markNodeKeys === undefined) {\n                  markNodeKeys = new Set();\n                  markNodeMap.set(id, markNodeKeys);\n                }\n                if (!markNodeKeys.has(key)) {\n                  markNodeKeys.add(key);\n                }\n              }\n            }\n          }\n        });\n      }),\n      editor.registerUpdateListener(({ editorState, tags }) => {\n        editorState.read(() => {\n          const selection = $getSelection();\n          let hasActiveIds = false;\n          let hasAnchorKey = false;\n\n          if ($isRangeSelection(selection)) {\n            const anchorNode = selection.anchor.getNode();\n\n            if ($isTextNode(anchorNode)) {\n              const commentIDs = $getMarkIDs(\n                anchorNode,\n                selection.anchor.offset\n              );\n              if (commentIDs !== null) {\n                setActiveIDs(commentIDs);\n                hasActiveIds = true;\n              }\n              if (!selection.isCollapsed()) {\n                setActiveAnchorKey(anchorNode.getKey());\n                hasAnchorKey = true;\n              }\n            }\n          }\n          if (!hasActiveIds) {\n            setActiveIDs((_activeIds) =>\n              _activeIds.length === 0 ? _activeIds : []\n            );\n          }\n          if (!hasAnchorKey) {\n            setActiveAnchorKey(null);\n          }\n        });\n        if (!tags.has('collaboration')) {\n          setShowCommentInput(false);\n        }\n      }),\n      editor.registerCommand(\n        INSERT_INLINE_COMMAND,\n        () => {\n          const domSelection = window.getSelection();\n          if (domSelection !== null) {\n            domSelection.removeAllRanges();\n          }\n          setShowCommentInput(true);\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR\n      )\n    );\n  }, [editor, markNodeMap]);\n\n  const onAddComment = () => {\n    editor.dispatchCommand(INSERT_INLINE_COMMAND, undefined);\n  };\n\n  return (\n    <>\n      {showCommentInput &&\n        createPortal(\n          <CommentInputBox\n            editor={editor}\n            cancelAddComment={cancelAddComment}\n            submitAddComment={submitAddComment}\n            t={t}\n          />,\n          document.body\n        )}\n      {activeAnchorKey !== null &&\n        activeAnchorKey !== undefined &&\n        !showCommentInput &&\n        createPortal(\n          <AddCommentBox\n            anchorKey={activeAnchorKey}\n            editor={editor}\n            onAddComment={onAddComment}\n          />,\n          document.body\n        )}\n      {createPortal(\n        <Button\n          className={`CommentPlugin_ShowCommentsButton ${\n            showComments ? 'active' : ''\n          }`}\n          onClick={() => setShowComments(!showComments)}\n          title={\n            showComments\n              ? t('toolbar:commentPlugin.Hide_Comments')\n              : t('toolbar:commentPlugin.Show_Comments')\n          }\n        >\n          <i className=\"comments\" />\n        </Button>,\n        document.body\n      )}\n      {showComments &&\n        createPortal(\n          <CommentsPanel\n            comments={comments}\n            submitAddComment={submitAddComment}\n            deleteCommentOrThread={deleteCommentOrThread}\n            activeIDs={activeIDs}\n            markNodeMap={markNodeMap}\n            t={t}\n          />,\n          document.body\n        )}\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { $isCodeHighlightNode } from '@lexical/code';\nimport { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $isAtNodeEnd } from '@lexical/selection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  FORMAT_TEXT_COMMAND,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\n\nimport { INSERT_INLINE_COMMAND } from './CommentPlugin';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nfunction setPopupPosition(\n  editor: HTMLElement,\n  rect: ClientRect,\n  rootElementRect: ClientRect\n): void {\n  let top = rect.top - 8 + window.pageYOffset;\n  let left =\n    rect.left + 340 + window.pageXOffset - editor.offsetWidth + rect.width;\n  if (\n    rect.width >= rootElementRect.width - 20 ||\n    left > rootElementRect.width - 150\n  ) {\n    left = rect.left;\n    top = rect.top - 50 + window.pageYOffset;\n  }\n  if (top < rootElementRect.top) {\n    top = rect.bottom + 20;\n  }\n  editor.style.opacity = '1';\n  editor.style.top = `${top}px`;\n  editor.style.left = `${left}px`;\n}\n\nfunction FloatingCharacterStylesEditor({\n  editor,\n  isLink,\n  isBold,\n  isItalic,\n  isUnderline,\n  isCode,\n  isStrikethrough,\n  isSubscript,\n  isSuperscript,\n  t,\n}: {\n  editor: LexicalEditor;\n  isBold: boolean;\n  isCode: boolean;\n  isItalic: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  isUnderline: boolean;\n  t: TFunction;\n}): JSX.Element {\n  const popupCharStylesEditorRef = useRef<HTMLDivElement | null>(null);\n  const mouseDownRef = useRef(false);\n\n  const insertLink = useCallback(() => {\n    if (!isLink) {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n    } else {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n    }\n  }, [editor, isLink]);\n\n  const insertComment = () => {\n    editor.dispatchCommand(INSERT_INLINE_COMMAND, null);\n  };\n\n  const updateCharacterStylesEditor = useCallback(() => {\n    const selection = $getSelection();\n\n    const popupCharStylesEditorElem = popupCharStylesEditorRef.current;\n    const nativeSelection = window.getSelection();\n\n    if (popupCharStylesEditorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      nativeSelection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      const rootElementRect = rootElement.getBoundingClientRect();\n      let rect;\n\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      if (!mouseDownRef.current) {\n        setPopupPosition(popupCharStylesEditorElem, rect, rootElementRect);\n      }\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateCharacterStylesEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateCharacterStylesEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateCharacterStylesEditor();\n    });\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateCharacterStylesEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateCharacterStylesEditor();\n          return false;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, updateCharacterStylesEditor]);\n\n  return (\n    <div ref={popupCharStylesEditorRef} className=\"verbum-character-style-popup\">\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n        }}\n        className={'verbum-popup-item spaced ' + (isBold ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_text_as_bold')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-bold\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n        }}\n        className={'verbum-popup-item spaced ' + (isItalic ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_as_italics'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-italic\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n        }}\n        className={'verbum-popup-item spaced ' + (isUnderline ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_to_underlined'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-underline\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={'verbum-popup-item spaced ' + (isStrikethrough ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_with_a_strikethrough'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-strikethrough\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'verbum-popup-item spaced ' + (isSubscript ? 'active' : '')}\n        title=\"Subscript\"\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_Subscript')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-subscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={'verbum-popup-item spaced ' + (isSuperscript ? 'active' : '')}\n        title=\"Superscript\"\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_Superscript')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-superscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n        }}\n        className={'verbum-popup-item spaced ' + (isCode ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Insert_code_block')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-code\" />\n      </button>\n      <button\n        onClick={insertLink}\n        className={'verbum-popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Insert_link')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-link\" />\n      </button>\n      <button\n        onClick={insertComment}\n        className={'verbum-popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Add_comment')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-add-comment\" />\n      </button>\n    </div>\n  );\n}\n\nfunction getSelectedNode(selection: RangeSelection): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n\nfunction useCharacterStylesPopup(editor: LexicalEditor): JSX.Element | null {\n  const [isText, setIsText] = useState(false);\n  const [isLink, setIsLink] = useState(false);\n  const [isBold, setIsBold] = useState(false);\n  const [isItalic, setIsItalic] = useState(false);\n  const [isUnderline, setIsUnderline] = useState(false);\n  const [isStrikethrough, setIsStrikethrough] = useState(false);\n  const [isSubscript, setIsSubscript] = useState(false);\n  const [isSuperscript, setIsSuperscript] = useState(false);\n  const [isCode, setIsCode] = useState(false);\n  const { t } = useTranslation(['toolbar']);\n\n  const updatePopup = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n      const nativeSelection = window.getSelection();\n      const rootElement = editor.getRootElement();\n\n      if (\n        nativeSelection !== null &&\n        (!$isRangeSelection(selection) ||\n          rootElement === null ||\n          !rootElement.contains(nativeSelection.anchorNode))\n      ) {\n        setIsText(false);\n        return;\n      }\n\n      if (!$isRangeSelection(selection)) {\n        return;\n      }\n\n      const node = getSelectedNode(selection);\n\n      // Update text format\n      setIsBold(selection.hasFormat('bold'));\n      setIsItalic(selection.hasFormat('italic'));\n      setIsUnderline(selection.hasFormat('underline'));\n      setIsStrikethrough(selection.hasFormat('strikethrough'));\n      setIsSubscript(selection.hasFormat('subscript'));\n      setIsSuperscript(selection.hasFormat('superscript'));\n      setIsCode(selection.hasFormat('code'));\n\n      // Update links\n      const parent = node.getParent();\n      if ($isLinkNode(parent) || $isLinkNode(node)) {\n        setIsLink(true);\n      } else {\n        setIsLink(false);\n      }\n\n      if (\n        !$isCodeHighlightNode(selection.anchor.getNode()) &&\n        selection.getTextContent() !== ''\n      ) {\n        setIsText($isTextNode(node));\n      } else {\n        setIsText(false);\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    document.addEventListener('selectionchange', updatePopup);\n    return () => {\n      document.removeEventListener('selectionchange', updatePopup);\n    };\n  }, [updatePopup]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      updatePopup();\n    });\n  }, [editor, updatePopup]);\n\n  if (!isText || isLink) {\n    return null;\n  }\n\n  return createPortal(\n    <FloatingCharacterStylesEditor\n      editor={editor}\n      isLink={isLink}\n      isBold={isBold}\n      isItalic={isItalic}\n      isStrikethrough={isStrikethrough}\n      isSubscript={isSubscript}\n      isSuperscript={isSuperscript}\n      isUnderline={isUnderline}\n      isCode={isCode}\n      t={t}\n    />,\n    document.body\n  );\n}\n\nexport default function CharacterStylesPopupPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n  return useCharacterStylesPopup(editor);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LinkNode } from '@lexical/link';\nimport type { LexicalEditor } from 'lexical';\n\nimport { $isLinkNode } from '@lexical/link';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getNearestNodeFromDOMNode } from 'lexical';\nimport { useEffect, useRef } from 'react';\n\ntype LinkFilter = (event: MouseEvent, linkNode: LinkNode) => boolean;\nexport default function ClickableLinkPlugin({\n  filter,\n  newTab = true,\n}: {\n  filter?: LinkFilter;\n  newTab?: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const hasMoved = useRef(false);\n  useEffect(() => {\n    let prevOffsetX;\n    let prevOffsetY;\n\n    function onPointerDown(event: PointerEvent) {\n      prevOffsetX = event.offsetX;\n      prevOffsetY = event.offsetY;\n    }\n\n    function onPointerUp(event: PointerEvent) {\n      hasMoved.current =\n        event.offsetX !== prevOffsetX || event.offsetY !== prevOffsetY;\n    }\n\n    function onClick(e: Event) {\n      // Based on pointerdown/up we can check if cursor moved during click event,\n      // and ignore clicks with moves (to allow link text selection)\n      const hasMovedDuringClick = hasMoved.current;\n      hasMoved.current = false;\n      // $FlowExpectedError[incompatible-cast] onClick handler will get MouseEvent, safe to cast\n      const event = e as MouseEvent;\n      const linkDomNode = getLinkDomNode(event, editor);\n\n      if (linkDomNode === null) {\n        return;\n      }\n\n      const href = linkDomNode.getAttribute('href');\n\n      if (\n        linkDomNode.getAttribute('contenteditable') === 'false' ||\n        href === undefined\n      ) {\n        return;\n      }\n\n      let linkNode = null;\n      editor.update(() => {\n        const maybeLinkNode = $getNearestNodeFromDOMNode(linkDomNode);\n\n        if ($isLinkNode(maybeLinkNode)) {\n          linkNode = maybeLinkNode;\n        }\n      });\n\n      if (\n        linkNode === null ||\n        (filter !== undefined && !filter(event, linkNode))\n      ) {\n        return;\n      }\n\n      if (hasMovedDuringClick) {\n        return;\n      }\n\n      try {\n        window.open(\n          href,\n          newTab || event.metaKey || event.ctrlKey ? '_blank' : '_self'\n        );\n      } catch {\n        // It didn't work, which is better than throwing an exception!\n      }\n    }\n\n    return editor.registerRootListener(\n      (\n        rootElement: null | HTMLElement,\n        prevRootElement: null | HTMLElement\n      ) => {\n        if (prevRootElement !== null) {\n          prevRootElement.removeEventListener('pointerdown', onPointerDown);\n          prevRootElement.removeEventListener('pointerup', onPointerUp);\n          prevRootElement.removeEventListener('click', onClick);\n        }\n\n        if (rootElement !== null) {\n          rootElement.addEventListener('click', onClick);\n          rootElement.addEventListener('pointerdown', onPointerDown);\n          rootElement.addEventListener('pointerup', onPointerUp);\n        }\n      }\n    );\n  }, [editor, filter, newTab]);\n  return null;\n}\n\nfunction isLinkDomNode(domNode: Node): boolean {\n  return domNode.nodeName.toLowerCase() === 'a';\n}\n\nfunction getLinkDomNode(\n  event: MouseEvent,\n  editor: LexicalEditor\n): HTMLAnchorElement | null {\n  return editor.getEditorState().read(() => {\n    // $FlowExpectedError[incompatible-cast]\n    const domNode = event.target as Node;\n\n    if (isLinkDomNode(domNode)) {\n      // $FlowExpectedError[incompatible-cast]\n      return domNode as HTMLAnchorElement;\n    }\n\n    if (domNode.parentNode && isLinkDomNode(domNode.parentNode)) {\n      // $FlowExpectedError[incompatible-cast]\n      return domNode.parentNode as HTMLAnchorElement;\n    }\n\n    return null;\n  });\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { registerCodeHighlighting } from '@lexical/code';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useEffect } from 'react';\n\nexport default function CodeHighlightPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return registerCodeHighlighting(editor);\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { TextNode } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useLexicalTextEntity } from '@lexical/react/useLexicalTextEntity';\nimport { useCallback, useEffect } from 'react';\n\nimport { $createKeywordNode, KeywordNode } from '../nodes/KeywordNode';\n\nconst KEYWORDS_REGEX =\n  /(^|$|[^A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ])(congrats|congratulations|gratuluju|gratuluji|gratulujeme|blahopřeju|blahopřeji|blahopřejeme|Til lykke|Tillykke|Glückwunsch|Gratuliere|felicitaciones|enhorabuena|paljon onnea|onnittelut|Félicitations|gratula|gratulálok|gratulálunk|congratulazioni|complimenti|おめでとう|おめでとうございます|축하해|축하해요|gratulerer|Gefeliciteerd|gratulacje|Parabéns|parabéns|felicitações|felicitări|мои поздравления|поздравляем|поздравляю|gratulujem|blahoželám|ยินดีด้วย|ขอแสดงความยินดี|tebrikler|tebrik ederim|恭喜|祝贺你|恭喜你|恭喜|恭喜|baie geluk|veels geluk|অভিনন্দন|Čestitam|Čestitke|Čestitamo|Συγχαρητήρια|Μπράβο|અભિનંદન|badhai|बधाई|अभिनंदन|Честитам|Свака част|hongera|வாழ்த்துகள்|வாழ்த்துக்கள்|అభినందనలు|അഭിനന്ദനങ്ങൾ|Chúc mừng|מזל טוב|mazel tov|mazal tov)(^|$|[^A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ])/i;\n\nexport default function KeywordsPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([KeywordNode])) {\n      throw new Error('KeywordsPlugin: KeywordNode not registered on editor');\n    }\n  }, [editor]);\n\n  const createKeywordNode = useCallback((textNode: TextNode): KeywordNode => {\n    return $createKeywordNode(textNode.getTextContent());\n  }, []);\n\n  const getKeywordMatch = useCallback((text: string) => {\n    const matchArr = KEYWORDS_REGEX.exec(text);\n\n    if (matchArr === null) {\n      return null;\n    }\n\n    const hashtagLength = matchArr[2].length;\n    const startOffset = matchArr.index + matchArr[1].length;\n    const endOffset = startOffset + hashtagLength;\n    return {\n      end: endOffset,\n      start: startOffset,\n    };\n  }, []);\n\n  useLexicalTextEntity<KeywordNode>(\n    getKeywordMatch,\n    KeywordNode,\n    createKeywordNode\n  );\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { RangeSelection } from 'lexical';\n\nimport { $getListDepth, $isListItemNode, $isListNode } from '@lexical/list';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isElementNode,\n  $isRangeSelection,\n  COMMAND_PRIORITY_CRITICAL,\n  ElementNode,\n  INDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport { useEffect } from 'react';\n\ntype Props = Readonly<{\n  maxDepth: number | null | undefined;\n}>;\n\nfunction getElementNodesInSelection(\n  selection: RangeSelection\n): Set<ElementNode> {\n  const nodesInSelection = selection.getNodes();\n\n  if (nodesInSelection.length === 0) {\n    return new Set([\n      selection.anchor.getNode().getParentOrThrow(),\n      selection.focus.getNode().getParentOrThrow(),\n    ]);\n  }\n\n  return new Set(\n    nodesInSelection.map((n) => ($isElementNode(n) ? n : n.getParentOrThrow()))\n  );\n}\n\nfunction isIndentPermitted(maxDepth: number): boolean {\n  const selection = $getSelection();\n\n  if (!$isRangeSelection(selection)) {\n    return false;\n  }\n\n  const elementNodesInSelection: Set<ElementNode> =\n    getElementNodesInSelection(selection);\n\n  let totalDepth = 0;\n\n  for (const elementNode of elementNodesInSelection) {\n    if ($isListNode(elementNode)) {\n      totalDepth = Math.max($getListDepth(elementNode) + 1, totalDepth);\n    } else if ($isListItemNode(elementNode)) {\n      const parent = elementNode.getParent();\n\n      if (!$isListNode(parent)) {\n        throw new Error(\n          'ListMaxIndentLevelPlugin: A ListItemNode must have a ListNode for a parent.'\n        );\n      }\n\n      totalDepth = Math.max($getListDepth(parent) + 1, totalDepth);\n    }\n  }\n\n  return totalDepth <= maxDepth;\n}\n\nexport default function ListMaxIndentLevelPlugin({ maxDepth }: Props): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INDENT_CONTENT_COMMAND,\n      () => !isIndentPermitted(maxDepth ?? 7),\n      COMMAND_PRIORITY_CRITICAL\n    );\n  }, [editor, maxDepth]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n *\n */\n\nimport { MarkdownShortcutPlugin } from '@lexical/react/LexicalMarkdownShortcutPlugin';\nimport * as React from 'react';\n\nimport { PLAYGROUND_TRANSFORMERS } from './MarkdownTransformers';\n\nexport default function MarkdownPlugin(): JSX.Element {\n  return <MarkdownShortcutPlugin transformers={PLAYGROUND_TRANSFORMERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $setSelection,\n  FOCUS_COMMAND,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nconst COMMAND_PRIORITY_LOW = 1;\nconst TAB_TO_FOCUS_INTERVAL = 100;\n\nlet lastTabKeyDownTimestamp = 0;\nlet hasRegisteredKeyDownListener = false;\n\nfunction registerKeyTimeStampTracker() {\n  window.addEventListener(\n    'keydown',\n    (event: KeyboardEvent) => {\n      // Tab\n      if (event.keyCode === 9) {\n        lastTabKeyDownTimestamp = event.timeStamp;\n      }\n    },\n    true\n  );\n}\n\nexport default function TabFocusPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!hasRegisteredKeyDownListener) {\n      registerKeyTimeStampTracker();\n      hasRegisteredKeyDownListener = true;\n    }\n\n    return editor.registerCommand(\n      FOCUS_COMMAND,\n      (event: FocusEvent) => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n          if (\n            lastTabKeyDownTimestamp + TAB_TO_FOCUS_INTERVAL >\n            event.timeStamp\n          ) {\n            $setSelection(selection.clone());\n          }\n        }\n        return false;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n  }, [editor]);\n\n  return null;\n}\n","import { LexicalEditor } from 'lexical';\nimport React, { createContext } from 'react';\n\ninterface IEditorContext {\n  initialEditor: LexicalEditor;\n  activeEditor: LexicalEditor;\n  setActiveEditor: React.Dispatch<React.SetStateAction<LexicalEditor>>;\n}\n\nconst EditorContext = createContext<IEditorContext | null>(null);\n\nexport default EditorContext;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Dialog.css';\n\nimport * as React from 'react';\nimport { ReactNode } from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  children: ReactNode;\n}>;\n\nexport function DialogButtonsList({ children }: Props): JSX.Element {\n  return <div className=\"DialogButtonsList\">{children}</div>;\n}\n\nexport function DialogActions({\n  'data-test-id': dataTestId,\n  children,\n}: Props): JSX.Element {\n  return (\n    <div className=\"DialogActions\" data-test-id={dataTestId}>\n      {children}\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  accept?: string;\n  label: string;\n  onChange: (files: FileList) => void;\n}>;\n\nexport default function FileInput({\n  accept,\n  label,\n  onChange,\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"file\"\n        accept={accept}\n        className=\"Input__input\"\n        onChange={(e) => onChange(e.target.files)}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  label: string;\n  onChange: (string) => void;\n  placeholder?: string;\n  value: string;\n}>;\n\nexport default function TextInput({\n  label,\n  value,\n  onChange,\n  placeholder = '',\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"text\"\n        className=\"Input__input\"\n        placeholder={placeholder}\n        value={value}\n        onChange={(e) => {\n          onChange(e.target.value);\n        }}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $wrapNodeInElement, mergeRegister } from '@lexical/utils';\nimport {\n  $createParagraphNode,\n  $createRangeSelection,\n  $getSelection,\n  $insertNodes,\n  $isNodeSelection,\n  $isRootOrShadowRoot,\n  $setSelection,\n  COMMAND_PRIORITY_EDITOR,\n  COMMAND_PRIORITY_HIGH,\n  COMMAND_PRIORITY_LOW,\n  createCommand,\n  DRAGOVER_COMMAND,\n  DRAGSTART_COMMAND,\n  DROP_COMMAND,\n  LexicalCommand,\n  LexicalEditor,\n} from 'lexical';\nimport { useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\n\nimport {\n  $createImageNode,\n  $isImageNode,\n  ImageNode,\n  ImagePayload,\n} from '../nodes/ImageNode';\nimport Button from '../ui/Button';\nimport { DialogActions, DialogButtonsList } from '../ui/Dialog';\nimport FileInput from '../ui/FileInput';\nimport TextInput from '../ui/TextInput';\n\nexport type InsertImagePayload = Readonly<ImagePayload>;\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n\nconst getDOMSelection = (targetWindow: Window | null): Selection | null =>\n  CAN_USE_DOM ? (targetWindow || window).getSelection() : null;\n\nexport const INSERT_IMAGE_COMMAND: LexicalCommand<InsertImagePayload> =\n  createCommand('INSERT_IMAGE_COMMAND');\n\nexport function InsertImageUriDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  return (\n    <>\n      <TextInput\n        label=\"Image URL\"\n        placeholder=\"i.e. https://source.unsplash.com/random\"\n        onChange={setSrc}\n        value={src}\n        data-test-id=\"image-modal-url-input\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Random unsplash image\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <DialogActions>\n        <Button\n          data-test-id=\"image-modal-confirm-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </DialogActions>\n    </>\n  );\n}\n\nexport function InsertImageUploadedDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  const loadImage = (files: FileList | null) => {\n    const reader = new FileReader();\n    reader.onload = function () {\n      if (typeof reader.result === 'string') {\n        setSrc(reader.result);\n      }\n      return '';\n    };\n    if (files !== null) {\n      reader.readAsDataURL(files[0]);\n    }\n  };\n\n  return (\n    <>\n      <FileInput\n        label=\"Image Upload\"\n        onChange={loadImage}\n        accept=\"image/*\"\n        data-test-id=\"image-modal-file-upload\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Descriptive alternative text\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <DialogActions>\n        <Button\n          data-test-id=\"image-modal-file-upload-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </DialogActions>\n    </>\n  );\n}\n\nexport const InsertImageDialog = ({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element => {\n  const [mode, setMode] = useState<null | 'url' | 'file'>(null);\n  const hasModifier = useRef(false);\n\n  useEffect(() => {\n    hasModifier.current = false;\n    const handler = (e: KeyboardEvent) => {\n      hasModifier.current = e.altKey;\n    };\n    document.addEventListener('keydown', handler);\n    return () => {\n      document.removeEventListener('keydown', handler);\n    };\n  }, [activeEditor]);\n\n  const onClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n    onClose();\n  };\n\n  return (\n    <>\n      {!mode && (\n        <DialogButtonsList>\n          <Button\n            data-test-id=\"image-modal-option-url\"\n            onClick={() => setMode('url')}\n          >\n            URL\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-file\"\n            onClick={() => setMode('file')}\n          >\n            File\n          </Button>\n        </DialogButtonsList>\n      )}\n      {mode === 'url' && <InsertImageUriDialogBody onClick={onClick} />}\n      {mode === 'file' && <InsertImageUploadedDialogBody onClick={onClick} />}\n    </>\n  );\n}\n\nexport default function ImagesPlugin({\n  captionsEnabled,\n  maxWidth,\n}: {\n  captionsEnabled?: boolean;\n  maxWidth?: number;\n}): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([ImageNode])) {\n      throw new Error('ImagesPlugin: ImageNode not registered on editor');\n    }\n\n    return mergeRegister(\n      editor.registerCommand<InsertImagePayload>(\n        INSERT_IMAGE_COMMAND,\n        (payload) => {\n          const imageNode = $createImageNode({\n            ...payload,\n            maxWidth: maxWidth,\n          });\n          $insertNodes([imageNode]);\n          if ($isRootOrShadowRoot(imageNode.getParentOrThrow())) {\n            $wrapNodeInElement(imageNode, $createParagraphNode).selectEnd();\n          }\n\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGSTART_COMMAND,\n        (event) => {\n          return onDragStart(event);\n        },\n        COMMAND_PRIORITY_HIGH\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGOVER_COMMAND,\n        (event) => {\n          return onDragover(event);\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand<DragEvent>(\n        DROP_COMMAND,\n        (event) => {\n          return onDrop(event, editor);\n        },\n        COMMAND_PRIORITY_HIGH\n      )\n    );\n  }, [captionsEnabled, editor]);\n\n  return null;\n}\n\nconst TRANSPARENT_IMAGE =\n  'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\nconst img = document.createElement('img');\nimg.src = TRANSPARENT_IMAGE;\n\nfunction onDragStart(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const dataTransfer = event.dataTransfer;\n  if (!dataTransfer) {\n    return false;\n  }\n  dataTransfer.setData('text/plain', '_');\n  dataTransfer.setDragImage(img, 0, 0);\n  dataTransfer.setData(\n    'application/x-lexical-drag',\n    JSON.stringify({\n      data: {\n        altText: node.__altText,\n        caption: node.__caption,\n        height: node.__height,\n        key: node.getKey(),\n        maxWidth: node.__maxWidth,\n        showCaption: node.__showCaption,\n        src: node.__src,\n        width: node.__width,\n      },\n      type: 'image',\n    })\n  );\n\n  return true;\n}\n\nfunction onDragover(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  if (!canDropImage(event)) {\n    event.preventDefault();\n  }\n  return true;\n}\n\nfunction onDrop(event: DragEvent, editor: LexicalEditor): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const data = getDragImageData(event);\n  if (!data) {\n    return false;\n  }\n  event.preventDefault();\n  if (canDropImage(event)) {\n    const range = getDragSelection(event);\n    node.remove();\n    const rangeSelection = $createRangeSelection();\n    if (range !== null && range !== undefined) {\n      rangeSelection.applyDOMRange(range);\n    }\n    $setSelection(rangeSelection);\n    editor.dispatchCommand(INSERT_IMAGE_COMMAND, data);\n  }\n  return true;\n}\n\nfunction getImageNodeInSelection(): ImageNode | null {\n  const selection = $getSelection();\n  if (!$isNodeSelection(selection)) {\n    return null;\n  }\n  const nodes = selection.getNodes();\n  const node = nodes[0];\n  return $isImageNode(node) ? node : null;\n}\n\nfunction getDragImageData(event: DragEvent): null | InsertImagePayload {\n  const dragData = event.dataTransfer?.getData('application/x-lexical-drag');\n  if (!dragData) {\n    return null;\n  }\n  const { type, data } = JSON.parse(dragData);\n  if (type !== 'image') {\n    return null;\n  }\n\n  return data;\n}\n\ndeclare global {\n  interface DragEvent {\n    rangeOffset?: number;\n    rangeParent?: Node;\n  }\n}\n\nfunction canDropImage(event: DragEvent): boolean {\n  const target = event.target;\n  return !!(\n    target &&\n    target instanceof HTMLElement &&\n    !target.closest('code, span.editor-image') &&\n    target.parentElement &&\n    target.parentElement.closest('div.ContentEditable__root')\n  );\n}\n\nfunction getDragSelection(event: DragEvent): Range | null | undefined {\n  let range;\n  const target = event.target as null | Element | Document;\n  const targetWindow =\n    target == null\n      ? null\n      : target.nodeType === 9\n      ? (target as Document).defaultView\n      : (target as Element).ownerDocument.defaultView;\n  const domSelection = getDOMSelection(targetWindow);\n  if (document.caretRangeFromPoint) {\n    range = document.caretRangeFromPoint(event.clientX, event.clientY);\n  } else if (event.rangeParent && domSelection !== null) {\n    domSelection.collapse(event.rangeParent, event.rangeOffset || 0);\n    range = domSelection.getRangeAt(0);\n  } else {\n    throw Error(`Cannot get the selection when dragging`);\n  }\n\n  return range;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { DRAG_DROP_PASTE } from '@lexical/rich-text';\nimport { isMimeType, mediaFileReader } from '@lexical/utils';\nimport { COMMAND_PRIORITY_LOW } from 'lexical';\nimport { useEffect } from 'react';\n\nimport { INSERT_IMAGE_COMMAND } from './ImagesPlugin';\n\nconst ACCEPTABLE_IMAGE_TYPES = [\n  'image/',\n  'image/heic',\n  'image/heif',\n  'image/gif',\n  'image/webp',\n];\n\nexport default function DragDropPaste(): null {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    return editor.registerCommand(\n      DRAG_DROP_PASTE,\n      (files) => {\n        (async () => {\n          const filesResult = await mediaFileReader(\n            files,\n            [ACCEPTABLE_IMAGE_TYPES].flatMap((x) => x)\n          );\n          for (const { file, result } of filesResult) {\n            if (isMimeType(file, ACCEPTABLE_IMAGE_TYPES)) {\n              editor.dispatchCommand(INSERT_IMAGE_COMMAND, {\n                altText: file.name,\n                src: result,\n              });\n            }\n          }\n        })();\n        return true;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n  }, [editor]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {AutoFocusPlugin} from '@lexical/react/LexicalAutoFocusPlugin';\nimport {CheckListPlugin} from '@lexical/react/LexicalCheckListPlugin';\nimport {ClearEditorPlugin} from '@lexical/react/LexicalClearEditorPlugin';\nimport {HashtagPlugin} from '@lexical/react/LexicalHashtagPlugin';\nimport {LinkPlugin} from '@lexical/react/LexicalLinkPlugin';\nimport {ListPlugin} from '@lexical/react/LexicalListPlugin';\nimport {RichTextPlugin} from '@lexical/react/LexicalRichTextPlugin';\nimport {OnChangePlugin} from '@lexical/react/LexicalOnChangePlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport React, {ReactNode, useEffect, useRef, useState} from 'react';\n\nimport {useSettings} from './context/SettingsContext';\nimport {useSharedHistoryContext} from './context/SharedHistoryContext';\nimport ActionsPlugin from './plugins/ActionsPlugin';\nimport AutoLinkPlugin from './plugins/AutoLinkPlugin';\nimport CharacterStylesPopupPlugin from './plugins/CharacterStylesPopupPlugin';\nimport ClickableLinkPlugin from './plugins/ClickableLinkPlugin';\nimport CodeHighlightPlugin from './plugins/CodeHighlightPlugin';\nimport KeywordsPlugin from './plugins/KeywordsPlugin';\nimport ListMaxIndentLevelPlugin from './plugins/ListMaxIndentLevelPlugin';\nimport MarkdownShortcutPlugin from './plugins/MarkdownShortcutPlugin';\nimport SpeechToTextPlugin from './plugins/SpeechToTextPlugin';\nimport TabFocusPlugin from './plugins/TabFocusPlugin';\nimport ContentEditable from './ui/ContentEditable';\nimport Placeholder from './ui/Placeholder';\nimport {HistoryPlugin} from '@lexical/react/LexicalHistoryPlugin';\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport EditorContext from './context/EditorContext';\nimport {LexicalEditor} from 'lexical';\nimport {useTranslation} from 'react-i18next';\nimport DragDropPaste from './plugins/DragDropPastePlugin';\n\ninterface IEditorProps {\n    children?: ReactNode\n    hashtagsEnabled?: boolean\n    autoFocusEnabled?: boolean\n    autoLinkEnabled?: boolean\n    emojisEnabled?: boolean\n    actionsEnabled?: boolean\n    speechToTextEnabled?: boolean\n    placeholder?: string\n    listMaxIndent?: number\n    isEditable?: boolean\n    locale?: 'en' | 'fr' | 'ptBr' | 'ru' | null\n    onChange?: (editorState: string, editorInstance?: LexicalEditor) => void\n}\n\nconst Editor = (\n    {\n        children,\n        hashtagsEnabled = false,\n        autoFocusEnabled = false,\n        autoLinkEnabled = false,\n        emojisEnabled = false,\n        actionsEnabled = false,\n        speechToTextEnabled = false,\n        listMaxIndent = 7,\n        placeholder = '',\n        isEditable = true,\n        locale = null,\n        onChange,\n    }: IEditorProps\n) => {\n    const [editor] = useLexicalComposerContext();\n    const [activeEditor, setActiveEditor] = useState(editor);\n\n    const editorStateRef = useRef(null);\n    const {historyState} = useSharedHistoryContext();\n    const {\n        settings: {isRichText},\n    } = useSettings();\n    const placeholderComponent = <Placeholder>{placeholder}</Placeholder>;\n\n    const {i18n} = useTranslation();\n\n    useEffect(() => {\n        editor.setEditable(isEditable)\n\n        if (locale) i18n.changeLanguage(locale)\n    }, [])\n\n    return <EditorContext.Provider value={{initialEditor: editor, activeEditor, setActiveEditor}}>\n        {children}\n        <div className={`verbum-editor-container`}>\n            {autoFocusEnabled && <AutoFocusPlugin/>}\n            <ClearEditorPlugin/>\n            {hashtagsEnabled && <HashtagPlugin/>}\n            <KeywordsPlugin/>\n            {speechToTextEnabled && <SpeechToTextPlugin/>}\n            <DragDropPaste/>\n            {autoLinkEnabled && <AutoLinkPlugin/>}\n\n            <>\n                <RichTextPlugin\n                    contentEditable={<ContentEditable/>}\n                    placeholder={placeholderComponent}\n                    ErrorBoundary={LexicalErrorBoundary}\n                />\n                <OnChangePlugin\n                    onChange={(editorState) => {\n                        onChange?.(JSON.stringify(editorState), activeEditor);\n                        return (editorStateRef.current = editorState);\n                    }}\n                />\n                <MarkdownShortcutPlugin/>\n                <CodeHighlightPlugin/>\n                <ListPlugin/>\n                <CheckListPlugin/>\n                <ListMaxIndentLevelPlugin maxDepth={listMaxIndent}/>\n                <LinkPlugin/>\n                <ClickableLinkPlugin/>\n                <CharacterStylesPopupPlugin/>\n                <TabFocusPlugin/>\n            </>\n\n            <HistoryPlugin externalHistoryState={historyState}/>\n            {actionsEnabled && <ActionsPlugin isRichText={isRichText}/>}\n        </div>\n    </EditorContext.Provider>\n}\n\nexport default Editor\n","import { $isAtNodeEnd } from '@lexical/selection';\nimport { ElementNode, RangeSelection, TextNode } from 'lexical';\n\nexport function getSelectedNode(\n  selection: RangeSelection\n): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n","import { LexicalEditor } from 'lexical';\nimport React, { createContext } from 'react';\n\ninterface IToolbarContext {\n  isRTL: boolean;\n  isBold: boolean;\n  isItalic: boolean;\n  isUnderline: boolean;\n  isCode: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  canUndo: boolean;\n  canRedo: boolean;\n  fontFamily: string;\n  fontSize: string;\n  fontColor: string;\n  bgColor: string;\n  blockType: string;\n  codeLanguage: string;\n  selectedElementKey: string;\n  applyStyleText: (styles: Record<string, string>) => void;\n  insertLink: () => void;\n}\n\nconst ToolbarContext = createContext<IToolbarContext | null>(null);\n\nexport default ToolbarContext;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\n\nexport default function DropDown({\n  buttonLabel,\n  buttonAriaLabel,\n  buttonClassName,\n  buttonIconClassName,\n  children,\n  stopCloseOnClickSelf,\n}: {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  children: JSX.Element | string | (JSX.Element | string)[];\n  stopCloseOnClickSelf?: boolean;\n}): JSX.Element {\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const buttonRef = useRef<HTMLButtonElement | null>(null);\n  const [showDropDown, setShowDropDown] = useState(false);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n    const dropDown = dropDownRef.current;\n\n    if (showDropDown && button !== null && dropDown !== null) {\n      const { top, left } = button.getBoundingClientRect();\n      dropDown.style.top = `${top + 40}px`;\n      dropDown.style.left = `${Math.min(\n        left,\n        window.innerWidth - dropDown.offsetWidth - 20\n      )}px`;\n    }\n  }, [dropDownRef, buttonRef, showDropDown]);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n\n    if (button !== null && showDropDown) {\n      const handle = (event: MouseEvent) => {\n        const target = event.target;\n        if (stopCloseOnClickSelf) {\n          if (dropDownRef.current.contains(target as Node)) return;\n        }\n        if (!button.contains(target as Node)) {\n          setShowDropDown(false);\n        }\n      };\n      document.addEventListener('click', handle);\n\n      return () => {\n        document.removeEventListener('click', handle);\n      };\n    }\n  }, [dropDownRef, buttonRef, showDropDown, stopCloseOnClickSelf]);\n\n  return (\n    <>\n      <button\n        aria-label={buttonAriaLabel || buttonLabel}\n        className={buttonClassName}\n        onClick={() => setShowDropDown(!showDropDown)}\n        ref={buttonRef}\n        type=\"button\"\n      >\n        {buttonIconClassName && <span className={buttonIconClassName} />}\n        {buttonLabel && (\n          <span className=\"verbum-text verbum-dropdown-button-text\">{buttonLabel}</span>\n        )}\n        <i className=\"verbum-chevron-down\" />\n      </button>\n\n      {showDropDown &&\n        createPortal(\n          <div className=\"verbum-dropdown\" ref={dropDownRef}>\n            {children}\n          </div>,\n          document.body\n        )}\n    </>\n  );\n}\n","import React, { useContext } from 'react';\nimport DropDown from '../../../ui/DropDown';\n\nimport {\n  FORMAT_ELEMENT_COMMAND,\n  INDENT_CONTENT_COMMAND,\n  LexicalEditor,\n  OUTDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nfunction Divider(): JSX.Element {\n  return <div className=\"verbum-divider\" />;\n}\n\nconst AlignDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isRTL } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <DropDown\n      buttonLabel={t('toolbar:alignDropdown.Title')}\n      buttonAriaLabel={t('toolbar:alignDropdown.Description')}\n      buttonClassName=\"verbum-toolbar-item spaced alignment\"\n      buttonIconClassName=\"verbum-icon verbum-left-align\"\n    >\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'left');\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-left-align\" />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.LeftAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'center');\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-center-align\" />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.CenterAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'right');\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-right-align\" />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.RightAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'justify');\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-justify-align\" />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.JustifyAlign')}</span>\n      </button>\n      <Divider />\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(OUTDENT_CONTENT_COMMAND, undefined);\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className={'icon ' + (isRTL ? 'indent' : 'outdent')} />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.Outdent')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(INDENT_CONTENT_COMMAND, undefined);\n        }}\n        className=\"verbum-item\"\n        type=\"button\"\n      >\n        <i className={'icon ' + (isRTL ? 'outdent' : 'indent')} />\n        <span className=\"verbum-text\">{t('toolbar:alignDropdown.Indent')}</span>\n      </button>\n    </DropDown>\n  );\n};\n\nexport default AlignDropdown;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nimport { CAN_USE_DOM } from './canUseDOM';\n\nconst documentMode =\n  // @ts-ignore\n  CAN_USE_DOM && 'documentMode' in document ? document.documentMode : null;\n\nexport const IS_APPLE: boolean =\n  CAN_USE_DOM && /Mac|iPod|iPhone|iPad/.test(navigator.platform);\n\nexport const IS_FIREFOX: boolean =\n  CAN_USE_DOM && /^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);\n\nexport const CAN_USE_BEFORE_INPUT: boolean =\n  CAN_USE_DOM && 'InputEvent' in window && !documentMode\n    ? 'getTargetRanges' in new window.InputEvent('input')\n    : false;\n\nexport const IS_SAFARI: boolean =\n  CAN_USE_DOM && /Version\\/[\\d\\.]+.*Safari/.test(navigator.userAgent);\n\nexport const IS_IOS: boolean =\n  CAN_USE_DOM &&\n  /iPad|iPhone|iPod/.test(navigator.userAgent) &&\n  !(window as any).MSStream;\n\n// Keep these in case we need to use them in the future.\n// export const IS_WINDOWS: boolean = CAN_USE_DOM && /Win/.test(navigator.platform);\n// export const IS_CHROME: boolean = CAN_USE_DOM && /^(?=.*Chrome).*/i.test(navigator.userAgent);\n// export const canUseTextInputEvent: boolean = CAN_USE_DOM && 'TextEvent' in window && !documentMode;\n","import * as React from 'react';\nimport { useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { UNDO_COMMAND } from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport { useTranslation } from 'react-i18next';\n\nconst UndoButton = () => {\n  const { canUndo } = useContext(ToolbarContext);\n  const { activeEditor } = useContext(EditorContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <button\n      disabled={!canUndo}\n      onClick={() => {\n        activeEditor.dispatchCommand(UNDO_COMMAND, undefined);\n      }}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:undoButton.Title')} (⌘Z)`\n          : `${t('toolbar:undoButton.Title')} (Ctrl+Z)`\n      }\n      className=\"verbum-toolbar-item spaced\"\n      aria-label={t('toolbar:undoButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-undo\" />\n    </button>\n  );\n};\n\nexport default UndoButton;\n","import * as React from 'react';\nimport { useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { REDO_COMMAND } from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport { useTranslation } from 'react-i18next';\n\nconst RedoButton = () => {\n  const { canRedo } = useContext(ToolbarContext);\n  const { activeEditor } = useContext(EditorContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <button\n      disabled={!canRedo}\n      onClick={() => {\n        activeEditor.dispatchCommand(REDO_COMMAND, undefined);\n      }}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:redoButton.Title')} (⌘Y)`\n          : `${t('toolbar:redoButton.Title')} (Ctrl+Y)`\n      }\n      className=\"verbum-toolbar-item\"\n      aria-label={t('toolbar:redoButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-redo\" />\n    </button>\n  );\n};\n\nexport default RedoButton;\n","import React from 'react';\n\nconst Select = ({\n  onChange,\n  className,\n  options,\n  value,\n}: {\n  className: string;\n  onChange: (event: { target: { value: string } }) => void;\n  options: [string, string][];\n  value: string;\n}): JSX.Element => {\n  return (\n    <select className={className} onChange={onChange} value={value}>\n      {options.map(([option, text]) => (\n        <option key={option} value={option}>\n          {text}\n        </option>\n      ))}\n    </select>\n  );\n};\n\nexport default Select;\n","import { $isCodeNode } from '@lexical/code';\nimport { $getNodeByKey } from 'lexical';\nimport React, { useCallback, useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst CODE_LANGUAGE_OPTIONS: [string, string][] = [\n  ['', '- Select language -'],\n  ['c', 'C'],\n  ['clike', 'C-like'],\n  ['css', 'CSS'],\n  ['html', 'HTML'],\n  ['js', 'JavaScript'],\n  ['markdown', 'Markdown'],\n  ['objc', 'Objective-C'],\n  ['plain', 'Plain Text'],\n  ['py', 'Python'],\n  ['rust', 'Rust'],\n  ['sql', 'SQL'],\n  ['swift', 'Swift'],\n  ['xml', 'XML'],\n];\n\nconst CodeLanguageDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { selectedElementKey, codeLanguage } = useContext(ToolbarContext);\n  const onCodeLanguageSelect = useCallback(\n    (e) => {\n      activeEditor.update(() => {\n        if (selectedElementKey !== null) {\n          const node = $getNodeByKey(selectedElementKey);\n          if ($isCodeNode(node)) {\n            console.log(e.target.value);\n            node.setLanguage(e.target.value);\n          }\n        }\n      });\n    },\n    [activeEditor, selectedElementKey]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"verbum-toolbar-item code-language\"\n        onChange={onCodeLanguageSelect}\n        options={CODE_LANGUAGE_OPTIONS}\n        value={codeLanguage}\n      />\n      <i className=\"verbum-chevron-down inside\" />\n    </>\n  );\n};\n\nexport default CodeLanguageDropdown;\n","import { $createCodeNode } from '@lexical/code';\nimport {\n  INSERT_CHECK_LIST_COMMAND,\n  INSERT_ORDERED_LIST_COMMAND,\n  INSERT_UNORDERED_LIST_COMMAND,\n  REMOVE_LIST_COMMAND,\n} from '@lexical/list';\nimport { $createHeadingNode, $createQuoteNode } from '@lexical/rich-text';\nimport { $wrapNodes } from '@lexical/selection';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  LexicalEditor,\n} from 'lexical';\nimport React, { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport DropDown from '../../../ui/DropDown';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst BlockFormatDropdown = () => {\n  const { initialEditor } = useContext(EditorContext);\n  const { blockType } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  const formatParagraph = () => {\n    if (blockType !== 'paragraph') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createParagraphNode());\n        }\n      });\n    }\n  };\n\n  const formatHeading = (headingSize) => {\n    if (blockType !== headingSize) {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createHeadingNode(headingSize));\n        }\n      });\n    }\n  };\n\n  const formatBulletList = () => {\n    if (blockType !== 'bullet') {\n      initialEditor.dispatchCommand(INSERT_UNORDERED_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatCheckList = () => {\n    if (blockType !== 'check') {\n      initialEditor.dispatchCommand(INSERT_CHECK_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatNumberedList = () => {\n    if (blockType !== 'number') {\n      initialEditor.dispatchCommand(INSERT_ORDERED_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatQuote = () => {\n    if (blockType !== 'quote') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createQuoteNode());\n        }\n      });\n    }\n  };\n\n  const formatCode = () => {\n    if (blockType !== 'code') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          if (selection.isCollapsed()) {\n            $wrapNodes(selection, () => $createCodeNode());\n          } else {\n            const textContent = selection.getTextContent();\n            const codeNode = $createCodeNode();\n            selection.removeText();\n            selection.insertNodes([codeNode]);\n            selection.insertRawText(textContent);\n          }\n        }\n      });\n    }\n  };\n\n  return (\n    <DropDown\n      buttonLabel={t(`blockFormatDropdown.${blockType}`)}\n      buttonAriaLabel={t('toolbar:blockFormatDropdown.Description')}\n      buttonClassName=\"verbum-toolbar-item verbum-block-controls\"\n      buttonIconClassName={'icon block-type ' + blockType}\n    >\n      <button className=\"verbum-item\" onClick={formatParagraph} type=\"button\">\n        <span className=\"verbum-icon verbum-paragraph\" />\n        <span className=\"verbum-text\">{t('toolbar:blockFormatDropdown.paragraph')}</span>\n        {blockType === 'paragraph' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => formatHeading('h1')}\n        type=\"button\"\n      >\n        <span className=\"verbum-icon verbum-h1\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.h1')}\n        </span>\n        {blockType === 'h1' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => formatHeading('h2')}\n        type=\"button\"\n      >\n        <span className=\"verbum-icon verbum-h2\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.h2')}\n        </span>\n        {blockType === 'h2' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => formatHeading('h3')}\n        type=\"button\"\n      >\n        <span className=\"verbum-icon verbum-h3\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.h3')}\n        </span>\n        {blockType === 'h3' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatBulletList} type=\"button\">\n        <span className=\"verbum-icon verbum-bullet-list\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.bullet')}\n        </span>\n        {blockType === 'bullet' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatNumberedList} type=\"button\">\n        <span className=\"verbum-icon verbum-numbered-list\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.number')}\n        </span>\n        {blockType === 'number' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatCheckList} type=\"button\">\n        <span className=\"verbum-icon verbum-check-list\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.check')}\n        </span>\n        {blockType === 'check' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatQuote} type=\"button\">\n        <span className=\"verbum-icon verbum-quote\" />\n        <span className=\"verbum-text\">{t('toolbar:blockFormatDropdown.quote')}</span>\n        {blockType === 'quote' && <span className=\"active\" />}\n      </button>\n      <button className=\"verbum-item\" onClick={formatCode} type=\"button\">\n        <span className=\"verbum-icon verbum-code\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:blockFormatDropdown.code')}\n        </span>\n        {blockType === 'code' && <span className=\"active\" />}\n      </button>\n    </DropDown>\n  );\n};\n\nexport default BlockFormatDropdown;\n","import React from 'react';\n\nexport default function Divider(): JSX.Element {\n  return <div className=\"divider\" />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {$isCodeNode} from '@lexical/code';\nimport {$isLinkNode, TOGGLE_LINK_COMMAND} from '@lexical/link';\nimport {$isListNode, ListNode} from '@lexical/list';\nimport {$isHeadingNode} from '@lexical/rich-text';\nimport {$getSelectionStyleValueForProperty, $isParentElementRTL, $patchStyleText,} from '@lexical/selection';\nimport {$getNearestNodeOfType, mergeRegister} from '@lexical/utils';\nimport {\n    $getSelection,\n    $isRangeSelection,\n    CAN_REDO_COMMAND,\n    CAN_UNDO_COMMAND,\n    COMMAND_PRIORITY_CRITICAL,\n    SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {useCallback, useContext, useEffect, useState} from 'react';\nimport useChild from 'use-child';\nimport {getSelectedNode} from '../../utils/node.util';\nimport EditorContext from '../../context/EditorContext';\nimport ToolbarContext from '../../context/ToolbarContext';\nimport AlignDropdown from './components/AlignDropdown';\nimport './ToolbarPlugin.css';\nimport UndoButton from './components/UndoButton';\nimport RedoButton from './components/RedoButton';\nimport CodeLanguageDropdown from './components/CodeLanguageDropdown';\nimport BlockFormatDropdown from './components/BlockFormatDropdown';\nimport Divider from '../../ui/Divider';\n\nconst supportedBlockTypes = new Set([\n    'paragraph',\n    'quote',\n    'code',\n    'h1',\n    'h2',\n    'h3',\n    'bullet',\n    'number',\n    'check',\n]);\n\nconst CODE_LANGUAGE_MAP = {\n    javascript: 'js',\n    md: 'markdown',\n    plaintext: 'plain',\n    python: 'py',\n    text: 'plain',\n};\n\ntype ToolbarProps = {\n    children?: React.ReactElement | React.ReactElement[]\n    defaultFontSize?: string /** The default selected font size in the toolbar */\n    defaultFontColor?: string /** The default selected font color in the toolbar */\n    defaultBgColor?: string /** The default selected background color in the toolbar */\n    defaultFontFamily?: string /** The default selected font family in the toolbar */\n    disableBlockTypeSelect?: boolean\n}\n\nconst ToolbarPlugin = ({\n                           children,\n                           defaultFontSize = '15px',\n                           defaultFontColor = '#000',\n                           defaultBgColor = '#fff',\n                           defaultFontFamily = 'Arial',\n                           disableBlockTypeSelect\n                       }: ToolbarProps) => {\n    const [alignExists, AlignComponent] = useChild(children, AlignDropdown);\n\n    const {initialEditor, activeEditor, setActiveEditor} =\n        useContext(EditorContext);\n    const [blockType, setBlockType] = useState('paragraph');\n    const [selectedElementKey, setSelectedElementKey] = useState(null);\n    const [fontSize, setFontSize] = useState<string>(defaultFontSize);\n    const [fontColor, setFontColor] = useState<string>(defaultFontColor);\n    const [bgColor, setBgColor] = useState<string>(defaultBgColor);\n    const [fontFamily, setFontFamily] = useState<string>(defaultFontFamily);\n    const [isLink, setIsLink] = useState(false);\n    const [isBold, setIsBold] = useState(false);\n    const [isItalic, setIsItalic] = useState(false);\n    const [isUnderline, setIsUnderline] = useState(false);\n    const [isStrikethrough, setIsStrikethrough] = useState(false);\n    const [isSubscript, setIsSubscript] = useState(false);\n    const [isSuperscript, setIsSuperscript] = useState(false);\n    const [isCode, setIsCode] = useState(false);\n    const [canUndo, setCanUndo] = useState(false);\n    const [canRedo, setCanRedo] = useState(false);\n    const [isRTL, setIsRTL] = useState(false);\n    const [codeLanguage, setCodeLanguage] = useState<string>('');\n\n    const updateToolbar = useCallback(() => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n            const anchorNode = selection.anchor.getNode();\n            const element =\n                anchorNode.getKey() === 'root'\n                    ? anchorNode\n                    : anchorNode.getTopLevelElementOrThrow();\n            const elementKey = element.getKey();\n            const elementDOM = activeEditor.getElementByKey(elementKey);\n\n            // Update text format\n            setIsBold(selection.hasFormat('bold'));\n            setIsItalic(selection.hasFormat('italic'));\n            setIsUnderline(selection.hasFormat('underline'));\n            setIsStrikethrough(selection.hasFormat('strikethrough'));\n            setIsSubscript(selection.hasFormat('subscript'));\n            setIsSuperscript(selection.hasFormat('superscript'));\n            setIsCode(selection.hasFormat('code'));\n            setIsRTL($isParentElementRTL(selection));\n\n            // Update links\n            const node = getSelectedNode(selection);\n            const parent = node.getParent();\n            if ($isLinkNode(parent) || $isLinkNode(node)) {\n                setIsLink(true);\n            } else {\n                setIsLink(false);\n            }\n\n            if (elementDOM !== null) {\n                setSelectedElementKey(elementKey);\n                if ($isListNode(element)) {\n                    const parentList = $getNearestNodeOfType<ListNode>(\n                        anchorNode,\n                        ListNode\n                    );\n                    const type = parentList\n                        ? parentList.getListType()\n                        : element.getListType();\n                    setBlockType(type);\n                } else {\n                    const type = $isHeadingNode(element)\n                        ? element.getTag()\n                        : element.getType();\n                    setBlockType(type);\n                    if ($isCodeNode(element)) {\n                        const language = element.getLanguage();\n                        setCodeLanguage(\n                            language ? CODE_LANGUAGE_MAP[language] || language : ''\n                        );\n                        return;\n                    }\n                }\n            }\n            // Hande buttons\n            setFontSize(\n                $getSelectionStyleValueForProperty(\n                    selection,\n                    'font-size',\n                    defaultFontSize\n                )\n            );\n            setFontColor(\n                $getSelectionStyleValueForProperty(selection, 'color', defaultFontColor)\n            );\n            setBgColor(\n                $getSelectionStyleValueForProperty(\n                    selection,\n                    'background-color',\n                    defaultBgColor\n                )\n            );\n\n            const font = $getSelectionStyleValueForProperty(selection, 'font-family');\n            if (font) setFontFamily(font);\n        }\n    }, [activeEditor]);\n\n    useEffect(() => {\n        return initialEditor.registerCommand(\n            SELECTION_CHANGE_COMMAND,\n            (_payload, newEditor) => {\n                updateToolbar();\n                setActiveEditor(newEditor);\n                return false;\n            },\n            COMMAND_PRIORITY_CRITICAL\n        );\n    }, [initialEditor, updateToolbar]);\n\n    useEffect(() => {\n        return mergeRegister(\n            activeEditor.registerUpdateListener(({editorState}) => {\n                editorState.read(() => {\n                    updateToolbar();\n                });\n            }),\n            activeEditor.registerCommand<boolean>(\n                CAN_UNDO_COMMAND,\n                (payload) => {\n                    setCanUndo(payload);\n                    return false;\n                },\n                COMMAND_PRIORITY_CRITICAL\n            ),\n            activeEditor.registerCommand<boolean>(\n                CAN_REDO_COMMAND,\n                (payload) => {\n                    setCanRedo(payload);\n                    return false;\n                },\n                COMMAND_PRIORITY_CRITICAL\n            )\n        );\n    }, [activeEditor, updateToolbar]);\n\n    const applyStyleText = useCallback(\n        (styles: Record<string, string>) => {\n            Object.entries(styles).forEach(([key, value]) => {\n                switch (key) {\n                    case \"font-family\":\n                        setFontFamily(value)\n                        break\n                    case \"font-size\":\n                        setFontSize(value)\n                        break\n                    case \"background-color\":\n                        setBgColor(value)\n                        break\n                    case \"color\":\n                        setFontColor(value)\n                        break\n                }\n            })\n\n            activeEditor.update(() => {\n                const selection = $getSelection();\n                if ($isRangeSelection(selection)) {\n                    $patchStyleText(selection, styles);\n                }\n            });\n        },\n        [activeEditor]\n    );\n\n    const insertLink = useCallback(() => {\n        if (!isLink) {\n            initialEditor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n        } else {\n            initialEditor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n        }\n    }, [initialEditor, isLink]);\n\n    return <ToolbarContext.Provider\n        value={{\n            isRTL,\n            canUndo,\n            canRedo,\n            fontFamily,\n            fontSize,\n            fontColor,\n            bgColor,\n            isBold,\n            isItalic,\n            isUnderline,\n            isCode,\n            isLink,\n            applyStyleText,\n            insertLink,\n            isStrikethrough,\n            isSubscript,\n            isSuperscript,\n            selectedElementKey,\n            codeLanguage,\n            blockType,\n        }}\n    >\n        <div className=\"verbum-toolbar\">\n            <UndoButton/>\n            <RedoButton/>\n            <Divider/>\n            {!disableBlockTypeSelect && supportedBlockTypes.has(blockType) && activeEditor === initialEditor && <>\n                <BlockFormatDropdown/>\n                <Divider/>\n            </>}\n            {blockType === 'code' ? <>\n                <CodeLanguageDropdown/>\n                <Divider/>\n                {alignExists && AlignComponent}\n            </> : <>{children}</>}\n        </div>\n    </ToolbarContext.Provider>;\n};\n\nexport default ToolbarPlugin;\n","import { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  LexicalTypeaheadMenuPlugin,\n  QueryMatch,\n  TypeaheadOption,\n  useBasicTypeaheadTriggerMatch,\n} from '@lexical/react/LexicalTypeaheadMenuPlugin';\nimport { $createTextNode, TextNode } from 'lexical';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport { $createMentionNode } from '../nodes/MentionNode';\nimport { $createAutoLinkNode } from '@lexical/link';\n\nimport './MentionsPlugin.css';\n\ntype SearchData<A> = (p: string) => Promise<A[]>;\n\nconst PUNCTUATION =\n  '\\\\.,\\\\+\\\\*\\\\?\\\\$\\\\@\\\\|#{}\\\\(\\\\)\\\\^\\\\-\\\\[\\\\]\\\\\\\\/!%\\'\"~=<>_:;';\nconst NAME = '\\\\b[A-Z][^\\\\s' + PUNCTUATION + ']';\n\nconst DocumentMentionsRegex = {\n  NAME,\n  PUNCTUATION,\n};\n\nconst CapitalizedNameMentionsRegex = new RegExp(\n  '(^|[^#])((?:' + DocumentMentionsRegex.NAME + '{' + 1 + ',})$)'\n);\n\nconst PUNC = DocumentMentionsRegex.PUNCTUATION;\n\nconst TRIGGERS = ['@'].join('');\n\n// Chars we expect to see in a mention (non-space, non-punctuation).\nconst VALID_CHARS = '[^' + TRIGGERS + PUNC + '\\\\s]';\n\n// Non-standard series of chars. Each series must be preceded and followed by\n// a valid char.\nconst VALID_JOINS =\n  '(?:' +\n  '\\\\.[ |$]|' + // E.g. \"r. \" in \"Mr. Smith\"\n  ' |' + // E.g. \" \" in \"Josh Duck\"\n  '[' +\n  PUNC +\n  ']|' + // E.g. \"-' in \"Salier-Hellendag\"\n  ')';\n\nconst LENGTH_LIMIT = 75;\n\nconst AtSignMentionsRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    VALID_JOINS +\n    '){0,' +\n    LENGTH_LIMIT +\n    '})' +\n    ')$'\n);\n\n// 50 is the longest alias length limit.\nconst ALIAS_LENGTH_LIMIT = 50;\n\n// Regex used to match alias.\nconst AtSignMentionsRegexAliasRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    '){0,' +\n    ALIAS_LENGTH_LIMIT +\n    '})' +\n    ')$'\n);\n\n// At most, 5 suggestions are shown in the popup.\nconst SUGGESTION_LIST_LENGTH_LIMIT = 5;\n\nconst mentionsCache = new Map();\n\nfunction useMentionLookupService<A>(\n  mentionString: string | null,\n  mentionData: SearchData<A>\n) {\n  const [results, setResults] = useState<Array<A>>([]);\n\n  useEffect(() => {\n    const cachedResults = mentionsCache.get(mentionString);\n\n    if (mentionString == null) {\n      setResults([]);\n      return;\n    }\n\n    if (cachedResults === null) {\n      return;\n    } else if (cachedResults !== undefined) {\n      setResults(cachedResults);\n      return;\n    }\n\n    mentionsCache.set(mentionString, null);\n\n    mentionData(mentionString).then((results) => {\n      mentionsCache.set(mentionString, results);\n      setResults(results);\n    });\n  }, [mentionString]);\n\n  return results;\n}\n\nfunction checkForCapitalizedNameMentions(\n  text: string,\n  minMatchLength: number\n): QueryMatch | null {\n  const match = CapitalizedNameMentionsRegex.exec(text);\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[2];\n    if (matchingString != null && matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: matchingString,\n      };\n    }\n  }\n  return null;\n}\n\nfunction checkForAtSignMentions(\n  text: string,\n  minMatchLength: number\n): QueryMatch | null {\n  let match = AtSignMentionsRegex.exec(text);\n\n  if (match === null) {\n    match = AtSignMentionsRegexAliasRegex.exec(text);\n  }\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[3];\n    if (matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: match[2],\n      };\n    }\n  }\n  return null;\n}\n\nfunction getPossibleQueryMatch(text: string): QueryMatch | null {\n  const match = checkForAtSignMentions(text, 1);\n  return match === null ? checkForCapitalizedNameMentions(text, 3) : match;\n}\n\nclass MentionTypeaheadOption extends TypeaheadOption {\n  name: string;\n  picture: JSX.Element;\n  url: string;\n\n  constructor(name: string, picture: JSX.Element, url?: string) {\n    super(name);\n    this.name = name;\n    this.picture = picture;\n    this.url = url;\n  }\n}\n\nfunction MentionsTypeaheadMenuItem({\n  index,\n  isSelected,\n  onClick,\n  onMouseEnter,\n  option,\n}: {\n  index: number;\n  isSelected: boolean;\n  onClick: () => void;\n  onMouseEnter: () => void;\n  option: MentionTypeaheadOption;\n}) {\n  let className = 'item';\n  if (isSelected) {\n    className += ' selected';\n  }\n  return (\n    <li\n      key={option.key}\n      tabIndex={-1}\n      className={className}\n      ref={option.setRefElement}\n      role=\"option\"\n      aria-selected={isSelected}\n      id={'typeahead-item-' + index}\n      onMouseEnter={onMouseEnter}\n      onClick={onClick}\n    >\n      {option.picture}\n      <span className=\"verbum-text\">{option.name}</span>\n    </li>\n  );\n}\n\nexport default function MentionsPlugin<A>(props: {\n  searchData: SearchData<A>;\n  getTypeaheadValues: (result: A) => {\n    url: string;\n    value: string;\n    picture: JSX.Element;\n  };\n}): JSX.Element | null {\n  const { searchData, getTypeaheadValues } = props;\n\n  const [editor] = useLexicalComposerContext();\n\n  const [queryString, setQueryString] = useState<string | null>(null);\n\n  const results = useMentionLookupService(queryString, searchData);\n\n  const checkForSlashTriggerMatch = useBasicTypeaheadTriggerMatch('/', {\n    minLength: 0,\n  });\n\n  const options = useMemo(\n    () =>\n      results\n        .map(\n          (result) =>\n            new MentionTypeaheadOption(\n              getTypeaheadValues(result).value,\n              getTypeaheadValues(result).picture,\n              getTypeaheadValues(result).url\n            )\n        )\n        .slice(0, SUGGESTION_LIST_LENGTH_LIMIT),\n    [results]\n  );\n\n  const onSelectOption = useCallback(\n    (\n      selectedOption: MentionTypeaheadOption,\n      nodeToReplace: TextNode | null,\n      closeMenu: () => void\n    ) => {\n      editor.update(() => {\n        if (nodeToReplace) {\n          const mentionNode = $createMentionNode(`@${selectedOption.name}`);\n          const linkNode = $createAutoLinkNode(selectedOption.url);\n          linkNode.append(mentionNode);\n          nodeToReplace.replace(linkNode);\n          linkNode.select();\n        }\n        closeMenu();\n      });\n    },\n    [editor]\n  );\n\n  const checkForMentionMatch = useCallback(\n    (text: string) => {\n      const mentionMatch = getPossibleQueryMatch(text);\n      const slashMatch = checkForSlashTriggerMatch(text, editor);\n      return !slashMatch && mentionMatch ? mentionMatch : null;\n    },\n    [checkForSlashTriggerMatch, editor]\n  );\n\n  return (\n    <LexicalTypeaheadMenuPlugin<MentionTypeaheadOption>\n      onQueryChange={setQueryString}\n      onSelectOption={onSelectOption}\n      triggerFn={checkForMentionMatch}\n      options={options}\n      menuRenderFn={(\n        anchorElementRef,\n        { selectedIndex, selectOptionAndCleanUp, setHighlightedIndex }\n      ) =>\n        anchorElementRef && results.length\n          ? ReactDOM.createPortal(\n              <div className=\"verbum-typeahead-popover verbum-mentions-menu\">\n                <ul>\n                  {options.map((option, i: number) => (\n                    <MentionsTypeaheadMenuItem\n                      index={i}\n                      isSelected={selectedIndex === i}\n                      onClick={() => {\n                        setHighlightedIndex(i);\n                        selectOptionAndCleanUp(option);\n                      }}\n                      onMouseEnter={() => {\n                        setHighlightedIndex(i);\n                      }}\n                      key={option.key}\n                      option={option}\n                    />\n                  ))}\n                </ul>\n              </div>,\n              anchorElementRef.current\n            )\n          : null\n      }\n    />\n  );\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './ColorPicker.css';\n\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\n\nimport DropDown from './DropDown';\n\ninterface ColorPickerProps {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  color?: string;\n  children?: JSX.Element;\n  onChange?: (color: string) => void;\n  title?: string;\n}\n\nconst basicColors = [\n  '#d0021b',\n  '#f5a623',\n  '#f8e71c',\n  '#8b572a',\n  '#7ed321',\n  '#417505',\n  '#bd10e0',\n  '#9013fe',\n  '#4a90e2',\n  '#50e3c2',\n  '#b8e986',\n  '#000000',\n  '#4a4a4a',\n  '#9b9b9b',\n  '#ffffff',\n];\n\nconst WIDTH = 214;\nconst HEIGHT = 150;\n\nexport default function ColorPicker({\n  color,\n  children,\n  onChange,\n  ...rest\n}: Readonly<ColorPickerProps>): JSX.Element {\n  const [selfColor, setSelfColor] = useState(transformColor('hex', color));\n\n  const saturationPosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.s / 100) * WIDTH,\n      y: ((100 - selfColor.hsv.v) / 100) * HEIGHT,\n    }),\n    [selfColor.hsv.s, selfColor.hsv.v]\n  );\n\n  const huePosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.h / 360) * WIDTH,\n    }),\n    [selfColor.hsv]\n  );\n\n  const onMoveSaturation = ({ x, y }: Position) => {\n    const newHsv = {\n      ...selfColor.hsv,\n      s: (x / WIDTH) * 100,\n      v: 100 - (y / HEIGHT) * 100,\n    };\n    const newColor = transformColor('hsv', newHsv);\n    setSelfColor(newColor);\n  };\n\n  const onMoveHue = ({ x }: Position) => {\n    const newHsv = { ...selfColor.hsv, h: (x / WIDTH) * 360 };\n    const newColor = transformColor('hsv', newHsv);\n\n    setSelfColor(newColor);\n  };\n\n  useEffect(() => {\n    onChange(selfColor.hex);\n  }, [selfColor, onChange]);\n\n  useEffect(() => {\n    if (color === undefined) return;\n    setSelfColor(transformColor('hex', color));\n  }, [color]);\n\n  return (\n    <DropDown {...rest} stopCloseOnClickSelf={true}>\n      <div className=\"verbum-color-picker-wrapper\" style={{ width: WIDTH }}>\n        <div className=\"verbum-color-picker-basic-color\">\n          {basicColors.map((basicColor) => (\n            <button\n              className={basicColor === selfColor.hex ? ' active' : ''}\n              key={basicColor}\n              style={{ backgroundColor: basicColor }}\n              onClick={() => setSelfColor(transformColor('hex', basicColor))}\n              type=\"button\"\n            />\n          ))}\n        </div>\n        <MoveWrapper\n          className=\"verbum-color-picker-saturation\"\n          style={{ backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)` }}\n          onChange={onMoveSaturation}\n        >\n          <div\n            className=\"verbum-color-picker-saturation_cursor\"\n            style={{\n              backgroundColor: selfColor.hex,\n              left: saturationPosition.x,\n              top: saturationPosition.y,\n            }}\n          />\n        </MoveWrapper>\n        <MoveWrapper className=\"verbum-color-picker-hue\" onChange={onMoveHue}>\n          <div\n            className=\"verbum-color-picker-hue_cursor\"\n            style={{\n              backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)`,\n              left: huePosition.x,\n            }}\n          />\n        </MoveWrapper>\n        <div className=\"verbum-color-picker-info\">\n          <span>{selfColor.hex}</span>\n          <div\n            className=\"verbum-color-picker-color\"\n            style={{ backgroundColor: selfColor.hex }}\n          />\n        </div>\n      </div>\n      {children}\n    </DropDown>\n  );\n}\n\nexport interface Position {\n  x: number;\n  y: number;\n}\n\ninterface MoveWrapperProps {\n  className?: string;\n  style?: React.CSSProperties;\n  onChange: (position: Position) => void;\n  children: JSX.Element;\n}\n\nfunction MoveWrapper({\n  className,\n  style,\n  onChange,\n  children,\n}: MoveWrapperProps) {\n  const divRef = useRef<HTMLDivElement>(null);\n\n  const move = (e: React.MouseEvent | MouseEvent): void => {\n    if (divRef.current) {\n      const { current: div } = divRef;\n      const { width, height, left, top } = div.getBoundingClientRect();\n\n      const x = clamp(e.clientX - left, width, 0);\n      const y = clamp(e.clientY - top, height, 0);\n\n      onChange({ x, y });\n    }\n  };\n\n  const onMouseDown = (e: React.MouseEvent): void => {\n    if (e.button !== 0) return;\n\n    move(e);\n\n    const onMouseMove = (_e: MouseEvent): void => {\n      move(_e);\n    };\n\n    const onMouseUp = (_e: MouseEvent): void => {\n      document.removeEventListener('mousemove', onMouseMove, false);\n      document.removeEventListener('mouseup', onMouseUp, false);\n\n      move(_e);\n    };\n\n    document.addEventListener('mousemove', onMouseMove, false);\n    document.addEventListener('mouseup', onMouseUp, false);\n  };\n\n  return (\n    <div\n      ref={divRef}\n      className={className}\n      style={style}\n      onMouseDown={onMouseDown}\n    >\n      {children}\n    </div>\n  );\n}\n\nfunction clamp(value: number, max: number, min: number) {\n  return value > max ? max : value < min ? min : value;\n}\n\ninterface RGB {\n  b: number;\n  g: number;\n  r: number;\n}\ninterface HSV {\n  h: number;\n  s: number;\n  v: number;\n}\ninterface Color {\n  hex: string;\n  hsv: HSV;\n  rgb: RGB;\n}\n\nexport function toHex(value: string): string {\n  if (!value.startsWith('#')) {\n    const ctx = document.createElement('canvas').getContext('2d');\n\n    if (!ctx) {\n      throw new Error('2d context not supported or canvas already initialized');\n    }\n\n    ctx.fillStyle = value;\n\n    return ctx.fillStyle;\n  } else if (value.length === 4 || value.length === 5) {\n    value = value\n      .split('')\n      .map((v, i) => (i ? v + v : '#'))\n      .join('');\n\n    return value;\n  } else if (value.length === 7 || value.length === 9) {\n    return value;\n  }\n\n  return '#000000';\n}\n\nfunction hex2rgb(hex: string): RGB {\n  const rbgArr = hex\n    .replace(\n      /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i,\n      (m, r, g, b) => '#' + r + r + g + g + b + b\n    )\n    .substring(1)\n    .match(/.{2}/g)\n    .map((x) => parseInt(x, 16));\n\n  return {\n    b: rbgArr[2],\n    g: rbgArr[1],\n    r: rbgArr[0],\n  };\n}\n\nfunction rgb2hsv({ r, g, b }: RGB): HSV {\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  const max = Math.max(r, g, b);\n  const d = max - Math.min(r, g, b);\n\n  const h = d\n    ? (max === r\n        ? (g - b) / d + (g < b ? 6 : 0)\n        : max === g\n        ? 2 + (b - r) / d\n        : 4 + (r - g) / d) * 60\n    : 0;\n  const s = max ? (d / max) * 100 : 0;\n  const v = max * 100;\n\n  return { h, s, v };\n}\n\nfunction hsv2rgb({ h, s, v }: HSV): RGB {\n  s /= 100;\n  v /= 100;\n\n  const i = ~~(h / 60);\n  const f = h / 60 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - s * f);\n  const t = v * (1 - s * (1 - f));\n  const index = i % 6;\n\n  const r = Math.round([v, q, p, p, t, v][index] * 255);\n  const g = Math.round([t, v, v, q, p, p][index] * 255);\n  const b = Math.round([p, p, t, v, v, q][index] * 255);\n\n  return { b, g, r };\n}\n\nfunction rgb2hex({ b, g, r }: RGB): string {\n  return '#' + [r, g, b].map((x) => x.toString(16).padStart(2, '0')).join('');\n}\n\nfunction transformColor<M extends keyof Color, C extends Color[M]>(\n  format: M,\n  color: C\n): Color {\n  let hex: Color['hex'] = toHex('#121212');\n  let rgb: Color['rgb'] = hex2rgb(hex);\n  let hsv: Color['hsv'] = rgb2hsv(rgb);\n\n  if (format === 'hex') {\n    const value = color as Color['hex'];\n\n    hex = toHex(value);\n    rgb = hex2rgb(hex);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'rgb') {\n    const value = color as Color['rgb'];\n\n    rgb = value;\n    hex = rgb2hex(rgb);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'hsv') {\n    const value = color as Color['hsv'];\n\n    hsv = value;\n    rgb = hsv2rgb(hsv);\n    hex = rgb2hex(rgb);\n  }\n\n  return { hex, hsv, rgb };\n}\n","import React, { useCallback, useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport ColorPicker from '../../../ui/ColorPicker';\nimport { useTranslation } from 'react-i18next';\n\nconst BackgroundColorPicker = () => {\n  const { bgColor, applyStyleText } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  const onBgColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({ 'background-color': value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <ColorPicker\n      buttonClassName=\"verbum-toolbar-item verbum-color-picker\"\n      buttonAriaLabel={t('toolbar:backgroundColorPicker.Description')}\n      buttonIconClassName=\"verbum-icon verbum-bg-color\"\n      color={bgColor}\n      onChange={onBgColorSelect}\n      title=\"bg color\"\n    />\n  );\n};\n\nexport default BackgroundColorPicker;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst BoldButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isBold } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n      }}\n      className={'verbum-toolbar-item spaced ' + (isBold ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:boldButton.Title')} (⌘B)`\n          : `${t('toolbar:boldButton.Title')} (Ctrl + B)`\n      }\n      aria-label={`${t('toolbar:boldButton.Description')} ${\n        IS_APPLE ? '⌘B' : 'Ctrl+B'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-bold\" />\n    </button>\n  );\n};\n\nexport default BoldButton;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst CodeFormatButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isCode } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n      }}\n      className={'verbum-toolbar-item spaced ' + (isCode ? 'active' : '')}\n      title={t('toolbar:codeFormatButton.Description')}\n      aria-label={t('toolbar:codeFormatButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-code\" />\n    </button>\n  );\n};\n\nexport default CodeFormatButton;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './LinkPreview.css';\n\nimport * as React from 'react';\nimport { Suspense } from 'react';\n\n// Cached responses or running request promises\nconst PREVIEW_CACHE = {};\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nfunction useSuspenseRequest(url: string) {\n  let cached = PREVIEW_CACHE[url];\n\n  if (!url.match(URL_MATCHER)) {\n    return { preview: null };\n  }\n\n  if (!cached) {\n    cached = PREVIEW_CACHE[url] = fetch(\n      `/api/link-preview?url=${encodeURI(url)}`\n    )\n      .then((response) => response.json())\n      .then((preview) => {\n        PREVIEW_CACHE[url] = preview;\n        return preview;\n      })\n      .catch(() => {\n        PREVIEW_CACHE[url] = { preview: null };\n      });\n  }\n\n  if (cached instanceof Promise) {\n    throw cached;\n  }\n\n  return cached;\n}\n\nfunction LinkPreviewContent({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  const { preview } = useSuspenseRequest(url);\n  if (preview === null) {\n    return null;\n  }\n  return (\n    <div className=\"LinkPreview__container\">\n      {preview.img && (\n        <div className=\"LinkPreview__imageWrapper\">\n          <img\n            src={preview.img}\n            alt={preview.title}\n            className=\"LinkPreview__image\"\n          />\n        </div>\n      )}\n      {preview.domain && (\n        <div className=\"LinkPreview__domain\">{preview.domain}</div>\n      )}\n      {preview.title && (\n        <div className=\"LinkPreview__title\">{preview.title}</div>\n      )}\n      {preview.description && (\n        <div className=\"LinkPreview__description\">{preview.description}</div>\n      )}\n    </div>\n  );\n}\n\nfunction Glimmer(props): JSX.Element {\n  return (\n    <div\n      className=\"LinkPreview__glimmer\"\n      {...props}\n      style={{\n        animationDelay: (props.index || 0) * 300,\n        ...(props.style || {}),\n      }}\n    />\n  );\n}\n\nexport default function LinkPreview({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  return (\n    <Suspense\n      fallback={\n        <>\n          <Glimmer style={{ height: '80px' }} index={0} />\n          <Glimmer style={{ width: '60%' }} index={1} />\n          <Glimmer style={{ width: '80%' }} index={2} />\n        </>\n      }\n    >\n      <LinkPreviewContent url={url} />\n    </Suspense>\n  );\n}\n","import { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { $isAtNodeEnd } from '@lexical/selection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport React from 'react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport LinkPreview from '../../../ui/LinkPreview';\nimport { getSelectedNode } from '../../../utils/node.util';\n\nfunction positionEditorElement(editor, rect) {\n  if (rect === null) {\n    editor.style.opacity = '0';\n    editor.style.top = '-1000px';\n    editor.style.left = '-1000px';\n  } else {\n    editor.style.opacity = '1';\n    editor.style.top = `${rect.top + rect.height + window.pageYOffset + 10}px`;\n    editor.style.left = `${\n      rect.left + window.pageXOffset - editor.offsetWidth / 2 + rect.width / 2\n    }px`;\n  }\n}\n\nfunction FloatingLinkEditor({\n  editor,\n}: {\n  editor: LexicalEditor;\n}): JSX.Element {\n  const editorRef = useRef<HTMLDivElement | null>(null);\n  const inputRef = useRef(null);\n  const [linkUrl, setLinkUrl] = useState('');\n  const [isEditMode, setEditMode] = useState(false);\n  const [lastSelection, setLastSelection] = useState(null);\n\n  const updateLinkEditor = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const node = getSelectedNode(selection);\n      const parent = node.getParent();\n      if ($isLinkNode(parent)) {\n        setLinkUrl(parent.getURL());\n      } else if ($isLinkNode(node)) {\n        setLinkUrl(node.getURL());\n      } else {\n        setLinkUrl('');\n      }\n    }\n    const editorElem = editorRef.current;\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (editorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      let rect;\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      positionEditorElement(editorElem, rect);\n      setLastSelection(selection);\n    } else if (!activeElement || activeElement.className !== 'link-input') {\n      positionEditorElement(editorElem, null);\n      setLastSelection(null);\n      setEditMode(false);\n      setLinkUrl('');\n    }\n\n    return true;\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateLinkEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateLinkEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateLinkEditor();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateLinkEditor();\n    });\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    if (isEditMode && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isEditMode]);\n\n  return (\n    <div ref={editorRef} className=\"verbum-link-editor\">\n      {isEditMode ? (\n        <input\n          ref={inputRef}\n          className=\"link-input\"\n          value={linkUrl}\n          onChange={(event) => {\n            setLinkUrl(event.target.value);\n          }}\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              event.preventDefault();\n              if (lastSelection !== null) {\n                if (linkUrl !== '') {\n                  editor.dispatchCommand(TOGGLE_LINK_COMMAND, linkUrl);\n                }\n                setEditMode(false);\n              }\n            } else if (event.key === 'Escape') {\n              event.preventDefault();\n              setEditMode(false);\n            }\n          }}\n        />\n      ) : (\n        <>\n          <div className=\"link-input\">\n            <a href={linkUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n              {linkUrl}\n            </a>\n            <div\n              className=\"link-edit\"\n              role=\"button\"\n              tabIndex={0}\n              onMouseDown={(event) => event.preventDefault()}\n              onClick={() => {\n                setEditMode(true);\n              }}\n            />\n          </div>\n          <LinkPreview url={linkUrl} />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default FloatingLinkEditor;\n","import React, { useCallback, useContext } from 'react';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { FontOptions } from '../../../types';\n\nconst defaultFontFamilyOptions: FontOptions = [\n  ['Arial', 'Arial'],\n  ['Courier New', 'Courier New'],\n  ['Georgia', 'Georgia'],\n  ['Times New Roman', 'Times New Roman'],\n  ['Trebuchet MS', 'Trebuchet MS'],\n  ['Verdana', 'Verdana'],\n];\n\ninterface IFontFamilyDropdown {\n  fontOptions?: FontOptions;\n}\n\nconst FontFamilyDropdown = ({\n  fontOptions = defaultFontFamilyOptions,\n}: IFontFamilyDropdown) => {\n  const { fontFamily, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontFamilySelect = useCallback(\n    (e) => {\n      applyStyleText({ 'font-family': e.target.value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"verbum-toolbar-item verbum-font-family\"\n        onChange={onFontFamilySelect}\n        options={fontOptions}\n        value={fontFamily}\n      />\n      <i className=\"verbum-chevron-down inside\" />\n    </>\n  );\n};\n\nexport default FontFamilyDropdown;\n","import React, { useCallback, useContext } from 'react';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { FontOptions } from '../../../types';\n\nconst defaultFontSizeOptions: FontOptions = [\n  ['10px', '10px'],\n  ['11px', '11px'],\n  ['12px', '12px'],\n  ['13px', '13px'],\n  ['14px', '14px'],\n  ['15px', '15px'],\n  ['16px', '16px'],\n  ['17px', '17px'],\n  ['18px', '18px'],\n  ['19px', '19px'],\n  ['20px', '20px'],\n];\n\ninterface IFontSizeDropdown {\n  fontSizeOptions?: FontOptions;\n}\n\nconst FontSizeDropdown = ({\n  fontSizeOptions = defaultFontSizeOptions,\n}: IFontSizeDropdown) => {\n  const { fontSize, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontSizeSelect = useCallback(\n    (e) => {\n      applyStyleText({ 'font-size': e.target.value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"verbum-toolbar-item verbum-font-size\"\n        onChange={onFontSizeSelect}\n        options={fontSizeOptions}\n        value={fontSize}\n      />\n      <i className=\"verbum-chevron-down inside\" />\n    </>\n  );\n};\n\nexport default FontSizeDropdown;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isRootNode,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createPollNode, PollNode } from '../nodes/PollNode';\n\nexport const INSERT_POLL_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function PollPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    if (!editor.hasNodes([PollNode])) {\n      throw new Error('PollPlugin: PollNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_POLL_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const question = payload;\n          const pollNode = $createPollNode(question);\n\n          if ($isRootNode(selection.anchor.getNode())) {\n            selection.insertParagraph();\n          }\n\n          selection.insertNodes([pollNode]);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createYouTubeNode, YouTubeNode } from '../nodes/YouTubeNode';\n\nexport const INSERT_YOUTUBE_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function YouTubePlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([YouTubeNode])) {\n      throw new Error('YouTubePlugin: YouTubeNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_YOUTUBE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const focusNode = selection.focus.getNode();\n\n          if (focusNode !== null) {\n            const youTubeNode = $createYouTubeNode(payload);\n            selection.focus\n              .getNode()\n              .getTopLevelElementOrThrow()\n              .insertAfter(youTubeNode);\n            const paragraphNode = $createParagraphNode();\n            youTubeNode.insertAfter(paragraphNode);\n            paragraphNode.select();\n          }\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport type { Cell } from '@lexical/table';\nimport type { LexicalEditor } from 'lexical';\n\nimport './TableCellResizer.css';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $isTableCellNode,\n  $isTableRowNode,\n  getCellFromTarget,\n} from '@lexical/table';\nimport {\n  $getNearestNodeFromDOMNode,\n  $getSelection,\n  DEPRECATED_$isGridSelection,\n  COMMAND_PRIORITY_HIGH,\n  SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {\n  ReactPortal,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { createPortal } from 'react-dom';\n\ntype MousePosition = {\n  x: number;\n  y: number;\n};\n\ntype MouseDraggingDirection = 'right' | 'bottom';\n\nconst MIN_ROW_HEIGHT = 33;\nconst MIN_COLUMN_WIDTH = 50;\n\nfunction TableCellResizer({ editor }: { editor: LexicalEditor }): JSX.Element {\n  const targetRef = useRef<HTMLElement | null>(null);\n  const resizerRef = useRef<HTMLDivElement | null>(null);\n  const tableRectRef = useRef<ClientRect | null>(null);\n\n  const mouseStartPosRef = useRef<MousePosition | null>(null);\n  const [mouseCurrentPos, updateMouseCurrentPos] =\n    useState<MousePosition | null>(null);\n\n  const [activeCell, updateActiveCell] = useState<Cell | null>(null);\n  const [isSelectingGrid, updateIsSelectingGrid] = useState<boolean>(false);\n  const [draggingDirection, updateDraggingDirection] =\n    useState<MouseDraggingDirection | null>(null);\n\n  useEffect(() => {\n    return editor.registerCommand(\n      SELECTION_CHANGE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n        const isGridSelection = DEPRECATED_$isGridSelection(selection);\n\n        if (isSelectingGrid !== isGridSelection) {\n          updateIsSelectingGrid(isGridSelection);\n        }\n\n        return false;\n      },\n      COMMAND_PRIORITY_HIGH\n    );\n  });\n\n  const resetState = useCallback(() => {\n    updateActiveCell(null);\n    targetRef.current = null;\n    updateDraggingDirection(null);\n    mouseStartPosRef.current = null;\n    tableRectRef.current = null;\n  }, []);\n\n  useEffect(() => {\n    const onMouseMove = (event: MouseEvent) => {\n      setTimeout(() => {\n        const target = event.target;\n\n        if (draggingDirection) {\n          updateMouseCurrentPos({\n            x: event.clientX,\n            y: event.clientY,\n          });\n          return;\n        }\n\n        if (resizerRef.current && resizerRef.current.contains(target as Node)) {\n          return;\n        }\n\n        if (targetRef.current !== target) {\n          targetRef.current = target as HTMLElement;\n          const cell = getCellFromTarget(target as HTMLElement);\n\n          if (cell && activeCell !== cell) {\n            editor.update(() => {\n              const tableCellNode = $getNearestNodeFromDOMNode(cell.elem);\n              if (!tableCellNode) {\n                throw new Error('TableCellResizer: Table cell node not found.');\n              }\n\n              const tableNode =\n                $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n              const tableElement = editor.getElementByKey(tableNode.getKey());\n\n              if (!tableElement) {\n                throw new Error('TableCellResizer: Table element not found.');\n              }\n\n              targetRef.current = target as HTMLElement;\n              tableRectRef.current = tableElement.getBoundingClientRect();\n              updateActiveCell(cell);\n            });\n          } else if (cell == null) {\n            resetState();\n          }\n        }\n      }, 0);\n    };\n\n    document.addEventListener('mousemove', onMouseMove);\n\n    return () => {\n      document.removeEventListener('mousemove', onMouseMove);\n    };\n  }, [activeCell, draggingDirection, editor, resetState]);\n\n  const isHeightChanging = (direction: MouseDraggingDirection) => {\n    if (direction === 'bottom') return true;\n    return false;\n  };\n\n  const updateRowHeight = useCallback(\n    (newHeight: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableRow = tableRows[tableRowIndex];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        tableRow.setHeight(newHeight);\n      });\n    },\n    [activeCell, editor]\n  );\n\n  const updateColumnWidth = useCallback(\n    (newWidth: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableColumnIndex =\n          $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        for (let r = 0; r < tableRows.length; r++) {\n          const tableRow = tableRows[r];\n\n          if (!$isTableRowNode(tableRow)) {\n            throw new Error('Expected table row');\n          }\n\n          const tableCells = tableRow.getChildren();\n\n          if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n            throw new Error('Expected table cell to be inside of table row.');\n          }\n\n          const tableCell = tableCells[tableColumnIndex];\n\n          if (!$isTableCellNode(tableCell)) {\n            throw new Error('Expected table cell');\n          }\n\n          tableCell.setWidth(newWidth);\n        }\n      });\n    },\n    [activeCell, editor]\n  );\n\n  const toggleResize = useCallback(\n    (direction) => (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      if (draggingDirection === direction && mouseStartPosRef.current) {\n        const { x, y } = mouseStartPosRef.current;\n\n        if (!activeCell) {\n          return;\n        }\n\n        const { height, width } = activeCell.elem.getBoundingClientRect();\n\n        if (isHeightChanging(direction)) {\n          const heightChange = Math.abs(event.clientY - y);\n\n          const isShrinking = direction === 'bottom' && y > event.clientY;\n\n          updateRowHeight(\n            Math.max(\n              isShrinking ? height - heightChange : heightChange + height,\n              MIN_ROW_HEIGHT\n            )\n          );\n        } else {\n          const widthChange = Math.abs(event.clientX - x);\n\n          const isShrinking = direction === 'right' && x > event.clientX;\n\n          updateColumnWidth(\n            Math.max(\n              isShrinking ? width - widthChange : widthChange + width,\n              MIN_COLUMN_WIDTH\n            )\n          );\n        }\n\n        resetState();\n      } else {\n        mouseStartPosRef.current = {\n          x: event.clientX,\n          y: event.clientY,\n        };\n        updateMouseCurrentPos(mouseStartPosRef.current);\n        updateDraggingDirection(direction);\n      }\n    },\n    [\n      activeCell,\n      draggingDirection,\n      resetState,\n      updateColumnWidth,\n      updateRowHeight,\n    ]\n  );\n\n  const getResizers = useCallback(() => {\n    if (activeCell) {\n      const { height, width, top, left } =\n        activeCell.elem.getBoundingClientRect();\n\n      const styles = {\n        bottom: {\n          backgroundColor: 'none',\n          cursor: 'row-resize',\n          height: '10px',\n          left: `${window.pageXOffset + left}px`,\n          top: `${window.pageYOffset + top + height}px`,\n          width: `${width}px`,\n        },\n        right: {\n          backgroundColor: 'none',\n          cursor: 'col-resize',\n          height: `${height}px`,\n          left: `${window.pageXOffset + left + width}px`,\n          top: `${window.pageYOffset + top}px`,\n          width: '10px',\n        },\n      };\n\n      const tableRect = tableRectRef.current;\n\n      if (draggingDirection && mouseCurrentPos && tableRect) {\n        if (isHeightChanging(draggingDirection)) {\n          styles[draggingDirection].left = `${\n            window.pageXOffset + tableRect.left\n          }px`;\n          styles[draggingDirection].top = `${\n            window.pageYOffset + mouseCurrentPos.y\n          }px`;\n          styles[draggingDirection].height = '3px';\n          styles[draggingDirection].width = `${tableRect.width}px`;\n        } else {\n          styles[draggingDirection].top = `${\n            window.pageYOffset + tableRect.top\n          }px`;\n          styles[draggingDirection].left = `${\n            window.pageXOffset + mouseCurrentPos.x\n          }px`;\n          styles[draggingDirection].width = '3px';\n          styles[draggingDirection].height = `${tableRect.height}px`;\n        }\n\n        styles[draggingDirection].backgroundColor = '#adf';\n      }\n\n      return styles;\n    }\n\n    return {\n      bottom: null,\n      left: null,\n      right: null,\n      top: null,\n    };\n  }, [activeCell, draggingDirection, mouseCurrentPos]);\n\n  const resizerStyles = getResizers();\n\n  return (\n    <div ref={resizerRef}>\n      {activeCell != null && !isSelectingGrid && (\n        <>\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.right}\n            onMouseDown={toggleResize('right')}\n            onMouseUp={toggleResize('right')}\n          />\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.bottom}\n            onMouseDown={toggleResize('bottom')}\n            onMouseUp={toggleResize('bottom')}\n          />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableCellResizerPlugin(): ReactPortal {\n  const [editor] = useLexicalComposerContext();\n\n  return useMemo(\n    () => createPortal(<TableCellResizer editor={editor} />, document.body),\n    [editor]\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $deleteTableColumn,\n  $getElementGridForTableNode,\n  $getTableCellNodeFromLexicalNode,\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $insertTableColumn,\n  $insertTableRow,\n  $isTableCellNode,\n  $isTableRowNode,\n  $removeTableRowAtIndex,\n  getTableSelectionFromTableElement,\n  HTMLTableElementWithWithTableSelectionState,\n  TableCellHeaderStates,\n  TableCellNode,\n} from '@lexical/table';\nimport { TFunction } from 'i18next';\nimport {\n  $getSelection,\n  DEPRECATED_$isGridSelection,\n  $isRangeSelection,\n  $setSelection,\n} from 'lexical';\nimport * as React from 'react';\nimport { ReactPortal, useCallback, useEffect, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useTranslation } from 'react-i18next';\n\ntype TableCellActionMenuProps = Readonly<{\n  contextRef: { current: null | HTMLElement };\n  onClose: () => void;\n  setIsMenuOpen: (isOpen: boolean) => void;\n  tableCellNode: TableCellNode;\n  t: TFunction;\n}>;\n\nfunction TableActionMenu({\n  onClose,\n  tableCellNode: _tableCellNode,\n  setIsMenuOpen,\n  contextRef,\n  t,\n}: TableCellActionMenuProps) {\n  const [editor] = useLexicalComposerContext();\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const [tableCellNode, updateTableCellNode] = useState(_tableCellNode);\n  const [selectionCounts, updateSelectionCounts] = useState({\n    columns: 1,\n    rows: 1,\n  });\n\n  useEffect(() => {\n    return editor.registerMutationListener(TableCellNode, (nodeMutations) => {\n      const nodeUpdated =\n        nodeMutations.get(tableCellNode.getKey()) === 'updated';\n\n      if (nodeUpdated) {\n        editor.getEditorState().read(() => {\n          updateTableCellNode(tableCellNode.getLatest());\n        });\n      }\n    });\n  }, [editor, tableCellNode]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n      if (DEPRECATED_$isGridSelection(selection)) {\n        const selectionShape = selection.getShape();\n\n        updateSelectionCounts({\n          columns: selectionShape.toX - selectionShape.fromX + 1,\n          rows: selectionShape.toY - selectionShape.fromY + 1,\n        });\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    const menuButtonElement = contextRef.current;\n    const dropDownElement = dropDownRef.current;\n\n    if (menuButtonElement != null && dropDownElement != null) {\n      const menuButtonRect = menuButtonElement.getBoundingClientRect();\n\n      dropDownElement.style.opacity = '1';\n\n      dropDownElement.style.left = `${\n        menuButtonRect.left + menuButtonRect.width + window.pageXOffset + 5\n      }px`;\n\n      dropDownElement.style.top = `${\n        menuButtonRect.top + window.pageYOffset\n      }px`;\n    }\n  }, [contextRef, dropDownRef]);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (\n        dropDownRef.current != null &&\n        contextRef.current != null &&\n        !dropDownRef.current.contains(event.target as Node) &&\n        !contextRef.current.contains(event.target as Node)\n      ) {\n        setIsMenuOpen(false);\n      }\n    }\n\n    window.addEventListener('click', handleClickOutside);\n\n    return () => window.removeEventListener('click', handleClickOutside);\n  }, [setIsMenuOpen, contextRef]);\n\n  const clearTableSelection = useCallback(() => {\n    editor.update(() => {\n      if (tableCellNode.isAttached()) {\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n        const tableElement = editor.getElementByKey(\n          tableNode.getKey()\n        ) as HTMLTableElementWithWithTableSelectionState;\n\n        if (!tableElement) {\n          throw new Error('Expected to find tableElement in DOM');\n        }\n\n        const tableSelection = getTableSelectionFromTableElement(tableElement);\n        if (tableSelection !== null) {\n          tableSelection.clearHighlight();\n        }\n\n        tableNode.markDirty();\n        updateTableCellNode(tableCellNode.getLatest());\n      }\n\n      $setSelection(null);\n    });\n  }, [editor, tableCellNode]);\n\n  const insertTableRowAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableRowIndex;\n\n        if (DEPRECATED_$isGridSelection(selection)) {\n          const selectionShape = selection.getShape();\n          tableRowIndex = shouldInsertAfter\n            ? selectionShape.toY\n            : selectionShape.fromY;\n        } else {\n          tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n        }\n\n        const grid = $getElementGridForTableNode(editor, tableNode);\n\n        $insertTableRow(\n          tableNode,\n          tableRowIndex,\n          shouldInsertAfter,\n          selectionCounts.rows,\n          grid\n        );\n\n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [editor, tableCellNode, selectionCounts.rows, clearTableSelection, onClose]\n  );\n\n  const insertTableColumnAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableColumnIndex;\n\n        if (DEPRECATED_$isGridSelection(selection)) {\n          const selectionShape = selection.getShape();\n          tableColumnIndex = shouldInsertAfter\n            ? selectionShape.toX\n            : selectionShape.fromX;\n        } else {\n          tableColumnIndex =\n            $getTableColumnIndexFromTableCellNode(tableCellNode);\n        }\n\n        const grid = $getElementGridForTableNode(editor, tableNode);\n\n        $insertTableColumn(\n          tableNode,\n          tableColumnIndex,\n          shouldInsertAfter,\n          selectionCounts.columns,\n          grid\n        );\n\n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [\n      editor,\n      tableCellNode,\n      selectionCounts.columns,\n      clearTableSelection,\n      onClose,\n    ]\n  );\n\n  const deleteTableRowAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      $removeTableRowAtIndex(tableNode, tableRowIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      tableNode.remove();\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableColumnAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      $deleteTableColumn(tableNode, tableColumnIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableRowIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n        throw new Error('Expected table cell to be inside of table row.');\n      }\n\n      const tableRow = tableRows[tableRowIndex];\n\n      if (!$isTableRowNode(tableRow)) {\n        throw new Error('Expected table row');\n      }\n\n      tableRow.getChildren().forEach((tableCell) => {\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.ROW);\n      });\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableColumnIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      for (let r = 0; r < tableRows.length; r++) {\n        const tableRow = tableRows[r];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        const tableCells = tableRow.getChildren();\n\n        if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableCell = tableCells[tableColumnIndex];\n\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.COLUMN);\n      }\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  return createPortal(\n    // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n    <div\n      className=\"verbum-dropdown\"\n      ref={dropDownRef}\n      onClick={(e) => {\n        e.stopPropagation();\n      }}\n    >\n      <button\n        className=\"verbum-item\"\n        onClick={() => insertTableRowAtSelection(false)}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.rows === 1\n            ? t('toolbar:tableActionMenuPlugin.row')\n            : `${selectionCounts.rows} ${t(\n                'toolbar:tableActionMenuPlugin.rows'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.above')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => insertTableRowAtSelection(true)}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.rows === 1\n            ? t('toolbar:tableActionMenuPlugin.row')\n            : `${selectionCounts.rows} ${t(\n                'toolbar:tableActionMenuPlugin.rows'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.below')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"verbum-item\"\n        onClick={() => insertTableColumnAtSelection(false)}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.columns === 1\n            ? t('toolbar:tableActionMenuPlugin.column')\n            : `${selectionCounts.columns} ${t(\n                'toolbar:tableActionMenuPlugin.columns'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.left')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => insertTableColumnAtSelection(true)}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.columns === 1\n            ? t('toolbar:tableActionMenuPlugin.column')\n            : `${selectionCounts.columns} ${t(\n                'toolbar:tableActionMenuPlugin.columns'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.right')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"verbum-item\"\n        onClick={() => deleteTableColumnAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_column')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => deleteTableRowAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_row')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => deleteTableAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_table')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"verbum-item\"\n        onClick={() => toggleTableRowIsHeader()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.ROW) ===\n          TableCellHeaderStates.ROW\n            ? t('action:Remove')\n            : t('action:Add')}{' '}\n          {t('toolbar:tableActionMenuPlugin.row_header')}\n        </span>\n      </button>\n      <button\n        className=\"verbum-item\"\n        onClick={() => toggleTableColumnIsHeader()}\n        type=\"button\"\n      >\n        <span className=\"verbum-text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.COLUMN) ===\n          TableCellHeaderStates.COLUMN\n            ? t('action:Remove')\n            : t('action:Add ')}{' '}\n          {t('toolbar:tableActionMenuPlugin.column_header')}\n        </span>\n      </button>\n    </div>,\n    document.body\n  );\n}\n\nfunction TableCellActionMenuContainer(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  const menuButtonRef = useRef(null);\n  const menuRootRef = useRef(null);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n\n  const [tableCellNode, setTableMenuCellNode] = useState<TableCellNode | null>(\n    null\n  );\n  const { t } = useTranslation(['toolbar', 'action']);\n\n  const moveMenu = useCallback(() => {\n    const menu = menuButtonRef.current;\n    const selection = $getSelection();\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (selection == null || menu == null) {\n      setTableMenuCellNode(null);\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n\n    if (\n      $isRangeSelection(selection) &&\n      rootElement !== null &&\n      nativeSelection !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const tableCellNodeFromSelection = $getTableCellNodeFromLexicalNode(\n        selection.anchor.getNode()\n      );\n\n      if (tableCellNodeFromSelection == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      const tableCellParentNodeDOM = editor.getElementByKey(\n        tableCellNodeFromSelection.getKey()\n      );\n\n      if (tableCellParentNodeDOM == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      setTableMenuCellNode(tableCellNodeFromSelection);\n    } else if (!activeElement) {\n      setTableMenuCellNode(null);\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        moveMenu();\n      });\n    });\n  });\n\n  useEffect(() => {\n    const menuButtonDOM = menuButtonRef.current as HTMLButtonElement | null;\n\n    if (menuButtonDOM != null && tableCellNode != null) {\n      const tableCellNodeDOM = editor.getElementByKey(tableCellNode.getKey());\n\n      if (tableCellNodeDOM != null) {\n        const tableCellRect = tableCellNodeDOM.getBoundingClientRect();\n        const menuRect = menuButtonDOM.getBoundingClientRect();\n\n        menuButtonDOM.style.opacity = '1';\n\n        menuButtonDOM.style.left = `${\n          tableCellRect.left +\n          window.pageXOffset -\n          menuRect.width +\n          tableCellRect.width -\n          10\n        }px`;\n\n        menuButtonDOM.style.top = `${\n          tableCellRect.top + window.pageYOffset + 5\n        }px`;\n      } else {\n        menuButtonDOM.style.opacity = '0';\n      }\n    }\n  }, [menuButtonRef, tableCellNode, editor]);\n\n  const prevTableCellDOM = useRef(tableCellNode);\n\n  useEffect(() => {\n    if (prevTableCellDOM.current !== tableCellNode) {\n      setIsMenuOpen(false);\n    }\n\n    prevTableCellDOM.current = tableCellNode;\n  }, [prevTableCellDOM, tableCellNode]);\n\n  return (\n    <div className=\"verbum-table-cell-action-button-container\" ref={menuButtonRef}>\n      {tableCellNode != null && (\n        <>\n          <button\n            className=\"verbum-table-cell-action-button chevron-down\"\n            onClick={(e) => {\n              e.stopPropagation();\n              setIsMenuOpen(!isMenuOpen);\n            }}\n            ref={menuRootRef}\n            type=\"button\"\n          >\n            <i className=\"verbum-chevron-down\" />\n          </button>\n          {isMenuOpen && (\n            <TableActionMenu\n              contextRef={menuRootRef}\n              setIsMenuOpen={setIsMenuOpen}\n              onClose={() => setIsMenuOpen(false)}\n              tableCellNode={tableCellNode}\n              t={t}\n            />\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableActionMenuPlugin(): ReactPortal {\n  return createPortal(<TableCellActionMenuContainer />, document.body);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createHorizontalRuleNode,\n  INSERT_HORIZONTAL_RULE_COMMAND,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nexport default function HorizontalRulePlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INSERT_HORIZONTAL_RULE_COMMAND,\n      (type) => {\n        const selection = $getSelection();\n\n        if (!$isRangeSelection(selection)) {\n          return false;\n        }\n\n        const focusNode = selection.focus.getNode();\n\n        if (focusNode !== null) {\n          const horizontalRuleNode = $createHorizontalRuleNode();\n          selection.insertParagraph();\n          selection.focus\n            .getNode()\n            .getTopLevelElementOrThrow()\n            .insertBefore(horizontalRuleNode);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","import React, { useState, useContext } from 'react';\nimport { $getRoot, LexicalEditor } from 'lexical';\nimport DropDown from '../../../ui/DropDown';\nimport Button from '../../../ui/Button';\nimport TextInput from '../../../ui/TextInput';\nimport FileInput from '../../../ui/FileInput';\nimport ImagesPlugin, {\n  INSERT_IMAGE_COMMAND,\n  InsertImagePayload,\n} from '../../ImagesPlugin';\nimport { INSERT_TABLE_COMMAND } from '@lexical/table';\nimport { INSERT_HORIZONTAL_RULE_COMMAND } from '@lexical/react/LexicalHorizontalRuleNode';\nimport PollPlugin, { INSERT_POLL_COMMAND } from '../../PollPlugin';\nimport YouTubePlugin, { INSERT_YOUTUBE_COMMAND } from '../../YouTubePlugin';\nimport { $createStickyNode } from '../../../nodes/StickyNode';\nimport useModal from '../../../hooks/useModal';\nimport TableCellResizer from '../../TableCellResizer';\nimport { TablePlugin } from '@lexical/react/LexicalTablePlugin';\nimport TableCellActionMenuPlugin from '../../TableActionMenuPlugin';\nimport HorizontalRulePlugin from '../../HorizontalRulePlugin';\nimport EditorContext from '../../../context/EditorContext';\n\n// Taken from https://stackoverflow.com/a/9102270\nconst YOUTUBE_ID_PARSER =\n  /^.*(youtu\\.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/;\n\nconst parseYouTubeVideoID = (url: string) => {\n  const urlMatches = url.match(YOUTUBE_ID_PARSER);\n\n  return urlMatches?.[2].length === 11 ? urlMatches[2] : null;\n};\n\n//#region Inserting different modules\nfunction InsertImageDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [mode, setMode] = useState<null | 'url' | 'file'>(null);\n\n  const onClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n    onClose();\n  };\n\n  return (\n    <>\n      {!mode && (\n        <div className=\"ToolbarPlugin__dialogButtonsList\">\n          <Button\n            data-test-id=\"image-modal-option-url\"\n            onClick={() => setMode('url')}\n          >\n            URL\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-file\"\n            onClick={() => setMode('file')}\n          >\n            File\n          </Button>\n        </div>\n      )}\n      {mode === 'url' && <InsertImageUriDialogBody onClick={onClick} />}\n      {mode === 'file' && <InsertImageUploadedDialogBody onClick={onClick} />}\n    </>\n  );\n}\n\nfunction InsertTableDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [rows, setRows] = useState('5');\n  const [columns, setColumns] = useState('5');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_TABLE_COMMAND, { columns, rows });\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"No of rows\" onChange={setRows} value={rows} />\n      <TextInput label=\"No of columns\" onChange={setColumns} value={columns} />\n      <div\n        className=\"ToolbarPlugin__dialogActions\"\n        data-test-id=\"table-model-confirm-insert\"\n      >\n        <Button onClick={onClick}>Confirm</Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertPollDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [question, setQuestion] = useState('');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_POLL_COMMAND, question);\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"Question\" onChange={setQuestion} value={question} />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button disabled={question.trim() === ''} onClick={onClick}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageUriDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  return (\n    <>\n      <TextInput\n        label=\"Image URL\"\n        placeholder=\"i.e. https://source.unsplash.com/random\"\n        onChange={setSrc}\n        value={src}\n        data-test-id=\"image-modal-url-input\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Random unsplash image\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-confirm-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageUploadedDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  const loadImage = (files: FileList) => {\n    const reader = new FileReader();\n    reader.onload = function () {\n      if (typeof reader.result === 'string') {\n        setSrc(reader.result);\n      }\n      return '';\n    };\n    reader.readAsDataURL(files[0]);\n  };\n\n  return (\n    <>\n      <FileInput\n        label=\"Image Upload\"\n        onChange={loadImage}\n        accept=\"image/*\"\n        data-test-id=\"image-modal-file-upload\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Descriptive alternative text\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-file-upload-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertYouTubeDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [text, setText] = useState('');\n\n  const onClick = () => {\n    const videoID = parseYouTubeVideoID(text);\n    if (videoID) {\n      activeEditor.dispatchCommand(INSERT_YOUTUBE_COMMAND, videoID);\n    }\n    onClose();\n  };\n\n  const isDisabled = text === '' || !parseYouTubeVideoID(text);\n\n  return (\n    <>\n      <TextInput\n        data-test-id=\"youtube-embed-modal-url\"\n        label=\"YouTube URL\"\n        placeholder=\"i.e. https://www.youtube.com/watch?v=jNQXAC9IVRw\"\n        onChange={setText}\n        value={text}\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"youtube-embed-modal-submit-btn\"\n          disabled={isDisabled}\n          onClick={onClick}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\n//#endregion Inserting different modules\n\nexport interface IInsertDropdownProps {\n  enableTable?: boolean;\n  enableYoutube?: boolean;\n  enablePoll?: boolean;\n  enableImage?: { enable: boolean; maxWidth: number };\n  enableEquations?: boolean;\n  enableExcalidraw?: boolean;\n  enableHorizontalRule?: boolean;\n  enableStickyNote?: boolean;\n}\n\nconst InsertDropdown: React.FC<IInsertDropdownProps> = ({\n  enableTable = true,\n  enableImage = { enable: true, maxWidth: 1000 },\n  enableYoutube = false,\n  enablePoll = false,\n  enableHorizontalRule = false,\n  enableStickyNote = false,\n}: IInsertDropdownProps) => {\n  const { initialEditor, activeEditor } = useContext(EditorContext);\n  const [modal, showModal] = useModal();\n\n  return (\n    <div>\n      {enableTable && (\n        <>\n          <TablePlugin />\n          <TableCellActionMenuPlugin />\n          <TableCellResizer />\n        </>\n      )}\n      {enableYoutube && <YouTubePlugin />}\n      {enablePoll && <PollPlugin />}\n      {enableImage.enable && <ImagesPlugin maxWidth={enableImage.maxWidth} />}\n      {enableHorizontalRule && <HorizontalRulePlugin />}\n\n      <DropDown\n        buttonClassName=\"verbum-toolbar-item spaced\"\n        buttonLabel=\"Insert\"\n        buttonAriaLabel=\"Insert specialized editor node\"\n        buttonIconClassName=\"verbum-icon verbum-plus\"\n      >\n        {enableHorizontalRule && (\n          <button\n            onClick={() => {\n              activeEditor.dispatchCommand(\n                INSERT_HORIZONTAL_RULE_COMMAND,\n                undefined\n              );\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-horizontal-rule\" />\n            <span className=\"verbum-text\">Horizontal Rule</span>\n          </button>\n        )}\n        {enableImage.enable && (\n          <button\n            onClick={() => {\n              showModal('Insert Image', (onClose) => (\n                <InsertImageDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-image\" />\n            <span className=\"verbum-text\">Image</span>\n          </button>\n        )}\n        {enableTable && (\n          <div>\n            <button\n              onClick={() => {\n                showModal('Insert Table', (onClose) => (\n                  <InsertTableDialog\n                    activeEditor={activeEditor}\n                    onClose={onClose}\n                  />\n                ));\n              }}\n              className=\"verbum-item\"\n              type=\"button\"\n            >\n              <i className=\"verbum-icon verbum-table\" />\n              <span className=\"verbum-text\">Table</span>\n            </button>\n          </div>\n        )}\n        {enablePoll && (\n          <button\n            onClick={() => {\n              showModal('Insert Poll', (onClose) => (\n                <InsertPollDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-poll\" />\n            <span className=\"verbum-text\">Poll</span>\n          </button>\n        )}\n        {enableYoutube && (\n          <button\n            onClick={() => {\n              showModal('Insert YouTube Video', (onClose) => (\n                <InsertYouTubeDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-youtube\" />\n            <span className=\"verbum-text\">YouTube Video</span>\n          </button>\n        )}\n        {enableStickyNote && (\n          <button\n            onClick={() => {\n              initialEditor.update(() => {\n                const root = $getRoot();\n                const stickyNode = $createStickyNode(0, 0);\n                root.append(stickyNode);\n              });\n            }}\n            className=\"verbum-item\"\n            type=\"button\"\n          >\n            <i className=\"verbum-icon verbum-sticky\" />\n            <span className=\"verbum-text\">Sticky Note</span>\n          </button>\n        )}\n      </DropDown>\n      {modal}\n    </div>\n  );\n};\n\nexport default InsertDropdown;\n","import React from 'react';\nimport { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport FloatingLinkEditor from './FloatingLinkEditor';\nimport { createPortal } from 'react-dom';\nimport { useTranslation } from 'react-i18next';\n\nconst InsertLinkButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isLink, insertLink } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <>\n      <button\n        onClick={insertLink}\n        className={'verbum-toolbar-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:insertLinkButton.Description')}\n        title={t('toolbar:insertLinkButton.Description')}\n        type=\"button\"\n      >\n        <i className=\"verbum-format verbum-link\" />\n      </button>\n      {isLink &&\n        createPortal(\n          <FloatingLinkEditor editor={activeEditor} />,\n          document.body\n        )}\n    </>\n  );\n};\n\nexport default InsertLinkButton;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst ItalicButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isItalic } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n      }}\n      className={'verbum-toolbar-item spaced ' + (isItalic ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:italicButton.Title')} (⌘I)`\n          : `${t('toolbar:italicButton.Title')} (Ctrl+I)`\n      }\n      aria-label={`${t('toolbar:italicButton.Description')} ${\n        IS_APPLE ? '⌘I' : 'Ctrl+I'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-italic\" />\n    </button>\n  );\n};\n\nexport default ItalicButton;\n","import React, { useCallback, useContext } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport ColorPicker from '../../../ui/ColorPicker';\n\nconst TextColorPicker = () => {\n  const { fontColor, applyStyleText } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  const onFontColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({ color: value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <ColorPicker\n      buttonClassName=\"verbum-toolbar-item verbum-color-picker\"\n      buttonAriaLabel={t('toolbar:textColorPicker.Description')}\n      buttonIconClassName=\"verbum-icon verbum-font-color\"\n      color={fontColor}\n      onChange={onFontColorSelect}\n      title=\"text color\"\n    />\n  );\n};\n\nexport default TextColorPicker;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React, { useContext } from 'react';\nimport DropDown from '../../../ui/DropDown';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst TextFormatDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isStrikethrough, isSubscript, isSuperscript } =\n    useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <DropDown\n      buttonClassName=\"verbum-toolbar-item spaced\"\n      buttonLabel=\"\"\n      buttonAriaLabel={t('toolbar:textFormatDropdown.Description')}\n      buttonIconClassName=\"verbum-icon verbum-dropdown-more\"\n    >\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={\n          'item ' + (isStrikethrough ? 'active dropdown-item-active' : '')\n        }\n        title={t('toolbar:textFormatDropdown.Options.Strikethrough.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Strikethrough.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-strikethrough\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:textFormatDropdown.Options.Strikethrough.Label')}\n        </span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'item ' + (isSubscript ? 'active dropdown-item-active' : '')}\n        title={t('toolbar:textFormatDropdown.Options.Subscript.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Subscript.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-subscript\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:textFormatDropdown.Options.Subscript.Label')}\n        </span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={\n          'item ' + (isSuperscript ? 'active dropdown-item-active' : '')\n        }\n        title={t('toolbar:textFormatDropdown.Options.Superscript.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Superscript.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"verbum-icon verbum-superscript\" />\n        <span className=\"verbum-text\">\n          {t('toolbar:textFormatDropdown.Options.Superscript.Label')}\n        </span>\n      </button>\n    </DropDown>\n  );\n};\n\nexport default TextFormatDropdown;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst UnderlineButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isUnderline } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n      }}\n      className={'verbum-toolbar-item spaced ' + (isUnderline ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:underlineButton.Title')} (⌘U)`\n          : `${t('toolbar:underlineButton.Title')} (Ctrl+U)`\n      }\n      aria-label={`${t('toolbar:underlineButton.Description')} ${\n        IS_APPLE ? '⌘U' : 'Ctrl+U'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"verbum-format verbum-underline\" />\n    </button>\n  );\n};\n\nexport default UnderlineButton;\n","import type { LexicalEditor, NodeKey } from 'lexical';\n\nimport * as React from 'react';\nimport { Suspense, useRef } from 'react';\n\nconst imageCache = new Set();\n\nfunction useSuspenseImage(src: string) {\n  if (!imageCache.has(src)) {\n    throw new Promise((resolve) => {\n      const img = new Image();\n      img.src = src;\n      img.onload = () => {\n        imageCache.add(src);\n        resolve(null);\n      };\n    });\n  }\n}\n\nfunction LazyImage({\n  altText,\n  className,\n  imageRef,\n  src,\n  width,\n  height,\n  maxWidth,\n}: {\n  altText: string;\n  className: string | null;\n  height: 'inherit' | number;\n  imageRef: { current: null | HTMLImageElement };\n  maxWidth: number;\n  src: string;\n  width: 'inherit' | number;\n}): JSX.Element {\n  useSuspenseImage(src);\n  return (\n    <img\n      className={className || undefined}\n      src={src}\n      alt={altText}\n      ref={imageRef}\n      style={{\n        height,\n        maxWidth,\n        width,\n      }}\n    />\n  );\n}\n\nexport default function ImageComponent({\n  src,\n  altText,\n  width,\n  height,\n  maxWidth,\n}: {\n  altText: string;\n  caption: LexicalEditor;\n  height: 'inherit' | number;\n  maxWidth: number;\n  nodeKey: NodeKey;\n  resizable: boolean;\n  showCaption: boolean;\n  src: string;\n  width: 'inherit' | number;\n  captionsEnabled: boolean;\n}): JSX.Element {\n  const imageRef = useRef<null | HTMLImageElement>(null);\n\n  return (\n    <Suspense fallback={null}>\n      <>\n        <div>\n          <LazyImage\n            className=\"\"\n            src={src}\n            altText={altText}\n            imageRef={imageRef}\n            width={width}\n            height={height}\n            maxWidth={maxWidth}\n          />\n        </div>\n      </>\n    </Suspense>\n  );\n}\n"],"names":["__className","EmojiNode","TextNode","getType","clone","node","__text","__key","constructor","className","text","key","createDOM","config","dom","document","createElement","inner","appendChild","updateDOM","prevNode","firstChild","importJSON","serializedNode","$createEmojiNode","setFormat","format","setDetail","detail","setMode","mode","setStyle","style","exportJSON","getClassName","type","self","getLatest","$isEmojiNode","emojiText","ImageComponent","React","convertImageElement","domNode","HTMLImageElement","alt","altText","src","width","height","$createImageNode","ImageNode","DecoratorNode","maxWidth","showCaption","caption","captionsEnabled","__src","__altText","__maxWidth","__width","__height","__showCaption","__caption","createEditor","__captionsEnabled","undefined","nestedEditor","editorState","parseEditorState","isEmpty","setEditorState","exportDOM","element","setAttribute","toString","importDOM","img","conversion","priority","getAltText","toJSON","getSrc","version","setWidthAndHeight","writable","getWritable","setShowCaption","span","theme","image","decorate","Suspense","fallback","nodeKey","getKey","resizable","$applyNodeReplacement","$isImageNode","KeywordNode","$createKeywordNode","cursor","canInsertTextBefore","canInsertTextAfter","isTextEntity","keyword","$isKeywordNode","mentionStyle","MentionNode","mentionName","__mention","$createMentionNode","setTextContent","cssText","mentionNode","toggleDirectionless","$isMentionNode","joinClasses","args","filter","Boolean","join","Button","dataTestId","children","onClick","disabled","small","title","createUID","Math","random","replace","substr","createPollOption","uid","votes","cloneOption","option","Array","from","getTotalVotes","options","reduce","totalVotes","next","length","PollOptionComponent","index","withPollNode","clientID","useCollaborationContext","checkboxRef","useRef","votesArray","checkedIndex","indexOf","checked","ref","onChange","e","toggleVote","value","setOptionText","target","placeholder","deleteOption","PollComponent","question","editor","useLexicalComposerContext","useMemo","cb","update","$getNodeByKey","$isPollNode","addOption","map","convertPollElement","getAttribute","$createPollNode","PollNode","__question","__options","forEach","push","splice","clonedOption","votesClone","voteIndex","hasAttribute","elem","display","CAN_USE_DOM","window","useLayoutEffectImpl","useLayoutEffect","useEffect","url","URL","location","href","params","URLSearchParams","search","WEBSOCKET_ENDPOINT","WEBSOCKET_SLUG","WEBSOCKET_ID","get","createWebsocketProvider","id","yjsDocMap","doc","Doc","set","load","WebsocketProvider","connect","Context","createContext","historyState","current","redoStack","undoStack","useSharedHistoryContext","useContext","characterLimit","code","codeHighlight","atrule","attr","boolean","builtin","cdata","char","class","comment","constant","deleted","doctype","entity","function","important","inserted","namespace","number","operator","prolog","property","punctuation","regex","selector","string","symbol","tag","variable","hashtag","heading","h1","h2","h3","h4","h5","link","list","listitem","listitemChecked","listitemUnchecked","nested","olDepth","ul","ltr","mark","markOverlap","paragraph","quote","rtl","table","tableCell","tableCellHeader","bold","italic","strikethrough","subscript","superscript","underline","underlineStrikethrough","baseTheme","LexicalContentEditable","ContentEditable","Placeholder","positionSticky","stickyElem","positioning","rootElementRect","rectLeft","left","rectTop","top","y","x","StickyComponent","color","stickyContainerRef","positioningRef","isDragging","offsetX","offsetY","isCollab","position","stickyContainer","resizeObserver","ResizeObserver","entries","i","entry","getBoundingClientRect","removeRootListener","registerRootListener","nextRootElem","prevRootElem","unobserve","observe","handleWindowResize","rootElement","getRootElement","addEventListener","removeEventListener","setTimeout","setProperty","handlePointerMove","event","pageX","pageY","handlePointerUp","classList","remove","$isStickyNode","setPosition","handleDelete","handleColorChange","toggleColor","onPointerDown","button","stickContainer","clientX","clientY","add","preventDefault","LexicalNestedComposer","initialEditor","initialTheme","StickyEditorTheme","CollaborationPlugin","providerFactory","shouldBootstrap","HistoryPlugin","externalHistoryState","PlainTextPlugin","contentEditable","ErrorBoundary","LexicalErrorBoundary","StickyNode","__x","__y","__color","xOffset","yOffset","div","$setSelection","createPortal","body","isIsolated","$createStickyNode","TypeaheadNode","$createTypeaheadNode","YouTubeComponent","videoID","BlockWithAlignableContents","frameBorder","allow","allowFullScreen","YouTubeNode","DecoratorBlockNode","__id","__format","$createYouTubeNode","getId","_editor","embedBlockTheme","embedBlock","base","focus","isTopLevel","$isYouTubeNode","PlaygroundNodes","HeadingNode","ListNode","ListItemNode","QuoteNode","CodeNode","TableNode","TableCellNode","TableRowNode","HashtagNode","CodeHighlightNode","AutoLinkNode","LinkNode","OverflowNode","HorizontalRuleNode","MarkNode","resources","ar","de","en","EN","es","fr","FR","it","ja","nl","pl","pt","ptBr","PTBR","ru","RU","ukr","zh","languageDetector","async","detect","callback","language","navigator","substring","init","cacheUserLanguage","i18n","i18next","ns","fallbackLng","debug","interpolation","escapeValue","err","t","use","EditorComposer","initialEditorState","initialConfig","nodes","onError","error","PlaygroundEditorTheme","LexicalComposer","I18nextProvider","hostName","hostname","isDevPlayground","DEFAULT_SETTINGS","disableBeforeInput","emptyEditor","isAutocomplete","isCharLimit","isCharLimitUtf8","isRichText","measureTypingPerf","showNestedEditorTreeView","showTreeView","setOption","name","settings","useSettings","PortalImpl","onClose","closeOnClickOutside","modalRef","modalOverlayElement","handler","keyCode","clickOutsideHandler","contains","parentElement","role","tabIndex","Modal","useModal","modalContent","setModalContent","useState","useCallback","modal","content","showModal","getContent","HR","dependencies","export","$isHorizontalRuleNode","regExp","parentNode","_1","_2","isImport","line","$createHorizontalRuleNode","getNextSibling","insertBefore","selectNext","IMAGE","exportChildren","exportFormat","importRegExp","textNode","match","imageNode","trigger","TABLE_ROW_REG_EXP","TABLE","$isTableNode","output","row","getChildren","rowOutput","$isTableRowNode","cell","$isElementNode","matchCells","mapToTableCells","rows","sibling","getPreviousSibling","maxCells","$isParagraphNode","getChildrenSize","getFirstChild","$isTextNode","cells","getTextContent","max","unshift","previousSibling","$createTableNode","tableRow","$createTableRowNode","append","createTableCell","getTableColumnsSize","selectEnd","textContent","$createTableCellNode","TableCellHeaderStates","NO_STATUS","$createParagraphNode","$createTextNode","trim","split","PLAYGROUND_TRANSFORMERS","CHECK_LIST","ELEMENT_TRANSFORMERS","TEXT_FORMAT_TRANSFORMERS","TEXT_MATCH_TRANSFORMERS","getElement","getElementById","fontSize","transform","padding","background","borderRadius","useReport","timer","cleanup","clearTimeout","removeChild","console","log","innerHTML","SPEECH_TO_TEXT_COMMAND","createCommand","VOICE_COMMANDS","selection","insertParagraph","redo","dispatchCommand","REDO_COMMAND","undo","UNDO_COMMAND","SUPPORT_SPEECH_RECOGNITION","SpeechToTextPlugin","isEnabled","setIsEnabled","SpeechRecognition","webkitSpeechRecognition","recognition","report","continuous","interimResults","resultItem","results","item","resultIndex","transcript","isFinal","$getSelection","$isRangeSelection","command","toLowerCase","insertText","start","stop","registerCommand","_isEnabled","COMMAND_PRIORITY_EDITOR","ActionsPlugin","isEditable","setIsEditable","isSpeechToText","setIsSpeechToText","connected","setConnected","isEditorEmpty","setIsEditorEmpty","useTranslation","mergeRegister","registerEditableListener","editable","CONNECTED_COMMAND","payload","isConnected","registerUpdateListener","getEditorState","read","root","$getRoot","paragraphChildren","handleMarkdownToggle","$isCodeNode","getLanguage","$convertFromMarkdownString","markdown","$convertToMarkdownString","clear","$createCodeNode","importFile","exportFile","fileName","Date","toISOString","source","ShowClearDialog","setEditable","TOGGLE_CONNECT_COMMAND","CLEAR_EDITOR_COMMAND","URL_MATCHER","EMAIL_MATCHER","MATCHERS","exec","LexicalAutoLinkPlugin","AutoLinkPlugin","matchers","INSERT_INLINE_COMMAND","setPopupPosition","rect","pageYOffset","pageXOffset","offsetWidth","bottom","opacity","FloatingCharacterStylesEditor","isLink","isBold","isItalic","isUnderline","isCode","isStrikethrough","isSubscript","isSuperscript","popupCharStylesEditorRef","mouseDownRef","insertLink","TOGGLE_LINK_COMMAND","insertComment","updateCharacterStylesEditor","popupCharStylesEditorElem","nativeSelection","getSelection","isCollapsed","anchorNode","domRange","getRangeAt","firstElementChild","onResize","SELECTION_CHANGE_COMMAND","COMMAND_PRIORITY_LOW","FORMAT_TEXT_COMMAND","getSelectedNode","anchor","getNode","focusNode","isBackward","$isAtNodeEnd","useCharacterStylesPopup","isText","setIsText","setIsLink","setIsBold","setIsItalic","setIsUnderline","setIsStrikethrough","setIsSubscript","setIsSuperscript","setIsCode","updatePopup","hasFormat","parent","getParent","$isLinkNode","$isCodeHighlightNode","CharacterStylesPopupPlugin","ClickableLinkPlugin","newTab","hasMoved","prevOffsetX","prevOffsetY","onPointerUp","hasMovedDuringClick","linkDomNode","getLinkDomNode","linkNode","maybeLinkNode","$getNearestNodeFromDOMNode","open","metaKey","ctrlKey","prevRootElement","isLinkDomNode","nodeName","CodeHighlightPlugin","registerCodeHighlighting","KEYWORDS_REGEX","KeywordsPlugin","hasNodes","Error","createKeywordNode","getKeywordMatch","matchArr","hashtagLength","startOffset","endOffset","end","useLexicalTextEntity","getElementNodesInSelection","nodesInSelection","getNodes","Set","getParentOrThrow","n","isIndentPermitted","maxDepth","elementNodesInSelection","totalDepth","elementNode","$isListNode","$getListDepth","$isListItemNode","ListMaxIndentLevelPlugin","INDENT_CONTENT_COMMAND","COMMAND_PRIORITY_CRITICAL","MarkdownPlugin","MarkdownShortcutPlugin","transformers","TAB_TO_FOCUS_INTERVAL","lastTabKeyDownTimestamp","hasRegisteredKeyDownListener","registerKeyTimeStampTracker","timeStamp","TabFocusPlugin","FOCUS_COMMAND","EditorContext","DialogButtonsList","DialogActions","FileInput","accept","label","files","TextInput","getDOMSelection","targetWindow","INSERT_IMAGE_COMMAND","InsertImageUriDialogBody","setSrc","setAltText","isDisabled","InsertImageUploadedDialogBody","loadImage","reader","FileReader","onload","result","readAsDataURL","InsertImageDialog","activeEditor","hasModifier","altKey","ImagesPlugin","$insertNodes","$isRootOrShadowRoot","$wrapNodeInElement","DRAGSTART_COMMAND","onDragStart","COMMAND_PRIORITY_HIGH","DRAGOVER_COMMAND","onDragover","DROP_COMMAND","onDrop","TRANSPARENT_IMAGE","getImageNodeInSelection","dataTransfer","setData","setDragImage","JSON","stringify","data","canDropImage","getDragImageData","range","getDragSelection","rangeSelection","$createRangeSelection","applyDOMRange","$isNodeSelection","dragData","getData","parse","HTMLElement","closest","nodeType","defaultView","ownerDocument","domSelection","caretRangeFromPoint","rangeParent","collapse","rangeOffset","ACCEPTABLE_IMAGE_TYPES","DragDropPaste","DRAG_DROP_PASTE","filesResult","mediaFileReader","flatMap","file","isMimeType","Editor","hashtagsEnabled","autoFocusEnabled","autoLinkEnabled","emojisEnabled","actionsEnabled","speechToTextEnabled","listMaxIndent","locale","setActiveEditor","editorStateRef","placeholderComponent","changeLanguage","Provider","AutoFocusPlugin","ClearEditorPlugin","HashtagPlugin","RichTextPlugin","OnChangePlugin","ListPlugin","CheckListPlugin","LinkPlugin","ToolbarContext","DropDown","buttonLabel","buttonAriaLabel","buttonClassName","buttonIconClassName","stopCloseOnClickSelf","dropDownRef","buttonRef","showDropDown","setShowDropDown","dropDown","min","innerWidth","handle","Divider","AlignDropdown","isRTL","FORMAT_ELEMENT_COMMAND","OUTDENT_CONTENT_COMMAND","IS_APPLE","test","platform","UndoButton","canUndo","RedoButton","canRedo","Select","CODE_LANGUAGE_OPTIONS","CodeLanguageDropdown","selectedElementKey","codeLanguage","onCodeLanguageSelect","setLanguage","BlockFormatDropdown","blockType","formatParagraph","$wrapNodes","formatHeading","headingSize","$createHeadingNode","formatBulletList","INSERT_UNORDERED_LIST_COMMAND","REMOVE_LIST_COMMAND","formatCheckList","INSERT_CHECK_LIST_COMMAND","formatNumberedList","INSERT_ORDERED_LIST_COMMAND","formatQuote","$createQuoteNode","formatCode","codeNode","removeText","insertNodes","insertRawText","supportedBlockTypes","CODE_LANGUAGE_MAP","javascript","md","plaintext","python","ToolbarPlugin","defaultFontSize","defaultFontColor","defaultBgColor","defaultFontFamily","disableBlockTypeSelect","alignExists","AlignComponent","useChild","setBlockType","setSelectedElementKey","setFontSize","fontColor","setFontColor","bgColor","setBgColor","fontFamily","setFontFamily","setCanUndo","setCanRedo","setIsRTL","setCodeLanguage","updateToolbar","getTopLevelElementOrThrow","elementKey","elementDOM","getElementByKey","$isParentElementRTL","parentList","$getNearestNodeOfType","getListType","$isHeadingNode","getTag","$getSelectionStyleValueForProperty","font","_payload","newEditor","CAN_UNDO_COMMAND","CAN_REDO_COMMAND","applyStyleText","styles","Object","$patchStyleText","has","PUNCTUATION","NAME","DocumentMentionsRegex","CapitalizedNameMentionsRegex","RegExp","PUNC","TRIGGERS","VALID_CHARS","VALID_JOINS","LENGTH_LIMIT","AtSignMentionsRegex","ALIAS_LENGTH_LIMIT","AtSignMentionsRegexAliasRegex","SUGGESTION_LIST_LENGTH_LIMIT","mentionsCache","Map","useMentionLookupService","mentionString","mentionData","setResults","cachedResults","then","checkForCapitalizedNameMentions","minMatchLength","maybeLeadingWhitespace","matchingString","leadOffset","replaceableString","checkForAtSignMentions","getPossibleQueryMatch","MentionTypeaheadOption","TypeaheadOption","picture","MentionsTypeaheadMenuItem","isSelected","onMouseEnter","setRefElement","MentionsPlugin","props","searchData","getTypeaheadValues","queryString","setQueryString","checkForSlashTriggerMatch","useBasicTypeaheadTriggerMatch","minLength","slice","onSelectOption","selectedOption","nodeToReplace","closeMenu","$createAutoLinkNode","select","checkForMentionMatch","mentionMatch","slashMatch","LexicalTypeaheadMenuPlugin","onQueryChange","triggerFn","menuRenderFn","anchorElementRef","selectedIndex","selectOptionAndCleanUp","setHighlightedIndex","ReactDOM","basicColors","WIDTH","HEIGHT","ColorPicker","rest","selfColor","setSelfColor","transformColor","saturationPosition","hsv","s","v","huePosition","h","onMoveSaturation","newHsv","newColor","onMoveHue","hex","basicColor","backgroundColor","MoveWrapper","divRef","move","clamp","onMouseDown","onMouseMove","_e","onMouseUp","toHex","startsWith","ctx","getContext","fillStyle","hex2rgb","rbgArr","m","r","g","b","parseInt","rgb2hsv","d","hsv2rgb","f","p","q","round","rgb2hex","padStart","rgb","BackgroundColorPicker","onBgColorSelect","BoldButton","CodeFormatButton","PREVIEW_CACHE","useSuspenseRequest","cached","preview","fetch","encodeURI","response","json","catch","Promise","LinkPreviewContent","domain","description","Glimmer","animationDelay","LinkPreview","positionEditorElement","FloatingLinkEditor","editorRef","inputRef","linkUrl","setLinkUrl","isEditMode","setEditMode","lastSelection","setLastSelection","updateLinkEditor","getURL","editorElem","activeElement","onKeyDown","rel","defaultFontFamilyOptions","FontFamilyDropdown","fontOptions","onFontFamilySelect","defaultFontSizeOptions","FontSizeDropdown","fontSizeOptions","onFontSizeSelect","INSERT_POLL_COMMAND","PollPlugin","pollNode","$isRootNode","INSERT_YOUTUBE_COMMAND","YouTubePlugin","youTubeNode","insertAfter","paragraphNode","MIN_ROW_HEIGHT","MIN_COLUMN_WIDTH","TableCellResizer","targetRef","resizerRef","tableRectRef","mouseStartPosRef","mouseCurrentPos","updateMouseCurrentPos","activeCell","updateActiveCell","isSelectingGrid","updateIsSelectingGrid","draggingDirection","updateDraggingDirection","isGridSelection","DEPRECATED_$isGridSelection","resetState","getCellFromTarget","tableCellNode","tableNode","$getTableNodeFromLexicalNodeOrThrow","tableElement","isHeightChanging","direction","updateRowHeight","newHeight","$isTableCellNode","tableRowIndex","$getTableRowIndexFromTableCellNode","tableRows","setHeight","updateColumnWidth","newWidth","tableColumnIndex","$getTableColumnIndexFromTableCellNode","tableCells","setWidth","toggleResize","stopPropagation","heightChange","abs","isShrinking","widthChange","getResizers","right","tableRect","resizerStyles","TableCellResizerPlugin","TableActionMenu","_tableCellNode","setIsMenuOpen","contextRef","updateTableCellNode","selectionCounts","updateSelectionCounts","columns","registerMutationListener","nodeMutations","nodeUpdated","selectionShape","getShape","toX","fromX","toY","fromY","menuButtonElement","dropDownElement","menuButtonRect","handleClickOutside","clearTableSelection","isAttached","tableSelection","getTableSelectionFromTableElement","clearHighlight","markDirty","insertTableRowAtSelection","shouldInsertAfter","grid","$getElementGridForTableNode","$insertTableRow","insertTableColumnAtSelection","$insertTableColumn","deleteTableRowAtSelection","$removeTableRowAtIndex","deleteTableAtSelection","deleteTableColumnAtSelection","$deleteTableColumn","toggleTableRowIsHeader","toggleHeaderStyle","ROW","toggleTableColumnIsHeader","COLUMN","__headerState","TableCellActionMenuContainer","menuButtonRef","menuRootRef","isMenuOpen","setTableMenuCellNode","moveMenu","menu","tableCellNodeFromSelection","$getTableCellNodeFromLexicalNode","tableCellParentNodeDOM","menuButtonDOM","tableCellNodeDOM","tableCellRect","menuRect","prevTableCellDOM","TableActionMenuPlugin","HorizontalRulePlugin","INSERT_HORIZONTAL_RULE_COMMAND","horizontalRuleNode","YOUTUBE_ID_PARSER","parseYouTubeVideoID","urlMatches","InsertTableDialog","setRows","setColumns","INSERT_TABLE_COMMAND","InsertPollDialog","setQuestion","InsertYouTubeDialog","setText","InsertDropdown","enableTable","enableImage","enable","enableYoutube","enablePoll","enableHorizontalRule","enableStickyNote","TablePlugin","TableCellActionMenuPlugin","stickyNode","InsertLinkButton","ItalicButton","TextColorPicker","onFontColorSelect","TextFormatDropdown","UnderlineButton","imageCache","useSuspenseImage","resolve","Image","LazyImage","imageRef"],"mappings":"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"}